!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,i){"use strict";function s(e){if(l[e])return l[e].message;console.log("missing i18n "+e)}function n(e){var t=o();l=c[t]}function o(){var e=navigator.language||navigator.userLanguage;return 5==e.length&&(e=e.substr(0,3)+e.substr(3,5).toUpperCase()),(""===e||"en-US"!=e&&"zh-TW"!=e)&&(e="en-US"),e=e.replace("-","_")}Object.defineProperty(t,"__esModule",{value:!0}),t.i18n=s,t.setupI18n=n,t.getLang=o;var r=i(14),a=i(15),c={};c.en_US=r.en_US,c.zh_TW=a.zh_TW;var l={}},function(e,t,i){"use strict";function s(e,t,i){return e?{timer:setInterval(t,i),cancel:function(){clearInterval(this.timer)}}:{timer:setTimeout(t,i),cancel:function(){clearTimeout(this.timer)}}}function n(e){for(var t=window.location.search.substring(1),i=t.split("&"),s=0;s<i.length;s++){var n=i[s].split("=");if(n[0]==e)return decodeURIComponent(n[1])}return null}function o(e,t){switch(e){case DUMP_TYPE_LOG:console.log(t);break;case DUMP_TYPE_WARN:console.warn(t);break;case DUMP_TYPE_ERROR:console.error(t);break;default:console.log(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.setTimer=s,t.getQueryVariable=n,t.dumpLog=o},function(e,t,i){"use strict";function s(){}Object.defineProperty(t,"__esModule",{value:!0}),t.Event=s,s.mixin=function(e){for(var t in s.prototype)e[t]=s.prototype[t]},s.prototype.addEventListener=function(e,t){this._listeners=this._listeners||{},(this._listeners[e]=this._listeners[e]||[]).push(t)},s.prototype.dispatchEvent=function(e){this._listeners=this._listeners||{};var t=this._listeners[e.type];if(t){t=t.slice(0);for(var i in t)t[i](e)}},s.prototype.removeEventListener=function(e,t){this._listeners=this._listeners||{};var i=this._listeners[e];if(i)for(var s in i)if(i[s]===t){i.splice(s,1);break}}},function(e,t,i){"use strict";function s(e){this.ch=e,this.resetAttr(),this.needUpdate=!1,this.isLeadByte=!1,this.startOfURL=!1,this.endOfURL=!1,this.partOfURL=!1,this.partOfKeyWord=!1,this.keyWordColor="#ff0000",this.fullurl=""}function n(){this.html=""}function o(e,t){for(this.cols=e,this.rows=t,this.view=null,this.cur_x=0,this.cur_y=0,this.cur_x_sav=-1,this.cur_y_sav=-1,this.scrollStart=0,this.scrollEnd=t-1,this._nowHighlight=-1,Object.defineProperty(this,"nowHighlight",{set:this.setHighlight.bind(this),get:function(){return this._nowHighlight}.bind(this)}),this.tempMouseCol=0,this.tempMouseRow=0,this.mouseCursor=0,this.highlightCursor=!0,this.useMouseBrowsing=!0,this.attr=new s(" "),this.newChar=new s(" "),this.disableLinefeed=!1,this.altScreen="",this.changed=!1,this.posChanged=!1,this.pageState=0,this.forceFullWidth=!1,this.enableDeleteDupLogin=!1,this.deleteDupLogin=!1,this.startedEasyReading=!1,this.easyReadingShowReplyText=!1,this.easyReadingShowPushInitText=!1,this.prevPageState=0,this.lines=new Array(t),this.linesX=new Array(0),this.linesY=new Array(0),this.pageLines=[],this.pageWrappedLines=[],this.outputhtmls=new Array(t),this.lineChangeds=new Array(t),this.viewBufferTimer=30;--t>=0;){for(var i=new Array(e),o=new Array(e),r=e;--r>=0;)i[r]=new s(" "),o[r]=new n;this.lines[t]=i,this.outputhtmls[t]=o}this.BBSWin=document.getElementById("BBSWindow")}Object.defineProperty(t,"__esModule",{value:!0}),t.termInvColors=void 0,t.TermBuf=o;var r=i(2),a=i(4),c=(t.termInvColors=["#FFFFFF","#7FFFFF","#FF7FFF","#7F7FFF","#FFFF7F","#7FFF7F","#FF7F7F","#3F3F3F","#7F7F7F","#00FFFF","#FF00FF","#0000FF","#FFFF00","#00FF00","#FF0000","#000000"],["auto","url(cursor/back.png) 0 6,auto","url(cursor/pageup.png) 6 0,auto","url(cursor/pagedown.png) 6 21,auto","url(cursor/home.png) 0 0,auto","url(cursor/end.png) 0 0,auto","pointer","default","url(cursor/prevous.png) 6 0,auto","url(cursor/next.png) 6 0,auto","url(cursor/first.png) 0 0,auto","auto","url(cursor/refresh.png) 0 0,auto","url(cursor/last.png) 0 0,auto","url(cursor/last.png) 0 0,auto"]);s.defaultFg=7,s.defaultBg=0,s.prototype={copyFrom:function(e){this.ch=e.ch,this.isLeadByte=e.isLeadByte,this.copyAttr(e)},copyAttr:function(e){this.fg=e.fg,this.bg=e.bg,this.bright=e.bright,this.invert=e.invert,this.blink=e.blink,this.underLine=e.underLine},resetAttr:function(){this.fg=7,this.bg=0,this.bright=!1,this.invert=!1,this.blink=!1,this.underLine=!1},getFg:function(){return this.invert?this.bright?this.bg+8:this.bg:this.bright?this.fg+8:this.fg},getBg:function(){return this.invert?this.fg:this.bg},getColor:function(){return new a.ColorState(this.getFg(),this.getBg(),this.blink)},isUnderLine:function(){return this.underLine},isStartOfURL:function(){return this.startOfURL},isEndOfURL:function(){return this.endOfURL},isPartOfURL:function(){return this.partOfURL},isPartOfKeyWord:function(){return this.partOfKeyWord},getKeyWordColor:function(){return this.keyWordColor},getFullURL:function(){return this.fullurl}},n.prototype={setHtml:function(e){this.html=e},addHtml:function(e){this.html+=e},getHtml:function(){return this.html}},o.prototype={timerUpdate:null,uriRegEx:/((ftp|http|https|telnet):\/\/([A-Za-z0-9_]+:{0,1}[A-Za-z0-9_]*@)?([A-Za-z0-9_#!:.?+=&%@!\-\/\$\^,;|*~'()]+)(:[0-9]+)?(\/|\/([A-Za-z0-9_#!:.?+=&%@!\-\/]))?)|(pid:\/\/(\d{1,10}))/gi,setView:function(e){this.view=e},puts:function(e){if(e){for(var t=this.cols,i=(this.rows,this.lines),s=e.length,n=i[this.cur_y],o=0;o<s;++o){var r=e[o];switch(r){case"":continue;case"\b":this.back();continue;case"\r":this.carriageReturn();continue;case"\n":case"\f":case"\v":this.lineFeed(),n=i[this.cur_y];continue;case"\0":continue}switch(this.cur_x>=t&&(this.disableLinefeed||this.lineFeed(),this.cur_x=0,n=i[this.cur_y],this.posChanged=!0),r){case"\t":this.tab();break;default:var a=n[this.cur_x];a.ch=r,a.copyAttr(this.attr),a.needUpdate=!0,++this.cur_x,a.isLeadByte&&(n[this.cur_x].needUpdate=!0),"UTF-8"==this.view.charset&&this.isFullWidth(r)&&this.cur_x<t&&(a=n[this.cur_x],a.ch="",a.copyAttr(this.attr),a.needUpdate=!0,++this.cur_x),this.changed=!0,this.posChanged=!0}}this.queueUpdate()}},updateCharAttr:function(){for(var e=this.cols,t=this.rows,i=this.lines,s=0;s<t;++s){for(var n=i[s],o=!1,r=0;r<e;++r){var a=n[r];if(a.needUpdate&&(o=!0),this.isFullWidth(a.ch)&&r+1<e){a.isLeadByte=!0,++r;var c=a;a=n[r],a.needUpdate&&(o=!0),c.needUpdate!=a.needUpdate&&(c.needUpdate=a.needUpdate=!0)}else if(a.isleadbyte&&r+1<e){var l=n[r+1];l.needUpdate=!0}a.isLeadByte=!1}if(o){if(this.lineChangeds[s]=!0,n.uris){for(var h=n.uris,u=h.length,p=0;p<u;++p){var d=h[p];n[d[0]].startOfURL=!1,n[d[0]].endOfURL=!1,n[d[0]].fullurl="",n[d[1]-1].startOfURL=!1,n[d[1]-1].endOfURL=!1,n[d[1]-1].fullurl="";for(var r=d[0];r<d[1];++r)n[r].partOfURL=!1,n[r].needUpdate=!0}n.uris=null}for(var f="",r=0;r<e;++r)f+=n[r].ch;if("UTF-8"!=this.view.charset)f=f.replace(/[^\x00-\x7f]./g,"«Í");else{for(var m="",g=0;g<f.length;++g)m+=f.charAt(g),this.isFullWidth(f.charAt(g))&&(m+=f.charAt(g));f=m}for(var b,h=null;null!==(b=this.uriRegEx.exec(f));){h||(h=[]);var d=[b.index,b.index+b[0].length];h.push(d)}if(h&&(n.uris=h),n.uris)for(var h=n.uris,u=h.length,p=0;p<u;++p){for(var d=h[p],v="",r=d[0];r<d[1];++r)v+=n[r].ch,n[r].partOfURL=!0,n[r].needUpdate=!0;var y;if("UTF-8"!=this.view.charset)y=v;else{for(var m="",g=0;g<v.length;++g)m+=v.charAt(g),this.isFullWidth(v.charAt(g))&&(m+=v.charAt(g));y=m}var w=v.toLowerCase();n[d[0]].startOfURL=!0,"pid://"==w.substr(0,6)?n[d[0]].fullurl="http://www.pixiv.net/member_illust.php?mode=big&illust_id="+w.substr(6,15):n[d[0]].fullurl=y,n[d[1]-1].endOfURL=!0}}}},clear:function(e){var t=this.rows,i=this.cols,s=this.lines;switch(e){case 0:var n,o,r=s[this.cur_y];for(n=this.cur_x;n<i;++n)r[n].copyFrom(this.newChar),r[n].needUpdate=!0;for(o=this.cur_y;o<t;++o)for(r=s[o],n=0;n<i;++n)r[n].copyFrom(this.newChar),r[n].needUpdate=!0;break;case 1:var r,n,o;for(o=0;o<this.cur_y;++o)for(r=s[o],n=0;n<i;++n)r[n].copyFrom(this.newChar),r[n].needUpdate=!0;for(r=s[this.cur_y],n=0;n<this.cur_x;++n)r[n].copyFrom(this.newChar),r[n].needUpdate=!0;break;case 2:for(;--t>=0;)for(var n=i,r=s[t];--n>=0;)r[n].copyFrom(this.newChar),r[n].needUpdate=!0}this.changed=!0,this.gotoPos(0,0),this.queueUpdate()},back:function(){this.cur_x>0&&(--this.cur_x,this.posChanged=!0,this.queueUpdate())},tab:function(e){var t=this.cur_x%4;this.cur_x+=4-t,e>1&&(this.cur_x+=4*(e-1)),this.cur_x>=this.cols&&(this.cur_x=this.cols-1),this.posChanged=!0,this.queueUpdate()},backTab:function(e){var t=this.cur_x%4;this.cur_x-=t>0?t:4,e>1&&(this.cur_x-=4*(e-1)),this.cur_x<0&&(this.cur_x=0),this.posChanged=!0,this.queueUpdate()},insert:function(e){var t=this.lines[this.cur_y],i=this.cols,s=this.cur_x;if(s>0&&t[s-1].isLeadByte&&++s,s!=i){if(s+e>=i)for(var n=s;n<i;++n)t[n].copyFrom(this.newChar),t[n].needUpdate=!0;else{for(;--e>=0;){var o=t.pop();t.splice(s,0,o),o.copyFrom(this.newChar)}for(var n=s;n<i;++n)t[n].needUpdate=!0}this.changed=!0,this.queueUpdate()}},del:function(e){var t=this.lines[this.cur_y],i=this.cols,s=this.cur_x;if(s>0&&t[s-1].isLeadByte&&++s,s!=i){if(s+e>=i)for(var n=s;n<i;++n)t[n].copyFrom(this.newChar),t[n].needUpdate=!0;else{for(var o=i-s-e;--o>=0;)t.splice(s,0,t.pop());for(var n=i-e;n<i;++n)t[n].copyFrom(this.newChar);for(var n=s;n<i;++n)t[n].needUpdate=!0}this.changed=!0,this.queueUpdate()}},eraseChar:function(e){var t=this.lines[this.cur_y],i=this.cols,s=this.cur_x;if(s>0&&t[s-1].isLeadByte&&++s,s!=i){for(var n=s+e>i?i:s+e,o=s;o<n;++o)t[o].copyFrom(this.newChar),t[o].needUpdate=!0;this.changed=!0,this.queueUpdate()}},eraseLine:function(e){var t=this.lines[this.cur_y],i=this.cols;switch(e){case 0:for(var s=this.cur_x;s<i;++s)t[s].copyFrom(this.newChar),t[s].needUpdate=!0;break;case 1:for(var n=this.cur_x,s=0;s<n;++s)t[s].copyFrom(this.newChar),t[s].needUpdate=!0;break;case 2:for(var s=0;s<i;++s)t[s].copyFrom(this.newChar),t[s].needUpdate=!0;break;default:return}this.changed=!0,this.queueUpdate()},deleteLine:function(e){var t=this.scrollStart;this.scrollStart=this.cur_y,this.scroll(!1,e),this.scrollStart=t,this.changed=!0,this.queueUpdate()},insertLine:function(e){var t=this.scrollStart;this.cur_y<this.scrollEnd&&(this.scrollStart=this.cur_y,this.scroll(!0,e)),this.scrollStart=t,this.changed=!0,this.queueUpdate()},scroll:function(e,t){var i=this.scrollStart,s=this.scrollEnd;if(s<=i&&(i=0,s<1&&(s=this.rows-1)),t>=this.rows)this.clear(2);else if(t>=s-i+1)for(var n=this.lines,o=this.cols,r=i;r<=s;++r)for(var a=0;a<o;++a)n[r][a].copyFrom(this.newChar),n[r][a].needUpdate=!0;else{var n=this.lines,c=this.rows,o=this.cols;if(e){for(var l=0;l<c-1-s;++l)n.unshift(n.pop());for(;--t>=0;){var h=n.pop();n.splice(c-1-s+i,0,h);for(var a=0;a<o;++a)h[a].copyFrom(this.newChar)}for(var l=0;l<c-1-s;++l)n.push(n.shift())}else{for(var l=0;l<i;++l)n.push(n.shift());for(;--t>=0;){var h=n.shift();n.splice(s-i,0,h);for(var a=0;a<o;++a)h[a].copyFrom(this.newChar)}for(var l=0;l<i;++l)n.unshift(n.pop())}for(var r=i;r<=s;++r)for(var h=n[r],a=0;a<o;++a)h[a].needUpdate=!0}this.changed=!0,this.queueUpdate()},gotoPos:function(e,t){e>=this.cols&&(e=this.cols-1),t>=this.rows&&(t=this.rows-1),e<0&&(e=0),t<0&&(t=0),this.cur_x=e,this.cur_y=t,this.posChanged=!0,this.queueUpdate()},carriageReturn:function(){this.cur_x=0,this.posChanged=!0,this.queueUpdate()},lineFeed:function(){this.cur_y<this.scrollEnd?(++this.cur_y,this.posChanged=!0,this.queueUpdate()):this.scroll(!1,1)},queueUpdate:function(e){if(!this.timerUpdate){var t=this,i=function(){t.notify()};this.timerUpdate=e?setTimeout(i,1):setTimeout(i,30)}},notify:function(e){if(clearTimeout(this.timerUpdate),this.timerUpdate=null,this.changed){if(this.updateCharAttr(),this.setPageState(),this.useMouseBrowsing&&this.clearHighlight(),this.enableDeleteDupLogin&&0===this.pageState){var t="\r",i=this.getRowText(22,0,this.cols),s=this.getRowText(21,0,this.cols);i.parseDuplicatedLoginTextLastRow()&&s.parseDuplicatedLoginText()&&(this.deleteDupLogin||(t="n"+t),this.view.conn.send(t))}this.dispatchEvent(new CustomEvent("change")),this.view&&this.view.update(),this.changed=!1,this.dispatchEvent(new CustomEvent("viewUpdate"))}if(this.posChanged&&(this.view&&this.view.updateCursorPos(),this.posChanged=!1),this.view.blinkOn){this.view.blinkOn=!1,this.view.blinkShow=!this.view.blinkShow;for(var n=document.getElementsByTagName("x"),o=0;o<n.length;o++){var r=this.view.blinkShow&&this.view.doBlink?n[o].getAttribute("h"):n[o].getAttribute("s");n[o].parentNode.setAttribute("class",r)}}},getText:function(e,t,i,s,n,o,r){var a="";if(a=r?r[e]:this.lines[e],t==this.cols)return"";if(t>0?!a[t].isLeadByte&&a[t-1].isLeadByte&&t--:t=0,i>0?a[i-1].isLeadByte&&i++:i=this.cols,t>=i)return"";if(this.view){var c=this.view.charset;if(s){for(var l=this.ansiCmp(this.newChar,a[t],o),h=t;h<i-1;++h)n&&a[h].isLeadByte&&this.ansiCmp(a[h],a[h+1])?l+=this.ansiCmp(a[h],a[h+1]).replace(/m$/g,";50m")+a[h].ch:l+=a[h].ch+this.ansiCmp(a[h],a[h+1]);return l+=a[i-1].ch+this.ansiCmp(a[i-1],this.newChar),n&&"UTF-8"!=c?l.b2u():l}return a=a.slice(t,i),a.map(function(e,t,i){if(!e.isLeadByte){if(t>=1&&i[t-1].isLeadByte){var s=i[t-1],n=s.ch+e.ch;return this.view&&"UTF-8"==this.view.charset||1==n.length?n:n.b2u()}return e.ch}}).join("")}},findText:function(e,t){var i={col:-1,row:-1},s=0,n=this.cols-1;t>=0&&(s=n=t);for(var o=s;o<=n;++o){var r=this.getText(o,0,this.cols,!1,!0);if(i.col=r.indexOf(e),i.col>=0){i.row=o;break}}return i},getRowText:function(e,t,i,s){var n="";n=s?s[e]:this.lines[e],t>0?!n[t].isLeadByte&&n[t-1].isLeadByte&&t--:t=0,i<this.cols?n[i].isLeadByte&&i++:i=this.cols,n=n.slice(t,i);var o=(this.view.charset,this);return n.map(function(e,t,i){if(!e.isLeadByte){if(t>=1&&i[t-1].isLeadByte){var s=i[t-1],n=s.ch+e.ch;return o.view&&"UTF-8"==o.view.charset||1==n.length?n:n.b2u()}return e.ch}}).join("")},parseText:function(e){for(var t=e.split("^"),i=t[0],s=1;s<t.length;++s)t[s].length>0?(i+=String.fromCharCode(t[s].charCodeAt(0)-64),i+=t[s].substr(1)):s<t.length-1?i+="^"+t[++s]:i+="^";return i},ansiCmp:function(e,t,i){var n="",o=i;(e.bright&&!t.bright||e.underLine&&!t.underLine||e.blink&&!t.blink||e.invert&&!t.invert)&&(o=!0),o&&(n=";"),!o&&e.bright||!t.bright||(n+="1;"),!o&&e.underLine||!t.underLine||(n+="4;"),!o&&e.blink||!t.blink||(n+="5;"),!o&&e.invert||!t.invert||(n+="7;");var r=s.defaultFg,a=s.defaultBg,c=-1==t.fg?r:t.fg,l=-1==e.fg?r:e.fg,h=-1==t.bg?a:t.bg,u=-1==e.bg?a:e.bg;return(o?c!=r:l!=c)&&(n+="3"+c+";"),(o?h!=a:u!=h)&&(n+="4"+h+";"),n?"["+n.substr(0,n.length-1)+"m":""},isFullWidth:function(e){var t=e.charCodeAt(0);return"UTF-8"!=this.view.charset||this.forceFullWidth?t>127:t>=4352&&t<=4447||t>=9001&&t<=9002||t>=11904&&t<=12350||t>=12352&&t<=42191||t>=44032&&t<=55203||t>=63744&&t<=64255||t>=65072&&t<=65135||t>=65280&&t<=65376||t>=65504&&t<=65510},isTextWrappedRow:function(e){var t=this.getRowText(e,0,this.cols),i=t.lastIndexOf("\\");if(i>0){var s=t.substr(0,i).u2b().length;if(77!=s&&78!=s)return!1;var n=this.lines[e][s];if(7==n.fg&&0===n.bg&&n.bright)return!0}return!1},setPageState:function(){var e=this.getRowText(23,0,this.cols);if(e.indexOf("請按任意鍵繼續")>0||e.indexOf("請按 空白鍵 繼續")>0)return void(this.pageState=5);if(0===e.indexOf(" 編輯文章  (^Z/F1)說明 (^P/^G)插入符號/範本 (^X/^Q)離開"))return void(this.pageState=6);if(e.parseStatusRow())return void(this.pageState=3);var t=this.getRowText(0,0,this.cols);if(this.isUnicolor(0,0,29)&&this.isUnicolor(0,60,70)){var i=t.indexOf("【主功能表】"),s=t.indexOf("【分類看板】"),n=t.indexOf("【精華文章】");0===i||0===s||0===n||e.parseListRow()?this.pageState=1:this.isUnicolor(2,0,70)&&!this.isLineEmpty(1)&&(this.cur_x<19||23==this.cur_y)&&(this.pageState=2)}else this.isUnicolor(23,28,53)&&23==this.cur_y&&79==this.cur_x&&(this.pageState=5);1!=this.pageState&&this.isLineEmpty(23)&&(this.pageState=0)},isPttZArea:function(){var e=this.lines;if("UTF-8"!=this.view.charset){for(var t=e[0],i="¡iºëµØ¤å³¹¡j",s=0;s<=11;++s)if(t[s].ch!=i.charAt(s))return!1;t=e[23];for(var n="¡i¥\\¯àÁä¡j",s=1;s<=10;++s)if(t[s].ch!=n.charAt(s-1))return!1}else{for(var t=e[0],o="",s=0;s<=11;s+=2)o+=t[s].ch;if(o!=this.PTTZSTR1)return!1;t=e[23],o="";for(var s=1;s<=10;s+=2)o+=t[s].ch;if(o!=this.PTTZSTR2)return!1}return!0},isUnicolor:function(e,t,i){for(var s=this.lines,n=s[e],o=n[t].getBg(),r=t;r<i;r++){var a=n[r].getBg();if(a!=o||0===a)return!1}return!0},isLineEmpty:function(e){for(var t=(this.rows,this.lines),i=t[e],s=0;s<this.cols;s++)if(" "!=i[s].ch||i[s].getBg())return!1;return!0},onMouse_move:function(e,t,i){switch(this.tempMouseCol=e,this.tempMouseRow=t,(this.nowHighlight!=t||i)&&this.clearHighlight(),this.pageState){case 0:this.mouseCursor=0;break;case 4:t>1&&t<22?e<=6?(this.mouseCursor=1,this.clearHighlight()):e>=64?(this.mouseCursor=t>12?3:2,this.clearHighlight()):this.isLineEmpty(t)?this.mouseCursor=11:(this.mouseCursor=6,this.nowHighlight=t):this.mouseCursor=1==t||2==t?2:0===t?4:5;break;case 2:t>2&&t<23?e<=6?(this.mouseCursor=1,this.clearHighlight()):e>=64?(this.mouseCursor=t>12?3:2,this.clearHighlight()):this.isLineEmpty(t)?this.mouseCursor=11:(this.mouseCursor=6,this.nowHighlight=t):this.mouseCursor=1==t||2==t?e<2?8:e>75?9:2:0===t?e<2?10:e>75?9:4:e<2?12:e>75?13:5;break;case 3:this.mouseCursor=23==t?e<2?12:e>75?14:5:0===t?e<2?10:e>75?9:e<7?1:2:1==t||2==t?e<2?8:e>75?9:e<7?1:2:e<7?1:t<12?2:3;break;case 1:this.mouseCursor=t>0&&t<23?e>7?7:1:0;break;default:this.mouseCursor=0}this.BBSWin.style.cursor=c[this.mouseCursor]},resetMousePos:function(){this.useMouseBrowsing&&this.onMouse_move(this.tempMouseCol,this.tempMouseRow,!0)},setHighlight:function(e){this._nowHighlight=e,this.view.setHighlightedRow(e)},clearHighlight:function(){this.nowHighlight=-1,this.mouseCursor=0}},r.Event.mixin(o.prototype)},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t,i,s,n){return ReactDOM.render(React.createElement(g,{chars:e,row:t,forceWidth:i,showsLinkPreviews:s}),n)}Object.defineProperty(t,"__esModule",{value:!0}),t.ColorState=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();t.renderRowHtml=r;var c=i(12),l=i(5),h=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){return React.createElement("a",{scol:this.props.col,srow:this.props.row,className:"y",href:this.props.href,rel:"noreferrer",target:"_blank"},this.props.inner)}}]),t}(React.Component),u=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){var e=["q"+this.props.colorState.fg,"b"+this.props.colorState.bg].join(" "),t="";return this.props.colorState.blink&&(t=React.createElement("x",{s:e,h:"qq"+this.props.colorState.bg})),React.createElement("span",{className:e},t,this.props.inner)}}]),t}(React.Component),p=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){return React.createElement("span",null,this.props.text)}}]),t}(React.Component),d=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){var e={display:"inline-block"};return this.props.forceWidth&&(e.width=this.props.forceWidth.toString()+"px"),React.createElement("span",{className:"wpadding",style:e},this.props.inner)}}]),t}(React.Component),f=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){var e=this.props.colorLead,t=this.props.colorTail,i=[];e.fg==t.fg?i.push("q"+e.fg):(i.push("w"+e.fg),i.push("q"+t.fg),i.push("o")),e.bg==t.bg?i.push("b"+e.bg):i.push("b"+e.bg+"b"+t.bg);var s={};return this.props.forceWidth&&(i.push("wpadding"),s.display="inline-block",s.width=this.props.forceWidth.toString()+"px"),React.createElement("span",{className:i.join(" "),style:s,"data-text":this.props.text},this.props.text)}}]),t}(React.Component),m=(t.ColorState=function(){function e(t,i,n){s(this,e),this.fg=t,this.bg=i,this.blink=n}return a(e,[{key:"equals",value:function(t){return t instanceof e&&(this.fg==t.fg&&this.bg==t.bg&&this.blink==t.blink)}}]),e}(),function(){function e(t){s(this,e),this.segs=[],this.curr=null,this.currCol=t}return a(e,[{key:"_isLastSegmentSameColor",value:function(e){return this.curr&&this.curr.colorState.equals(e)}},{key:"_addSegment",value:function(e){this.curr={col:this.currCol,colorState:e,texts:[]},this.segs.push(this.curr)}},{key:"_append",value:function(e,t,i){this._isLastSegmentSameColor(i)||this._addSegment(i),this.curr.texts.push({col:this.currCol,type:e,text:t})}},{key:"_reuseChars",value:function(e,t){if(!this._isLastSegmentSameColor(t))return null;var i=this.curr.texts.length;if(0==i)return null;var s=this.curr.texts[i-1];return s.type==e?s:null}},{key:"_appendNormalText",value:function(e,t,i){var s=this._reuseChars("normalText",i);s?s.text+=t:this._append("normalText",t,i),this.currCol+=e}},{key:"appendNormalChar",value:function(e,t){this._appendNormalText(1,e,t)}},{key:"appendNormalWord",value:function(e,t,i){i?(this._append("forceWidthWord",e,t),this.currCol+=2):this._appendNormalText(2,e,t)}},{key:"appendTwoColorWord",value:function(e,t,i){this._addSegment(t),this.curr.texts.push({col:this.currCol,type:"twoColorWord",text:e,color:t,color2:i}),this.currCol+=2,this.curr=null}},{key:"build",value:function(){return this.segs}}]),e}()),g=function(e){function t(){s(this,t);var e=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={highlighted:!1},e}return o(t,e),a(t,[{key:"_segmentHyperLinks",value:function(e){for(var t=[],i=null,s=0;s<e.length;s++){var n=e[s];i&&!n.isStartOfURL()||(i={col:s,href:n.isStartOfURL()?n.getFullURL():null,chars:[]},t.push(i)),i.chars.push(n),n.isEndOfURL()&&(i=null)}return t}},{key:"_segmentTwoColorDBCS",value:function(e,t){var i=new m(e),s=null,n=!0,o=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value;if(l.isLeadByte)s=l;else if(s){var h=(s.ch+l.ch).b2u();1==h.length?this._isBadDBCS(h)?(i.appendNormalChar("?",s.getColor()),i.appendNormalChar("?",l.getColor())):s.getColor().equals(l.getColor())?i.appendNormalWord(h,s.getColor(),this._shouldForceWidth(h)?this.props.forceWidth:0):i.appendTwoColorWord(h,s.getColor(),l.getColor()):(i.appendNormalChar("?",s.getColor()),i.appendNormalChar(" "==l.ch?" ":"?",l.getColor())),s=null}else i.appendNormalChar(l.ch,l.getColor())}}catch(e){o=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw r}}return i.build()}},{key:"render",value:function(){var e=0,t=[],i=[],s=!0,n=!1,o=void 0;try{for(var r,a=this._segmentHyperLinks(this.props.chars)[Symbol.iterator]();!(s=(r=a.next()).done);s=!0){var c=r.value,m=[],g=!0,b=!1,v=void 0;try{for(var y,w=this._segmentTwoColorDBCS(e,c.chars)[Symbol.iterator]();!(g=(y=w.next()).done);g=!0){var _=y.value,x=[],k=!0,C=!1,S=void 0;try{for(var T,A=_.texts[Symbol.iterator]();!(k=(T=A.next()).done);k=!0){var R=T.value,B="text-c-"+R.col,E=this.props.forceWidth?this.props.forceWidth:0;switch(R.type){case"normalText":x.push(React.createElement(p,{key:B,text:R.text}));break;case"forceWidthWord":x.push(React.createElement(d,{key:B,inner:R.text,forceWidth:E}));break;case"twoColorWord":x.push(React.createElement(f,{key:B,text:R.text,colorLead:R.color,colorTail:R.color2,forceWidth:E}))}}}catch(e){C=!0,S=e}finally{try{!k&&A.return&&A.return()}finally{if(C)throw S}}var P="colorSpan-c-"+_.col;m.push(React.createElement(u,{key:P,colorState:_.colorState,inner:x}))}}catch(e){b=!0,v=e}finally{try{!g&&w.return&&w.return()}finally{if(b)throw v}}if(c.href){var L="hyperLink-c-"+c.col;t.push(React.createElement(h,{key:L,href:c.href,inner:m,"data-scol":c.col,"data-srow":this.props.row})),this.props.showsLinkPreviews&&i.push(React.createElement(l.HyperLinkPreview,{key:L,src:c.href}))}else t=t.concat(m);e+=c.chars.length}}catch(e){n=!0,o=e}finally{try{!s&&a.return&&a.return()}finally{if(n)throw o}}var H=[];return this.state.highlighted&&H.push("b2"),React.createElement("div",null,React.createElement("span",{key:"line",className:H.join(" "),"data-type":"bbsline","data-row":this.props.row},t),React.createElement("div",{key:"previews"},i))}},{key:"setHighlight",value:function(e){this.state.highlighted!=e&&this.setState({highlighted:e})}},{key:"_isBadDBCS",value:function(e){return 3==c.symbolTable["x"+e.charCodeAt(0).toString(16)]}},{key:"_shouldForceWidth",value:function(e){var t=c.symbolTable["x"+e.charCodeAt(0).toString(16)];return 1==t||2==t}}]),t}(React.Component)},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){return ReactDOM.render(React.createElement(u,{src:t}),e)}Object.defineProperty(t,"__esModule",{value:!0}),t.HyperLinkPreview=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}();t.renderImagePreview=r;var c=i(13),l=function(e){function t(e){s(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.state={left:0,top:0,spinning:!!i.props.src},i}return o(t,e),a(t,[{key:"componentDidMount",value:function(){this._mouseMoveListener=this._onMouseMove.bind(this),document.addEventListener("mousemove",this._mouseMoveListener)}},{key:"componentWillUnmount",value:function(){this._mouseMoveListener&&document.removeEventListener("mousemove",this._mouseMoveListener)}},{key:"componentWillReceiveProps",value:function(e){this.props.src!=e.src&&this.setState({spinning:!!e.src})}},{key:"_onMouseMove",value:function(e){this.setState({left:e.clientX,top:e.clientY})}},{key:"_imageStyle",value:function(){if(!this._preview||""===this.props.src||this.state.spinning)return{display:"none"};var e=this.state.top,t=this.state.left,i=$(window).height(),s=this._preview.clientHeight,n=20;return e+s/2>i-20?s/2<e&&(n=i-20-s):e-20>s/2&&(n=e-s/2),{display:this.state.spinning?"none":"block",position:"absolute",left:t+20+"px",top:n+"px",maxHeight:"80%",maxWidth:"90%",zIndex:2}}},{key:"_spinnerStyle",value:function(){return this.state.spinning?{position:"absolute",left:this.state.left+20+"px",top:this.state.top+"px",zIndex:2}:{display:"none"}}},{key:"_stopSpinner",value:function(){this.setState({spinning:!1})}},{key:"_onImageLoaded",value:function(){this._stopSpinner(),this.forceUpdate()}},{key:"render",value:function(){var e=this;return React.createElement("div",null,React.createElement("img",{key:"preview",ref:function(t){e._preview=t},src:this.props.src,style:this._imageStyle(),onLoad:this._onImageLoaded.bind(this)}),React.createElement("i",{key:"spinner",className:"glyphicon glyphicon-refresh glyphicon-refresh-animate",style:this._spinnerStyle()}))}}]),t}(React.Component),h=function(e){function t(e){s(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.state={resolvedSrc:""},i}return o(t,e),a(t,[{key:"componentDidMount",value:function(){this._startFetch(this.props.src)}},{key:"componentWillReceiveProps",value:function(e){this.props.src!=e.src&&this._startFetch(e.src)}},{key:"_startFetch",value:function(e){var t=this;if(this.setState({resolvedSrc:""}),e){var i=c.ImageURL.create(e);if(i){var s=function(i){t._onResolve(i,e)};i.fetchSrc().then(s)}}}},{key:"_onResolve",value:function(e,t){t==this.props.src&&this.setState({resolvedSrc:e})}}]),t}(React.Component),u=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){return React.createElement(l,{src:this.state.resolvedSrc})}}]),t}(h);t.HyperLinkPreview=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"render",value:function(){return this.state.resolvedSrc?React.createElement("img",{className:"easyReadingImg hyperLinkPreview",src:this.state.resolvedSrc}):React.createElement("div",null)}}]),t}(h)},function(e,t,i){i(7),i(25),e.exports=i(26)},function(e,t,i){"use strict";function s(){var e=((0,a.getQueryVariable)("site"),(0,a.getQueryVariable)("from")),t=(0,a.getQueryVariable)("keepAlive");(0,r.setupI18n)(),pttchrome.app=new o.App(function(e){e.setInputAreaFocus(),$("#BBSWindow").show(),e.onWindowResize()},{from:e,keepAlive:t})}function n(e){return new Promise(function(t,i){$.ajax({url:e,processData:!1,xhrFields:{responseType:"arraybuffer"}}).done(function(e){t(e)}).fail(function(t,s,n){console.log("loadTable failed: "+s+": "+e),i()})})}var o=i(8),r=i(0),a=i(1);!function(){Promise.all([n("conv/b2u_table.bin"),n("conv/u2b_table.bin")]).then(function(e){window.lib=window.lib||{},window.lib.b2uArray=new Uint8Array(e[0]),window.lib.u2bArray=new Uint8Array(e[1]),$(document).ready(s)},function(){console.log("loadResources failed")})}()},function(e,t,i){"use strict";var s=i(9),n=i(10),o=i(3),r=i(16),a=i(17),c=i(18),l=i(19),h=i(22),u=i(24),p=i(0),d=i(1);pttchrome=pttchrome||{},pttchrome.App=function(e,t){this.CmdHandler=document.getElementById("cmdHandler"),this.CmdHandler.setAttribute("useMouseBrowsing","1"),this.CmdHandler.setAttribute("doDOMMouseScroll","0"),this.CmdHandler.setAttribute("useTextDragAndDrop","0"),this.CmdHandler.setAttribute("webContextMenu","1"),this.CmdHandler.setAttribute("SavePageMenu","1"),this.CmdHandler.setAttribute("EmbeddedPlayerMenu","1"),this.CmdHandler.setAttribute("PreviewPictureMenu","0"),this.CmdHandler.setAttribute("PushThreadMenu","0"),this.CmdHandler.setAttribute("OpenAllLinkMenu","0"),this.CmdHandler.setAttribute("MouseBrowseMenu","0"),this.CmdHandler.setAttribute("FileIoMenu","0"),this.CmdHandler.setAttribute("ScreenKeyboardMenu","1"),this.CmdHandler.setAttribute("ScreenKeyboardOpened","0"),this.CmdHandler.setAttribute("DragingWindow","0"),this.CmdHandler.setAttribute("MaxZIndex",11),this.CmdHandler.setAttribute("allowDrag","0"),this.CmdHandler.setAttribute("haveLink","0"),this.CmdHandler.setAttribute("draging","0"),this.CmdHandler.setAttribute("textSelected","0"),this.CmdHandler.setAttribute("dragType",""),this.CmdHandler.setAttribute("LastPicAddr","0"),this.CmdHandler.setAttribute("isMouseRightBtnDrag","0"),this.CmdHandler.setAttribute("hideBookMarkLink","1"),this.CmdHandler.setAttribute("hideSendLink","1"),this.CmdHandler.setAttribute("hideBookMarkPage","1"),this.CmdHandler.setAttribute("hideSendPage","1"),this.CmdHandler.setAttribute("hideViewInfo","1"),this.CmdHandler.setAttribute("SkipMouseClick","0"),this.pref=null,this.view=new n.TermView(24),this.buf=new o.TermBuf(80,24),this.buf.setView(this.view),this.view.setBuf(this.buf),this.view.setCore(this),this.parser=new s.AnsiParser(this.buf),this.easyReading=new c.EasyReading(this,this.view,this.buf),this.antiIdleStr="",this.antiIdleTime=0,this.idleTime=0,this.curX=0,this.curY=0,this.inputArea=document.getElementById("t"),this.BBSWin=document.getElementById("BBSWindow"),this.BBSWin.setAttribute("align","center"),this.view.mainDisplay.style.transformOrigin="center",this.mouseLeftButtonDown=!1,this.mouseRightButtonDown=!1,this.inputAreaFocusTimer=null,this.alertBeforeUnload=!1,this.modalShown=!1,this.inputHelper=new l.InputHelper(this),this.lastSelection=null,this.waterball={userId:"",message:""},this.appFocused=!0,this.endTurnsOnLiveUpdate=!1,this.copyOnSelect=!1;var i=window.navigator.userAgent.match(/Chrom(e|ium)\/(\d+)\./);i&&i.length>2&&(this.chromeVersion=parseInt(i[2],10));var r=this;this.CmdHandler.addEventListener("OverlayCommand",function(e){r.overlayCommandListener(e)},!1),window.addEventListener("click",function(e){r.mouse_click(e)},!1),window.addEventListener("mousedown",function(e){r.mouse_down(e)},!1),$(window).mousedown(function(e){if(!1===r.middleMouse_down(e))return!1}),window.addEventListener("mouseup",function(e){r.mouse_up(e)},!1),document.addEventListener("mousemove",function(e){r.mouse_move(e)},!1),document.addEventListener("mouseover",function(e){r.mouse_over(e)},!1),window.addEventListener("mousewheel",function(e){r.mouse_scroll(e)},!0),window.addEventListener("contextmenu",function(e){r.context_menu(e)},!1),window.addEventListener("focus",function(e){r.appFocused=!0,r.view.titleTimer&&(r.view.titleTimer.cancel(),r.view.titleTimer=null,document.title=r.connectedUrl.site,r.view.notif.close())},!1),window.addEventListener("blur",function(e){r.appFocused=!1},!1),this.strToCopy=null,document.addEventListener("copy",function(e){r.onDOMCopy(e)}),this.inputArea.addEventListener("paste",function(e){r.onDOMPaste(e)}),this.view.innerBounds=this.getWindowInnerBounds(),this.view.firstGridOffset=this.getFirstGridOffsets(),window.onresize=function(){r.onWindowResize()},this.isFromApp="app"===t.from,this.dblclickTimer=null,this.mbTimer=null,this.timerEverySec=null,this.pushthreadAutoUpdateCount=0,this.maxPushthreadAutoUpdateCount=-1,this.onWindowResize(),this.setupDeveloperModeAlert(),this.setupConnectionAlert(),this.setupPasteShortcutAlert(),this.setupLiveHelper(),this.setupOtherSiteInput(),this.setupContextMenus(),this.contextMenuShown=!1,this.pref=new h.PttChromePref(this,e),new Promise(function(e,t){pttchrome.Constants.DEVELOPER_MODE?($("#developerModeAlertDismiss").click(function(t){$("#developerModeAlert").hide(),e()}),$("#developerModeAlert").show()):e()}).then(function(){r.connect((0,d.getQueryVariable)("site")||pttchrome.Constants.DEFAULT_SITE),console.log("load pref from storage"),r.pref.getStorage()}),this.chromeVersion&&this.chromeVersion>=37&&(this.touch=new u.TouchController(this))},pttchrome.App.prototype.isConnected=function(){return 1==this.connectState&&!!this.conn},pttchrome.App.prototype.connect=function(e){this.connectState=0,console.log("connect: "+e);var t=this._parseURLSimple(e);if("wsstelnet"==t.protocol)this._setupWebsocketConn("wss://"+t.hostname+t.path);else{if("wstelnet"!=t.protocol)return void console.log("unsupport connect url protocol: "+parser.protocol);this._setupWebsocketConn("ws://"+t.hostname+t.path)}this.connectedUrl={url:e,site:t.hostname,port:t.port,easyReadingSupported:!0}},pttchrome.App.prototype._parseURLSimple=function(e){var t=e.split(/:\/\//,2);if(2!=t.length)return null;var i=t[1].split(/\//,2),s=i[0].split(/:/);if(s>2)return null;var n=s.length>1?parseInt(s[1]):{wstelnet:80,wsstelnet:443,telnet:23,ssh:22}[t[0]];return{protocol:t[0],hostname:i[0],host:s[0],port:n,path:"/"+(i.length>1?i[1]:"")}},pttchrome.App.prototype._setupWebsocketConn=function(e){var t=new a.Websocket(e);this._attachConn(new r.TelnetConnection(t))},pttchrome.App.prototype._attachConn=function(e){var t=this;this.conn=e,this.conn.addEventListener("open",this.onConnect.bind(this)),this.conn.addEventListener("close",this.onClose.bind(this)),this.conn.addEventListener("data",function(e){t.onData(e.detail.data)})},pttchrome.App.prototype.onConnect=function(){this.conn.isConnected=!0,this.view.setConn(this.conn),$("#connectionAlert").hide(),(0,d.dumpLog)(DUMP_TYPE_LOG,"pttchrome onConnect"),this.connectState=1,this.updateTabIcon("connect"),this.idleTime=0;var e=this;this.timerEverySec=(0,d.setTimer)(!0,function(){e.antiIdle(),e.view.onBlink(),e.incrementCountToUpdatePushthread()},1e3),this.view.resetCursorBlink(),this.alertBeforeUnload&&this.regExitAlert()},pttchrome.App.prototype.onData=function(e){if(this.parser.feed(e),!this.appFocused&&this.view.enableNotifications){var t=e.b2u().parseWaterball();t&&("userId"in t&&(this.waterball.userId=t.userId),"message"in t&&(this.waterball.message=t.message),this.view.showWaterballNotification())}},pttchrome.App.prototype.onClose=function(){(0,d.dumpLog)(DUMP_TYPE_LOG,"pttchrome onClose"),this.timerEverySec&&this.timerEverySec.cancel(),this.view.cursorBlinkTimer&&this.view.cursorBlinkTimer.cancel(),this.conn.isConnected=!1,this.cancelMbTimer(),this.unregExitAlert(),this.connectState=2,this.idleTime=0,$("#connectionAlert").show(),this.updateTabIcon("disconnect")},pttchrome.App.prototype.sendData=function(e){1==this.connectState&&this.conn.convSend(e)},pttchrome.App.prototype.sendCmdData=function(e){1==this.connectState&&this.conn.send(e)},pttchrome.App.prototype.cancelMbTimer=function(){this.mbTimer&&(this.mbTimer.cancel(),this.mbTimer=null)},pttchrome.App.prototype.setMbTimer=function(){this.cancelMbTimer();var e=this;this.mbTimer=(0,d.setTimer)(!1,function(){e.mbTimer.cancel(),e.mbTimer=null,e.CmdHandler.setAttribute("SkipMouseClick","0")},100)},pttchrome.App.prototype.cancelDblclickTimer=function(){this.dblclickTimer&&(this.dblclickTimer.cancel(),this.dblclickTimer=null)},pttchrome.App.prototype.setDblclickTimer=function(){this.cancelDblclickTimer();var e=this;this.dblclickTimer=(0,d.setTimer)(!1,function(){e.dblclickTimer.cancel(),e.dblclickTimer=null},350)},pttchrome.App.prototype.setInputAreaFocus=function(){this.modalShown||this.touch&&this.touch.touchStarted||this.inputArea.focus()},pttchrome.App.prototype.setupLiveHelper=function(){$("#liveHelperEnable").text((0,p.i18n)("liveHelperEnable")),$("#liveHelperSpan").text((0,p.i18n)("liveHelperSpan")),$("#liveHelperSpanSec").text((0,p.i18n)("liveHelperSpanSec"));var e=this;$("#liveHelperEnable").click(function(t){e.onLiveHelperEnableClicked(!0)}),$("#liveHelperEnable").tooltip({title:"Alt + r"}),$("#liveHelperSec").change(function(t){var i=$(this).val();i<1&&(i=1,$(this).val(i)),$("#liveHelperEnable").hasClass("active")&&e.setAutoPushthreadUpdate(i)}),$("#liveHelperClose").click(function(e){$("#liveHelper").hide()})},pttchrome.App.prototype.onLiveHelperEnableClicked=function(e){if($("#liveHelperEnable").hasClass("active"))this.disableLiveHelper(e);else{this.view.useEasyReadingMode=!1,this.switchToEasyReadingMode();var t=$("#liveHelperSec").val();this.setAutoPushthreadUpdate(t),e||$("#liveHelperEnable").addClass("active")}},pttchrome.App.prototype.disableLiveHelper=function(e){this.setAutoPushthreadUpdate(-1),e||$("#liveHelperEnable").removeClass("active")},pttchrome.App.prototype.switchToEasyReadingMode=function(e){this.easyReading.leaveCurrentPost(),e?(this.disableLiveHelper(),this.buf.pageLines=[],3==this.buf.pageState&&this.view.conn.send("[D[C")):(this.view.mainContainer.style.paddingBottom="",this.view.lastRowIndex=22,this.view.lastRowDiv.style.display="",this.view.replyRowDiv.style.display="",this.buf.pageLines=[]),this.view.conn.send("^L".unescapeStr())},pttchrome.App.prototype.setupDeveloperModeAlert=function(){$("#developerModeAlertReconnect").empty(),$("#developerModeAlertHeader").text((0,p.i18n)("alert_developerModeHeader")),$("#developerModeAlertText").text((0,p.i18n)("alert_developerModeText")),$("#developerModeAlertDismiss").text((0,p.i18n)("alert_developerModeDismiss"))},pttchrome.App.prototype.setupConnectionAlert=function(){$("#connectionAlertReconnect").empty(),$("#connectionAlertHeader").text((0,p.i18n)("alert_connectionHeader")),$("#connectionAlertText").text((0,p.i18n)("alert_connectionText")),$("#connectionAlertReconnect").text((0,p.i18n)("alert_connectionReconnect")),$("#connectionAlertPortOption1").text((0,p.i18n)("alert_connectionPortOption1")),$("#connectionAlertPortOption2").text((0,p.i18n)("alert_connectionPortOption2"));var e=this;$("#connectionAlertReconnect").click(function(t){e.connect(e.connectedUrl.url),$("#connectionAlert").hide()}),$("#connectionAlertPortOption2").click(function(t){var i="ptt.cc";e.connectedUrl.site&&(i=e.connectedUrl.site),e.isFromApp?e.connect(i+":443"):window.location.replace("?site="+i+":443")})},pttchrome.App.prototype.setupPasteShortcutAlert=function(){$("#pasteShortcutHeader").text((0,p.i18n)("alert_pasteShortcutHeader")),$("#pasteShortcutText").text((0,p.i18n)("alert_pasteShortcutText")),$("#pasteShortcutClose").text((0,p.i18n)("alert_pasteShortcutClose")),$("#pasteShortcutClose").click(function(e){$("#pasteShortcutAlert").modal("hide"),self.modalShown=!1})},pttchrome.App.prototype.setupOtherSiteInput=function(){var e=this;$("#siteModal input").attr("placeholder",(0,p.i18n)("input_sitePlaceholder")),$("#siteModal input").keyup(function(t){if(13==t.keyCode){var i=$(this).val();e.connect(i),$("#siteModal").modal("hide")}}),$("#siteModal").on("shown.bs.modal",function(t){$("#connectionAlert").hide(),e.modalShown=!0,$("#siteModal input").val(""),$("#siteModal input").focus()}),$("#siteModal").on("hidden.bs.modal",function(t){$("#connectionAlert").hide(),e.modalShown=!1})},pttchrome.App.prototype.doCopy=function(e){e.indexOf("")<0&&(e=e.replace(/\r\n/g,"\r"),e=e.replace(/\n/g,"\r"),e=e.replace(/ +\r/g,"\r")),this.strToCopy=e,document.execCommand("copy")},pttchrome.App.prototype.doCopyAnsi=function(){if(this.lastSelection){var e=this.lastSelection,t=null;this.view.useEasyReadingMode&&3==this.buf.pageState&&(t=this.buf.pageLines);var i="";if(e.start.row==e.end.row)i+=this.buf.getText(e.start.row,e.start.col,e.end.col,!0,!0,!1,t);else for(var s=e.start.row;s<=e.end.row;++s){var n=0,o=this.buf.cols-1;s==e.start.row?n=e.start.col:s==e.end.row&&(o=e.end.col),i+=this.buf.getText(s,n,o,!0,!0,!1,t),s!=e.end.row&&(i+="\r")}this.doCopy(i)}},pttchrome.App.prototype.onDOMCopy=function(e){this.strToCopy&&(e.clipboardData.setData("text",this.strToCopy),e.preventDefault(),console.log("copied: ",this.strToCopy),this.strToCopy=null)},pttchrome.App.prototype.doPaste=function(){console.log("doPaste not implemented"),$("#pasteShortcutAlert").modal("show"),self.modalShown=!0},pttchrome.App.prototype.onPasteDone=function(e){this.view.onTextInput(e,!0)},pttchrome.App.prototype.onDOMPaste=function(e){var t=e.clipboardData.getData("text");t&&(e.preventDefault(),this.onPasteDone(t))},pttchrome.App.prototype.onSymFont=function(e){console.log("using "+(e?"extension":"system")+" font");var t=e?"src: url("+e.data+");":"",i="@font-face { font-family: MingLiUNoGlyph; "+t+" }",s=document.createElement("style");s.type="text/css",s.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(s)},pttchrome.App.prototype.doSelectAll=function(){window.getSelection().selectAllChildren(this.view.mainDisplay)},pttchrome.App.prototype.doSearchGoogle=function(e){window.open("http://google.com/search?q="+e)},pttchrome.App.prototype.doOpenUrlNewTab=function(e){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!0,!1,!1,!1,0,null),e.dispatchEvent(t)},pttchrome.App.prototype.doGoToOtherSite=function(){$("#siteModal").modal("show")},pttchrome.App.prototype.incrementCountToUpdatePushthread=function(e){if(-1==this.maxPushthreadAutoUpdateCount)return void(this.pushthreadAutoUpdateCount=0);++this.pushthreadAutoUpdateCount>=this.maxPushthreadAutoUpdateCount&&(this.pushthreadAutoUpdateCount=0,3!=this.buf.pageState&&2!=this.buf.pageState||this.view.conn.send("[D[C[4~"))},pttchrome.App.prototype.setAutoPushthreadUpdate=function(e){this.maxPushthreadAutoUpdateCount=e},pttchrome.App.prototype.doAddBlacklistUserId=function(e){this.pref.blacklistedUserIds[e]=!0,this.pref.setBlacklistValue(),this.pref.setBlacklistStorage(),$(".blu_"+e).css("opacity","0.2")},pttchrome.App.prototype.doRemoveBlacklistUserId=function(e){delete this.pref.blacklistedUserIds[e],this.pref.setBlacklistValue(),this.pref.setBlacklistStorage(),$(".blu_"+e).css("opacity","")},pttchrome.App.prototype.doSettings=function(){$("#prefModal").modal("show")},pttchrome.App.prototype.onWindowResize=function(){if(this.view.innerBounds=this.getWindowInnerBounds(),this.view.fontResize(),this.modalShown){var e=.7*document.documentElement.clientWidth;e=e>730?e:730,e-=190;var t=.9*document.documentElement.clientHeight;t=t>400?t:400,t-=76,$("#prefModal .modal-body").css("height",t+"px"),$("#prefModal .modal-body").css("width",e+"px"),$("#opt_blacklistedUsers").css("height",t-150+"px")}},pttchrome.App.prototype.switchMouseBrowsing=function(){"1"==this.CmdHandler.getAttribute("useMouseBrowsing")?(this.CmdHandler.setAttribute("useMouseBrowsing","0"),this.buf.useMouseBrowsing=!1):(this.CmdHandler.setAttribute("useMouseBrowsing","1"),this.buf.useMouseBrowsing=!0),this.buf.useMouseBrowsing?(this.buf.resetMousePos(),this.view.redraw(!0),this.view.updateCursorPos()):(this.buf.BBSWin.style.cursor="auto",this.buf.clearHighlight(),this.buf.mouseCursor=0,this.buf.nowHighlight=-1,this.buf.tempMouseCol=0,this.buf.tempMouseRow=0)},pttchrome.App.prototype.antiIdle=function(){this.antiIdleTime&&this.idleTime>this.antiIdleTime?""!==this.antiIdleStr&&1==this.connectState&&this.conn.send(this.antiIdleStr):1==this.connectState&&(this.idleTime+=1e3)},pttchrome.App.prototype.updateTabIcon=function(e){var t="icon/logo.png";switch(e){case"connect":t="icon/logo_connect.png",this.setInputAreaFocus();break;case"disconnect":t="icon/logo_disconnect.png"}var i=document.querySelector("link[rel~='icon']");i?i.setAttribute("href",t):(i=document.createElement("link"),i.setAttribute("rel","icon"),i.setAttribute("href",t),document.head.appendChild(i))},pttchrome.App.prototype.getWindowInnerBounds=function(){return{width:document.documentElement.clientWidth-2*this.view.bbsViewMargin,height:document.documentElement.clientHeight-2*this.view.bbsViewMargin}},pttchrome.App.prototype.getFirstGridOffsets=function(){var e=$("#mainContainer")[0];return{top:e.offsetTop,left:e.offsetLeft}},pttchrome.App.prototype.clientToPos=function(e,t){var i,s,n=this.view.innerBounds.width,o=this.view.innerBounds.height;!this.view.horizontalAlignCenter||1==this.view.scaleX&&1==this.view.scaleY?(i=e-parseFloat(this.view.firstGridOffset.left),s=t-parseFloat(this.view.firstGridOffset.top)):(i=e-(n-this.view.chw*this.buf.cols*this.view.scaleX)/2,s=t-(o-this.view.chh*this.buf.rows*this.view.scaleY)/2);var r=Math.floor(i/(this.view.chw*this.view.scaleX)),a=Math.floor(s/(this.view.chh*this.view.scaleY));return a<0?a=0:a>=this.buf.rows-1&&(a=this.buf.rows-1),r<0?r=0:r>=this.buf.cols-1&&(r=this.buf.cols-1),{col:r,row:a}},pttchrome.App.prototype.onMouse_click=function(e){var t=e.clientX,i=e.clientY;if(this.conn&&this.conn.isConnected){if(this.inputHelper.clickedOn)return void(this.inputHelper.clickedOn=!1);if(this.disableLiveHelper(),this.easyReading._onMouseClick(e),!e.defaultPrevented)switch(this.buf.mouseCursor){case 1:this.conn.send("[D");break;case 2:this.conn.send("[5~");break;case 3:this.conn.send("[6~");break;case 4:this.conn.send("[1~");break;case 5:this.conn.send("[4~");break;case 6:if(-1!=this.buf.nowHighlight){var s="";if(this.buf.cur_y>this.buf.nowHighlight)for(var n=this.buf.cur_y-this.buf.nowHighlight,o=0;o<n;++o)s+="[A";else if(this.buf.cur_y<this.buf.nowHighlight)for(var n=this.buf.nowHighlight-this.buf.cur_y,o=0;o<n;++o)s+="[B";s+="\r",this.conn.send(s)}break;case 7:var r=this.clientToPos(t,i),s="";if(this.buf.cur_y>r.row)for(var n=this.buf.cur_y-r.row,o=0;o<n;++o)s+="[A";else if(this.buf.cur_y<r.row)for(var n=r.row-this.buf.cur_y,o=0;o<n;++o)s+="[B";s+="\r",this.conn.send(s);break;case 0:this.conn.send("[D");break;case 8:this.conn.send("[");break;case 9:this.conn.send("]");break;case 10:this.conn.send("=");break;case 12:this.conn.send("[D\r[4~");break;case 13:this.conn.send("[D\r[4~[]");break;case 14:this.conn.send("[D[4~[]\r")}}},pttchrome.App.prototype.overlayCommandListener=function(e){var t=e.target,i=t.getAttribute("pttChromeCommand");if(t){if("cmdHandler"==t.id)switch(i){case"doArrowUp":this.view.useEasyReadingMode&&this.buf.startedEasyReading?0===this.view.mainDisplay.scrollTop?(this.easyReading.leaveCurrentPost(),this.conn.send("[D[A[C")):this.view.mainDisplay.scrollTop-=this.view.chh:this.conn.send("[A");break;case"doArrowDown":this.view.useEasyReadingMode&&this.buf.startedEasyReading?this.view.mainDisplay.scrollTop>=this.view.mainContainer.clientHeight-this.view.chh*this.buf.rows?(this.easyReading.leaveCurrentPost(),this.conn.send("[B")):this.view.mainDisplay.scrollTop+=this.view.chh:this.conn.send("[B");break;case"doPageUp":this.view.useEasyReadingMode&&this.buf.startedEasyReading?this.view.mainDisplay.scrollTop-=this.view.chh*this.easyReading._turnPageLines:this.conn.send("[5~");break;case"doPageDown":this.view.useEasyReadingMode&&this.buf.startedEasyReading?this.view.mainDisplay.scrollTop+=this.view.chh*this.easyReading._turnPageLines:this.conn.send("[6~");break;case"previousThread":this.view.useEasyReadingMode&&this.buf.startedEasyReading?(this.easyReading.leaveCurrentPost(),this.conn.send("[")):2!=this.buf.pageState&&3!=this.buf.pageState&&4!=this.buf.pageState||this.conn.send("[");break;case"nextThread":this.view.useEasyReadingMode&&this.buf.startedEasyReading?(this.easyReading.leaveCurrentPost(),this.conn.send("]")):2!=this.buf.pageState&&3!=this.buf.pageState&&4!=this.buf.pageState||this.conn.send("]");break;case"doEnter":this.view.useEasyReadingMode&&this.buf.startedEasyReading?this.view.mainDisplay.scrollTop>=this.view.mainContainer.clientHeight-this.view.chh*this.buf.rows?(this.easyReading.leaveCurrentPost(),this.conn.send("\r")):this.view.mainDisplay.scrollTop+=this.view.chh:this.conn.send("\r");break;case"doRight":this.view.useEasyReadingMode&&this.buf.startedEasyReading?this.view.mainDisplay.scrollTop>=this.view.mainContainer.clientHeight-this.view.chh*this.buf.rows?(this.easyReading.leaveCurrentPost(),this.conn.send("[C")):this.view.mainDisplay.scrollTop+=this.view.chh*this.easyReading._turnPageLines:this.conn.send("[C");break;case"reloadTabIconDelay":this.doReloadTabIcon(100);break;case"reloadTabIcon":this.reloadTabIcon();break;case"doAddTrack":this.doAddTrack();break;case"doDelTrack":this.doDelTrack();break;case"doClearTrack":this.doClearTrack();break;case"openSymbolInput":this.symbolinput&&(this.symbolinput.setCore(this),this.symbolinput.displayWindow());break;case"doSavePage":this.doSavePage();break;case"doCopyHtml":this.doCopyHtml();break;case"doSelectAll":this.doSelectAll();break;case"doCopy":this.doCopySelect();break;case"doPaste":this.doPaste();break;case"doOpenAllLink":this.doOpenAllLink();break;case"switchMouseBrowsing":this.switchMouseBrowsing();break;case"openYoutubeWindow":var s=t.getAttribute("YoutubeURL");t.removeAttribute("YoutubeURL"),this.playerMgr&&this.playerMgr.openYoutubeWindow(s);break;case"openUstreamWindow":var s=t.getAttribute("UstreamURL");t.removeAttribute("UstreamURL"),this.playerMgr&&this.playerMgr.openUstreamWindow(s);break;case"openUrecordWindow":var s=t.getAttribute("UrecordURL");t.removeAttribute("UrecordURL"),this.playerMgr&&this.playerMgr.openUrecordWindow(s);break;case"previewPicture":var s=t.getAttribute("PictureURL");t.removeAttribute("PictureURL"),this.picViewerMgr&&this.picViewerMgr.openPicture(s);break;case"checkPrefExist":this.doSiteSettingCheck(250);break;case"pushThread":this.doPushThread();break;case"setAlert":var s=t.getAttribute("AlertMessage");t.removeAttribute("AlertMessage")}t.removeAttribute("pttChromeCommand")}},pttchrome.App.prototype.onMouse_move=function(e,t){var i=this.clientToPos(e,t);this.buf.onMouse_move(i.col,i.row,!1)},pttchrome.App.prototype.resetMouseCursor=function(e,t){this.buf.BBSWin.style.cursor="auto",this.buf.mouseCursor=11},pttchrome.App.prototype.onPrefChange=function(e,t){try{switch(t){case"useMouseBrowsing":var i=e.get(t);this.CmdHandler.setAttribute("useMouseBrowsing",i?"1":"0"),this.buf.useMouseBrowsing=i,this.buf.useMouseBrowsing||(this.buf.BBSWin.style.cursor="auto",this.buf.clearHighlight(),this.buf.mouseCursor=0,this.buf.nowHighlight=-1,this.buf.tempMouseCol=0,this.buf.tempMouseRow=0),this.buf.resetMousePos(),this.view.redraw(!0),this.view.updateCursorPos();break;case"mouseBrowsingHighlight":this.buf.highlightCursor=e.get(t),this.view.redraw(!0),this.view.updateCursorPos();break;case"mouseBrowsingHighlightColor":this.view.highlightBG=e.get(t),this.view.redraw(!0),this.view.updateCursorPos();break;case"mouseLeftFunction":this.view.leftButtonFunction=e.get(t),"boolean"==typeof this.view.leftButtonFunction&&(this.view.leftButtonFunction=this.view.leftButtonFunction?1:0);break;case"mouseMiddleFunction":this.view.middleButtonFunction=e.get(t);break;case"mouseWheelFunction1":this.view.mouseWheelFunction1=e.get(t);break;case"mouseWheelFunction2":this.view.mouseWheelFunction2=e.get(t);break;case"mouseWheelFunction3":this.view.mouseWheelFunction3=e.get(t);break;case"copyOnSelect":this.copyOnSelect=e.get(t);break;case"closeQuery":this.alertBeforeUnload=e.get(t);break;case"endTurnsOnLiveUpdate":this.endTurnsOnLiveUpdate=e.get(t);break;case"enablePicPreview":this.view.enablePicPreview=e.get(t);break;case"enableNotifications":this.view.enableNotifications=e.get(t);break;case"enableEasyReading":break;case"antiIdleTime":this.antiIdleTime=1e3*e.get(t);break;case"dbcsDetect":this.view.dbcsDetect=e.get(t);break;case"lineWrap":this.conn.lineWrap=e.get(t);break;case"fontFitWindowWidth":this.view.fontFitWindowWidth=e.get(t),this.view.fontFitWindowWidth?$(".main").addClass("trans-fix"):$(".main").removeClass("trans-fix"),this.onWindowResize();break;case"fontFace":var s=e.get(t);s||(s="monospace"),this.view.setFontFace(s);break;case"bbsMargin":var n=e.get(t);this.view.bbsViewMargin=n,this.onWindowResize();break;case"enableBlacklist":this.pref.enableBlacklist=e.get(t),this.view.redraw(!0);break;case"enableDeleteDupLogin":this.buf.enableDeleteDupLogin=e.get(t);break;case"deleteDupLogin":this.buf.deleteDupLogin=e.get(t)}}catch(e){return}},pttchrome.App.prototype.checkClass=function(e){return e.indexOf("closeSI")>=0||e.indexOf("EPbtn")>=0||e.indexOf("closePP")>=0||e.indexOf("picturePreview")>=0||e.indexOf("drag")>=0||e.indexOf("floatWindowClientArea")>=0||e.indexOf("WinBtn")>=0||e.indexOf("sBtn")>=0||e.indexOf("nonspan")>=0||e.indexOf("nomouse_command")>=0},pttchrome.App.prototype.mouse_click=function(e){if(!this.modalShown){var t="1"==this.CmdHandler.getAttribute("SkipMouseClick");if(this.CmdHandler.setAttribute("SkipMouseClick","0"),2==e.button);else if(0===e.button){if($(e.target).is("a")||$(e.target).parent().is("a"))return;if(window.getSelection().isCollapsed)if(this.buf.useMouseBrowsing){var i=!0;if(e.target.className&&this.checkClass(e.target.className)&&(i=!1),e.target.tagName&&e.target.tagName.indexOf("menuitem")>=0&&(i=!1),t){i=!1;var s=this.clientToPos(e.clientX,e.clientY);this.buf.onMouse_move(s.col,s.row,!0)}i&&(this.onMouse_click(e),this.setDblclickTimer(),e.preventDefault(),this.setInputAreaFocus())}else this.view.leftButtonFunction&&(1==this.view.leftButtonFunction?(this.setBBSCmd("doEnter",this.CmdHandler),e.preventDefault(),this.setInputAreaFocus()):2==this.view.leftButtonFunction&&(this.setBBSCmd("doRight",this.CmdHandler),e.preventDefault(),this.setInputAreaFocus()))}else e.button}},pttchrome.App.prototype.middleMouse_down=function(e){if(1==e.button){if($(e.target).is("a")||$(e.target).parent().is("a"))return;if(1==this.view.middleButtonFunction)return this.conn.send("\r"),!1;if(2==this.view.middleButtonFunction)return this.conn.send("[D"),!1;if(3==this.view.middleButtonFunction)return this.doPaste(),!1}},pttchrome.App.prototype.mouse_down=function(e){if(!this.modalShown)if(0===e.button){this.buf.useMouseBrowsing&&(this.dblclickTimer&&(e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0),this.setDblclickTimer()),this.mouseLeftButtonDown=!0,window.getSelection().isCollapsed||this.CmdHandler.setAttribute("SkipMouseClick","1");e.target.className&&this.checkClass(e.target.className)&&!1,e.target.tagName&&e.target.tagName.indexOf("menuitem")>=0&&!1}else 2==e.button&&(this.mouseRightButtonDown=!0)},pttchrome.App.prototype.mouse_up=function(e){if(!this.modalShown){if(0===e.button?(this.setMbTimer(),this.mouseLeftButtonDown=!1):2==e.button&&(this.mouseRightButtonDown=!1),0===e.button||2==e.button)if(window.getSelection().isCollapsed){if(this.buf.useMouseBrowsing&&this.onMouse_move(e.clientX,e.clientY),this.setInputAreaFocus(),0===e.button){var t=!0;e.target.className&&this.checkClass(e.target.className)&&(t=!1),e.target.tagName&&e.target.tagName.indexOf("menuitem")>=0&&(t=!1),t&&e.preventDefault()}}else this.copyOnSelect&&this.doCopy(window.getSelection().toString().replace(/\u00a0/g," "));else this.setInputAreaFocus(),e.preventDefault();var i=this;this.inputAreaFocusTimer=(0,d.setTimer)(!1,function(){clearTimeout(i.inputAreaFocusTimer),i.inputAreaFocusTimer=null,window.getSelection().isCollapsed&&i.setInputAreaFocus()},10)}},pttchrome.App.prototype.mouse_move=function(e){if(this.inputHelper.mouseDown)return void this.inputHelper.onMouseDrag(e);this.buf.useMouseBrowsing&&(window.getSelection().isCollapsed?this.mouseLeftButtonDown||this.onMouse_move(e.clientX,e.clientY):this.resetMouseCursor())},pttchrome.App.prototype.mouse_over=function(e){this.modalShown||(this.curX=e.clientX,this.curY=e.clientY,window.getSelection().isCollapsed&&!this.mouseLeftButtonDown&&this.setInputAreaFocus())},pttchrome.App.prototype.mouse_scroll=function(e){if(!(this.modalShown||this.view.useEasyReadingMode&&3==this.buf.pageState)){var t=this.CmdHandler,i=["none","doArrowUp","doPageUp","previousThread"],s=["none","doArrowDown","doPageDown","nextThread"];if(e.wheelDelta>0)if(this.mouseRightButtonDown){var n=i[this.view.mouseWheelFunction2];"none"!==n&&this.setBBSCmd(n,t)}else if(this.mouseLeftButtonDown){var n=i[this.view.mouseWheelFunction3];"none"!==n&&(this.setBBSCmd(n,t),this.setBBSCmd("cancelHoldMouse",t))}else{var n=i[this.view.mouseWheelFunction1];"none"!==n&&this.setBBSCmd(n,t)}else if(this.mouseRightButtonDown){var n=s[this.view.mouseWheelFunction2];"none"!==n&&this.setBBSCmd(n,t)}else if(this.mouseLeftButtonDown){var n=s[this.view.mouseWheelFunction3];"none"!==n&&(this.setBBSCmd(n,t),this.setBBSCmd("cancelHoldMouse",t))}else{var n=s[this.view.mouseWheelFunction1];"none"!==n&&this.setBBSCmd(n,t)}e.stopPropagation(),e.preventDefault(),this.mouseRightButtonDown&&t.setAttribute("doDOMMouseScroll","1"),this.mouseLeftButtonDown&&this.buf.useMouseBrowsing&&t.setAttribute("SkipMouseClick","1")}},pttchrome.App.prototype.showQuickSearchMenus=function(e,t,i){if(0!==this.pref.quickSearches.length){for(var s="#quickSearchMenus",n="",o=0;o<this.pref.quickSearches.length;++o){var r=this.pref.quickSearches[o];n+='<li class="cmenuItem"><a data-url="'+r.url+'">'+r.name+"</a></li>"}$(s).html(n),$("#quickSearchMenus a").off(),$("#quickSearchMenus a").click(function(e){var s=$(this).data("url");s=s.replace("%s",t),window.open(s),e.stopPropagation(),i()});var a=$(window).height(),c=$(window).width();e.pageY>a/2?$(s).addClass("cmenuGoesUp"):$(s).removeClass("cmenuGoesUp"),e.pageX>.8*c?$(s).addClass("cmenuGoesLeft"):$(s).removeClass("cmenuGoesLeft")}},pttchrome.App.prototype.setupContextMenus=function(){var e=this,t="",i="",s="",n=null;$("#BBSWindow").on("contextmenu",function(r){var a=e.CmdHandler;if("1"==a.getAttribute("doDOMMouseScroll"))return r.stopPropagation(),r.preventDefault(),void a.setAttribute("doDOMMouseScroll","0");var c=$(r.target);if(i="",s="",window.getSelection().isCollapsed?e.lastSelection=null:e.lastSelection=e.view.getSelectionColRow(),n=null,c.is("a")?(i=c.attr("href"),n=c[0]):c.parent().is("a")&&(i=c.parent().attr("href"),n=c[0].parentNode),e.pref.enableBlacklist){var l=c.attr("srow");if(void 0!==l&&null!==l||(l=c.parent().attr("srow")),l=parseInt(l),!isNaN(l)){var h="";h=e.view.useEasyReadingMode&&3==e.buf.pageState?e.buf.getRowText(l,0,e.buf.cols,e.buf.pageLines):e.buf.getRowText(l,0,e.buf.cols),3==e.buf.pageState?s=h.parsePushthreadForUserId():2==e.buf.pageState&&(s=h.parseThreadForUserId())}}if(t=window.getSelection().toString().replace(/\u00a0/g," "),i)$(".contextQuickSearch").hide(),$(".contextUrl").show(),$(".contextSel").hide(),$(".contextNormal").hide();else if(window.getSelection().isCollapsed)$(".contextQuickSearch").hide(),$(".contextUrl").hide(),$(".contextSel").hide(),$(".contextNormal").show();else{$(".contextUrl").hide(),$(".contextSel").show(),$(".contextNormal").hide();var u=t;u.length>15&&(u=u.substr(0,15)+" ... "),$("#cmenuSearchContent").text("'"+u+"'"),e.pref.quickSearches.length>0?(e.showQuickSearchMenus(r,t,function(){o()}),$(".contextQuickSearch").show()):$(".contextQuickSearch").hide()}return s?(s in e.pref.blacklistedUserIds?($("#cmenuRemoveBlacklistUserIdContent").text("'"+s+"'"),$("#cmenu_addBlacklistUserId").hide(),$("#cmenu_removeBlacklistUserId").show()):($("#cmenuAddBlacklistUserIdContent").text("'"+s+"'"),$("#cmenu_addBlacklistUserId").show(),$("#cmenu_removeBlacklistUserId").hide()),$("#cmenu_divider3").show()):($("#cmenu_addBlacklistUserId").hide(),$("#cmenu_removeBlacklistUserId").hide()),e.buf.useMouseBrowsing?$("#cmenu_mouseBrowsing a").addClass("checked"):$("#cmenu_mouseBrowsing a").removeClass("checked"),$("#contextMenus").show().css({position:"absolute",left:function(e){var t=e.pageX,i=$(window).width(),s=$("#contextMenus").width();return t+s>i&&s<t?t-s:t}(r),top:function(e){var t=e.pageY,i=$(window).height(),s=$("#contextMenus").height();return t+s>i&&s<t?t-s:t}(r)}),e.contextMenuShown=!0,!1});var o=function(){$("#contextMenus").hide(),t="",e.contextMenuShown=!1};$(window).keyup(function(s){if(e.contextMenuShown){if(!s.altKey&&!s.ctrlKey&&!s.shiftKey)switch(s.keyCode){case 67:e.doCopy(t),o();break;case 69:e.doCopy(i),o();break;case 80:e.doPaste(),o();break;case 83:e.doSearchGoogle(t),o();break;case 84:e.doOpenUrlNewTab(n),o()}s.preventDefault(),s.stopPropagation()}}),$(window).click(function(){o()}),"ontouchstart"in window&&(window.ontouchstart=function(e){e.target.parentNode.classList.length>0&&"cmenuItem"==e.target.parentNode.classList[0]||o()}),$("#cmenu_copy a").html((0,p.i18n)("cmenu_copy")+'<span class="cmenuHotkey">Ctrl+C</span>'),$("#cmenu_copyAnsi a").text((0,p.i18n)("cmenu_copyAnsi")),$("#cmenu_paste a").html((0,p.i18n)("cmenu_paste")+'<span class="cmenuHotkey">Shift+Insert</span>'),$("#cmenu_selectAll a").html((0,p.i18n)("cmenu_selectAll")+'<span class="cmenuHotkey">Ctrl+A</span>'),$("#cmenu_searchGoogle a").html((0,p.i18n)("cmenu_searchGoogle")+' <span id="cmenuSearchContent"></span>'),$("#cmenu_quickSearch a").html((0,p.i18n)("cmenu_quickSearch")+' <span style="float:right;">&#9658;</span>'),$("#cmenu_openUrlNewTab a").text((0,p.i18n)("cmenu_openUrlNewTab")),$("#cmenu_copyLinkUrl a").text((0,p.i18n)("cmenu_copyLinkUrl")),$("#cmenu_mouseBrowsing a").text((0,p.i18n)("cmenu_mouseBrowsing")),$("#cmenu_goToOtherSite a").text((0,p.i18n)("cmenu_goToOtherSite")),$("#cmenu_showInputHelper a").text((0,p.i18n)("cmenu_showInputHelper")),$("#cmenu_showLiveArticleHelper a").text((0,p.i18n)("cmenu_showLiveArticleHelper")),$("#cmenu_addBlacklistUserId a").html((0,p.i18n)("cmenu_addBlacklistUserId")+' <span id="cmenuAddBlacklistUserIdContent"></span>'),$("#cmenu_removeBlacklistUserId a").html((0,p.i18n)("cmenu_removeBlacklistUserId")+' <span id="cmenuRemoveBlacklistUserIdContent"></span>'),$("#cmenu_settings a").text((0,p.i18n)("cmenu_settings"));var r={cmenu_copy:function(){e.doCopy(t)},cmenu_copyAnsi:function(){e.doCopyAnsi()},cmenu_paste:function(){e.doPaste()},cmenu_selectAll:function(){e.doSelectAll()},cmenu_searchGoogle:function(){e.doSearchGoogle(t)},cmenu_openUrlNewTab:function(){e.doOpenUrlNewTab(n)},cmenu_copyLinkUrl:function(){e.doCopy(i)},cmenu_mouseBrowsing:function(){e.switchMouseBrowsing()},cmenu_goToOtherSite:function(){e.doGoToOtherSite()},cmenu_showInputHelper:function(){e.inputHelper.showHelper()},cmenu_showLiveArticleHelper:function(){$("#liveHelper").show()},cmenu_addBlacklistUserId:function(){e.doAddBlacklistUserId(s)},cmenu_removeBlacklistUserId:function(){e.doRemoveBlacklistUserId(s)},cmenu_settings:function(){e.doSettings()}};$(".cmenuItem").click(function(e){var t=$(this).attr("id");t in r&&r[t](),e.stopPropagation(),o()}),$("#contextMenus").on("contextmenu",function(e){e.stopPropagation(),e.preventDefault()})},pttchrome.App.prototype.context_menu=function(e){var t=this.CmdHandler;if("1"==t.getAttribute("doDOMMouseScroll"))return e.stopPropagation(),e.preventDefault(),void t.setAttribute("doDOMMouseScroll","0")},pttchrome.App.prototype.regExitAlert=function(){window.onbeforeunload||0===window.location.origin.indexOf("http://localhost")||(window.onbeforeunload=function(){return"Connected to "+document.title})},pttchrome.App.prototype.unregExitAlert=function(){window.onbeforeunload=null},pttchrome.App.prototype.setBBSCmd=function(e,t){var i=document;if(t||(t=this.getCmdHandler()),t&&"createEvent"in i){t.setAttribute("pttChromeCommand",e);var s=i.createEvent("Events");s.initEvent("OverlayCommand",!1,!1),t.dispatchEvent(s)}},t.App=pttchrome.App},function(e,t,i){"use strict";function s(e){this.termbuf=e,this.state=s.STATE_TEXT,this.esc=""}Object.defineProperty(t,"__esModule",{value:!0}),t.AnsiParser=s,s.STATE_TEXT=0,s.STATE_ESC=1,s.STATE_CSI=2,s.STATE_C1=3,s.prototype.feed=function(e){var t=this.termbuf;if(t){for(var i="",n=e.length,o=0;o<n;++o){var r=e[o];switch(this.state){case s.STATE_TEXT:switch(r){case"":i&&(t.puts(i),i=""),this.state=s.STATE_ESC;break;default:i+=r}break;case s.STATE_CSI:if(r>="`"&&r<="z"||r>="@"&&r<="Z"){var a=this.esc.split(";"),c="";if(a[0]&&(a[0].charAt(0)<"0"||a[0].charAt(0)>"9")&&(c=a[0].charAt(0),a[0]=a[0].slice(1)),c&&"h"!=r&&"l"!=r){this.state=s.STATE_TEXT,this.esc="";break}for(var l=0;l<a.length;++l)a[l]?a[l]=parseInt(a[l],10):a[l]=0;switch(r){case"m":for(var h=t.attr,u=a.length;u;--u){var p=a.shift();switch(p){case 0:h.resetAttr();break;case 1:h.bright=!0;break;case 4:h.underLine=!0;break;case 5:case 6:h.blink=!0;break;case 7:h.invert=!0;break;case 8:break;default:p<=37?p>=30&&(h.fg=p-30):p>=40&&p<=47&&(h.bg=p-40)}}break;case"@":t.insert(a[0]>0?a[0]:1);break;case"A":t.gotoPos(t.cur_x,t.cur_y-(a[0]?a[0]:1));break;case"B":case"e":t.gotoPos(t.cur_x,t.cur_y+(a[0]?a[0]:1));break;case"C":case"e":t.gotoPos(t.cur_x+(a[0]?a[0]:1),t.cur_y);break;case"D":t.gotoPos(t.cur_x-(a[0]?a[0]:1),t.cur_y);break;case"E":t.gotoPos(0,t.cur_y+(a[0]?a[0]:1));break;case"F":t.gotoPos(0,t.cur_y-(a[0]?a[0]:1));break;case"G":case"`":t.gotoPos(a[0]>0?a[0]-1:0,t.cur_y);break;case"I":t.tab(a[0]>0?a[0]:1);break;case"d":t.gotoPos(t.cur_x,a[0]>0?a[0]-1:0);break;case"J":t.clear(a?a[0]:0);break;case"H":case"f":a.length<2?t.gotoPos(0,0):(a[0]>0&&--a[0],a[1]>0&&--a[1],t.gotoPos(a[1],a[0]));break;case"K":t.eraseLine(a?a[0]:0);break;case"L":t.insertLine(a[0]>0?a[0]:1);break;case"M":t.deleteLine(a[0]>0?a[0]:1);break;case"P":t.del(a[0]>0?a[0]:1);break;case"r":a.length<2?(t.scrollStart=0,t.scrollEnd=t.rows-1):(a[0]>0&&--a[0],a[1]>0&&--a[1],t.scrollStart=a[0],t.scrollEnd=a[1]);break;case"s":t.cur_x_sav=t.cur_x,t.cur_y_sav=t.cur_y;break;case"u":if(t.cur_x_sav<0||t.cur_y_sav<0)break;t.cur_x=t.cur_x_sav,t.cur_y=t.cur_y_sav;break;case"S":t.scroll(!1,a[0]>0?a[0]:1);break;case"T":t.scroll(!0,a[0]>0?a[0]:1);break;case"X":t.eraseChar(a[0]>0?a[0]:1);break;case"Z":t.backTab(a[0]>0?a[0]:1)}this.state=s.STATE_TEXT,this.esc=""}else this.esc+=r;break;case s.STATE_C1:var d=!0,f=[" ","#","%","(",")","*","+","-",".","/"];if(this.esc){for(var l=0;l<f.length;++l)this.esc==f[l]&&(d=!1);d?--o:this.esc+=r,this.esc="",this.state=s.STATE_TEXT;break}switch(r){case"7":t.cur_x_sav=t.cur_x,t.cur_y_sav=t.cur_y;break;case"8":if(t.cur_x_sav<0||t.cur_y_sav<0)break;t.cur_x=t.cur_x_sav,t.cur_y=t.cur_y_sav;break;case"D":t.scroll(!1,1);break;case"E":t.lineFeed(),t.carriageReturn();break;case"M":t.scroll(!0,1);break;default:this.esc+=r,d=!1}if(!d)break;this.esc="",this.state=s.STATE_TEXT;break;case s.STATE_ESC:"["==r?this.state=s.STATE_CSI:(this.state=s.STATE_C1,--o)}}i&&(t.puts(i),i="")}}},function(e,t,i){"use strict";function s(e){this.screenType=0,this.bbsWidth=0,this.bbsHeight=0,this.bbsFontSize=14,this.useHyperLink=!0,this.dbcsDetect=!0,this.inputBufferSizeType=0,this.defineInputBufferSize=12,this.hideInputBuffer=!1,this.hotkeyForSelectAll=!1,this.highlightBG=2,this.charset="big5",this.EnterChar="\r",this.EscChar="",this.dropToPaste=!1,this.ctrlPicturePreview=!1,this.picturePreviewInfo=!1,this.middleButtonFunction=0,this.leftButtonFunction=!1,this.mouseWheelFunction1=1,this.mouseWheelFunction2=2,this.mouseWheelFunction3=3,this.DisplayBackground=!1,this.BackgroundMD5="",this.fontFitWindowWidth=!1,this.verticalAlignCenter=!0,this.horizontalAlignCenter=!0,this.easyReadingWithImg=!1,this.bbsViewMargin=0,this.cursorShow=!0,this.buf=null,this.bbscore=null,this.page=null,this.cursorX=0,this.cursorY=0,this.useEasyReadingMode=!1,this.easyReadingKeyDownKeyCode=0,this.doHighlightOnCurRow=!1,this.displayingRows=[],this.curRow=0,this.curCol=0,this.actualRowIndex=0,this.lineWrap=78,this.blinkShow=!1,this.blinkOn=!1,this.doBlink=!0,this.cursorBlinkTimer=null,this.selection=null,this.input=document.getElementById("t"),this.bbsCursor=document.getElementById("cursor"),this.trackKeyWordList=document.getElementById("TrackKeyWordList"),this.BBSWin=document.getElementById("BBSWindow"),this.enablePicPreview=!0,this.scaleX=1,this.scaleY=1;var t=document.createElement("style");document.head.appendChild(t),this.dynamicCss=t.sheet,this.innerBounds={width:0,height:0},this.firstGridOffset={top:0,left:0},this.enableNotifications=!0,this.titleTimer=null,this.notif=null;var i=document.createElement("div");i.setAttribute("class","main");for(var s="",o=0;o<e;++o)s+='<span type="bbsrow" srow="'+o+'"></span>',this.displayingRows.push(null);i.innerHTML='<div id="mainContainer">'+s+"</div>",this.BBSWin.appendChild(i),this.mainDisplay=i;var r=document.createElement("div");r.setAttribute("id","easyReadingLastRow"),this.lastRowDivContent='<span align="left"><span class="q0 b7">                                                       </span><span class="q1 b7">(y)</span><span class="q0 b7">回應</span><span class="q1 b7">(X%)</span><span class="q0 b7">推文</span><span class="q1 b7">(←)</span><span class="q0 b7">離開 </span> </span>',r.innerHTML=this.lastRowDivContent,this.lastRowDiv=r,this.BBSWin.appendChild(r);var a=document.createElement("div");a.setAttribute("id","easyReadingReplyRow"),this.replyRowDivContent='<span align="left"></span>',a.innerHTML=this.replyRowDivContent,this.replyRowDiv=a,this.BBSWin.appendChild(a),this.mainContainer=document.getElementById("mainContainer"),this.mainDisplay.style.border="0px",this.setFontFace("MingLiu,monospace"),this._keyboard=new n.TermKeyboard(this.checkLeftDB.bind(this),this.checkCurDB.bind(this),this._send.bind(this));var c=this;this.input.addEventListener("compositionstart",function(e){c.onCompositionStart(e),c.bbscore.setInputAreaFocus()},!1),this.input.addEventListener("compositionend",function(e){c.onCompositionEnd(e),c.bbscore.setInputAreaFocus(),c.onInput(e)},!1),this.input.addEventListener("compositionupdate",function(e){},!1),addEventListener("keydown",function(e){if(229!=e.keyCode&&0!=e.keyCode&&(!c.isComposition||e.ctrlKey||e.altKey)&&(e.altKey||c.bbscore.disableLiveHelper(),!(e.keyCode>15&&e.keyCode<19||c.bbscore.modalShown||c.bbscore.contextMenuShown)))return"none"!=document.getElementById("connectionAlert").style.display?(13==e.keyCode&&document.getElementById("connectionAlertReconnect").click(),void(27==e.keyCode&&document.getElementById("connectionAlertExitAll").click())):void c.onKeyDown(e)},!1),addEventListener("keyup",function(e){e.keyCode>15&&e.keyCode<19||c.bbscore.modalShown||c.bbscore.contextMenuShown||("none"==document.getElementById("connectionAlert").style.display||13!=e.keyCode&&27!=e.keyCode)&&c.bbscore.setInputAreaFocus()},!1),this.input.addEventListener("input",function(e){c.onInput(e)},!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.TermView=s;var n=i(11),o=i(3),r=i(5),a=i(4),c=i(0),l=i(1);s.prototype={onBlink:function(){this.blinkOn=!0,this.buf.queueUpdate(!0)},onCursorBlink:function(){this.cursorShow=!this.cursorShow,this.cursorShow?this.bbsCursor.style.display="block":this.bbsCursor.style.display="none"},resetCursorBlink:function(){if(this._isConnected()){var e=this;this.cursorShow=!0,this.bbsCursor.style.display="block",this.cursorBlinkTimer&&this.cursorBlinkTimer.cancel(),this.cursorBlinkTimer=(0,l.setTimer)(!0,function(){e.onCursorBlink()},1e3)}},setBuf:function(e){this.buf=e},setConn:function(e){this.conn=e},_send:function(e){this.conn&&this.conn.send(e)},_convSend:function(e){this.conn&&this.conn.convSend(e)},setCore:function(e){this.bbscore=e},_isConnected:function(){return this.bbscore.isConnected()&&!!this.conn},setFontFace:function(e){this.fontFace=e,this.input.style.setProperty("font-family",this.fontFace,"important"),this.mainDisplay.style.setProperty("font-family",this.fontFace,"important"),this.lastRowDiv.style.setProperty("font-family",this.fontFace,"important"),this.replyRowDiv.style.setProperty("font-family",this.fontFace,"important"),document.getElementById("cursor").style.setProperty("font-family",this.fontFace,"important")},update:function(){this.redraw(!1)},prePicRel:function(e){return-1==e.search(/\.(bmp|gif|jpe?g|png)$/i)?' type="w"':' type="p"'},redraw:function(e){for(var t=this.buf.cols,i=this.buf.rows,s=this.buf.lineChangeds,n=[],o=[],c=this.buf.lines,l=this.buf.outputhtmls,h=0;h<i;++h){this.chh;this.curRow=h;var u=c[h];l[h];if(!1!==s[h]||e){var p=!1;this.chw;for(this.curCol=0;this.curCol<t;++this.curCol)p=!0;p&&(p=!1,n.push(u),o.push(h),s[h]=!1)}}if(n.length>0){if(this.useEasyReadingMode)this.buf.startedEasyReading&&this.buf.easyReadingShowReplyText?this.updateEasyReadingReplyRow(n[n.length-1]):this.buf.startedEasyReading&&this.buf.easyReadingShowPushInitText?this.updateEasyReadingPushInitRow(n[n.length-1]):this.populateEasyReadingPage();else{for(;this.mainContainer.childNodes.length>i;)this.mainContainer.removeChild(this.mainContainer.lastChild);for(var d=0;d<o.length;++d){var h=o[d],f=(0,a.renderRowHtml)(n[d],h,this.chh,!1,this.mainContainer.childNodes[h]);f.setHighlight(this.buf.highlightCursor&&this.buf.currentHighlighted==h),this.displayingRows[h]=f}}this.buf.prevPageState=this.buf.pageState,this.enablePicPreview&&((0,r.renderImagePreview)(document.getElementById("imagePreviewContainer"),null),this.setupPicPreviewOnHover())}},setHighlightedRow:function(e){this.currentHighlighted==e||null===this.currentHighlighted&&e<0||(console.log("highlight: "+e),this.currentHighlighted&&this.displayingRows[this.currentHighlighted].setHighlight(!1),e>=0?(this.displayingRows[e].setHighlight(!0),this.currentHighlighted=e):this.currentHighlighted=null)},onInput:function(e){if(!this.bbscore.modalShown&&!this.bbscore.contextMenuShown){if(this.isComposition)return void this.updateInputBufferWidth();if(this.useEasyReadingMode&&this.buf.startedEasyReading&&!this.buf.easyReadingShowReplyText&&!this.buf.easyReadingShowPushInitText&&229==this.easyReadingKeyDownKeyCode&&"X"!=e.target.value)return void(e.target.value="");e.target.value&&this.onTextInput(e.target.value),e.target.value=""}},onTextInput:function(e,t){this.resetCursorBlink(),t&&(e=e.replace(/\r\n/g,"\r"),e=e.replace(/\n/g,"\r"),e=e.replace(/\r/g,this.EnterChar),e.indexOf("")<0&&this.lineWrap>0&&(e=e.wrapText(this.lineWrap,this.EnterChar)),e=e.replace(/\x1b/g,this.EscChar)),this._convSend(e)},onKeyDown:function(e){if(this.resetCursorBlink(),!this.useEasyReadingMode||!this.buf.startedEasyReading||this.buf.easyReadingShowReplyText||this.buf.easyReadingShowPushInitText||(this.easyReadingKeyDownKeyCode=e.keyCode,this.bbscore.easyReading._onKeyDown(e),!e.defaultPrevented)){var t=!1;if(e.ctrlKey||e.altKey)if(!e.ctrlKey||e.altKey||e.shiftKey){if(e.ctrlKey&&!e.altKey&&e.shiftKey)switch(e.key.toLowerCase()){case"V":this.bbscore.doPaste(),t=!0}}else switch(e.key.toLowerCase()){case"c":if(!window.getSelection().isCollapsed){var i=window.getSelection().toString().replace(/\u00a0/g," ");this.bbscore.doCopy(i),t=!0}break;case"a":this.bbscore.doSelectAll(),t=!0}else switch(e.key){case"End":2!=this.bbscore.buf.pageState&&3!=this.bbscore.buf.pageState||!this.bbscore.endTurnsOnLiveUpdate||(this.bbscore.onLiveHelperEnableClicked(!1),t=!0)}if(t)return void e.preventDefault();this._keyboard.onKeyDown(e),e.defaultPrevented}},setTermFontSize:function(e,t){var i=this.innerBounds;this.chw=e,this.chh=t;var s=this.chh+"px",n=this.chw*this.buf.cols+10+"px";this.mainDisplay.style.fontSize=s,this.mainDisplay.style.lineHeight=s,this.bbsCursor.style.fontSize=s,this.bbsCursor.style.lineHeight=s,this.mainDisplay.style.overflowX="hidden",this.mainDisplay.style.overflowY="auto",this.mainDisplay.style.textAlign="left",this.mainDisplay.style.width=n,this.lastRowDiv.style.fontSize=s,this.lastRowDiv.style.width=n,this.replyRowDiv.style.fontSize=s,this.replyRowDiv.style.width=n,this.verticalAlignCenter&&this.chh*this.buf.rows<i.height?this.mainDisplay.style.marginTop=(i.height-this.chh*this.buf.rows)/2+this.bbsViewMargin+"px":this.mainDisplay.style.marginTop=this.bbsViewMargin+"px",this.fontFitWindowWidth?(this.scaleX=Math.floor(i.width/(this.chw*this.buf.cols+10)*100)/100,this.scaleY=Math.floor(i.height/(this.chh*this.buf.rows)*100)/100):(this.scaleX=1,this.scaleY=1);var o="none";if(1!=this.scaleX||1!=this.scaleY){o="scale("+this.scaleX+","+this.scaleY+")";var r="left";this.horizontalAlignCenter&&(r="center"),this.mainDisplay.style.webkitTransformOriginX=r,this.lastRowDiv.style.webkitTransformOriginX=r,this.replyRowDiv.style.webkitTransformOriginX=r,this.lastRowDiv.style.webkitTransformOriginY="-1100%",this.replyRowDiv.style.webkitTransformOriginY="-1010%"}else this.lastRowDiv.style.webkitTransformOriginY="",this.replyRowDiv.style.webkitTransformOriginY="";this.mainDisplay.style.webkitTransform=o,this.lastRowDiv.style.webkitTransform=o,this.replyRowDiv.style.webkitTransform=o,this.firstGridOffset=this.bbscore.getFirstGridOffsets(),this.updateReverseScaleCss(),this.updateCursorPos()},updateReverseScaleCss:function(){for(var e="img.hyperLinkPreview { -webkit-transform: scale("+Math.floor(1/this.scaleX*100)/100+","+Math.floor(1/this.scaleY*100)/100+"); }";this.dynamicCss.cssRules.length>0;)this.dynamicCss.deleteRule(0);this.dynamicCss.insertRule(e,this.dynamicCss.cssRules.length)},convertMN2XYEx:function(e,t){var i,s=this.innerBounds.width,n=this.innerBounds.height;return i=!this.horizontalAlignCenter||1==this.scaleX&&1==this.scaleY?[this.firstGridOffset.left,this.firstGridOffset.top]:[(s-(this.chw*this.buf.cols+10)*this.scaleX)/2+this.bbsViewMargin,(n-this.chh*this.buf.rows*this.scaleY)/2+this.bbsViewMargin],[i[0]+e*this.chw*this.scaleX,i[1]+t*this.chh*this.scaleY]},checkLeftDB:function(){if(this.dbcsDetect&&this.buf.cur_x>1){if(this.buf.lines[this.buf.cur_y][this.buf.cur_x-2].isLeadByte)return!0}return!1},checkCurDB:function(){if(this.dbcsDetect){if(this.buf.lines[this.buf.cur_y][this.buf.cur_x].isLeadByte)return!0}return!1},updateCursorPos:function(){var e=this.convertMN2XYEx(this.buf.cur_x,this.buf.cur_y);if(!(this.buf.cur_y>=this.buf.rows||this.buf.cur_x>=this.buf.cols)){var t=this.buf.lines,i=t[this.buf.cur_y],s=i[this.buf.cur_x],n=s.getBg();if(1==this.scaleX&&1==this.scaleY)this.bbsCursor.style.webkitTransform="none",this.lastRowDiv.style.webkitTransformOriginY="",this.replyRowDiv.style.webkitTransformOriginY="";else{var r="scale("+this.scaleX+","+this.scaleY+")";this.mainDisplay.style.webkitTransform=r,this.lastRowDiv.style.webkitTransform=r,this.replyRowDiv.style.webkitTransform=r,this.bbsCursor.style.webkitTransform=r,this.bbsCursor.style.webkitTransformOriginX="left",this.lastRowDiv.style.webkitTransformOriginY="-1100%",this.replyRowDiv.style.webkitTransformOriginY="-1010%"}this.bbsCursor.style.left=e[0]+"px",this.bbsCursor.style.top=e[1]-this.scaleY+"px",this.bbsCursor.style.color=o.termInvColors[n],this.updateInputBufferPos()}},updateInputBufferPos:function(){if("1"==this.input.getAttribute("bshow")){var e=this.convertMN2XYEx(this.buf.cur_x,this.buf.cur_y);this.hideInputBuffer?(this.input.style.border="none",this.input.style.width="0px",this.input.style.height="0px",this.input.style.fontSize=this.chh+"px",this.input.style.opacity="0"):(this.input.style.opacity="1",this.input.style.border="double",0===this.inputBufferSizeType?(this.input.style.fontSize=this.chh-4+"px",this.input.style.height=this.chh+"px"):(this.input.style.fontSize=2*this.defineInputBufferSize-4+"px",this.input.style.height=2*this.defineInputBufferSize+"px"));var t=this.innerBounds,i=t.height,s=t.width;i<e[1]+parseFloat(this.input.style.height)+this.chh?this.input.style.top=e[1]-parseFloat(this.input.style.height)-this.chh+4+"px":this.input.style.top=e[1]+this.chh+"px",s<e[0]+parseFloat(this.input.style.width)?this.input.style.left=s-parseFloat(this.input.style.width)-10+"px":this.input.style.left=e[0]+"px"}},updateInputBufferWidth:function(){var e=this.input.value.u2b().length,t=this.chh/2-2,i=t*e;this.input.style.width=i+"px";var s=this.innerBounds;parseInt(this.input.style.left)+i+2*t>=s.width&&(this.input.style.left=s.width-i-2*t+"px")},onCompositionStart:function(e){this.input.setAttribute("bshow","1"),this.updateInputBufferPos(),this.isComposition=!0},onCompositionEnd:function(e){this.input.setAttribute("bshow","0"),this.input.style.border="none",this.input.style.width="1px",this.input.style.height="1px",this.input.style.left="-100000px",this.input.style.top="-100000px",this.input.style.opacity="0",this.isComposition=!1},fontResize:function(){var e=(this.buf&&this.buf.cols,this.buf&&this.buf.rows,this.innerBounds),t=2*this.bbsFontSize;if(0===this.screenType||1==this.screenType){var i=this.bbsWidth?this.bbsWidth:e.width,s=this.bbsHeight?this.bbsHeight:e.height;if(0===i||0===s)return;i-=10;var n,o,r=4,a=this.chh,c=this.chw;do{++r,a=2*r,c=r,n=24*a,o=80*c}while(n<=s&&o<=i);--r,a=2*r,c=r,this.setTermFontSize(c,a),t=a}else this.setTermFontSize(this.bbsFontSize,2*this.bbsFontSize);for(var l=document.querySelectorAll(".wpadding"),r=0;r<l.length;++r){l[r].style.width=t+"px"}},countCol:function(e,t){for(var i=void 0,s=e;s!=s.parentNode;s=s.parentNode)if(s instanceof Element&&"bbsline"==s.getAttribute("data-type")){i=s;break}if(!i)return{row:0,col:0};var n=0;return function i(s){if(s==e)return n+=s.textContent.substring(0,t).u2b().length,!1;if("#text"==s.nodeName)return n+=s.textContent.u2b().length,!0;var o=!0,r=!1,a=void 0;try{for(var c,l=s.childNodes[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){if(!i(c.value))return!1}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}return!0}(i),{row:parseInt(i.getAttribute("data-row")),col:n}},getSelectionColRow:function(){var e=window.getSelection().getRangeAt(0);return{start:this.countCol(e.startContainer,e.startOffset),end:this.countCol(e.endContainer,e.endOffset)}},setupPicPreviewOnHover:function(){for(var e=$([".main a[href^='http://ppt.cc/']",".main a[type='p']",".main a[href^='http://imgur.com/']",".main a[href^='https://imgur.com/']",".main a[href^='http://i.imgur.com/']",".main a[href^='https://i.imgur.com/']",".main a[href^='https://flic.kr/p/']",".main a[href^='https://www.flickr.com/photos/']"].join(",")).not(["a[href^='http://imgur.com/a/']","a[href^='https://imgur.com/a/']","a[href^='http://imgur.com/gallery/']","a[href^='https://imgur.com/gallery/']"].join(",")),t=document.getElementById("imagePreviewContainer"),i=function(e){(0,r.renderImagePreview)(t,this.getAttribute("href"))},s=function(e){(0,r.renderImagePreview)(t,null)},n=0;n<e.length;++n){var o=e[n];o.addEventListener("mouseover",i),o.addEventListener("mouseout",s)}},showWaterballNotification:function(){if(this.enableNotifications){var e=this.bbscore,t=e.waterball.userId+" "+(0,c.i18n)("notification_said");this.titleTimer&&(this.titleTimer.cancel(),this.titleTimer=null),this.titleTimer=(0,l.setTimer)(!0,function(){document.title==e.connectedUrl.site?document.title=t+" "+e.waterball.message:document.title=e.connectedUrl.site},1500);var i={icon:"icon_128.png",body:e.waterball.message,tag:e.waterball.userId};this.notif=new Notification(t,i),this.notif.onclick=function(){window.focus()}}},populateEasyReadingPage:function(){if(3==this.buf.pageState&&3==this.buf.prevPageState){this.mainContainer.style.paddingBottom="1em";var e=this.buf.getRowText(23,0,this.buf.cols),t=e.parseStatusRow();if(t){var i=this.buf.pageLines.length-1,s=1,n=!1;if(t.pageIndex==t.pageTotal&&100==t.pagePercent||t.rowIndexStart!=this.actualRowIndex){n=t.rowIndexStart!=this.actualRowIndex;for(var o=0,r=t.rowIndexStart;r<this.actualRowIndex+1;++r)o+=this.buf.pageWrappedLines[r];s=o,i-=s-1}for(var r=s;r<this.buf.rows-1;++r)r>0&&this.buf.isTextWrappedRow(r-1)?(this.buf.pageWrappedLines[this.actualRowIndex]+=1,n||r!=s||s++):this.buf.pageWrappedLines[++this.actualRowIndex]=1;this.appendRows(this.buf.lines.slice(s,-1),!0),this.buf.pageLines=this.buf.pageLines.concat(JSON.parse(JSON.stringify(this.buf.lines.slice(s,-1))))}this.buf.prevPageState=3}else{if(this.mainContainer.style.paddingBottom="",this.actualRowIndex=0,this.buf.pageWrappedLines=[],3==this.buf.pageState){for(var e=this.buf.getRowText(23,0,this.buf.cols),r=0;r<this.buf.rows-1;++r)4==r||r>0&&this.buf.isTextWrappedRow(r-1)?this.buf.pageWrappedLines[this.actualRowIndex]+=1:this.buf.pageWrappedLines[++this.actualRowIndex]=1;this.clearRows(),this.appendRows(this.buf.lines.slice(0,-1),!0),this.lastRowDiv.innerHTML=this.lastRowDivContent,this.lastRowDiv.style.display="block",this.buf.pageLines=this.buf.pageLines.concat(JSON.parse(JSON.stringify(this.buf.lines.slice(0,-1))))}else this.hideEasyReading();this.buf.prevPageState=this.buf.pageState}},clearRows:function(){this.mainContainer.innerHTML="",this.displayingRows=[]},appendRows:function(e,t){for(var i in e){var s=e[i],n=document.createElement("span");n.setAttribute("type","bbsrow"),n.setAttribute("srow",this.mainContainer.childNodes.length),this.mainContainer.appendChild(n);var o=(0,a.renderRowHtml)(s,this.mainContainer.childNodes.length,this.chh,t,n);this.displayingRows.push(o)}},renderSingleRow:function(e,t){var i=document.createElement("span");return i.setAttribute("type","bbsrow"),i.setAttribute("srow","0"),e.appendChild(i),(0,a.renderRowHtml)(t,0,this.chh,!1,i)},hideEasyReading:function(){this.lastRowDiv.style.display="",this.replyRowDiv.style.display="",this.buf.pageLines=[],this.clearRows(),this.appendRows(this.buf.lines,!1)},updateEasyReadingReplyRow:function(e){var t=document.createElement("span");t.style="background-color:black;",this.renderSingleRow(t,e),this.setSingleChild(this.replyRowDiv.childNodes[0],t),this.replyRowDiv.style.display="block"},updateEasyReadingPushInitRow:function(e){var t=document.createElement("span");t.style="background-color:black;",this.renderSingleRow(t,e),this.setSingleChild(this.lastRowDiv.childNodes[0],t)},setSingleChild:function(e,t){for(;e.childNodes.length>0;)e.removeChild(e.lastChild);e.appendChild(t)}}},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});for(var n=(function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}()),o={Backspace:"\b",Tab:"\t",Enter:"\r",Escape:"",Home:"[1~",Insert:"[2~",Delete:"[3~",End:"[4~",PageUp:"[5~",PageDown:"[6~",ArrowUp:"[A",ArrowDown:"[B",ArrowRight:"[C",ArrowLeft:"[D"},r={"@":50,"^":54,_:109,"?":127,"[":219,"\\":220,"]":221},a=97;a<=122;a++)r[String.fromCharCode(a)]=a-96;t.TermKeyboard=function(){function e(t,i,n){s(this,e),this._checkLeftDB=t,this._checkCurDB=i,this._sendFunc=n}return n(e,[{key:"_send",value:function(e){return this._sendFunc(e),!0}},{key:"_sendCharCode",value:function(e){return this._send(String.fromCharCode(e))}},{key:"_checkDB",value:function(e){switch(e){case"Backspace":case"ArrowLeft":return this._checkLeftDB();case"Delete":case"ArrowRight":return this._checkCurDB()}return!1}},{key:"onKeyDown",value:function(e){this._onKeyDown(e)&&e.preventDefault()}},{key:"_onKeyDown",value:function(e){if(e.getModifierState("Meta"))return!1;if(e.ctrlKey||e.altKey)if(!e.ctrlKey||e.altKey||e.shiftKey){if(!e.ctrlKey&&e.altKey&&!e.shiftKey)switch(e.key.toLowerCase()){case"r":case"t":case"w":return this._sendCharCode(e.key.toUpperCase().charCodeAt(0)-64)}}else{var t=1==e.key.length?e.key.toLowerCase():e.key,i=r[t];if(i)return this._sendCharCode(i)}else{if(e.shiftKey&&"Insert"==e.key)return!1;var s=o[e.key];if(s)return this._checkDB(e.key)?this._send(s+s):this._send(s);if(1==e.key.length)return this._send(e.key)}return!1}}]),e}()},function(e,t,i){"use strict";t.symbolTable={};var s=t.symbolTable;s.xa1=1,s.xa0=1,s.xa1=1,s.xa4=1,s.xa7=1,s.xaa=1,s.xae=1,s.xaf=1,s.xb0=1,s.xb1=1,s.xb6=1,s.xb7=1,s.xb8=1,s.xba=1,s.xbf=1,s.xc0=1,s.xc1=1,s.xc2=1,s.xc3=1,s.xc4=1,s.xc5=1,s.xc6=1,s.xc7=1,s.xc8=1,s.xc9=1,s.xca=1,s.xcb=1,s.xcc=1,s.xcd=1,s.xce=1,s.xcf=1,s.xd0=1,s.xd1=1,s.xd2=1,s.xd3=1,s.xd4=1,s.xd5=1,s.xd6=1,s.xd7=1,s.xd8=1,s.xd9=1,s.xda=1,s.xdb=1,s.xdc=1,s.xde=1,s.xdf=1,s.xe0=1,s.xe1=1,s.xe2=1,s.xe3=1,s.xe4=1,s.xe5=1,s.xe6=1,s.xe7=1,s.xe8=1,s.xe9=1,s.xea=1,s.xeb=1,s.xec=1,s.xed=1,s.xee=1,s.xef=1,s.xf0=1,s.xf1=1,s.xf2=1,s.xf3=1,s.xf4=1,s.xf5=1,s.xf6=1,s.xf8=1,s.xf9=1,s.xfa=1,s.xfb=1,s.xfc=1,s.xfe=1,s.xff=1,s.x14a=2,s.x153=1,s.x16b=2,s.x192=1,s.x28c=1,s.x252=2,s.x259=2,s.x25a=2,s.x25c=2,s.x25d=2,s.x26f=2,s.x278=2,s.x287=2,s.x292=2,s.x2a4=2,s.x2a7=2,s.x2cf=2,s.x414=2,s.x41f=2,s.x430=2,s.x431=1,s.x432=2,s.x433=2,s.x434=2,s.x435=2,s.x436=2,s.x437=2,s.x438=2,s.x439=2,s.x43a=1,s.x43b=1,s.x43c=2,s.x43d=2,s.x43e=1,s.x43f=2,s.x440=1,s.x441=2,s.x442=2,s.x445=2,s.x446=2,s.x44b=2,s.x44c=2,s.x44f=2,s.x1e3b=2,s.x1e43=2,s.x1e49=1,s.x1ef2=3,s.x1ef3=1,s.x2010=1,s.x2027=1,s.x211e=1,s.x2122=1,s.x213b=2,s.x2157=1,s.x215c=2,s.x21b2=1,s.x21e6=1,s.x21e8=1,s.x21e9=1,s.x2200=2,s.x2202=1,s.x222c=2,s.x2237=2,s.x2282=2,s.x2401=3,s.x2402=3,s.x2403=3,s.x2404=3,s.x2405=3,s.x2406=3,s.x2407=3,s.x2408=3,s.x2409=3,s.x240a=3,s.x240b=3,s.x240c=3,s.x240d=3,s.x240e=3,s.x240f=3,s.x2410=3,s.x2411=3,s.x2412=3,s.x2413=3,s.x2414=3,s.x2415=3,s.x2416=3,s.x2417=3,s.x2418=3,s.x2419=3,s.x241a=3,s.x241b=3,s.x241c=3,s.x241d=3,s.x241e=3,s.x241f=3,s.x2421=3,s.x246a=2,s.x246b=2,s.x246c=2,s.x246d=2,s.x246e=2,s.x246f=2,s.x2470=2,s.x2471=2,s.x2472=2,s.x2473=2,s.x2503=2,s.x2601=2,s.x2602=2,s.x260e=2,s.x2611=2,s.x261b=2,s.x261c=2,s.x261e=2,s.x261f=2,s.x2620=2,s.x262f=2,s.x2630=2,s.x2631=2,s.x2632=2,s.x2633=2,s.x2634=2,s.x2635=2,s.x2636=2;s.x2637=2,s.x2639=1,s.x263a=2,s.x263b=2,s.x263c=2,s.x263d=2,s.x2660=2,s.x2661=1,s.x2662=1,s.x2663=2,s.x2664=1,s.x2665=2,s.x2666=1,s.x2667=1,s.x266a=1,s.x266c=2,s.x2702=2,s.x2708=2,s.x2709=2,s.x2713=2,s.x2715=2,s.x2721=2,s.x2729=2,s.x274f=2,s.x278e=2,s.x278f=2,s.x2790=2,s.x2791=2,s.x2792=2,s.xe11b=3,s.xe282=3,s.xe568=3,s.xe56b=3,s.xe686=3,s.xe687=3,s.xe7e0=3,s.xe9cc=3,s.xe9ce=3,s.xe9cf=3,s.xeb8b=3,s.xec63=3,s.xec64=3,s.xec65=3,s.xec66=3,s.xec67=3,s.xec6c=1,s.xec6a=1,s.xec6e=3,s.xec71=3,s.xec72=3,s.xec73=3,s.xec74=3,s.xec71=3,s.xec7c=3,s.xec7d=3,s.xec80=3,s.xec83=3,s.xec85=3,s.xec86=3,s.xec87=3,s.xec88=3,s.xec89=3,s.xec8a=3,s.xec8b=3,s.xec8c=3,s.xec8d=3,s.xec8e=3,s.xec8f=3,s.xec90=3,s.xec91=3,s.xec9f=3,s.xeca0=3,s.xeca1=3,s.xeca3=3,s.xeca4=3,s.xeca5=3,s.xeca6=3,s.xeca7=3,s.xeca8=3,s.xeca9=3,s.xeca3=3,s.xecae=3,s.xecb5=3,s.xecb6=3,s.xecb8=3,s.xecc1=3,s.xecc2=3,s.xecc8=3,s.xecca=3,s.xeccb=3,s.xeccc=3,s.xeccd=3,s.xecce=3,s.xed91=3,s.xed92=3,s.xee1e=3,s.xee22=3,s.xee58=3,s.xee5a=3,s.xee5c=3,s.xee5e=3,s.xee5f=3,s.xeeb6=3,s.xf7e6=3,s.xf7e8=3,s.xf7ee=3,s.xf7ef=3,s.xf7f0=3,s.xf7f1=3,s.xf7f2=3,s.xf7f3=3,s.xf7f4=3,s.xf7f5=3,s.xf7f6=3,s.xf7f7=3,s.xf7f8=3,s.xf7f8=3,s.xf7fa=3,s.xf849=3,s.xf84a=3,s.xf84b=3,s.xf84c=3,s.xf84d=3,s.xf84e=3,s.xf84f=3,s.xf850=3,s.xf851=3,s.xf852=3,s.xf853=3,s.xf854=3,s.xf855=3,s.xf856=3,s.xf857=3,s.xf858=3,s.xf859=3,s.xf85a=3,s.xf85b=3,s.xf85c=3,s.xf85d=3,s.xf85e=3,s.xf85f=3,s.xf860=3,s.xf861=3,s.xf862=3,s.xf863=3,s.xf864=3,s.xf865=3,s.xff61=1,s.xff62=1,s.xff63=1,s.xff64=1,s.xff65=1,s.xff66=1,s.xff67=1,s.xff68=1,s.xff69=1,s.xff6a=1,s.xff6b=1,s.xff6c=1,s.xff6d=1,s.xff6e=1,s.xff6f=1,s.xff70=1,s.xff71=1,s.xff72=1,s.xff73=1,s.xff74=1,s.xff75=1,s.xff76=1,s.xff77=1,s.xff78=1,s.xff79=1,s.xff7a=1,s.xff7b=1,s.xff7c=1,s.xff7d=1,s.xff7e=1,s.xff7f=1,s.xff80=1,s.xff81=1,s.xff82=1,s.xff83=1,s.xff84=1,s.xff85=1,s.xff86=1,s.xff87=1,s.xff88=1,s.xff89=1,s.xff8a=1,s.xff8b=1,s.xff8c=1,s.xff8d=1,s.xff8e=1,s.xff8f=1,s.xff90=1,s.xff91=1,s.xff92=1,s.xff93=1,s.xff94=1,s.xff95=1;s.xff96=1,s.xff97=1,s.xff98=1,s.xff99=1,s.xff9a=1,s.xff9b=1,s.xff9c=1,s.xff9d=1,s.xff9e=1,s.xff9f=1,s.xfffd=3},function(e,t,i){"use strict";"use struct";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=t.ImageURL=function(){function e(){s(this,e)}return n(e,null,[{key:"register",value:function(e){this._providers||(this._providers=[]),this._providers.push(e)}},{key:"create",value:function(e){var t=!0,i=!1,s=void 0;try{for(var n,o=this._providers[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value,a=r.create(e);if(a)return a}}catch(e){i=!0,s=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw s}}return null}}]),e}(),r=function(){function e(t){s(this,e),this._photoID=t}return n(e,null,[{key:"base58_decode",value:function(e){for(var t="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",i=e.length,s=0,n=1,o=i-1;o>=0;o--)s+=n*t.indexOf(e[o]),n*=t.length;return s}},{key:"create",value:function(t){var i=t.match("flic.kr/p/(\\w+)|flickr.com/photos/[\\w@]+/(\\d+)");if(!i)return null;var s=i[1];return new e(s?this.base58_decode(s):i[2])}}]),n(e,[{key:"fetchSrc",value:function(){var e="https://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key=c8c95356e465b8d7398ff2847152740e&photo_id="+encodeURIComponent(this._photoID)+"&format=json&jsoncallback=?";return new Promise(function(t,i){$.getJSON(e,function(e){if(e.photo){var s=e.photo,n="https://farm"+s.farm+".staticflickr.com/"+s.server+"/"+s.id+"_"+s.secret+".jpg";t(n)}else i()})})}}]),e}();o.register(r);var a=function(){function e(t){s(this,e),this._href=t}return n(e,null,[{key:"create",value:function(t){return t.match("^https?://(i.)?imgur.com/")?new e(t):null}}]),n(e,[{key:"fetchSrc",value:function(){var e=this._href.replace(/^https?:\/\/imgur.com/,"https://i.imgur.com")+".jpg";return Promise.resolve(e)}}]),e}();o.register(a);var c=function(){function e(){s(this,e)}return n(e,[{key:"fetchSrc",value:function(){return Promise.reject("not implemented")}}],[{key:"create",value:function(e){return null}}]),e}();o.register(c)},function(e,t,i){"use strict";t.en_US={appName:{message:"PttChrome",description:"The title of the application, displayed in the web store."},appDesc:{message:"A GNU/GPL telnet client extension specifically designed for BBS browsing.",description:"The description of the application, displayed in the web store."},menu_coloredCopy:{message:"Copy with ANSI color"},menu_goToOtherSite:{message:"Other site"},menu_paste:{message:"Paste"},menu_selectAll:{message:"Select all"},menu_mouseBrowsing:{message:"Mouse"},menu_settings:{message:"Settings"},cmenu_copy:{message:"Copy"},cmenu_copyAnsi:{message:"Copy with ANSI colors"},cmenu_paste:{message:"Paste"},cmenu_selectAll:{message:"Select all"},cmenu_searchGoogle:{message:"Search Google for"},cmenu_quickSearch:{message:"Quick Search"},cmenu_openUrlNewTab:{message:"Open link in new tab"},cmenu_copyLinkUrl:{message:"Copy link address"},cmenu_mouseBrowsing:{message:"Mouse browsing"},cmenu_goToOtherSite:{message:"Go to other site ..."},cmenu_showInputHelper:{message:"Input helper ..."},cmenu_showLiveArticleHelper:{message:"Live article helper ..."},cmenu_addBlacklistUserId:{message:"Add blacklist user"},cmenu_removeBlacklistUserId:{message:"Remove blacklist user"},cmenu_settings:{message:"Settings"},cmenu_restartInTab:{message:"Restart PttChrome in a new tab"},options_general:{message:"General"},options_autologin:{message:"Auto login"},options_blacklist:{message:"Blacklist"},options_extensions:{message:"Extensions"},options_about:{message:"About"},options_openInPackagedApp:{message:"Launch PttChrome in packaged app."},options_closeQuery:{message:"Ask before closing tab."},options_enablePicPreview:{message:"Enable preview when hover on image URLs."},options_enableNotifications:{message:"Enable notifications when a message is received."},options_enableEasyReading:{message:"Enable easy reading article view."},options_endTurnsOnLiveUpdate:{message:"Press END turns on pushthread live update."},options_copyOnSelect:{message:"Copy text when selected."},options_enableDeleteDupLogin:{message:"When asked to disconnect other logged-in connections, answer:"},options_preferences:{message:"Preferences"},options_antiIdleTime:{message:"Anti-idle interval (sec)"},options_lineWrap:{message:"Wrap line for pasting text longer than"},options_reset:{message:"Restore defaults"},options_appearance:{message:"Appearance"},options_bbsMargin:{message:"Margins around BBS view (px)"},options_fontFitWindowWidth:{message:"Stretch font to fill the view"},options_fontFace:{message:"Font face"},options_mouse:{message:"Mouse"},options_mouseBrowsing:{message:"Mouse browsing"},options_useMouseBrowsing:{message:"Mouse browsing on start"},options_mouseBrowsingHighlight:{message:"Mouse browsing highlight effect"},options_highlightColor:{message:"Color"},options_mouseLeftFunction:{message:"Mouse left button"},options_mouseMiddleFunction:{message:"Mouse middle button"},options_mouseWheelFunction1:{message:"Mouse wheel"},options_mouseWheelFunction2:{message:"Right mouse key + mouse wheel"},options_mouseWheelFunction3:{message:"Left mouse key + mouse wheel"},options_none:{message:"No action"},options_doPaste:{message:"Perform 'Paste'"},options_leftKey:{message:"Sends LEFT key"},options_rightKey:{message:"Sends RIGHT key"},options_enterKey:{message:"Sends ENTER key"},options_upDown:{message:"Controls up / down"},options_pageUpDown:{message:"Controls pageup / pagedown"},options_threadLastNext:{message:"Controls thread previous / next"},options_enableBlacklist:{message:"Enable user blacklist feature"},options_blacklistInstruction:{message:"Type in the usernames in the textarea below, one per line"},autologin_username:{message:"Username"},autologin_password:{message:"Password"},autologin_warning:{message:"Login info is not encrypted, DO NOT use on a public machine"},ext_quickSearch:{message:"Quick Search"},ext_addQuickSearchNamePlaceholder:{message:"Add search engine"},ext_addQuickSearchQueryPlaceholder:{message:"URL with %s in place of query"},about_appName_subtitle:{message:"An open source BBS client"},about_description:{message:"Originally written by #link_github_iamchucky#. This is a modified version by #link_github_robertabcd#. It supports connecting over Websocket, and works on most browsers."},about_version_title:{message:"Version"},about_version_current:{message:"This version: #link_robertabcd_PttChrome#, #link_GPL20#."},about_version_original:{message:"Original version: webapp12 6/2/2015, #link_iamchucky_PttChrome#, #link_GPL20#."},about_new_title:{message:"What's new"},about_new_content:{message:["Allow setting keepAlive from url, append ?keepAlive=[SECONDS] to the URL","Added SSH connection to PTT, append ?ssh=true to the URL","Limited easy reading mode to ptt.cc only","Added features to load/backup blacklist with Google Drive","Suggest to try port 443 when disconnected","Settings to answer duplicated connection query in autologin settings","Added Live Article Helper in context menu to auto refresh pushthread, or use Alt + r","Switching easy reading mode in settings no longer require a restart","Disabled hammerjs that caused mouse related issue on old Chrome verisons","Fixing bug with spacebar when in chinese input mode and easy reading mode","Fixing ssh connection problem with kex","Added option to ask before closing","Added setting to send right arrow key to left mouse button","Added option to turn on live update with END","Middle mouse button click has new option to do paste","Added option to enable copy on select","Added Quick Search in settings and context menu (thanks to abccbaandy)"]},alert_developerModeHeader:{message:"Developer Mode"},alert_developerModeText:{message:"You are using developer mode. Things may break in this version of PttChrome. Use this at your own risk."},alert_developerModeDismiss:{message:"Yes, I understand."},alert_connectionHeader:{message:"You are disconnected!"},alert_connectionText:{message:"Would you like to reconnect to the site?"},alert_connectionReconnect:{message:"Reconnect (ENTER)"},alert_connectionPortOption1:{message:"or"},alert_connectionPortOption2:{message:"Try with port 443"},alert_pasteShortcutHeader:{message:"Paste"},alert_pasteShortcutText:{message:"Please use Shift+Insert to paste"},alert_pasteShortcutClose:{message:"OK"},notification_said:{message:"says:"},input_sitePlaceholder:{message:"input URL here and then press ENTER"},inputHelperTitle:{message:"Input helper"},colorTitle:{message:"Color"},colorHelperSend:{message:"Send ANSI color code"},colorHelperSendMenuFore:{message:"Send foreground only"},colorHelperSendMenuBack:{message:"Send background only"},colorHelperSendMenuReset:{message:"Send reset code"},colorHelperBlink:{message:"Blink"},colorHelperPreview:{message:"▅ PREVIEW ▅"},colorHelperTooltip1:{message:"Left click: foreground color"},colorHelperTooltip2:{message:"Right click: background color, upper row only"},symTitle:{message:"Symbols"},symTitle_general:{message:"General"},symTitle_lineBorders:{message:"Line borders"},symTitle_blocks:{message:"Blocks"},symTitle_lines:{message:"Lines"},symTitle_special:{message:"Special"},symTitle_brackets:{message:"Brackets"},symTitle_greek:{message:"Greek"},symTitle_phonetic:{message:"Phonetic"},symTitle_math:{message:"Math"},symTitle_hiragana:{message:"Hiragana"},symTitle_katakana:{message:"Katakana"},emoTitle:{message:"Emoticons"},emoTitle_angry:{message:"Angry"},emoTitle_meh:{message:"Meh"},emoTitle_sweat:{message:"Sweat & awkward"},emoTitle_happy:{message:"Happy"},emoTitle_other:{message:"Others"},liveHelperEnable:{message:"Enable"},liveHelperSpan:{message:"pushthread refreshes every"},liveHelperSpanSec:{message:"sec"},tooltip_antiIdleTime:{message:"Input 0 to disable this feature."},tooltip_fontFace:{message:"Separate each font with a comma, start with the desired font and end with a generic font."}}},function(e,t,i){"use strict";t.zh_TW={appName:{message:"PttChrome",description:"The title of the application, displayed in the web store."},appDesc:{message:"專為 BBS 瀏覽設計，採 GNU/GPL 授權的 telnet 連線程式套件",description:"The description of the application, displayed in the web store."},menu_coloredCopy:{message:"複製 (包含 ANSI 顏色)"},menu_goToOtherSite:{message:"其他站台"},menu_paste:{message:"貼上"},menu_selectAll:{message:"全選"},menu_mouseBrowsing:{message:"滑鼠瀏覽"},menu_settings:{message:"設定"},cmenu_copy:{message:"複製"},cmenu_copyAnsi:{message:"複製 (包含 ANSI 顏色)"},cmenu_paste:{message:"貼上"},cmenu_selectAll:{message:"全選"},cmenu_searchGoogle:{message:"在 Google 上搜尋"},cmenu_quickSearch:{message:"快速搜尋"},cmenu_openUrlNewTab:{message:"在新分頁中開啟連結"},cmenu_copyLinkUrl:{message:"複製連結網址"},cmenu_mouseBrowsing:{message:"滑鼠瀏覽"},cmenu_goToOtherSite:{message:"去其他站台 ..."},cmenu_showInputHelper:{message:"輸入小幫手 ..."},cmenu_showLiveArticleHelper:{message:"Live 文小幫手 ..."},cmenu_addBlacklistUserId:{message:"在黑名單裡加入使用者"},cmenu_removeBlacklistUserId:{message:"在黑名單裡移除使用者"},cmenu_settings:{message:"設定"},cmenu_restartInTab:{message:"在新分頁重新開啟 PttChrome"},options_general:{message:"一般"},options_autologin:{message:"自動登入"},options_blacklist:{message:"黑名單"},options_extensions:{message:"額外功能"},options_about:{message:"關於"},options_openInPackagedApp:{message:"'批' 圖示會在獨立視窗開啟 PttChrome"},options_closeQuery:{message:"關閉分頁時先詢問"},options_enablePicPreview:{message:"當滑鼠在圖片連結上時顯示圖片預覽"},options_enableNotifications:{message:"啟用水球通知"},options_enableEasyReading:{message:"啟用文章好讀模式"},options_endTurnsOnLiveUpdate:{message:"END 啟用推文即時更新 (如 Alt + r)"},options_copyOnSelect:{message:"選取文字時自動複製文字"},options_enableDeleteDupLogin:{message:"當被問到是否刪除其他重複登入的連線，回答:"},options_preferences:{message:"設定"},options_antiIdleTime:{message:"防閒置間隔 (秒)"},options_lineWrap:{message:"自動換行, 當貼上的字長於"},options_reset:{message:"設回預設值"},options_appearance:{message:"介面"},options_bbsMargin:{message:"BBS 周圍邊距 (像素)"},options_fontFitWindowWidth:{message:"把字體拉大來補滿畫面"},options_fontFace:{message:"字型"},options_mouseBrowsing:{message:"滑鼠瀏覽"},options_useMouseBrowsing:{message:"預設使用滑鼠瀏覽"},options_mouseBrowsingHighlight:{message:"啟用滑鼠瀏覽的底色效果"},options_highlightColor:{message:"底色"},options_mouseLeftFunction:{message:"滑鼠左鍵"},options_mouseMiddleFunction:{message:"滑鼠中鍵"},options_mouseWheelFunction1:{message:"滑鼠滾輪"},options_mouseWheelFunction2:{message:"滑鼠右鍵 + 滑鼠滾輪"},options_mouseWheelFunction3:{message:"滑鼠左鍵 + 滑鼠滾輪"},options_none:{message:"無動作"},options_doPaste:{message:"執行 '貼上'"},options_leftKey:{message:"送出左方向鍵"},options_rightKey:{message:"送出右方向鍵"},options_enterKey:{message:"送出ENTER鍵"},options_upDown:{message:"控制上 / 下"},options_pageUpDown:{message:"控制上頁 / 下頁"},options_threadLastNext:{message:"控制文章前篇 / 下篇"},options_enableBlacklist:{message:"啟用使用者黑名單功能"},options_blacklistInstruction:{message:"請在下面輸入所有欲加入黑名單的使用者ID, 每行一個"},autologin_username:{message:"帳號"},autologin_password:{message:"密碼"},autologin_warning:{message:"帳號密碼沒有加密儲存, 千萬不要在公用電腦上使用"},ext_quickSearch:{message:"快速搜尋"},ext_addQuickSearchNamePlaceholder:{message:"新增搜尋引擎"},ext_addQuickSearchQueryPlaceholder:{message:"網址以 %s 取代網址中的搜尋字詞"},about_appName_subtitle:{message:"開放原始碼的 BBS 瀏覽軟體"},about_description:{message:"原作者為 #link_github_iamchucky#。此版本是由 #link_github_robertabcd# 修改，使用 Websocket 加密連線，並支援大多數瀏覽器。"},about_version_title:{message:"版本"},about_version_current:{message:"此版本：#link_robertabcd_PttChrome#, #link_GPL20#."},about_version_original:{message:"原版本：webapp12 6/2/2015, #link_iamchucky_PttChrome#, #link_GPL20#."},about_new_title:{message:"新功能"},about_new_content:{message:["網址設定 keepAlive 參數, 只要在網址後面加上 ?keepAlive=[幾秒]","加入了 SSH 連到 PTT 的功能, 只要在網址後面加上 ?ssh=true","好讀模式只限於 ptt.cc 上使用","黑名單可用 Google Drive 來讀取或備份","斷線提示用 443 端口連線","自動登入設定頁面可設定是否自動刪除其他重複連線","右鍵選單新增 Live 文小幫手來自動更新推文, 也可用 Alt + r 來啟動","設定中切換好讀模式不用再重新整理即可切換","暫時停用 hammerjs 避免在舊的 Chrome 造成滑鼠圈選的問題","修正中文輸入法時好讀模式的空白鍵的問題","修正 ssh 連線 kex 的問題","加入了關閉分頁先詢問的選項","加入了滑鼠左鍵送出右方向鍵的選項","加入了 END 啟用即時更新的選項","滑鼠中鍵可以設定執行貼上功能","加入了選取自動複製文字的選項","新增了快速搜尋的功能 (感謝abccbaandy)"]},alert_developerModeHeader:{message:"開發者模式"},alert_developerModeText:{message:"您正在使用開發者模式。此版本的 PttChrome 並不穩定，無法保證所有功能會正常運作。"},alert_developerModeDismiss:{message:"是，我瞭解了"},alert_connectionHeader:{message:"你斷線了!"},alert_connectionText:{message:"現在要重新連線嗎?"},alert_connectionReconnect:{message:"重新連線 (ENTER)"},alert_connectionPortOption1:{message:"或"},alert_connectionPortOption2:{message:"用443端口連線"},alert_pasteShortcutHeader:{message:"貼上"},alert_pasteShortcutText:{message:"請使用 Shift+Insert 快速鍵來貼上。"},alert_pasteShortcutClose:{message:"確定"},notification_said:{message:"說:"},input_sitePlaceholder:{message:"在此輸入站台地址後按 ENTER"},inputHelperTitle:{message:"輸入小幫手"},colorTitle:{message:"上色"},colorHelperSend:{message:"送出 ANSI 顏色字元"},colorHelperSendMenuFore:{message:"只送出前景色彩"},colorHelperSendMenuBack:{message:"只送出背景色彩"},colorHelperSendMenuReset:{message:"送出色彩還原碼"},colorHelperBlink:{message:"閃爍"},colorHelperPreview:{message:"▅ 預 覽 ▅"},colorHelperTooltip1:{message:'點滑鼠"左"鍵選"前景"顏色'},colorHelperTooltip2:{message:'點滑鼠"右"鍵選"背景"顏色 (上排)'},symTitle:{message:"符號"},symTitle_general:{message:"一般"},symTitle_lineBorders:{message:"線條邊框"},symTitle_blocks:{message:"方塊"},symTitle_lines:{message:"線條"},symTitle_special:{message:"特殊"},symTitle_brackets:{message:"括弧"},symTitle_greek:{message:"希臘"},symTitle_phonetic:{message:"注音"},symTitle_math:{message:"數學"},symTitle_hiragana:{message:"平假名"},symTitle_katakana:{message:"片假名"},emoTitle:{message:"表情"},emoTitle_angry:{message:"生氣"},emoTitle_meh:{message:"酸民"},emoTitle_sweat:{message:"汗顏加三條線"},emoTitle_happy:{message:"開心"},emoTitle_other:{message:"其他"},liveHelperEnable:{message:"啟用"},liveHelperSpan:{message:"推文每"},liveHelperSpanSec:{message:"秒自動更新"},tooltip_antiIdleTime:{message:"輸入 0 可停用這功能。"},tooltip_fontFace:{message:"以逗號隔開，由欲套用的字型開始至較通用的字型。"}}},function(e,t,i){"use strict";function s(e){this.socket=e,this.socket.addEventListener("open",this._onOpen.bind(this)),this.socket.addEventListener("data",this._onDataAvailable.bind(this)),this.socket.addEventListener("close",this._onClose.bind(this)),this.state=o,this.iac_sb="",this.termType="VT100"}Object.defineProperty(t,"__esModule",{value:!0}),t.TelnetConnection=s;var n=i(2),o=0;n.Event.mixin(s.prototype),s.prototype._onOpen=function(e){this.dispatchEvent(new CustomEvent("open"))},s.prototype._onClose=function(e){this.dispatchEvent(new CustomEvent("close"))},s.prototype._onDataAvailable=function(e){for(var t=e.detail.data,i="",s=t.length;s>0;){var n=t;s-=n.length;for(var r=n.length,a=0;a<r;++a){var c=n[a];switch(this.state){case o:"ÿ"==c?(i&&(this._dispatchData(i),i=""),this.state=1):i+=c;break;case 1:switch(c){case"û":this.state=2;break;case"ü":this.state=3;break;case"ý":this.state=4;break;case"þ":this.state=5;break;case"ú":this.state=6;break;default:this.state=o}break;case 2:switch(c){case"":case"":this._sendRaw("ÿý"+c);break;default:this._sendRaw("ÿþ"+c)}this.state=o;break;case 4:switch(c){case"":this._sendRaw("ÿû"+c);break;case"":break;default:this._sendRaw("ÿü"+c)}this.state=o;break;case 5:case 3:this.state=o;break;case 6:if(this.iac_sb+=c,"ÿð"==this.iac_sb.slice(-2)){switch(this.iac_sb[0]){case"":var l="ÿú\0"+this.termType+"ÿð";this._sendRaw(l)}this.state=o,this.iac_sb="";break}}}i&&(this._dispatchData(i),i="")}},s.prototype._dispatchData=function(e){this.dispatchEvent(new CustomEvent("data",{detail:{data:e}}))},s.prototype.send=function(e){this._sendRaw(e)},s.prototype._sendRaw=function(e){e&&this.socket.send(e)},s.prototype.convSend=function(e){var t=e.u2b();t&&(t=t.ansiHalfColorConv(),this._sendRaw(t))},s.prototype.sendNaws=function(e,t){var i=String.fromCharCode(Math.floor(e/256),e%256,Math.floor(t/256),t%256).replace(/(\xff)/g,"ÿÿ"),s="ÿú"+i+"ÿð";this._sendRaw(s)}},function(e,t,i){"use strict";function s(e){this._conn=new WebSocket(e),this._conn.binaryType="arraybuffer",this._conn.addEventListener("open",this._onOpen.bind(this)),this._conn.addEventListener("message",this._onMessage.bind(this)),this._conn.addEventListener("error",this._onError.bind(this)),this._conn.addEventListener("close",this._onClose.bind(this))}Object.defineProperty(t,"__esModule",{value:!0}),t.Websocket=s,i(2).Event.mixin(s.prototype),s.prototype._onOpen=function(e){this.dispatchEvent(new CustomEvent("open"))},s.prototype._onMessage=function(e){var t=new Uint8Array(e.data);this.dispatchEvent(new CustomEvent("data",{detail:{data:String.fromCharCode.apply(String,t)}}))},s.prototype._onError=function(e){this.dispatchEvent(new CustomEvent("error"))},s.prototype._onClose=function(e){this.dispatchEvent(new CustomEvent("close"))},s.prototype.send=function(e){for(var t=0;t<e.length;t+=1e3){var i=e.substring(t,t+1e3),s=new Uint8Array(i.split("").map(function(e){return e.charCodeAt(0)}));this._conn.send(s.buffer)}},s.prototype.close=function(){this._conn.close()}},function(e,t,i){"use strict";function s(e,t,i){function s(e,t,i,s){s||(s=t),Object.defineProperty(i,s,{get:function(){return e[t]},set:function(i){e[t]=i}})}this._core=e,this._view=t,this._termBuf=i,this._turnPageLines=22,this.easyReadingReachedPageEnd=!1,this.sendCommandAfterUpdate="",this.ignoreOneUpdate=!1,s(this._view,"useEasyReadingMode",this,"_enabled"),s(this._termBuf,"startedEasyReading",this),s(this._termBuf,"easyReadingShowReplyText",this),s(this._termBuf,"easyReadingShowPushInitText",this),this._termBuf.addEventListener("change",this._onChanged.bind(this)),this._termBuf.addEventListener("viewUpdate",this._onViewUpdated.bind(this))}Object.defineProperty(t,"__esModule",{value:!0}),t.EasyReading=s,s.prototype._onChanged=function(e){if(console.log("page state: "+this._termBuf.prevPageState+"->"+this._termBuf.pageState),2==this._termBuf.prevPageState&&3==this._termBuf.pageState&&!this._enabled&&this._core.pref.values.enableEasyReading&&this._core.connectedUrl.easyReadingSupported?this._enabled=!0:this._core.pref.values.enableEasyReading||(this._enabled=!1),this._enabled){var t=this._termBuf.getRowText(23,0,this._termBuf.cols);if(3==this._termBuf.pageState?this.startedEasyReading=!0:this.startedEasyReading&&t.parseReqNotMetText()?this.easyReadingShowPushInitText=!0:(this.easyReadingShowReplyText=!1,this.easyReadingShowPushInitText=!1,this.startedEasyReading=!1),this.startedEasyReading)if(console.log("easy reading cursor pos: "+this._termBuf.cur_y+":"+this._termBuf.cur_x),23==this._termBuf.cur_y&&79==this._termBuf.cur_x){if(this.ignoreOneUpdate)return void(this.ignoreOneUpdate=!1);var i=t.parseStatusRow();if(i){var s=this._termBuf.lines[23][0];4==s.getBg()&&7==s.getFg()?this.easyReadingReachedPageEnd=!0:(this.easyReadingReachedPageEnd=!1,this.sendCommandAfterUpdate||(this.sendCommandAfterUpdate="[6~"))}else this.easyReadingShowPushInitText||(this._termBuf.pageState=5,this.startedEasyReading=!1)}else if(23==this._termBuf.cur_y){if(!this.easyReadingShowPushInitText){var t=this._termBuf.getRowText(23,0,this._termBuf.cols),i=t.parsePushInitText();if(!i)return void(this.easyReadingShowPushInitText=!1);this.easyReadingShowPushInitText=!0}}else{if(22!=this._termBuf.cur_y)return;var n=this._termBuf.getRowText(22,0,this._termBuf.cols),i=n.parseReplyText();if(!i)return void(this.easyReadingShowReplyText=!1);this.easyReadingShowReplyText=!0}}},s.prototype._onViewUpdated=function(e){console.log("view update"),this.sendCommandAfterUpdate&&(console.log("send:"+this.sendCommandAfterUpdate),"skipOne"!=this.sendCommandAfterUpdate&&this._send(this.sendCommandAfterUpdate),this.sendCommandAfterUpdate="")},s.prototype.leaveCurrentPost=function(){console.log("leave curent post"),this.easyReadingReachedPageEnd||(this.ignoreOneUpdate=!0),this._termBuf.prevPageState=0},s.prototype.stopEasyReading=function(){console.log("stop easy reading"),this.sendCommandAfterUpdate="skipOne"},s.prototype._send=function(e){this._view.conn.send(e)},s.prototype._onKeyDown=function(e){if(this._enabled&&this.startedEasyReading&&(this._onKeyDownProcessUI(e),!e.defaultPrevented)){var t=!1;if(e.ctrlKey||e.altKey){if(e.ctrlKey&&!e.altKey)switch(e.key){case"h":this._send("[D[A[C"),t=!0}}else switch(e.key){case"Backspace":case"ArrowUp":this._send("[D[A[C"),t=!0;break;case"ArrowDown":this._send("[D[B[C"),t=!0}t&&e.preventDefault()}},s.prototype._scrollBy=function(e){var t=this._view.mainDisplay;return!(e<0&&0==t.scrollTop)&&(!(e>0&&t.scrollTop>=this._view.mainContainer.clientHeight-this._view.chh*this._termBuf.rows)&&(t.scrollTop+=this._view.chh*e,!0))},s.prototype._scrollEnd=function(){return this._view.mainDisplay.scrollTop=this._view.mainContainer.clientHeight,!0},s.prototype._scrollTop=function(){return this._view.mainDisplay.scrollTop=0,!0},s.prototype._onKeyDownProcessUI=function(e){var t=!1;if(e.ctrlKey||e.altKey){if(e.ctrlKey&&!e.altKey)switch(e.key){case"f":this._scrollBy(this._turnPageLines),t=!0;break;case"b":this._scrollBy(-this._turnPageLines),t=!0;break;case"h":t=this._scrollBy(-this._turnPageLines),t||this.leaveCurrentPost();break;default:if("@^_?".indexOf(e.key)>=0){t=!0;break}}}else switch(e.key){case"Backspace":t=this._scrollBy(-this._turnPageLines),t||this.leaveCurrentPost();break;case"ArrowRight":case" ":case"t":t=this._scrollBy(this._turnPageLines),t||this.leaveCurrentPost();break;case"PageUp":this._scrollBy(-this._turnPageLines),t=!0;break;case"PageDown":this._scrollBy(this._turnPageLines),t=!0;break;case"ArrowLeft":this.stopEasyReading();break;case"ArrowUp":t=this._scrollBy(-1),t||this.leaveCurrentPost();break;case"Enter":case"ArrowDown":t=this._scrollBy(1),t||this.leaveCurrentPost();break;case"k":this._scrollBy(-1),t=!0;break;case"j":this._scrollBy(1),t=!0;break;case"Home":case"0":case"g":t=this._scrollTop();break;case"End":case"$":case"G":t=this._scrollEnd();break;case"Tab":t=!0;break;default:if("abf=+-[]ABF".indexOf(e.key)>=0){this.leaveCurrentPost();break}if("123456789hops;,./\\H#OP:<>".indexOf(e.key)>=0){t=!0;break}}t&&e.preventDefault()},s.prototype._onMouseClick=function(e){if(this._enabled&&this.startedEasyReading){var t=!1;switch(this._termBuf.mouseCursor){case 0:case 1:this.stopEasyReading();break;case 2:this._scrollBy(-this._turnPageLines),t=!0;break;case 3:this._scrollBy(this._turnPageLines),t=!0;break;case 4:this._scrollTop(),t=!0;break;case 5:this._scrollEnd(),t=!0;break;case 6:case 7:break;case 8:case 9:case 10:case 12:case 13:case 14:this.leaveCurrentPost()}t&&e.preventDefault()}}},function(e,t,i){"use strict";function s(e){this.app=e,this.node=document.getElementById("inputHelper"),this.nodeOffsetTop=20,this.nodeOffsetLeft=20,this.mouseDown=!1,this.clickedOn=!1,this.colorHelperBlinkCheckbox=null,this.colorHelperPreview=null,this.colorHelperPreviewFgShown=!0,this.colorHelperFg=7,this.colorHelperBg=0,this.colorHelperIsBlink=!1,this.blinkTimer=null,this.symbols=null,this.emoticons=null,this.setupUi(),this.registerHandlers()}Object.defineProperty(t,"__esModule",{value:!0}),t.InputHelper=s;var n=i(20),o=i(21),r=i(0),a=i(1);s.prototype.setupUi=function(){var e=this;document.querySelector("#inputHelper .modal-title").textContent=(0,r.i18n)("inputHelperTitle"),document.getElementById("colorHelperSend").textContent=(0,r.i18n)("colorHelperSend"),document.getElementById("colorHelperBlink").innerHTML='<label><input id="colorHelperBlinkCheckbox" type="checkbox">'+(0,r.i18n)("colorHelperBlink")+"</label>",document.getElementById("colorHelperPreview").textContent=(0,r.i18n)("colorHelperPreview"),document.getElementById("inputHelperClose").addEventListener("click",function(t){e.hideHelper()}),document.querySelector("#colorsTabTitle a").textContent=(0,r.i18n)("colorTitle"),$("#colorHelperSendMenuFore").text((0,r.i18n)("colorHelperSendMenuFore")),$("#colorHelperSendMenuBack").text((0,r.i18n)("colorHelperSendMenuBack")),$("#colorHelperSendMenuReset").text((0,r.i18n)("colorHelperSendMenuReset")),this.symbols=new o.Symbols(this.app),this.emoticons=new n.Emoticons(this.app)},s.prototype.onMouseDrag=function(e){window.getSelection().removeAllRanges(),this.nodeOffsetTop+=e.movementY,this.nodeOffsetLeft+=e.movementX,this.node.style.cssText+="top:"+this.nodeOffsetTop+"px;left:"+this.nodeOffsetLeft+"px;"},s.prototype.registerHandlers=function(){var e=this,t=document.getElementById("colorHelperList"),i="<div>"+(0,r.i18n)("colorHelperTooltip1")+"</div><div>"+(0,r.i18n)("colorHelperTooltip2")+"</div>";$(t).tooltip({html:!0,title:i}),this.colorHelperBlinkCheckbox=document.getElementById("colorHelperBlinkCheckbox"),this.colorHelperPreview=document.getElementById("colorHelperPreview"),document.getElementById("colorHelperBlink").addEventListener("click",function(t){var i=e.colorHelperBlinkCheckbox.checked;i!=e.colorHelperIsBlink&&(e.colorHelperIsBlink=i,i?e.blinkTimer=(0,a.setTimer)(!0,function(){e.colorHelperPreviewFgShown?e.colorHelperPreview.style.color="transparent":e.colorHelperPreview.style.color="",e.colorHelperPreviewFgShown=!e.colorHelperPreviewFgShown},1e3):(e.blinkTimer.cancel(),e.blinkTimer=null,e.colorHelperPreview.style.color="",e.colorHelperPreviewFgShown=!0)),t.stopPropagation()}),document.getElementById("colorHelperSend").addEventListener("click",function(t){e.sendColorCommand()}),document.getElementById("colorHelperSendMenu").addEventListener("click",function(t){t.target.hasAttribute("type")&&e.sendColorCommand(t.target.getAttribute("type"))}),t.addEventListener("click",function(t){t.target.hasAttribute("value")&&(1==t.which&&(e.colorHelperFg=parseInt(t.target.getAttribute("value")),e.colorHelperPreview.setAttribute("class","q"+e.colorHelperFg+" b"+e.colorHelperBg)),t.preventDefault(),t.stopPropagation())}),t.addEventListener("contextmenu",function(t){if(t.target.hasAttribute("value")){var i=parseInt(t.target.getAttribute("value"));if(i>7)return t.preventDefault(),void t.stopPropagation();e.colorHelperBg=i,e.colorHelperPreview.setAttribute("class","q"+e.colorHelperFg+" b"+e.colorHelperBg),t.preventDefault(),t.stopPropagation()}}),this.node.addEventListener("mousedown",function(t){1==t.which&&(e.mouseDown=!0)}),this.node.addEventListener("mouseup",function(t){1==t.which&&(e.mouseDown=!1)}),this.node.addEventListener("click",function(t){e.clickedOn=!0}),this.symbols.registerHandlers(),this.emoticons.registerHandlers()},s.prototype.sendColorCommand=function(e){if("reset"==e)return void this.app.conn.send("[m");var t=this.colorHelperFg,i="0;";t>7&&(t%=8,i="1;"),t+=30;var s=this.colorHelperBg;s+=40;var n=this.colorHelperIsBlink,o="";n&&(o="5;");var r="[";if(r+="foreground"==e?i+o+t+"m":"background"==e?s+"m":i+o+t+";"+s+"m",!window.getSelection().isCollapsed&&6==this.app.buf.pageState){var a=this.app.view.getSelectionColRow(),c=this.app.buf.cur_y,l="";l+="[H",c>a.end.row?l+="[A".repeat(c-a.end.row):c<a.end.row&&(l+="[B".repeat(a.end.row-c));var h=this.app.buf.getRowText(a.end.row,0,a.end.col).length;l+="[C".repeat(h)+"[m",c=a.end.row,l+="[H",c>a.start.row?l+="[A".repeat(c-a.start.row):c<a.start.row&&(l+="[B".repeat(a.start.row-c)),h=this.app.buf.getRowText(a.start.row,0,a.start.col).length,l+="[C".repeat(h),r=l+r}this.app.conn.send(r)},s.prototype.showHelper=function(){this.node.style.display="block"},s.prototype.hideHelper=function(){this.node.style.display="none"}},function(e,t,i){"use strict";function s(e){this.app=e,this.tab=document.getElementById("inputHelperTabContent"),this.setupUi()}Object.defineProperty(t,"__esModule",{value:!0}),t.Emoticons=s;var n=i(0),o={angry:["(ノ ゜Д゜)ノ ︵ ═╩════╩═","╯-____-)╯~═╩════╩═~","(╭∩╮\\_/╭∩╮)","( ︶︿︶)_╭∩╮","( ‵□′)───C＜─___-)|||","(￣ε(#￣) #○=(一-一o)","(o一-一)=○# (￣#)3￣)","╰(‵皿′＊)╯","○(#‵︿′ㄨ)○","◢▆▅▄▃-崩╰(〒皿〒)╯潰-▃▄▅▆◣"],meh:["(σ′▽‵)′▽‵)σ 哈哈哈哈～你看看你","( ￣ c￣)y▂ξ","( ′-`)y-～","′_>‵","╮(′～‵〞)╭",'╮(﹀_﹀")╭',"︿(￣︶￣)︿","..╮(﹋﹏﹌)╭..","╮(╯_╰)╭","╮(╯▽╰)/"],sweat:["(－^－)ｄ","(￣￣；)","(￣□￣|||)a","(●；－_－)●","￣▽￣||","╭ ﹀◇﹀〣","ˋ(′_‵||)ˊ","●( ¯▽¯；●","o(＞＜；)o o"],happy:["~(￣▽￣)~(＿△＿)~(￣▽￣)~(＿△＿)~(￣▽￣)~","(~^O^~)","(∩_∩)","<(￣︶￣)>","v(￣︶￣)y","﹨(╯▽╰)∕","\\(@^0^@)/","\\(^▽^)/","\\⊙▽⊙/"],other:["(．＿．?)","(？o？)","(‧Q‧)","〒△〒","m川@.川m","(¯(∞)¯)","(⊙o⊙)","(≧<>≦)","(☆_☆)",'o(‧"‧)o']};s.prototype.setupUi=function(){var e="",t="";for(var i in o){t+='<li><a href="#emo_'+i+'_list" name="'+i+'" data-toggle="tab">'+(0,n.i18n)("emoTitle_"+i)+"</a></li>";e+='<ul id="emo_'+i+'_list" class="tab-pane emoList" style="height:'+27*o[i].length+'px;"><li>'+o[i].join("</li><li>")+"</li></ul>"}this.tab.innerHTML+=e,document.querySelector("#emoticonsTabTitle .dropdown-menu").innerHTML=t,document.querySelector("#emoticonsTabTitle .dropdown-toggle").innerHTML=(0,n.i18n)("emoTitle")+' <span class="caret"></span>'},s.prototype.registerHandlers=function(){var e=this;$("#emoticonsTabTitle .dropdown-menu a").click(function(e){e.preventDefault(),$(this).tab("show")}),$(".emoList > li").click(function(t){e.app.conn.convSend(t.target.textContent)})}},function(e,t,i){"use strict";function s(e){this.app=e,this.tab=document.getElementById("inputHelperTabContent"),this.setupUi()}Object.defineProperty(t,"__esModule",{value:!0}),t.Symbols=s;var n=i(0),o={general:["，","、","。","．","？","！","～","＄","％","＠","＆","＃","＊","‧","；","︰","…","‥","﹐","﹒","˙","·","﹔","﹕","‘","’","“","”","〝","〞","‵","′","〃"],lineBorders:["├","─","┼","┴","┬","┤","┌","┐","│","▕","└","┘","╭","╮","╰","╯","╔","╦","╗","╠","═","╬","╣","╓","╥","╖","╒","╤","╕","║","╚","╩","╝","╟","╫","╢","╙","╨","╜","╞","╪","╡","╘","╧","╛"],blocks:["＿","ˍ","▁","▂","▃","▄","▅","▆","▇","█","▏","▎","▍","▌","▋","▊","▉","◢","◣","◥","◤"],lines:["﹣","﹦","≡","｜","∣","∥","–","︱","—","︳","╴","¯","￣","﹉","﹊","﹍","﹎","﹋","﹌","﹏","︴","∕","﹨","╱","╲","／","＼"],special:["↑","↓","←","→","↖","↗","↙","↘","㊣","◎","○","●","⊕","⊙","△","▲","☆","★","◇","Æ","□","■","▽","▼","§","￥","〒","￠","￡","※","♀","♂"],brackets:["〔","〕","【","】","《","》","（","）","｛","｝","﹙","﹚","『","』","﹛","﹜","﹝","﹞","＜","＞","﹤","﹥","「","」","︵","︶","︷","︸","︹","︺","︻","︼","︽","︾","〈","〉","︿","﹀","﹁","﹂","﹃","﹄"],greek:["Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],phonetic:["ㄅ","ㄆ","ㄇ","ㄈ","ㄉ","ㄊ","ㄋ","ㄌ","ㄍ","ㄎ","ㄏ","ㄐ","ㄑ","ㄒ","ㄓ","ㄔ","ㄕ","ㄖ","ㄗ","ㄘ","ㄙ","ㄚ","ㄛ","ㄜ","ㄝ","ㄞ","ㄟ","ㄠ","ㄡ","ㄢ","ㄣ","ㄤ","ㄥ","ㄦ","ㄧ","ㄨ","ㄩ","˙","ˊ","ˇ","ˋ"],math:["╳","＋","﹢","－","×","÷","＝","≠","≒","∞","ˇ","±","√","⊥","∠","∟","⊿","㏒","㏑","∫","∮","∵","∴","≦","≧","∩","∪"],hiragana:["あ","い","う","え","お","か","き","く","け","こ","さ","し","す","せ","そ","た","ち","つ","て","と","な","に","ぬ","ね","の","は","ひ","ふ","へ","ほ","ま","み","む","め","も","ら","り","る","れ","ろ","が","ぎ","ぐ","げ","ご","ざ","じ","ず","ぜ","ぞ","だ","ぢ","づ","で","ど","ば","び","ぶ","べ","ぼ","ぱ","ぴ","ぷ","ぺ","ぽ","や","ゆ","よ","わ","ん","を"],katakana:["ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ラ","リ","ル","レ","ロ","ガ","ギ","グ","ゲ","ゴ","ザ","ジ","ズ","ゼ","ゾ","ダ","ジ","ズ","デ","ド","バ","ビ","ブ","ベ","ボ","パ","ピ","プ","ペ","ポ","ヤ","ユ","ヨ","ワ","ン","ヲ"]};s.prototype.setupUi=function(){var e="",t="";for(var i in o){t+='<li><a href="#sym_'+i+'_list" name="'+i+'" data-toggle="tab">'+(0,n.i18n)("symTitle_"+i)+"</a></li>";var s=o[i];e+='<ul id="sym_'+i+'_list" class="tab-pane symList" style="height:'+37*Math.ceil(s.length/8)+'px;"><li>'+o[i].join("</li><li>")+"</li></ul>"}this.tab.innerHTML+=e,document.querySelector("#symbolsTabTitle .dropdown-menu").innerHTML=t,document.querySelector("#symbolsTabTitle .dropdown-toggle").innerHTML=(0,n.i18n)("symTitle")+' <span class="caret"></span>'},s.prototype.registerHandlers=function(){var e=this;$("#symbolsTabTitle .dropdown-menu a").click(function(e){e.preventDefault(),$(this).tab("show")}),$(".symList > li").click(function(t){e.app.conn.convSend(t.target.textContent)})}},function(e,t,i){"use strict";function s(e,t){this.values={},this.logins=null,this.app=e,this.shouldResetToDefault=!1,this.enableBlacklist=!1,this.blacklistedUserIds={},this.quickSearches=[],this.onInitializedCallback=t,this.initCallbackCalled=!1}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.PttChromePref=s;var o=i(0),r=i(23);s.prototype={updateSettingsToUi:function(){this.refreshBlacklistOnUi();var e="",t=0,i=function(e){var t="#opt_mouseBrowsingHighlightColor",i=$(t+" select").val(),s=$(t+" .b"+i).css("background-color");$(t+" select").css("background-color",s)};for(var s in this.values){$("#opt_"+s).empty();var r=this.values[s];if("blacklistedUserIds"!==s)if("quickSearchList"!==s)if("deleteDupLogin"!==s)if("mouseBrowsingHighlightColor"!==s)if(s in PREF_OPTIONS){var a="#opt_"+s;e=(0,o.i18n)("options_"+s)+'<select class="form-control">';var c=PREF_OPTIONS[s];for(t=0;t<c.length;++t)e+='<option value="'+t+'">'+(0,o.i18n)(c[t])+"</option>";e+="</select>",$(a).html(e),"boolean"==typeof r&&(r=r?1:0),$(a+" select").val(r)}else{var l="";switch("fontFace"!=s&&"antiIdleTime"!=s||(l=' data-toggle="popover" data-trigger="focus" data-content="'+(0,o.i18n)("tooltip_"+s)+'"'),void 0===r?"undefined":n(r)){case"number":$("#opt_"+s).html('<label style="font-weight:normal;">'+(0,o.i18n)("options_"+s)+'</label><input type="number" class="form-control" value="'+r+'"'+l+">");break;case"string":$("#opt_"+s).html('<label style="font-weight:normal;">'+(0,o.i18n)("options_"+s)+'</label><input type="text" class="form-control" value="'+r+'"'+l+">");break;case"boolean":$("#opt_"+s).html('<label><input type="checkbox" '+(r?"checked":"")+">"+(0,o.i18n)("options_"+s)+"</label>")}"fontFace"!=s&&"antiIdleTime"!=s||$("#opt_"+s+" input").popover()}else{var h="#opt_"+s;for(e=(0,o.i18n)("options_highlightColor")+'<select class="form-control">',t=1;t<16;++t)e+='<option value="'+t+'" class="b'+t+'"></option>';e+="</select>",$(h).html(e),$(h+" select").val(r);var u=$(h+" .b"+r).css("background-color");$(h+" select").css("background-color",u),$(h+" select").on("change",i)}else{var p=$("#opt_deleteDupLoginYes");r&&p.click()}else this.setupQuickSearchUiList(),this.setupQuickSearchUiHandlers()}$("#login_username").html('<label style="font-weight:normal;">'+(0,o.i18n)("autologin_username")+'</label><input type="text" class="form-control" value="'+this.logins[0]+'">'),$("#login_password").html('<label style="font-weight:normal;">'+(0,o.i18n)("autologin_password")+'</label><input type="password" class="form-control" value="'+this.logins[1]+'">')},setupSettingsUi:function(){var e,t=this;$("#opt_title").text((0,o.i18n)("menu_settings")),$("#opt_reset").off(),$("#opt_reset").text((0,o.i18n)("options_reset")),$("#opt_reset").click(function(){t.shouldResetToDefault=!0,$("#prefModal").modal("hide")}),"en_US"==(0,o.getLang)()&&($("#opt_reset").css("fontSize","12px"),$("#opt_reset").css("marginLeft","-10px"));var i="";for(e in PREFS_CATEGORIES)i=PREFS_CATEGORIES[e],$("#opt_"+i).text((0,o.i18n)("options_"+i));for(e in PREFS_NAV)i=PREFS_NAV[e],$("#optNav_"+i).text((0,o.i18n)("options_"+i));$("#opt_tabs a:first").tab("show");$("#modalHeader").text((0,o.i18n)("options_general")),$("#opt_autologinWarning").text((0,o.i18n)("autologin_warning")),$("#opt_blacklistInstruction").text((0,o.i18n)("options_blacklistInstruction")),this.setupExtensionsPage(),this.setupAboutPage(),$("#opt_tabs a").click(function(e){e.preventDefault();var t=$(this).attr("name");$("#modalHeader").text((0,o.i18n)("options_"+t)),$(this).tab("show")})},populateSettingsToUi:function(){var e=this;this.setupSettingsUi(),this.updateSettingsToUi(),$("#prefModal").off(),$("#prefModal").on("show.bs.modal",function(t){var i=.7*document.documentElement.clientWidth;i=i>730?i:730,i-=190;var s=.9*document.documentElement.clientHeight;s=s>400?s:400,s-=76,$("#prefModal .modal-body").css("height",s+"px"),$("#prefModal .modal-body").css("width",i+"px"),$("#opt_blacklistedUsers").css("height",s-150+"px"),e.refreshBlacklistOnUi()}),$("#prefModal").on("shown.bs.modal",function(t){e.app.disableLiveHelper(),e.app.modalShown=!0}),$("#prefModal").on("hidden.bs.modal",function(t){e.shouldResetToDefault?(e.clearStorage(),e.values=JSON.parse(JSON.stringify(DEFAULT_PREFS)),e.blacklistedUserIds={},e.quickSearches=JSON.parse(DEFAULT_PREFS.quickSearchList),e.logins=["",""],e.updateSettingsToUi(),e.app.view.redraw(!0),e.shouldResetToDefault=!1):e.readValueFromUi(),e.saveAndDoneWithIt(),e.app.switchToEasyReadingMode(e.app.view.useEasyReadingMode)})},setupQuickSearchUiList:function(){$("#ext_quickSearch").text((0,o.i18n)("ext_quickSearch"));for(var e='<input type="text" class="form-control qSearchItemName" placeholder="'+(0,o.i18n)("ext_addQuickSearchNamePlaceholder")+'" /><input type="text" class="form-control qSearchItemQuery" placeholder="'+(0,o.i18n)("ext_addQuickSearchQueryPlaceholder")+'" />',t="",i=0;i<this.quickSearches.length;++i){var s=this.quickSearches[i];t+='<li class="list-group-item">',t+='<div class="qSearchItemName"><span>'+s.name+'</span><input type="text" class="form-control" value="'+s.name+'" /></div>',t+='<div class="qSearchItemQuery"><span>'+s.url+'</span><input type="text" class="form-control" value="'+s.url+'" /></div>',t+='<button type="button" class="close">&times;</button></li>'}t+='<li class="list-group-item">'+e+'<button type="button" class="close" data="add">&#43;</button></li>',$("#ext_quickSearchList").html(t)},validateQuickSearchInput:function(e){var t=e.val();if(""===t)return void e.addClass("has-error");(e.hasClass("qSearchItemQuery")||e.parent().hasClass("qSearchItemQuery"))&&t.indexOf("%s")<0?e.addClass("has-error"):e.removeClass("has-error")},setupQuickSearchUiHandlers:function(){var e=this;$("#ext_quickSearchList li input").on("input",function(t){var i=$(this);if(i.parent().is("li"))for(var s=i.parent().find("input"),n=0;n<s.length;++n)i=$(s[n]),e.validateQuickSearchInput(i);else e.validateQuickSearchInput(i)}),$("#ext_quickSearchList li button").click(function(t){if("add"==$(this).attr("data")){var i=$(this.parentNode),s=i.find("input.qSearchItemName"),n=i.find("input.qSearchItemQuery"),o=s.val(),r=n.val();if(s.hasClass("has-error")||n.hasClass("has-error")||""===o||""===r)return;e.quickSearches.push({name:o,url:r}),e.setupQuickSearchUiList(),e.setupQuickSearchUiHandlers()}else{var a=$("#ext_quickSearchList li").index(this.parentNode);a>-1&&e.quickSearches.splice(a,1),$(this).parent().remove()}}),$("#ext_quickSearchList li div").click(function(e){$(this).parent().addClass("editMode"),$(this).find("input")[0].select()}).focusout(function(t){if(!t.relatedTarget||!t.relatedTarget.parentNode||this.parentNode!=t.relatedTarget.parentNode.parentNode){var i=$(this).parent();if(!i.find(".has-error").length)if($(this).is("input")&&i.is("li"));else{i.removeClass("editMode");var s=i.find(".qSearchItemName input").val(),n=i.find(".qSearchItemQuery input").val();i.find(".qSearchItemName span").text(s),i.find(".qSearchItemQuery span").text(n);var o=$("#ext_quickSearchList li").index(this.parentNode);o>-1&&(e.quickSearches[o]={name:s,url:n})}}})},setupExtensionsPage:function(){this.setupQuickSearchUiList(),this.setupQuickSearchUiHandlers()},setupAboutPage:function(){ReactDOM.render(React.createElement(r.AboutPane,null),$("#tabContentAbout").get(0))},refreshBlacklistOnUi:function(){var e=$("#opt_blacklistedUsers"),t=Object.keys(this.blacklistedUserIds).join("\n");e.val(t)},readBlacklistValues:function(){var e=$("#opt_blacklistedUsers"),t=e.val(),i=t.split("\n");this.blacklistedUserIds={};for(var s in i){var n=i[s];n&&(this.blacklistedUserIds[n.replace(" ","").toLowerCase()]=!0)}this.setBlacklistValue(),this.app.view.redraw(!0)},saveAndDoneWithIt:function(){var e=this,t={values:e.values,logins:{u:e.logins[0],p:e.logins[1]}};this.setStorage(t),this.updateToApp(),this.app.modalShown=!1,this.app.setInputAreaFocus()},readValueFromUi:function(){this.readBlacklistValues();var e;for(var t in this.values)if("blacklistedUserIds"!==t)if("quickSearchList"!==t)if("deleteDupLogin"!==t)if("mouseBrowsingHighlightColor"!==t)if(t in PREF_OPTIONS)e=$("#opt_"+t+" select").val(),this.values[t]=parseInt(e);else{var i=$("#opt_"+t+" input"),s=n(this.values[t]);switch(s){case"number":this.values[t]=parseInt(i.val());break;case"string":this.values[t]=i.val();break;case"boolean":this.values[t]=i.prop("checked")}}else e=$("#opt_"+t+" select").val(),this.values[t]=parseInt(e);else{var o=$("#opt_deleteDupLoginYes");this.values[t]=o.prop("checked")}else this.values[t]=JSON.stringify(this.quickSearches);var r=$("#login_username input").val(),a=$("#login_password input").val();""===r&&(a=""),this.logins=[r,a]},loadDefault:function(e){this.values=JSON.parse(JSON.stringify(DEFAULT_PREFS)),this.logins={u:"",p:""},this.updateToApp(),this.populateSettingsToUi(),e()},updateToApp:function(){for(var e in this.values)this.app.onPrefChange(this,e);this.logins[0]&&(this.app.conn.loginStr[1]=this.logins[0]),this.logins[1]&&(this.app.conn.loginStr[2]=this.logins[1])},resetSettings:function(){this.clearStorage(),this.getStorage()},get:function(e){return console.log(e+" = "+this.values[e]),this.values[e]},set:function(e,t){this.values[e]=t},onStorageDone:function(e){if(e.data&&e.data.values)for(var t in DEFAULT_PREFS)if(t in e.data.values&&null!==e.data.values[t])if("blacklistedUserIds"===t)this.blacklistedUserIds=JSON.parse(e.data.values[t]);else if("quickSearchList"===t){var i=e.data.values[t];this.quickSearches=JSON.parse(i),this.values[t]=i}else this.values[t]=e.data.values[t];else this.values[t]=DEFAULT_PREFS[t],"quickSearchList"===t&&(this.quickSearches=JSON.parse(this.values[t]));if(e.data&&e.data.logins){var s=e.data.logins;this.logins=[s.u,s.p]}this.updateToApp(),this.populateSettingsToUi(),this.initCallbackCalled||null!==this.values&&null!==this.logins&&(this.initCallbackCalled=!0,this.onInitializedCallback(this.app))},getStorage:function(e){console.log("getStorage not implemented, returning defaults.");var t={values:DEFAULT_PREFS,logins:{u:"",p:""}};this.onStorageDone({data:t})},setBlacklistValue:function(){var e=JSON.stringify(this.blacklistedUserIds);this.values.blacklistedUserIds=e},setBlacklistStorage:function(){var e={values:{blacklistedUserIds:this.values.blacklistedUserIds}};console.log("setBlacklistStorage not implemented, items: "+e)},setStorage:function(e){console.log("setStorage not implemented, items: "+e)},clearStorage:function(){console.log("clearStorage not implemented")}}},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.AboutPane=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(0);t.AboutPane=function(e){function t(){return s(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),r(t,[{key:"render",value:function(){var e=function(e,t){return'<a href="'+t+'" target="_blank" rel="noreferrer">'+e+"</a>"},t={"#link_github_iamchucky#":e("Chuck Yang","https://github.com/iamchucky"),"#link_github_robertabcd#":e("robertabcd","https://github.com/robertabcd"),"#link_robertabcd_PttChrome#":e("robertabcd/PttChrome","https://github.com/robertabcd/PttChrome"),"#link_iamchucky_PttChrome#":e("iamchucky/PttChrome","https://github.com/iamchucky/PttChrome"),"#link_GPL20#":e("General Public License v2.0","https://www.gnu.org/licenses/old-licenses/gpl-2.0.html")},i=function(e){var i=(0,a.i18n)(e);for(var s in t)i=i.replace(s,t[s]);return React.createElement("span",{dangerouslySetInnerHTML:{__html:i}})},s=(0,a.i18n)("about_new_content").map(function(e,t){return React.createElement("li",{key:"i"+t},e)});return React.createElement("div",null,React.createElement("div",{className:"list-group"},React.createElement("h4",{className:"list-group-item-heading"},"PttChrome",React.createElement("small",null," - ",(0,a.i18n)("about_appName_subtitle"))),React.createElement("div",{id:"about_description"},React.createElement("p",null,i("about_description")))),React.createElement("div",{className:"list-group"},React.createElement("h4",{className:"list-group-item-heading"},(0,a.i18n)("about_version_title")),React.createElement("div",{className:"list-group-item-text"},React.createElement("ul",null,React.createElement("li",null,i("about_version_current")),React.createElement("li",null,i("about_version_original"))))),React.createElement("div",{className:"list-group"},React.createElement("h4",{className:"list-group-item-heading"},(0,a.i18n)("about_new_title")),React.createElement("div",{className:"list-group-item-text"},React.createElement("ul",null,s))))}}]),t}(React.Component)},function(e,t,i){"use strict";function s(e){this.app=e,this.highlightCopy=!1,this.touchStarted=!1,this.touchedCenter={x:0,y:0},delete Hammer.defaults.cssProps.userSelect,this.ham=null,this.setupHandlers()}Object.defineProperty(t,"__esModule",{value:!0}),t.TouchController=s,s.prototype.setupHandlers=function(){var e=this,t=this.app;document.body.ontouchmove=function(e){return 1==e.touches.length},document.body.ontouchstart=function(i){e.touchStarted=!0,t.inputArea.blur(),console.log("touchstart")},document.body.ontouchend=function(i){2==t.buf.pageState&&t.buf.highlightCursor&&-1!=t.buf.nowHighlight&&(t.onMouse_click(e.touchedCenter.x,e.touchedCenter.y),t.buf.nowHighlight=-1,t.buf.highlightCursor=e.highlightCopy,t.BBSWin.style.cursor="auto",e.touchStarted=!1,t.inputArea.focus()),console.log("touchend")},this.ham=new Hammer(t.BBSWin),this.ham.on("pan",function(i){"touch"==i.pointerType&&2==t.buf.pageState&&(i.preventDefault(),i.srcEvent.preventDefault(),e.highlightCopy=t.buf.highlightCursor,t.buf.highlightCursor=!0,t.onMouse_move(i.center.x,i.center.y),e.touchedCenter.x=i.center.x,e.touchedCenter.y=i.center.y)}),this.ham.on("tap",function(i){i.preventDefault(),i.srcEvent.stopPropagation(),i.srcEvent.preventDefault(),"touch"==i.pointerType&&(e.highlightCopy=t.buf.highlightCursor,t.buf.highlightCursor=!1,t.onMouse_move(i.center.x,i.center.y),t.onMouse_click(i.center.x,i.center.y),t.buf.nowHighlight=-1,t.buf.highlightCursor=e.highlightCopy,t.BBSWin.style.cursor="auto",e.touchStarted=!1,t.inputArea.focus(),console.log("touchtap"))})}},function(e,t){},function(e,t){}]);
//# sourceMappingURL=pttchrome.min.js.map