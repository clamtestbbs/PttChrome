{"version":3,"sources":["webpack:///pttchrome.min.js","webpack:///webpack/bootstrap 766eb063246ee98a64ce","webpack:///./js/i18n.js","webpack:///./js/util.js","webpack:///./js/event.js","webpack:///./js/term_buf.js","webpack:///./js/term_ui.jsx","webpack:///./js/image_preview.jsx","webpack:///./js/main.js","webpack:///./js/pttchrome.js","webpack:///./js/ansi_parser.js","webpack:///./js/term_view.js","webpack:///./js/term_keyboard.js","webpack:///./js/symbol_table.js","webpack:///./js/image_urls.js","webpack:///./js/en_US_messages.js","webpack:///./js/zh_TW_messages.js","webpack:///./js/telnet.js","webpack:///./js/websocket.js","webpack:///./js/easy_reading.js","webpack:///./js/input_helper.js","webpack:///./js/emoticon.js","webpack:///./js/symbols.js","webpack:///./js/pref.js","webpack:///./js/pref_about.jsx","webpack:///./js/touch_controller.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","i18n","str","i18n_val","message","console","log","setupI18n","callback","lang","getLang","locale","navigator","language","userLanguage","length","substr","toUpperCase","replace","value","_en_US_messages","_zh_TW_messages","en_US","zh_TW","setTimer","repeat","func","timelimit","timer","setInterval","cancel","clearInterval","this","setTimeout","clearTimeout","getQueryVariable","variable","query","window","location","search","substring","vars","split","pair","decodeURIComponent","dumpLog","type","string","DUMP_TYPE_LOG","DUMP_TYPE_WARN","warn","DUMP_TYPE_ERROR","error","Event","mixin","obj","key","addEventListener","listener","_listeners","push","dispatchEvent","e","fns","slice","removeEventListener","splice","TermChar","ch","resetAttr","needUpdate","isLeadByte","startOfURL","endOfURL","partOfURL","partOfKeyWord","keyWordColor","fullurl","TermHtml","html","TermBuf","cols","rows","view","cur_x","cur_y","cur_x_sav","cur_y_sav","scrollStart","scrollEnd","_nowHighlight","set","setHighlight","bind","tempMouseCol","tempMouseRow","mouseCursor","highlightCursor","useMouseBrowsing","attr","newChar","disableLinefeed","altScreen","changed","posChanged","pageState","forceFullWidth","enableDeleteDupLogin","deleteDupLogin","startedEasyReading","easyReadingShowReplyText","easyReadingShowPushInitText","prevPageState","lines","Array","linesX","linesY","pageLines","pageWrappedLines","outputhtmls","lineChangeds","viewBufferTimer","line","outputhtml","BBSWin","document","getElementById","termInvColors","undefined","_event","_term_ui","mouseCursorMap","defaultFg","defaultBg","copyFrom","copyAttr","fg","bg","bright","invert","blink","underLine","getFg","getBg","getColor","ColorState","isUnderLine","isStartOfURL","isEndOfURL","isPartOfURL","isPartOfKeyWord","getKeyWordColor","getFullURL","setHtml","addHtml","getHtml","timerUpdate","uriRegEx","setView","puts","back","carriageReturn","lineFeed","tab","ch2","charset","isFullWidth","queueUpdate","updateCharAttr","row","col","ch0","isleadbyte","uris","nuris","iuri","uri","charAt","res","exec","index","urlTemp","u","urlTemp2","toLowerCase","clear","param","gotoPos","mod","backTab","insert","pop","del","eraseChar","eraseLine","deleteLine","scroll","insertLine","up","unshift","shift","x","y","directupdate","_this","notify","setPageState","clearHighlight","strToSend","lastRowText","getRowText","nextLastRowText","parseDuplicatedLoginTextLastRow","parseDuplicatedLoginText","conn","send","CustomEvent","update","updateCursorPos","blinkOn","blinkShow","allBlinkSpan","getElementsByTagName","doBlink","getAttribute","parentNode","setAttribute","getText","colStart","colEnd","color","isutf8","reset","text","output","ansiCmp","b2u","map","prevC","b5","join","findText","searchrow","result","searchStart","searchEnd","indexOf","that","parseText","strs","returnStr","String","fromCharCode","charCodeAt","preChar","thisChar","forceReset","DeFg","DeBg","thisFg","preFg","thisBg","preBg","code","isTextWrappedRow","rowText","slashIndex","lastIndexOf","u2b","parseStatusRow","firstRowText","isUnicolor","main","classList","archiveList","parseListRow","isLineEmpty","isPttZArea","PTTstr1","PTTstr2","PTTstr","PTTZSTR1","PTTZSTR2","lineindex","start","end","clr","clr1","iLine","onMouse_move","tcol","trow","doRefresh","nowHighlight","style","cursor","resetMousePos","setHighlightedRow","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","renderRowHtml","chars","forceWidth","showsLinkPreviews","cont","ReactDOM","render","React","createElement","Row","_createClass","defineProperties","target","props","descriptor","protoProps","staticProps","_symbol_table","_image_preview","HyperLink","_React$Component","getPrototypeOf","apply","arguments","scol","srow","className","href","rel","inner","Component","ColorSpan","_React$Component2","classes","colorState","blinkNode","h","NormalText","_React$Component3","ForceWidthWord","_React$Component4","styles","display","toString","TwoColorWord","_React$Component5","c1","colorLead","c2","colorTail","data-text","ColorSegmentBuilder","oth","currCol","segs","curr","equals","texts","_isLastSegmentSameColor","_addSegment","len","last","width","reuse","_reuseChars","_append","_appendNormalText","color2","_React$Component6","_this6","state","highlighted","segments","cur","colOffset","builder","lead","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","_isBadDBCS","appendNormalChar","appendNormalWord","_shouldForceWidth","appendTwoColorWord","err","return","build","linkPreviews","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_segmentHyperLinks","linkSeg","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_segmentTwoColorDBCS","colorSeg","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","data-scol","data-srow","HyperLinkPreview","src","concat","data-type","data-row","shouldHighlight","setState","symbolTable","renderImagePreview","AsyncImagePreview","_image_urls","ImagePreview","left","top","spinning","_mouseMoveListener","_onMouseMove","nextProps","clientX","clientY","_preview","mouseHeight","curX","pageHeight","$","height","imageHeight","clientHeight","imgTop","position","maxHeight","maxWidth","zIndex","_stopSpinner","forceUpdate","_this2","ref","img","_imageStyle","onLoad","_onImageLoaded","_spinnerStyle","BaseAsyncImagePreview","_this3","resolvedSrc","_startFetch","_this4","ImageURL","cb","_onResolve","fetchSrc","then","forSrc","_BaseAsyncImagePrevie","_BaseAsyncImagePrevie2","startApp","from","_util","keepAlive","_i18n","pttchrome","app","_pttchrome","App","setInputAreaFocus","show","onWindowResize","loadTable","url","Promise","resolve","reject","ajax","processData","xhrFields","responseType","data","fail","jqXHR","textStatus","errorThrown","all","binData","lib","b2uArray","Uint8Array","u2bArray","ready","_ansi_parser","_term_view","_term_buf","_telnet","_websocket","_easy_reading","_input_helper","_pref","_touch_controller","onInitializedCallback","options","CmdHandler","pref","TermView","buf","setBuf","setCore","parser","AnsiParser","easyReading","EasyReading","antiIdleStr","antiIdleTime","idleTime","curY","inputArea","mainDisplay","transformOrigin","mouseLeftButtonDown","mouseRightButtonDown","inputAreaFocusTimer","alertBeforeUnload","modalShown","inputHelper","InputHelper","lastSelection","waterball","userId","appFocused","endTurnsOnLiveUpdate","copyOnSelect","version","userAgent","match","chromeVersion","parseInt","overlayCommandListener","mouse_click","mouse_down","mousedown","middleMouse_down","mouse_up","mouse_move","mouse_over","mouse_scroll","context_menu","titleTimer","title","connectedUrl","site","notif","close","strToCopy","onDOMCopy","onDOMPaste","innerBounds","getWindowInnerBounds","firstGridOffset","getFirstGridOffsets","onresize","isFromApp","dblclickTimer","mbTimer","timerEverySec","pushthreadAutoUpdateCount","maxPushthreadAutoUpdateCount","setupDeveloperModeAlert","setupConnectionAlert","setupPasteShortcutAlert","setupLiveHelper","setupOtherSiteInput","setupContextMenus","contextMenuShown","PttChromePref","Constants","DEVELOPER_MODE","click","hide","connect","DEFAULT_SITE","getStorage","touch","TouchController","isConnected","connectState","parsed","_parseURLSimple","protocol","_setupWebsocketConn","hostname","path","port","easyReadingSupported","hostport","wstelnet","wsstelnet","telnet","ssh","host","wsConn","Websocket","_attachConn","TelnetConnection","onConnect","onClose","onData","detail","setConn","updateTabIcon","antiIdle","onBlink","incrementCountToUpdatePushthread","resetCursorBlink","regExitAlert","feed","enableNotifications","wb","parseWaterball","showWaterballNotification","cursorBlinkTimer","cancelMbTimer","unregExitAlert","sendData","convSend","sendCmdData","setMbTimer","cancelDblclickTimer","setDblclickTimer","touchStarted","focus","onLiveHelperEnableClicked","tooltip","change","sec","val","hasClass","setAutoPushthreadUpdate","fromUi","disableLiveHelper","useEasyReadingMode","switchToEasyReadingMode","addClass","removeClass","doSwitch","leaveCurrentPost","mainContainer","paddingBottom","lastRowIndex","lastRowDiv","replyRowDiv","unescapeStr","empty","modal","keyup","keyCode","on","doCopy","execCommand","doCopyAnsi","selection","ansiText","ecol","clipboardData","setData","preventDefault","doPaste","onPasteDone","content","onTextInput","getData","onSymFont","font_src","css","innerHTML","appendChild","doSelectAll","getSelection","selectAllChildren","doSearchGoogle","searchTerm","open","doOpenUrlNewTab","a","createEvent","initMouseEvent","doGoToOtherSite","interval","seconds","doAddBlacklistUserId","userid","blacklistedUserIds","setBlacklistValue","setBlacklistStorage","doRemoveBlacklistUserId","doSettings","fontResize","documentElement","clientWidth","switchMouseBrowsing","redraw","aStatus","icon","link","querySelector","head","bbsViewMargin","container","offsetTop","offsetLeft","clientToPos","cX","cY","w","horizontalAlignCenter","scaleX","scaleY","parseFloat","chw","chh","Math","floor","onMouse_click","clickedOn","_onMouseClick","defaultPrevented","sendstr","count","pos","elm","cmd","id","scrollTop","_turnPageLines","doReloadTabIcon","reloadTabIcon","doAddTrack","doDelTrack","doClearTrack","symbolinput","displayWindow","doSavePage","doCopyHtml","doCopySelect","doOpenAllLink","removeAttribute","playerMgr","openYoutubeWindow","openUstreamWindow","openUrecordWindow","picViewerMgr","openPicture","doSiteSettingCheck","doPushThread","resetMouseCursor","onPrefChange","highlightBG","leftButtonFunction","middleButtonFunction","mouseWheelFunction1","mouseWheelFunction2","mouseWheelFunction3","enablePicPreview","dbcsDetect","lineWrap","fontFitWindowWidth","fontFace","setFontFace","margin","enableBlacklist","checkClass","cn","skipMouseClick","button","is","parent","isCollapsed","doMouseCommand","tagName","setBBSCmd","stopPropagation","cancelBubble","mouseDown","onMouseDrag","cmdhandler","mouseWheelActionsUp","mouseWheelActionsDown","wheelDelta","action","showQuickSearchMenus","selectedText","hideContextMenu","quickSearches","menuSelector","menuHtml","q","off","pageWidth","pageY","pageX","contextOnUrl","contextOnUserId","aElement","getSelectionColRow","isNaN","parsePushthreadForUserId","parseThreadForUserId","clipedText","mouseWidth","menuWidth","menuHeight","altKey","ctrlKey","shiftKey","ontouchstart","contextMenuItemOnClickHandler","cmenu_copy","cmenu_copyAnsi","cmenu_paste","cmenu_selectAll","cmenu_searchGoogle","cmenu_openUrlNewTab","cmenu_copyLinkUrl","cmenu_mouseBrowsing","cmenu_goToOtherSite","cmenu_showInputHelper","showHelper","cmenu_showLiveArticleHelper","cmenu_addBlacklistUserId","cmenu_removeBlacklistUserId","cmenu_settings","onbeforeunload","origin","doc","getCmdHandler","evt","initEvent","termbuf","STATE_TEXT","esc","STATE_ESC","STATE_CSI","STATE_C1","term","params","firstChar","j","n_params","v","C1_End","C1_Char","rowCount","screenType","bbsWidth","bbsHeight","bbsFontSize","useHyperLink","inputBufferSizeType","defineInputBufferSize","hideInputBuffer","hotkeyForSelectAll","EnterChar","EscChar","dropToPaste","ctrlPicturePreview","picturePreviewInfo","DisplayBackground","BackgroundMD5","verticalAlignCenter","easyReadingWithImg","cursorShow","bbscore","page","cursorX","cursorY","easyReadingKeyDownKeyCode","doHighlightOnCurRow","displayingRows","curRow","curCol","actualRowIndex","input","bbsCursor","trackKeyWordList","dynamicStyle","dynamicCss","sheet","mainDiv","defaultRows","lastRowDivContent","replyRowDivContent","border","_keyboard","_term_keyboard","TermKeyboard","checkLeftDB","checkCurDB","_send","onCompositionStart","onCompositionEnd","onInput","isComposition","onKeyDown","onCursorBlink","_isConnected","_convSend","core","setProperty","prePicRel","force","changedLineHtmlStrs","changedRows","outhtmls","lineUpdated","updateEasyReadingReplyRow","updateEasyReadingPushInitRow","populateEasyReadingPage","childNodes","removeChild","lastChild","component","currentHighlighted","setupPicPreviewOnHover","updateInputBufferWidth","isPasting","wrapText","_onKeyDown","stop","setTermFontSize","cw","fontSize","mainWidth","lineHeight","overflowX","overflowY","textAlign","marginTop","scaleCss","transOrigin","webkitTransformOriginX","webkitTransformOriginY","webkitTransform","updateReverseScaleCss","rule","cssRules","deleteRule","insertRule","convertMN2XYEx","cx","cy","updateInputBufferPos","opacity","bbswinheight","bbswinwidth","wordCounts","oneWordWidth","bounds","fontWidth","o_h","o_w","nowchh","nowchw","forceWidthElems","querySelectorAll","countCol","node","rowNode","r","Element","doCount","textContent","nodeName","getRangeAt","startContainer","startOffset","endContainer","endOffset","aNodes","not","onover","onout","aNode","body","tag","Notification","onclick","rowOffset","beginIndex","atLastPage","pageIndex","pageTotal","pagePercent","rowIndexStart","numRows","appendRows","JSON","parse","stringify","clearRows","hideEasyReading","showsLinkPreview","el","renderSingleRow","setSingleChild","par","child","KeyMap","Backspace","Tab","Enter","Escape","Home","Insert","Delete","End","PageUp","PageDown","ArrowUp","ArrowDown","ArrowRight","ArrowLeft","CtrlShiftMap","@","^","_","?","[","\\","]","isLeftDB","isCurDB","_checkLeftDB","_checkCurDB","_sendFunc","getModifierState","_sendCharCode","mappedCode","mapped","_checkDB","xa1","xa0","xa4","xa7","xaa","xae","xaf","xb0","xb1","xb6","xb7","xb8","xba","xbf","xc0","xc1","xc2","xc3","xc4","xc5","xc6","xc7","xc8","xc9","xca","xcb","xcc","xcd","xce","xcf","xd0","xd1","xd2","xd3","xd4","xd5","xd6","xd7","xd8","xd9","xda","xdb","xdc","xde","xdf","xe0","xe1","xe2","xe3","xe4","xe5","xe6","xe7","xe8","xe9","xea","xeb","xec","xed","xee","xef","xf0","xf1","xf2","xf3","xf4","xf5","xf6","xf8","xf9","xfa","xfb","xfc","xfe","xff","x14a","x153","x16b","x192","x28c","x252","x259","x25a","x25c","x25d","x26f","x278","x287","x292","x2a4","x2a7","x2cf","x414","x41f","x430","x431","x432","x433","x434","x435","x436","x437","x438","x439","x43a","x43b","x43c","x43d","x43e","x43f","x440","x441","x442","x445","x446","x44b","x44c","x44f","x1e3b","x1e43","x1e49","x1ef2","x1ef3","x2010","x2027","x211e","x2122","x213b","x2157","x215c","x21b2","x21e6","x21e8","x21e9","x2200","x2202","x222c","x2237","x2282","x2401","x2402","x2403","x2404","x2405","x2406","x2407","x2408","x2409","x240a","x240b","x240c","x240d","x240e","x240f","x2410","x2411","x2412","x2413","x2414","x2415","x2416","x2417","x2418","x2419","x241a","x241b","x241c","x241d","x241e","x241f","x2421","x246a","x246b","x246c","x246d","x246e","x246f","x2470","x2471","x2472","x2473","x2503","x2601","x2602","x260e","x2611","x261b","x261c","x261e","x261f","x2620","x262f","x2630","x2631","x2632","x2633","x2634","x2635","x2636","x2637","x2639","x263a","x263b","x263c","x263d","x2660","x2661","x2662","x2663","x2664","x2665","x2666","x2667","x266a","x266c","x2702","x2708","x2709","x2713","x2715","x2721","x2729","x274f","x278e","x278f","x2790","x2791","x2792","xe11b","xe282","xe568","xe56b","xe686","xe687","xe7e0","xe9cc","xe9ce","xe9cf","xeb8b","xec63","xec64","xec65","xec66","xec67","xec6c","xec6a","xec6e","xec71","xec72","xec73","xec74","xec7c","xec7d","xec80","xec83","xec85","xec86","xec87","xec88","xec89","xec8a","xec8b","xec8c","xec8d","xec8e","xec8f","xec90","xec91","xec9f","xeca0","xeca1","xeca3","xeca4","xeca5","xeca6","xeca7","xeca8","xeca9","xecae","xecb5","xecb6","xecb8","xecc1","xecc2","xecc8","xecca","xeccb","xeccc","xeccd","xecce","xed91","xed92","xee1e","xee22","xee58","xee5a","xee5c","xee5e","xee5f","xeeb6","xf7e6","xf7e8","xf7ee","xf7ef","xf7f0","xf7f1","xf7f2","xf7f3","xf7f4","xf7f5","xf7f6","xf7f7","xf7f8","xf7fa","xf849","xf84a","xf84b","xf84c","xf84d","xf84e","xf84f","xf850","xf851","xf852","xf853","xf854","xf855","xf856","xf857","xf858","xf859","xf85a","xf85b","xf85c","xf85d","xf85e","xf85f","xf860","xf861","xf862","xf863","xf864","xf865","xff61","xff62","xff63","xff64","xff65","xff66","xff67","xff68","xff69","xff6a","xff6b","xff6c","xff6d","xff6e","xff6f","xff70","xff71","xff72","xff73","xff74","xff75","xff76","xff77","xff78","xff79","xff7a","xff7b","xff7c","xff7d","xff7e","xff7f","xff80","xff81","xff82","xff83","xff84","xff85","xff86","xff87","xff88","xff89","xff8a","xff8b","xff8c","xff8d","xff8e","xff8f","xff90","xff91","xff92","xff93","xff94","xff95","xff96","xff97","xff98","xff99","xff9a","xff9b","xff9c","xff9d","xff9e","xff9f","xfffd","clazz","_providers","provider","FlickrImageURL","photoID","_photoID","snipcode","alphabet","num","decoded","multi","found_flickr","flickrBase58Id","base58_decode","apiURL","encodeURIComponent","getJSON","photo","farm","server","secret","register","ImgurImageURL","_href","GenericImageURL","appName","description","appDesc","menu_coloredCopy","menu_goToOtherSite","menu_paste","menu_selectAll","menu_mouseBrowsing","menu_settings","cmenu_quickSearch","cmenu_restartInTab","options_general","options_autologin","options_blacklist","options_extensions","options_about","options_openInPackagedApp","options_closeQuery","options_enablePicPreview","options_enableNotifications","options_enableEasyReading","options_endTurnsOnLiveUpdate","options_copyOnSelect","options_enableDeleteDupLogin","options_preferences","options_antiIdleTime","options_lineWrap","options_reset","options_appearance","options_bbsMargin","options_fontFitWindowWidth","options_fontFace","options_mouse","options_mouseBrowsing","options_useMouseBrowsing","options_mouseBrowsingHighlight","options_highlightColor","options_mouseLeftFunction","options_mouseMiddleFunction","options_mouseWheelFunction1","options_mouseWheelFunction2","options_mouseWheelFunction3","options_none","options_doPaste","options_leftKey","options_rightKey","options_enterKey","options_upDown","options_pageUpDown","options_threadLastNext","options_enableBlacklist","options_blacklistInstruction","autologin_username","autologin_password","autologin_warning","ext_quickSearch","ext_addQuickSearchNamePlaceholder","ext_addQuickSearchQueryPlaceholder","about_appName_subtitle","about_description","about_version_title","about_version_current","about_version_original","about_new_title","about_new_content","alert_developerModeHeader","alert_developerModeText","alert_developerModeDismiss","alert_connectionHeader","alert_connectionText","alert_connectionReconnect","alert_connectionPortOption1","alert_connectionPortOption2","alert_pasteShortcutHeader","alert_pasteShortcutText","alert_pasteShortcutClose","notification_said","input_sitePlaceholder","inputHelperTitle","colorTitle","colorHelperSend","colorHelperSendMenuFore","colorHelperSendMenuBack","colorHelperSendMenuReset","colorHelperBlink","colorHelperPreview","colorHelperTooltip1","colorHelperTooltip2","symTitle","symTitle_general","symTitle_lineBorders","symTitle_blocks","symTitle_lines","symTitle_special","symTitle_brackets","symTitle_greek","symTitle_phonetic","symTitle_math","symTitle_hiragana","symTitle_katakana","emoTitle","emoTitle_angry","emoTitle_meh","emoTitle_sweat","emoTitle_happy","emoTitle_other","liveHelperEnable","liveHelperSpan","liveHelperSpanSec","tooltip_antiIdleTime","tooltip_fontFace","socket","_onOpen","_onDataAvailable","_onClose","STATE_DATA","iac_sb","termType","_dispatchData","_sendRaw","IAC","rep","unicode_str","ansiHalfColorConv","sendNaws","nawsStr","_conn","WebSocket","binaryType","_onMessage","_onError","chunkStr","byteArray","buffer","termBuf","bindProperty","prop","_core","_view","_termBuf","easyReadingReachedPageEnd","sendCommandAfterUpdate","ignoreOneUpdate","_onChanged","_onViewUpdated","_enabled","values","enableEasyReading","parseReqNotMetText","lastRowFirstCh","parsePushInitText","secondToLastRowText","parseReplyText","stopEasyReading","_onKeyDownProcessUI","_scrollBy","_scrollEnd","_scrollTop","nodeOffsetTop","nodeOffsetLeft","colorHelperBlinkCheckbox","colorHelperPreviewFgShown","colorHelperFg","colorHelperBg","colorHelperIsBlink","blinkTimer","symbols","emoticons","setupUi","registerHandlers","_emoticon","_symbols","hideHelper","Symbols","Emoticons","removeAllRanges","movementY","movementX","cssText","colorHelperList","tooltipHtml","checked","sendColorCommand","hasAttribute","which","lightColor","isBlink","sel","selCmd","repeats","angry","meh","sweat","happy","other","htmlStr","dropdownHtmlStr","general","lineBorders","blocks","special","brackets","greek","phonetic","math","hiragana","katakana","sym","ceil","logins","shouldResetToDefault","initCallbackCalled","_typeof","_pref_about","updateSettingsToUi","refreshBlacklistOnUi","onMouseBrowsingHighlightColorChange","qName","PREF_OPTIONS","optName","popoverTooltips","popover","yesNode","setupQuickSearchUiList","setupQuickSearchUiHandlers","setupSettingsUi","cat","PREFS_CATEGORIES","PREFS_NAV","setupExtensionsPage","setupAboutPage","currTab","populateSettingsToUi","clearStorage","DEFAULT_PREFS","quickSearchList","readValueFromUi","saveAndDoneWithIt","addNewSearchHtml","quickSearchListHtml","qSearch","buttonCloseHtml","validateQuickSearchInput","inputs","find","nameNode","queryNode","nameVal","queryVal","ind","remove","select","focusout","relatedTarget","AboutPane","listNode","listStr","keys","readBlacklistValues","blacklistArray","b","setStorage","updateToApp","selectedVal","elem","user","pswd","loadDefault","loginStr","resetSettings","prefName","onStorageDone","msg","defaults","blacklist","items","replacements","#link_github_iamchucky#","#link_github_robertabcd#","#link_robertabcd_PttChrome#","#link_iamchucky_PttChrome#","#link_GPL20#","replaced_i18n","dangerouslySetInnerHTML","__html","aboutNewList","highlightCopy","touchedCenter","Hammer","cssProps","userSelect","ham","setupHandlers","ontouchmove","touches","blur","ontouchend","ev","pointerType","srcEvent","center"],"mappings":"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","file":"pttchrome.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 6);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.i18n = i18n;\nexports.setupI18n = setupI18n;\nexports.getLang = getLang;\n\nvar _en_US_messages = __webpack_require__(14);\n\nvar _zh_TW_messages = __webpack_require__(15);\n\nvar locale = {};\nlocale.en_US = _en_US_messages.en_US;\nlocale.zh_TW = _zh_TW_messages.zh_TW;\nvar i18n_val = {};\nfunction i18n(str) {\n  if (i18n_val[str]) {\n    return i18n_val[str].message;\n  } else {\n    console.log('missing i18n ' + str);\n  }\n}\n\nfunction setupI18n(callback) {\n  var lang = getLang();\n  i18n_val = locale[lang];\n}\n\nfunction getLang() {\n  var lang = navigator.language || navigator.userLanguage;\n  if (lang.length == 5) {\n    // chrome 40+ uses lower case country code\n    lang = lang.substr(0, 3) + lang.substr(3, 5).toUpperCase();\n  }\n  if (lang === '' || !(lang == 'en-US' || lang == 'zh-TW')) {\n    lang = 'en-US';\n  }\n  lang = lang.replace('-', '_');\n  return lang;\n}\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.setTimer = setTimer;\nexports.getQueryVariable = getQueryVariable;\nexports.dumpLog = dumpLog;\nfunction setTimer(repeat, func, timelimit) {\n\tif (repeat) {\n\t\treturn {\n\t\t\ttimer: setInterval(func, timelimit),\n\t\t\tcancel: function cancel() {\n\t\t\t\tclearInterval(this.timer);\n\t\t\t}\n\t\t};\n\t} else {\n\t\treturn {\n\t\t\ttimer: setTimeout(func, timelimit),\n\t\t\tcancel: function cancel() {\n\t\t\t\tclearTimeout(this.timer);\n\t\t\t}\n\t\t};\n\t}\n}\n\nfunction getQueryVariable(variable) {\n\tvar query = window.location.search.substring(1);\n\tvar vars = query.split(\"&\");\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split(\"=\");\n\t\tif (pair[0] == variable) {\n\t\t\treturn decodeURIComponent(pair[1]);\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction dumpLog(type, string) {\n\tswitch (type) {\n\t\tcase DUMP_TYPE_LOG:\n\t\t\tconsole.log(string);break;\n\t\tcase DUMP_TYPE_WARN:\n\t\t\tconsole.warn(string);break;\n\t\tcase DUMP_TYPE_ERROR:\n\t\t\tconsole.error(string);break;\n\t\tdefault:\n\t\t\tconsole.log(string);break;\n\t}\n}\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Event = Event;\nfunction Event() {}\n\nEvent.mixin = function (obj) {\n  for (var key in Event.prototype) {\n    obj[key] = Event.prototype[key];\n  }\n};\n\nEvent.prototype.addEventListener = function (type, listener) {\n  this._listeners = this._listeners || {};\n  (this._listeners[type] = this._listeners[type] || []).push(listener);\n};\n\nEvent.prototype.dispatchEvent = function (e) {\n  this._listeners = this._listeners || {};\n  var fns = this._listeners[e.type];\n  if (fns) {\n    fns = fns.slice(0);\n    for (var i in fns) {\n      fns[i](e);\n    }\n  }\n};\n\nEvent.prototype.removeEventListener = function (type, listener) {\n  this._listeners = this._listeners || {};\n  var fns = this._listeners[type];\n  if (fns) {\n    for (var i in fns) {\n      if (fns[i] === listener) {\n        fns.splice(i, 1);\n        break;\n      }\n    }\n  }\n};\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.termInvColors = undefined;\nexports.TermBuf = TermBuf;\n\nvar _event = __webpack_require__(2);\n\nvar _term_ui = __webpack_require__(4);\n\n// Terminal Screen Buffer, displayed by TermView\n\nvar termColors = [\n// dark\n'#000000', // black\n'#800000', // red\n'#008000', // green\n'#808000', // yellow\n'#000080', // blue\n'#800080', // magenta\n'#008080', // cyan\n'#c0c0c0', // light gray\n// bright\n'#808080', // gray\n'#ff0000', // red\n'#00ff00', // green\n'#ffff00', // yellow\n'#0000ff', // blue\n'#ff00ff', // magenta\n'#00ffff', // cyan\n'#ffffff' // white\n];\n\nvar termInvColors = exports.termInvColors = [\n// dark\n'#FFFFFF', // black\n'#7FFFFF', // red\n'#FF7FFF', // green\n'#7F7FFF', // yellow\n'#FFFF7F', // blue\n'#7FFF7F', // magenta\n'#FF7F7F', // cyan\n'#3F3F3F', // light gray\n// bright\n'#7F7F7F', // gray\n'#00FFFF', // red\n'#FF00FF', // green\n'#0000FF', // yellow\n'#FFFF00', // blue\n'#00FF00', // magenta\n'#FF0000', // cyan\n'#000000' // white\n];\n\nvar mouseCursorMap = ['auto', // 0\n'url(cursor/back.png) 0 6,auto', // 1\n'url(cursor/pageup.png) 6 0,auto', // 2\n'url(cursor/pagedown.png) 6 21,auto', // 3\n'url(cursor/home.png) 0 0,auto', // 4\n'url(cursor/end.png) 0 0,auto', // 5\n'pointer', // 6\n'default', // 7\n'url(cursor/prevous.png) 6 0,auto', // 8\n'url(cursor/next.png) 6 0,auto', // 9\n'url(cursor/first.png) 0 0,auto', // 10\n'auto', // 11\n'url(cursor/refresh.png) 0 0,auto', // 12\n'url(cursor/last.png) 0 0,auto', // 13\n'url(cursor/last.png) 0 0,auto' // 14\n];\n\nfunction TermChar(ch) {\n  this.ch = ch;\n  this.resetAttr();\n  this.needUpdate = false;\n  this.isLeadByte = false;\n  this.startOfURL = false;\n  this.endOfURL = false;\n  this.partOfURL = false;\n  this.partOfKeyWord = false;\n  this.keyWordColor = '#ff0000';\n  this.fullurl = '';\n}\n\n// static variable for all TermChar objects\nTermChar.defaultFg = 7;\nTermChar.defaultBg = 0;\n\nTermChar.prototype = {\n\n  copyFrom: function copyFrom(attr) {\n    this.ch = attr.ch;\n    this.isLeadByte = attr.isLeadByte;\n    this.copyAttr(attr);\n  },\n\n  copyAttr: function copyAttr(attr) {\n    this.fg = attr.fg;\n    this.bg = attr.bg;\n    this.bright = attr.bright;\n    this.invert = attr.invert;\n    this.blink = attr.blink;\n    this.underLine = attr.underLine;\n  },\n\n  resetAttr: function resetAttr() {\n    this.fg = 7;\n    this.bg = 0;\n    this.bright = false;\n    this.invert = false;\n    this.blink = false;\n    this.underLine = false;\n  },\n\n  getFg: function getFg() {\n    if (this.invert) return this.bright ? this.bg + 8 : this.bg;\n    return this.bright ? this.fg + 8 : this.fg;\n  },\n\n  getBg: function getBg() {\n    return this.invert ? this.fg : this.bg;\n  },\n\n  getColor: function getColor() {\n    return new _term_ui.ColorState(this.getFg(), this.getBg(), this.blink);\n  },\n\n  isUnderLine: function isUnderLine() {\n    return this.underLine;\n  },\n\n  isStartOfURL: function isStartOfURL() {\n    return this.startOfURL;\n  },\n\n  isEndOfURL: function isEndOfURL() {\n    return this.endOfURL;\n  },\n\n  isPartOfURL: function isPartOfURL() {\n    return this.partOfURL;\n  },\n\n  isPartOfKeyWord: function isPartOfKeyWord() {\n    return this.partOfKeyWord;\n  },\n\n  getKeyWordColor: function getKeyWordColor() {\n    return this.keyWordColor;\n  },\n\n  getFullURL: function getFullURL() {\n    return this.fullurl;\n  }\n};\n\nfunction TermHtml() {\n  this.html = '';\n}\n\nTermHtml.prototype = {\n\n  setHtml: function setHtml(str) {\n    this.html = str;\n  },\n\n  addHtml: function addHtml(str) {\n    this.html += str;\n  },\n\n  getHtml: function getHtml() {\n    return this.html;\n  }\n};\n\nfunction TermBuf(cols, rows) {\n  this.cols = cols;\n  this.rows = rows;\n  this.view = null;\n  this.cur_x = 0;\n  this.cur_y = 0;\n  this.cur_x_sav = -1;\n  this.cur_y_sav = -1;\n  this.scrollStart = 0;\n  this.scrollEnd = rows - 1;\n  this._nowHighlight = -1;\n  Object.defineProperty(this, 'nowHighlight', {\n    set: this.setHighlight.bind(this),\n    get: function () {\n      return this._nowHighlight;\n    }.bind(this)\n  });\n  this.tempMouseCol = 0;\n  this.tempMouseRow = 0;\n  this.mouseCursor = 0;\n  this.highlightCursor = true;\n  this.useMouseBrowsing = true;\n  //this.scrollingTop=0;\n  //this.scrollingBottom=23;\n  this.attr = new TermChar(' ');\n  this.newChar = new TermChar(' ');\n  this.disableLinefeed = false;\n  this.altScreen = '';\n  this.changed = false;\n  this.posChanged = false;\n  this.pageState = 0;\n  this.forceFullWidth = false;\n  this.enableDeleteDupLogin = false;\n  this.deleteDupLogin = false;\n\n  this.startedEasyReading = false;\n  this.easyReadingShowReplyText = false;\n  this.easyReadingShowPushInitText = false;\n  this.prevPageState = 0;\n\n  this.lines = new Array(rows);\n  this.linesX = new Array(0);\n  this.linesY = new Array(0);\n\n  this.pageLines = [];\n  this.pageWrappedLines = [];\n\n  this.outputhtmls = new Array(rows);\n  this.lineChangeds = new Array(rows);\n\n  this.viewBufferTimer = 30;\n\n  while (--rows >= 0) {\n    var line = new Array(cols);\n    var outputhtml = new Array(cols);\n    var c = cols;\n    while (--c >= 0) {\n      line[c] = new TermChar(' ');\n      outputhtml[c] = new TermHtml();\n    }\n    this.lines[rows] = line;\n    this.outputhtmls[rows] = outputhtml;\n    //this.keyWordLine[rows]=false;\n  }\n  this.BBSWin = document.getElementById('BBSWindow');\n}\n\nTermBuf.prototype = {\n\n  timerUpdate: null,\n\n  uriRegEx: /((ftp|http|https|telnet):\\/\\/([A-Za-z0-9_]+:{0,1}[A-Za-z0-9_]*@)?([A-Za-z0-9_#!:.?+=&%@!\\-\\/\\$\\^,;|*~'()]+)(:[0-9]+)?(\\/|\\/([A-Za-z0-9_#!:.?+=&%@!\\-\\/]))?)|(pid:\\/\\/(\\d{1,10}))/ig,\n\n  setView: function setView(view) {\n    this.view = view;\n  },\n\n  puts: function puts(str) {\n    if (!str) return;\n    var cols = this.cols;\n    var rows = this.rows;\n    var lines = this.lines;\n    var n = str.length;\n    var line = lines[this.cur_y];\n    for (var i = 0; i < n; ++i) {\n      var ch = str[i];\n      switch (ch) {\n        case '\\x07':\n          // FIXME: beep (1)Sound (2)AlertNotification (3)change icon\n          // should only play sound\n          continue;\n        case '\\b':\n          this.back();\n          continue;\n        case '\\r':\n          this.carriageReturn();\n          continue;\n        case '\\n':\n        case '\\f':\n        case '\\v':\n          this.lineFeed();\n          line = lines[this.cur_y];\n          continue;\n        case '\\0':\n          continue;\n      }\n      //if( ch < ' ')\n      //    //dump('Unhandled invisible char' + ch.charCodeAt(0)+ '\\n');\n\n      if (this.cur_x >= cols) {\n        // next line\n        if (!this.disableLinefeed) this.lineFeed();\n        this.cur_x = 0;\n        line = lines[this.cur_y];\n        this.posChanged = true;\n      }\n\n      switch (ch) {\n        case '\\t':\n          this.tab();\n          break;\n        default:\n          var ch2 = line[this.cur_x];\n          ch2.ch = ch;\n          ch2.copyAttr(this.attr);\n          ch2.needUpdate = true;\n          ++this.cur_x;\n          if (ch2.isLeadByte) // previous state before this function\n            line[this.cur_x].needUpdate = true;\n          if (this.view.charset == 'UTF-8' && this.isFullWidth(ch) && this.cur_x < cols) {\n            ch2 = line[this.cur_x];\n            ch2.ch = '';\n            ch2.copyAttr(this.attr);\n            ch2.needUpdate = true;\n            ++this.cur_x;\n            // assume server will handle mouse moving on full-width char\n          }\n          this.changed = true;\n          this.posChanged = true;\n      }\n    }\n    this.queueUpdate();\n  },\n\n  updateCharAttr: function updateCharAttr() {\n    var cols = this.cols;\n    var rows = this.rows;\n    var lines = this.lines;\n    for (var row = 0; row < rows; ++row) {\n      var line = lines[row];\n      var needUpdate = false;\n      for (var col = 0; col < cols; ++col) {\n        var ch = line[col];\n        if (ch.needUpdate) needUpdate = true;\n        // all chars > ASCII code are regarded as lead byte of DBCS.\n        // FIXME: this is not correct, but works most of the times.\n        if (this.isFullWidth(ch.ch) && col + 1 < cols) {\n          ch.isLeadByte = true;\n          ++col;\n          var ch0 = ch;\n          ch = line[col];\n          if (ch.needUpdate) needUpdate = true;\n          // ensure simutaneous redraw of both bytes\n          if (ch0.needUpdate != ch.needUpdate) {\n            ch0.needUpdate = ch.needUpdate = true;\n          }\n        } else if (ch.isleadbyte && col + 1 < cols) {\n          var ch2 = line[col + 1];\n          ch2.needUpdate = true;\n        }\n        ch.isLeadByte = false;\n      }\n\n      if (needUpdate) {\n        // this line has been changed\n        this.lineChangeds[row] = true;\n        // perform URI detection again\n        // remove all previously cached uri positions\n        if (line.uris) {\n          var uris = line.uris;\n          var nuris = uris.length;\n\n          // FIXME: this is inefficient\n          for (var iuri = 0; iuri < nuris; ++iuri) {\n            var uri = uris[iuri];\n            line[uri[0]].startOfURL = false;\n            line[uri[0]].endOfURL = false;\n            line[uri[0]].fullurl = '';\n            line[uri[1] - 1].startOfURL = false;\n            line[uri[1] - 1].endOfURL = false;\n            line[uri[1] - 1].fullurl = '';\n            for (var col = uri[0]; col < uri[1]; ++col) {\n              line[col].partOfURL = false;\n              line[col].needUpdate = true;\n            }\n          }\n          line.uris = null;\n        }\n        var s = '';\n        for (var col = 0; col < cols; ++col) {\n          s += line[col].ch;\n        }if (this.view.charset != 'UTF-8') s = s.replace(/[^\\x00-\\x7f]./g, '\\xab\\xcd');else {\n          var str = '';\n          for (var i = 0; i < s.length; ++i) {\n            str += s.charAt(i);\n            if (this.isFullWidth(s.charAt(i))) str += s.charAt(i);\n          }\n          s = str;\n        }\n        var res;\n        var uris = null;\n        // pairs of URI start and end positions are stored in line.uri.\n        while ((res = this.uriRegEx.exec(s)) !== null) {\n          if (!uris) uris = [];\n          var uri = [res.index, res.index + res[0].length];\n          uris.push(uri);\n          // dump('found URI: ' + res[0] + '\\n');\n        }\n\n        if (uris) {\n          line.uris = uris;\n          // dump(line.uris.length + \"uris found\\n\");\n        }\n        //\n        if (line.uris) {\n          var uris = line.uris;\n          var nuris = uris.length;\n          for (var iuri = 0; iuri < nuris; ++iuri) {\n            var uri = uris[iuri];\n            var urlTemp = '';\n\n            for (var col = uri[0]; col < uri[1]; ++col) {\n              urlTemp += line[col].ch;\n              line[col].partOfURL = true;\n              line[col].needUpdate = true; //fix link bug\n            }\n            var u;\n            if (this.view.charset != 'UTF-8') u = urlTemp; //this.conv.convertStringToUTF8(urlTemp, this.view.charset,  true);\n            else {\n                var str = '';\n                for (var i = 0; i < urlTemp.length; ++i) {\n                  str += urlTemp.charAt(i);\n                  if (this.isFullWidth(urlTemp.charAt(i))) str += urlTemp.charAt(i);\n                }\n                u = str;\n              }\n            var urlTemp2 = urlTemp.toLowerCase();\n            line[uri[0]].startOfURL = true;\n            if (urlTemp2.substr(0, 6) == 'pid://') {\n              line[uri[0]].fullurl = 'http://www.pixiv.net/member_illust.php?mode=big&illust_id=' + urlTemp2.substr(6, 15);\n            } else {\n              //var g = encodeURI(u);\n              //line[uri[0]].fullurl=g;\n              line[uri[0]].fullurl = u;\n            }\n            line[uri[1] - 1].endOfURL = true;\n            //line[uri[1]-1].needUpdate = true; //fix link bug, some wee need update 2 byte(this byte and prevous byte)\n            //for (var col = uri[0]; col < uri[1]; ++col)\n            //  line[col].fullurl = g;\n          }\n        }\n        //\n      }\n    }\n  },\n\n  clear: function clear(param) {\n    var rows = this.rows;\n    var cols = this.cols;\n    var lines = this.lines;\n\n    switch (param) {\n      case 0:\n        var line = lines[this.cur_y];\n        var col, row;\n        for (col = this.cur_x; col < cols; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n        for (row = this.cur_y; row < rows; ++row) {\n          line = lines[row];\n          for (col = 0; col < cols; ++col) {\n            line[col].copyFrom(this.newChar);\n            line[col].needUpdate = true;\n          }\n        }\n        break;\n      case 1:\n        var line;\n        var col, row;\n        for (row = 0; row < this.cur_y; ++row) {\n          line = lines[row];\n          for (col = 0; col < cols; ++col) {\n            line[col].copyFrom(this.newChar);\n            line[col].needUpdate = true;\n          }\n        }\n        line = lines[this.cur_y];\n        for (col = 0; col < this.cur_x; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n        break;\n      case 2:\n        while (--rows >= 0) {\n          var col = cols;\n          var line = lines[rows];\n          while (--col >= 0) {\n            line[col].copyFrom(this.newChar);\n            line[col].needUpdate = true;\n          }\n        }\n        break;\n    }\n    this.changed = true;\n    this.gotoPos(0, 0);\n    this.queueUpdate();\n  },\n\n  back: function back() {\n    if (this.cur_x > 0) {\n      --this.cur_x;\n      this.posChanged = true;\n      this.queueUpdate();\n    }\n  },\n\n  tab: function tab(param) {\n    var mod = this.cur_x % 4;\n    this.cur_x += 4 - mod;\n    if (param > 1) this.cur_x += 4 * (param - 1);\n    if (this.cur_x >= this.cols) this.cur_x = this.cols - 1;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  backTab: function backTab(param) {\n    var mod = this.cur_x % 4;\n    this.cur_x -= mod > 0 ? mod : 4;\n    if (param > 1) this.cur_x -= 4 * (param - 1);\n    if (this.cur_x < 0) this.cur_x = 0;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  insert: function insert(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    var cur_x = this.cur_x;\n    if (cur_x > 0 && line[cur_x - 1].isLeadByte) ++cur_x;\n    if (cur_x == cols) return;\n    if (cur_x + param >= cols) {\n      for (var col = cur_x; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n    } else {\n      while (--param >= 0) {\n        var ch = line.pop();\n        line.splice(cur_x, 0, ch);\n        ch.copyFrom(this.newChar);\n      }\n      for (var col = cur_x; col < cols; ++col) {\n        line[col].needUpdate = true;\n      }\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  del: function del(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    var cur_x = this.cur_x;\n    if (cur_x > 0 && line[cur_x - 1].isLeadByte) ++cur_x;\n    if (cur_x == cols) return;\n    if (cur_x + param >= cols) {\n      for (var col = cur_x; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n    } else {\n      var n = cols - cur_x - param;\n      while (--n >= 0) {\n        line.splice(cur_x, 0, line.pop());\n      }for (var col = cols - param; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n      }for (var col = cur_x; col < cols; ++col) {\n        line[col].needUpdate = true;\n      }\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  eraseChar: function eraseChar(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    var cur_x = this.cur_x;\n    if (cur_x > 0 && line[cur_x - 1].isLeadByte) ++cur_x;\n    if (cur_x == cols) return;\n    var n = cur_x + param > cols ? cols : cur_x + param;\n    for (var col = cur_x; col < n; ++col) {\n      line[col].copyFrom(this.newChar);\n      line[col].needUpdate = true;\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  eraseLine: function eraseLine(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    switch (param) {\n      case 0:\n        // erase to rigth\n        for (var col = this.cur_x; col < cols; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n        break;\n      case 1:\n        //erase to left\n        var cur_x = this.cur_x;\n        for (var col = 0; col < cur_x; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n        break;\n      case 2:\n        //erase all\n        for (var col = 0; col < cols; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n        break;\n      default:\n        return;\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  deleteLine: function deleteLine(param) {\n    var scrollStart = this.scrollStart;\n    this.scrollStart = this.cur_y;\n    this.scroll(false, param);\n    this.scrollStart = scrollStart;\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  insertLine: function insertLine(param) {\n    var scrollStart = this.scrollStart;\n    if (this.cur_y < this.scrollEnd) {\n      this.scrollStart = this.cur_y;\n      this.scroll(true, param);\n    }\n    this.scrollStart = scrollStart;\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  scroll: function scroll(up, n) {\n    var scrollStart = this.scrollStart;\n    var scrollEnd = this.scrollEnd;\n    if (scrollEnd <= scrollStart) {\n      scrollStart = 0;\n      if (scrollEnd < 1) scrollEnd = this.rows - 1;\n    }\n    if (n >= this.rows) // scroll more than 1 page = clear\n      this.clear(2);else if (n >= scrollEnd - scrollStart + 1) {\n      var lines = this.lines;\n      var cols = this.cols;\n      for (var row = scrollStart; row <= scrollEnd; ++row) {\n        for (var col = 0; col < cols; ++col) {\n          lines[row][col].copyFrom(this.newChar);\n          lines[row][col].needUpdate = true;\n        }\n      }\n    } else {\n      var lines = this.lines;\n      var rows = this.rows;\n      var cols = this.cols;\n\n      if (up) {\n        // move lines down\n        for (var i = 0; i < rows - 1 - scrollEnd; ++i) {\n          lines.unshift(lines.pop());\n        }while (--n >= 0) {\n          var line = lines.pop();\n          lines.splice(rows - 1 - scrollEnd + scrollStart, 0, line);\n          for (var col = 0; col < cols; ++col) {\n            line[col].copyFrom(this.newChar);\n          }\n        }\n        for (var i = 0; i < rows - 1 - scrollEnd; ++i) {\n          lines.push(lines.shift());\n        }\n      } else {\n        // move lines up\n        for (var i = 0; i < scrollStart; ++i) {\n          lines.push(lines.shift());\n        }while (--n >= 0) {\n          var line = lines.shift();\n          lines.splice(scrollEnd - scrollStart, 0, line);\n          for (var col = 0; col < cols; ++col) {\n            // clear the line\n            line[col].copyFrom(this.newChar);\n          }\n        }\n        for (var i = 0; i < scrollStart; ++i) {\n          lines.unshift(lines.pop());\n        }\n      }\n\n      // update the whole screen within scroll region\n      for (var row = scrollStart; row <= scrollEnd; ++row) {\n        var line = lines[row];\n        for (var col = 0; col < cols; ++col) {\n          line[col].needUpdate = true;\n        }\n      }\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  gotoPos: function gotoPos(x, y) {\n    // dump('gotoPos: ' + x + ', ' + y + '\\n');\n    if (x >= this.cols) x = this.cols - 1;\n    if (y >= this.rows) y = this.rows - 1;\n    if (x < 0) x = 0;\n    if (y < 0) y = 0;\n    this.cur_x = x;\n    this.cur_y = y;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  carriageReturn: function carriageReturn() {\n    this.cur_x = 0;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  lineFeed: function lineFeed() {\n    if (this.cur_y < this.scrollEnd) {\n      ++this.cur_y;\n      this.posChanged = true;\n      this.queueUpdate();\n    } else {\n      // at bottom of screen\n      this.scroll(false, 1);\n    }\n  },\n\n  queueUpdate: function queueUpdate(directupdate) {\n    if (this.timerUpdate) return;\n\n    var _this = this;\n    var func = function func() {\n      _this.notify();\n    };\n    if (directupdate) this.timerUpdate = setTimeout(func, 1);else this.timerUpdate = setTimeout(func, 30);\n  },\n\n  notify: function notify(timer) {\n    clearTimeout(this.timerUpdate);\n    this.timerUpdate = null;\n\n    if (this.changed) {\n      // content changed\n      this.updateCharAttr();\n\n      this.setPageState();\n      if (this.useMouseBrowsing) {\n        // clear highlight and reset cursor on page change\n        // without the redraw being called here\n        this.clearHighlight();\n      }\n\n      if (this.enableDeleteDupLogin) {\n        if (this.pageState === 0) {\n          var strToSend = '\\r';\n          var lastRowText = this.getRowText(22, 0, this.cols);\n          var nextLastRowText = this.getRowText(21, 0, this.cols);\n          if (lastRowText.parseDuplicatedLoginTextLastRow() && nextLastRowText.parseDuplicatedLoginText()) {\n            if (!this.deleteDupLogin) {\n              strToSend = 'n' + strToSend;\n            }\n            this.view.conn.send(strToSend);\n          }\n        }\n      }\n\n      this.dispatchEvent(new CustomEvent('change'));\n\n      if (this.view) {\n        this.view.update();\n      }\n      this.changed = false;\n\n      this.dispatchEvent(new CustomEvent('viewUpdate'));\n    }\n\n    if (this.posChanged) {\n      // cursor pos changed\n      if (this.view) {\n        this.view.updateCursorPos();\n      }\n      this.posChanged = false;\n    }\n\n    if (this.view.blinkOn) {\n      this.view.blinkOn = false;\n      this.view.blinkShow = !this.view.blinkShow;\n      //\n      var allBlinkSpan = document.getElementsByTagName('x');\n      for (var i = 0; i < allBlinkSpan.length; i++) {\n        var c = this.view.blinkShow && this.view.doBlink ? allBlinkSpan[i].getAttribute(\"h\") : allBlinkSpan[i].getAttribute(\"s\");\n        allBlinkSpan[i].parentNode.setAttribute(\"class\", c);\n      }\n    }\n  },\n\n  getText: function getText(row, colStart, colEnd, color, isutf8, reset, lines) {\n    var text = '';\n    if (lines) {\n      text = lines[row];\n    } else {\n      text = this.lines[row];\n    }\n    // always start from leadByte, and end at second-byte of DBCS.\n    // Note: this might change colStart and colEnd. But currently we don't return these changes.\n    if (colStart == this.cols) return '';\n\n    if (colStart > 0) {\n      if (!text[colStart].isLeadByte && text[colStart - 1].isLeadByte) colStart--;\n    } else colStart = 0;\n\n    if (colEnd > 0) {\n      if (text[colEnd - 1].isLeadByte) colEnd++;\n    } else colEnd = this.cols;\n\n    if (colStart >= colEnd) return '';\n\n    if (!this.view) return;\n\n    var charset = this.view.charset;\n\n    // generate texts with ansi color\n    if (color) {\n      var output = this.ansiCmp(this.newChar, text[colStart], reset);\n      for (var col = colStart; col < colEnd - 1; ++col) {\n        if (isutf8 && text[col].isLeadByte && this.ansiCmp(text[col], text[col + 1])) output += this.ansiCmp(text[col], text[col + 1]).replace(/m$/g, ';50m') + text[col].ch;else output += text[col].ch + this.ansiCmp(text[col], text[col + 1]);\n      }\n      output += text[colEnd - 1].ch + this.ansiCmp(text[colEnd - 1], this.newChar);\n      return isutf8 && charset != 'UTF-8' ? output.b2u() : output;\n    }\n\n    text = text.slice(colStart, colEnd);\n    return text.map(function (c, col, line) {\n      if (!c.isLeadByte) {\n        if (col >= 1 && line[col - 1].isLeadByte) {\n          // second byte of DBCS char\n          var prevC = line[col - 1];\n          var b5 = prevC.ch + c.ch;\n          if (this.view && this.view.charset == 'UTF-8' || b5.length == 1) return b5;else return b5.b2u();\n        } else return c.ch;\n      }\n    }).join('');\n  },\n\n  findText: function findText(text, searchrow) {\n    var result = { col: -1, row: -1 };\n    var searchStart = 0;\n    var searchEnd = this.cols - 1;\n    if (searchrow >= 0) searchStart = searchEnd = searchrow;\n    for (var row = searchStart; row <= searchEnd; ++row) {\n      var line = this.getText(row, 0, this.cols, false, true);\n      result.col = line.indexOf(text);\n      if (result.col >= 0) {\n        result.row = row;\n        break;\n      }\n    }\n    return result;\n  },\n\n  getRowText: function getRowText(row, colStart, colEnd, lines) {\n\n    var text = '';\n    if (lines) {\n      text = lines[row];\n    } else {\n      text = this.lines[row];\n    }\n    // always start from leadByte, and end at second-byte of DBCS.\n    // Note: this might change colStart and colEnd. But currently we don't return these changes.\n    if (colStart > 0) {\n      if (!text[colStart].isLeadByte && text[colStart - 1].isLeadByte) colStart--;\n    } else colStart = 0;\n\n    if (colEnd < this.cols) {\n      if (text[colEnd].isLeadByte) colEnd++;\n    } else colEnd = this.cols;\n\n    text = text.slice(colStart, colEnd);\n    var charset = this.view.charset;\n    var that = this;\n    return text.map(function (c, col, line) {\n      if (!c.isLeadByte) {\n        if (col >= 1 && line[col - 1].isLeadByte) {\n          // second byte of DBCS char\n          var prevC = line[col - 1];\n          var b5 = prevC.ch + c.ch;\n          if (that.view && that.view.charset == 'UTF-8' || b5.length == 1) return b5;else return b5.b2u();\n        } else return c.ch;\n      }\n    }).join('');\n  },\n\n  parseText: function parseText(text) {\n    var strs = text.split('^');\n    var returnStr = strs[0];\n    for (var i = 1; i < strs.length; ++i) {\n      if (strs[i].length > 0) {\n        returnStr += String.fromCharCode(strs[i].charCodeAt(0) - 64);\n        returnStr += strs[i].substr(1);\n      } else if (i < strs.length - 1) {\n        returnStr += '^' + strs[++i];\n      } else returnStr += '^';\n    }\n    return returnStr;\n  },\n\n  ansiCmp: function ansiCmp(preChar, thisChar, forceReset) {\n    var text = '';\n    var reset = forceReset;\n    if (preChar.bright && !thisChar.bright || preChar.underLine && !thisChar.underLine || preChar.blink && !thisChar.blink || preChar.invert && !thisChar.invert) reset = true;\n    if (reset) text = ';';\n    if ((reset || !preChar.bright) && thisChar.bright) text += '1;';\n    if ((reset || !preChar.underLine) && thisChar.underLine) text += '4;';\n    if ((reset || !preChar.blink) && thisChar.blink) text += '5;';\n    if ((reset || !preChar.invert) && thisChar.invert) text += '7;';\n    var DeFg = TermChar.defaultFg;\n    var DeBg = TermChar.defaultBg;\n    var thisFg = thisChar.fg == -1 ? DeFg : thisChar.fg;\n    var preFg = preChar.fg == -1 ? DeFg : preChar.fg;\n    var thisBg = thisChar.bg == -1 ? DeBg : thisChar.bg;\n    var preBg = preChar.bg == -1 ? DeBg : preChar.bg;\n    if (reset ? thisFg != DeFg : preFg != thisFg) text += '3' + thisFg + ';';\n    if (reset ? thisBg != DeBg : preBg != thisBg) text += '4' + thisBg + ';';\n    if (!text) return '';else return '\\x1b[' + text.substr(0, text.length - 1) + 'm';\n  },\n\n  isFullWidth: function isFullWidth(str) {\n    var code = str.charCodeAt(0);\n    if (this.view.charset != 'UTF-8' || this.forceFullWidth) {\n      // PTT support\n      if (code > 0x7f) return true;else return false;\n    }\n    if (code >= 0x1100 && code <= 0x115f || code >= 0x2329 && code <= 0x232a || code >= 0x2e80 && code <= 0x303e || code >= 0x3040 && code <= 0xa4cf || code >= 0xac00 && code <= 0xd7a3 || code >= 0xf900 && code <= 0xfaff || code >= 0xfe30 && code <= 0xfe6f || code >= 0xff00 && code <= 0xff60 || code >= 0xffe0 && code <= 0xffe6) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  isTextWrappedRow: function isTextWrappedRow(row) {\n    // determine whether it is wrapped by looking for the ending \"\\\"\n    var rowText = this.getRowText(row, 0, this.cols);\n    var slashIndex = rowText.lastIndexOf('\\\\');\n    if (slashIndex > 0) {\n      var col = rowText.substr(0, slashIndex).u2b().length;\n      if (col != 77 && col != 78) return false;\n      // check the color\n      var ch = this.lines[row][col];\n      if (ch.fg == 7 && ch.bg === 0 && ch.bright) return true;\n    }\n    return false;\n  },\n\n  setPageState: function setPageState() {\n    //this.pageState = 0; //NORMAL\n    var m_ColsPerPage = 80;\n    var lastRowText = this.getRowText(23, 0, this.cols);\n    if (lastRowText.indexOf('請按任意鍵繼續') > 0 || lastRowText.indexOf('請按 空白鍵 繼續') > 0) {\n      //console.log('pageState = 5 (PASS)');\n      this.pageState = 5; // some ansi drawing screen to pass\n      return;\n    }\n    if (lastRowText.indexOf(' 編輯文章  (^Z/F1)說明 (^P/^G)插入符號/範本 (^X/^Q)離開') === 0) {\n      this.pageState = 6;\n      return;\n    }\n    if (lastRowText.parseStatusRow()) {\n      this.pageState = 3; // READING\n      return;\n    }\n\n    var firstRowText = this.getRowText(0, 0, this.cols);\n\n    if (this.isUnicolor(0, 0, 29) && this.isUnicolor(0, 60, 70)) {\n      var main = firstRowText.indexOf('【主功能表】');\n      var classList = firstRowText.indexOf('【分類看板】');\n      var archiveList = firstRowText.indexOf('【精華文章】');\n      if (main === 0 || classList === 0 || archiveList === 0 || lastRowText.parseListRow()) {\n        //console.log('pageState = 1 (MENU)');\n        this.pageState = 1; // MENU\n      } else if (this.isUnicolor(2, 0, 70) && !this.isLineEmpty(1) && (this.cur_x < 19 || this.cur_y == 23)) {\n        //console.log('pageState = 2 (LIST)');\n        this.pageState = 2; // LIST\n      }\n    } else if (this.isUnicolor(23, 28, 53) && this.cur_y == 23 && this.cur_x == 79) {\n      //console.log('pageState = 5 (PASS)');\n      this.pageState = 5; // some ansi drawing screen to pass\n    }\n    if (this.pageState != 1 && this.isLineEmpty(23)) {\n      //console.log('pageState = 0 (NORMAL)');\n      this.pageState = 0;\n    }\n  },\n\n  isPttZArea: function isPttZArea() {\n    var rows = 24;\n    var lines = this.lines;\n    if (this.view.charset != 'UTF-8') {\n      var line = lines[0];\n      var PTTstr1 = '\\xa1\\x69\\xba\\xeb\\xb5\\xd8\\xa4\\xe5\\xb3\\xb9\\xa1\\x6a';\n      for (var i = 0; i <= 11; ++i) {\n        if (line[i].ch != PTTstr1.charAt(i)) return false;\n      }\n      line = lines[rows - 1];\n      var PTTstr2 = '\\xa1\\x69\\xa5\\x5c\\xaf\\xe0\\xc1\\xe4\\xa1\\x6a';\n      for (var i = 1; i <= 10; ++i) {\n        if (line[i].ch != PTTstr2.charAt(i - 1)) return false;\n      }\n    } else {\n      var line = lines[0];\n      var PTTstr = '';\n      for (var i = 0; i <= 11; i += 2) {\n        PTTstr += line[i].ch;\n      }\n      if (PTTstr != this.PTTZSTR1) return false;\n      line = lines[rows - 1];\n      PTTstr = '';\n      for (var i = 1; i <= 10; i += 2) {\n        PTTstr += line[i].ch;\n      }\n      if (PTTstr != this.PTTZSTR2) return false;\n    }\n    return true;\n  },\n\n  isUnicolor: function isUnicolor(lineindex, start, end) {\n    var lines = this.lines;\n    var line = lines[lineindex];\n    var clr = line[start].getBg();\n\n    // a dirty hacking, because of the difference between maple and firebird bbs.\n    for (var i = start; i < end; i++) {\n      var clr1 = line[i].getBg();\n      if (clr1 != clr || clr1 === 0) return false;\n    }\n    return true;\n  },\n\n  isLineEmpty: function isLineEmpty(iLine) {\n    var rows = this.rows;\n    var lines = this.lines;\n    var line = lines[iLine];\n\n    for (var col = 0; col < this.cols; col++) {\n      if (line[col].ch != ' ' || line[col].getBg()) return false;\n    }return true;\n  },\n\n  onMouse_move: function onMouse_move(tcol, trow, doRefresh) {\n    this.tempMouseCol = tcol;\n    this.tempMouseRow = trow;\n\n    if (this.nowHighlight != trow || doRefresh) {\n      this.clearHighlight();\n    }\n\n    switch (this.pageState) {\n      case 0:\n        //NORMAL\n        //SetCursor(m_ArrowCursor);\n        //m_CursorState = 0;\n        this.mouseCursor = 0;\n        break;\n\n      case 4:\n        //LIST\n        if (trow > 1 && trow < 22) {\n          //m_pTermData->m_RowsPerPage-1\n          if (tcol <= 6) {\n            this.mouseCursor = 1;\n            this.clearHighlight();\n            //SetCursor(m_ExitCursor);m_CursorState=1;\n          } else if (tcol >= 64) {\n            //m_pTermData->m_ColsPerPage-16\n            if (trow > 12) this.mouseCursor = 3;else this.mouseCursor = 2;\n            this.clearHighlight();\n          } else {\n            if (!this.isLineEmpty(trow)) {\n              this.mouseCursor = 6;\n              this.nowHighlight = trow;\n            } else {\n              this.mouseCursor = 11;\n            }\n          }\n        } else if (trow == 1 || trow == 2) {\n          this.mouseCursor = 2;\n        } else if (trow === 0) {\n          this.mouseCursor = 4;\n        } else {\n          // if ( trow == 23)\n          this.mouseCursor = 5;\n        }\n        break;\n\n      case 2:\n        //LIST\n        if (trow > 2 && trow < 23) {\n          //m_pTermData->m_RowsPerPage-1\n          if (tcol <= 6) {\n            this.mouseCursor = 1;\n            this.clearHighlight();\n            //SetCursor(m_ExitCursor);m_CursorState=1;\n          } else if (tcol >= 64) {\n            //m_pTermData->m_ColsPerPage-16\n            if (trow > 12) this.mouseCursor = 3;else this.mouseCursor = 2;\n            this.clearHighlight();\n          } else {\n            if (!this.isLineEmpty(trow)) {\n              this.mouseCursor = 6;\n              this.nowHighlight = trow;\n            } else {\n              this.mouseCursor = 11;\n            }\n          }\n        } else if (trow == 1 || trow == 2) {\n          if (tcol < 2) //[\n            this.mouseCursor = 8;else if (tcol > 75) //]\n            this.mouseCursor = 9;else this.mouseCursor = 2;\n        } else if (trow === 0) {\n          if (tcol < 2) //=\n            this.mouseCursor = 10;else if (tcol > 75) //]\n            this.mouseCursor = 9;else this.mouseCursor = 4;\n        } else {\n          // if ( trow == 23)\n          if (tcol < 2) this.mouseCursor = 12;else if (tcol > 75) this.mouseCursor = 13;else this.mouseCursor = 5;\n        }\n        break;\n\n      case 3:\n        //READING\n        if (trow == 23) {\n          if (tcol < 2) //]\n            this.mouseCursor = 12;else if (tcol > 75) this.mouseCursor = 14;else this.mouseCursor = 5;\n        } else if (trow === 0) {\n          if (tcol < 2) //=\n            this.mouseCursor = 10;else if (tcol > 75) //]\n            this.mouseCursor = 9;else if (tcol < 7) this.mouseCursor = 1;else this.mouseCursor = 2;\n        } else if (trow == 1 || trow == 2) {\n          if (tcol < 2) //[\n            this.mouseCursor = 8;else if (tcol > 75) //]\n            this.mouseCursor = 9;else if (tcol < 7) this.mouseCursor = 1;else this.mouseCursor = 2;\n        } else if (tcol < 7) this.mouseCursor = 1;else if (trow < 12) this.mouseCursor = 2;else this.mouseCursor = 3;\n        break;\n\n      case 1:\n        //MENU\n        if (trow > 0 && trow < 23) {\n          if (tcol > 7) this.mouseCursor = 7;else this.mouseCursor = 1;\n        } else {\n          this.mouseCursor = 0;\n          //SetCursor(m_ArrowCursor);m_CursorState=0;\n        }\n        break;\n\n      default:\n        this.mouseCursor = 0;\n        break;\n    }\n\n    this.BBSWin.style.cursor = mouseCursorMap[this.mouseCursor];\n  },\n\n  resetMousePos: function resetMousePos() {\n    if (this.useMouseBrowsing) {\n      this.onMouse_move(this.tempMouseCol, this.tempMouseRow, true);\n    }\n  },\n\n  setHighlight: function setHighlight(row) {\n    this._nowHighlight = row;\n    this.view.setHighlightedRow(row);\n  },\n\n  clearHighlight: function clearHighlight() {\n    this.nowHighlight = -1;\n    this.mouseCursor = 0;\n  }\n};\n\n_event.Event.mixin(TermBuf.prototype);\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ColorState = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.renderRowHtml = renderRowHtml;\n\nvar _symbol_table = __webpack_require__(12);\n\nvar _image_preview = __webpack_require__(5);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar HyperLink = function (_React$Component) {\n  _inherits(HyperLink, _React$Component);\n\n  function HyperLink() {\n    _classCallCheck(this, HyperLink);\n\n    return _possibleConstructorReturn(this, (HyperLink.__proto__ || Object.getPrototypeOf(HyperLink)).apply(this, arguments));\n  }\n\n  _createClass(HyperLink, [{\n    key: 'render',\n    value: function render() {\n      return React.createElement(\n        'a',\n        { scol: this.props.col, srow: this.props.row,\n          className: 'y', href: this.props.href, rel: 'noreferrer', target: '_blank' },\n        this.props.inner\n      );\n    }\n  }]);\n\n  return HyperLink;\n}(React.Component);\n\nvar ColorSpan = function (_React$Component2) {\n  _inherits(ColorSpan, _React$Component2);\n\n  function ColorSpan() {\n    _classCallCheck(this, ColorSpan);\n\n    return _possibleConstructorReturn(this, (ColorSpan.__proto__ || Object.getPrototypeOf(ColorSpan)).apply(this, arguments));\n  }\n\n  _createClass(ColorSpan, [{\n    key: 'render',\n    value: function render() {\n      var classes = ['q' + this.props.colorState.fg, 'b' + this.props.colorState.bg].join(' ');\n      var blinkNode = '';\n      if (this.props.colorState.blink) {\n        blinkNode = React.createElement('x', { s: classes, h: 'qq' + this.props.colorState.bg });\n      }\n      return React.createElement(\n        'span',\n        { className: classes },\n        blinkNode,\n        this.props.inner\n      );\n    }\n  }]);\n\n  return ColorSpan;\n}(React.Component);\n\nvar NormalText = function (_React$Component3) {\n  _inherits(NormalText, _React$Component3);\n\n  function NormalText() {\n    _classCallCheck(this, NormalText);\n\n    return _possibleConstructorReturn(this, (NormalText.__proto__ || Object.getPrototypeOf(NormalText)).apply(this, arguments));\n  }\n\n  _createClass(NormalText, [{\n    key: 'render',\n    value: function render() {\n      return React.createElement(\n        'span',\n        null,\n        this.props.text\n      );\n    }\n  }]);\n\n  return NormalText;\n}(React.Component);\n\nvar ForceWidthWord = function (_React$Component4) {\n  _inherits(ForceWidthWord, _React$Component4);\n\n  function ForceWidthWord() {\n    _classCallCheck(this, ForceWidthWord);\n\n    return _possibleConstructorReturn(this, (ForceWidthWord.__proto__ || Object.getPrototypeOf(ForceWidthWord)).apply(this, arguments));\n  }\n\n  _createClass(ForceWidthWord, [{\n    key: 'render',\n    value: function render() {\n      var styles = {\n        display: 'inline-block'\n      };\n      if (this.props.forceWidth) {\n        styles['width'] = this.props.forceWidth.toString() + 'px';\n      }\n      return React.createElement(\n        'span',\n        { className: 'wpadding', style: styles },\n        this.props.inner\n      );\n    }\n  }]);\n\n  return ForceWidthWord;\n}(React.Component);\n\nvar TwoColorWord = function (_React$Component5) {\n  _inherits(TwoColorWord, _React$Component5);\n\n  function TwoColorWord() {\n    _classCallCheck(this, TwoColorWord);\n\n    return _possibleConstructorReturn(this, (TwoColorWord.__proto__ || Object.getPrototypeOf(TwoColorWord)).apply(this, arguments));\n  }\n\n  _createClass(TwoColorWord, [{\n    key: 'render',\n    value: function render() {\n      var c1 = this.props.colorLead,\n          c2 = this.props.colorTail;\n      var classes = [];\n      if (c1.fg == c2.fg) {\n        classes.push('q' + c1.fg);\n      } else {\n        classes.push('w' + c1.fg);\n        classes.push('q' + c2.fg);\n        classes.push('o');\n      }\n      if (c1.bg == c2.bg) {\n        classes.push('b' + c1.bg);\n      } else {\n        classes.push('b' + c1.bg + 'b' + c2.bg);\n      }\n      // TODO: add blinking.\n      var styles = {};\n      if (this.props.forceWidth) {\n        classes.push('wpadding');\n        styles['display'] = 'inline-block';\n        styles['width'] = this.props.forceWidth.toString() + 'px';\n      }\n      return React.createElement(\n        'span',\n        { className: classes.join(' '), style: styles,\n          'data-text': this.props.text },\n        this.props.text\n      );\n    }\n  }]);\n\n  return TwoColorWord;\n}(React.Component);\n\nvar ColorState = exports.ColorState = function () {\n  function ColorState(fg, bg, blink) {\n    _classCallCheck(this, ColorState);\n\n    this.fg = fg;\n    this.bg = bg;\n    this.blink = blink;\n  }\n\n  _createClass(ColorState, [{\n    key: 'equals',\n    value: function equals(oth) {\n      if (oth instanceof ColorState) {\n        return this.fg == oth.fg && this.bg == oth.bg && this.blink == oth.blink;\n      }\n      return false;\n    }\n  }]);\n\n  return ColorState;\n}();\n\nvar ColorSegmentBuilder = function () {\n  function ColorSegmentBuilder(currCol) {\n    _classCallCheck(this, ColorSegmentBuilder);\n\n    this.segs = [];\n    this.curr = null;\n    this.currCol = currCol;\n  }\n\n  _createClass(ColorSegmentBuilder, [{\n    key: '_isLastSegmentSameColor',\n    value: function _isLastSegmentSameColor(color) {\n      return this.curr && this.curr.colorState.equals(color);\n    }\n  }, {\n    key: '_addSegment',\n    value: function _addSegment(color) {\n      this.curr = {\n        col: this.currCol,\n        colorState: color,\n        texts: []\n      };\n      this.segs.push(this.curr);\n    }\n  }, {\n    key: '_append',\n    value: function _append(type, text, color) {\n      if (!this._isLastSegmentSameColor(color)) this._addSegment(color);\n      this.curr.texts.push({\n        col: this.currCol,\n        type: type,\n        text: text\n      });\n    }\n  }, {\n    key: '_reuseChars',\n    value: function _reuseChars(type, color) {\n      if (!this._isLastSegmentSameColor(color)) return null;\n      var len = this.curr.texts.length;\n      if (len == 0) return null;\n      var last = this.curr.texts[len - 1];\n      return last.type == type ? last : null;\n    }\n  }, {\n    key: '_appendNormalText',\n    value: function _appendNormalText(width, text, color) {\n      var reuse = this._reuseChars('normalText', color);\n      if (reuse) reuse.text += text;else this._append('normalText', text, color);\n      this.currCol += width;\n    }\n  }, {\n    key: 'appendNormalChar',\n    value: function appendNormalChar(text, color) {\n      this._appendNormalText(1, text, color);\n    }\n  }, {\n    key: 'appendNormalWord',\n    value: function appendNormalWord(text, color, forceWidth) {\n      if (forceWidth) {\n        this._append('forceWidthWord', text, color);\n        this.currCol += 2;\n      } else {\n        this._appendNormalText(2, text, color);\n      }\n    }\n  }, {\n    key: 'appendTwoColorWord',\n    value: function appendTwoColorWord(text, color, color2) {\n      this._addSegment(color);\n      this.curr.texts.push({\n        col: this.currCol,\n        type: 'twoColorWord',\n        text: text,\n        color: color,\n        color2: color2\n      });\n      this.currCol += 2;\n      this.curr = null;\n    }\n  }, {\n    key: 'build',\n    value: function build() {\n      return this.segs;\n    }\n  }]);\n\n  return ColorSegmentBuilder;\n}();\n\nvar Row = function (_React$Component6) {\n  _inherits(Row, _React$Component6);\n\n  function Row() {\n    _classCallCheck(this, Row);\n\n    var _this6 = _possibleConstructorReturn(this, (Row.__proto__ || Object.getPrototypeOf(Row)).call(this));\n\n    _this6.state = { highlighted: false };\n    return _this6;\n  }\n\n  _createClass(Row, [{\n    key: '_segmentHyperLinks',\n    value: function _segmentHyperLinks(chars) {\n      var segments = [];\n      var cur = null;\n      for (var i = 0; i < chars.length; i++) {\n        var ch = chars[i];\n        if (!cur || ch.isStartOfURL()) {\n          cur = {\n            col: i,\n            href: ch.isStartOfURL() ? ch.getFullURL() : null,\n            chars: []\n          };\n          segments.push(cur);\n        }\n        cur.chars.push(ch);\n        if (ch.isEndOfURL()) cur = null;\n      }\n      return segments;\n    }\n  }, {\n    key: '_segmentTwoColorDBCS',\n    value: function _segmentTwoColorDBCS(colOffset, chars) {\n      var builder = new ColorSegmentBuilder(colOffset);\n      var lead = null;\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = chars[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var ch = _step.value;\n\n          if (ch.isLeadByte) {\n            lead = ch;\n            continue;\n          }\n          if (lead) {\n            var u = (lead.ch + ch.ch).b2u();\n            if (u.length == 1) {\n              if (this._isBadDBCS(u)) {\n                builder.appendNormalChar('?', lead.getColor());\n                builder.appendNormalChar('?', ch.getColor());\n              } else if (lead.getColor().equals(ch.getColor())) {\n                builder.appendNormalWord(u, lead.getColor(), this._shouldForceWidth(u) ? this.props.forceWidth : 0);\n              } else {\n                builder.appendTwoColorWord(u, lead.getColor(), ch.getColor());\n              }\n            } else {\n              // Conversion error.\n              builder.appendNormalChar('?', lead.getColor());\n              builder.appendNormalChar(ch.ch == '\\x20' ? ' ' : '?', ch.getColor());\n            }\n            lead = null;\n          } else {\n            builder.appendNormalChar(ch.ch, ch.getColor());\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return builder.build();\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var colOffset = 0;\n      var cols = [];\n      var linkPreviews = [];\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this._segmentHyperLinks(this.props.chars)[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var linkSeg = _step2.value;\n\n          var inner = [];\n          var _iteratorNormalCompletion3 = true;\n          var _didIteratorError3 = false;\n          var _iteratorError3 = undefined;\n\n          try {\n            for (var _iterator3 = this._segmentTwoColorDBCS(colOffset, linkSeg.chars)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n              var colorSeg = _step3.value;\n\n              var texts = [];\n              var _iteratorNormalCompletion4 = true;\n              var _didIteratorError4 = false;\n              var _iteratorError4 = undefined;\n\n              try {\n                for (var _iterator4 = colorSeg.texts[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n                  var ch = _step4.value;\n\n                  var _key2 = 'text-c-' + ch.col;\n                  var forceWidth = this.props.forceWidth ? this.props.forceWidth : 0;\n                  switch (ch.type) {\n                    case 'normalText':\n                      texts.push(React.createElement(NormalText, { key: _key2, text: ch.text }));\n                      break;\n                    case 'forceWidthWord':\n                      texts.push(React.createElement(ForceWidthWord, { key: _key2, inner: ch.text,\n                        forceWidth: forceWidth }));\n                      break;\n                    case 'twoColorWord':\n                      texts.push(React.createElement(TwoColorWord, { key: _key2, text: ch.text,\n                        colorLead: ch.color, colorTail: ch.color2,\n                        forceWidth: forceWidth }));\n                      break;\n                  }\n                }\n              } catch (err) {\n                _didIteratorError4 = true;\n                _iteratorError4 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion4 && _iterator4.return) {\n                    _iterator4.return();\n                  }\n                } finally {\n                  if (_didIteratorError4) {\n                    throw _iteratorError4;\n                  }\n                }\n              }\n\n              var _key = 'colorSpan-c-' + colorSeg.col;\n              inner.push(React.createElement(ColorSpan, { key: _key, colorState: colorSeg.colorState,\n                inner: texts }));\n            }\n          } catch (err) {\n            _didIteratorError3 = true;\n            _iteratorError3 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                _iterator3.return();\n              }\n            } finally {\n              if (_didIteratorError3) {\n                throw _iteratorError3;\n              }\n            }\n          }\n\n          if (linkSeg.href) {\n            var key = 'hyperLink-c-' + linkSeg.col;\n            cols.push(React.createElement(HyperLink, { key: key, href: linkSeg.href, inner: inner,\n              'data-scol': linkSeg.col, 'data-srow': this.props.row }));\n            // TODO: Modularize this.\n            if (this.props.showsLinkPreviews) {\n              linkPreviews.push(React.createElement(_image_preview.HyperLinkPreview, { key: key, src: linkSeg.href }));\n            }\n          } else {\n            cols = cols.concat(inner);\n          }\n          colOffset += linkSeg.chars.length;\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      var classes = [];\n      if (this.state.highlighted) {\n        classes.push('b2');\n      }\n      // TODO: Detect userid and apply class \"blu_$userid\".\n      return React.createElement(\n        'div',\n        null,\n        React.createElement(\n          'span',\n          { key: 'line', className: classes.join(' '),\n            'data-type': 'bbsline',\n            'data-row': this.props.row },\n          cols\n        ),\n        React.createElement(\n          'div',\n          { key: 'previews' },\n          linkPreviews\n        )\n      );\n    }\n  }, {\n    key: 'setHighlight',\n    value: function setHighlight(shouldHighlight) {\n      if (this.state.highlighted != shouldHighlight) {\n        this.setState({ highlighted: shouldHighlight });\n      }\n    }\n  }, {\n    key: '_isBadDBCS',\n    value: function _isBadDBCS(u) {\n      return _symbol_table.symbolTable['x' + u.charCodeAt(0).toString(16)] == 3;\n    }\n  }, {\n    key: '_shouldForceWidth',\n    value: function _shouldForceWidth(u) {\n      var code = _symbol_table.symbolTable['x' + u.charCodeAt(0).toString(16)];\n      return code == 1 || code == 2;\n    }\n  }]);\n\n  return Row;\n}(React.Component);\n\nfunction renderRowHtml(chars, row, forceWidth, showsLinkPreviews, cont) {\n  return ReactDOM.render(React.createElement(Row, { chars: chars, row: row, forceWidth: forceWidth,\n    showsLinkPreviews: showsLinkPreviews }), cont);\n}\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HyperLinkPreview = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.renderImagePreview = renderImagePreview;\n\nvar _image_urls = __webpack_require__(13);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n// ImagePreview shows a spinner or a image that moves along with cursor.\n// It shows a spinner and hides image when the image is loading. Reverse\n// afterwards.\n//\n// @prop src the URL of image to diaplay; empty string hides components.\nvar ImagePreview = function (_React$Component) {\n  _inherits(ImagePreview, _React$Component);\n\n  function ImagePreview(props) {\n    _classCallCheck(this, ImagePreview);\n\n    var _this = _possibleConstructorReturn(this, (ImagePreview.__proto__ || Object.getPrototypeOf(ImagePreview)).call(this, props));\n\n    _this.state = {\n      left: 0,\n      top: 0,\n      spinning: !!_this.props.src\n    };\n    return _this;\n  }\n\n  _createClass(ImagePreview, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._mouseMoveListener = this._onMouseMove.bind(this);\n      document.addEventListener('mousemove', this._mouseMoveListener);\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (this._mouseMoveListener) {\n        document.removeEventListener('mousemove', this._mouseMoveListener);\n      }\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.props.src != nextProps.src) {\n        this.setState({ spinning: !!nextProps.src });\n      }\n    }\n  }, {\n    key: '_onMouseMove',\n    value: function _onMouseMove(e) {\n      this.setState({\n        left: e.clientX,\n        top: e.clientY\n      });\n    }\n  }, {\n    key: '_imageStyle',\n    value: function _imageStyle() {\n      if (!this._preview || this.props.src === '' || this.state.spinning) {\n        return { 'display': 'none' };\n      }\n\n      var mouseHeight = this.state.top;\n      var curX = this.state.left;\n      var pageHeight = $(window).height();\n      var imageHeight = this._preview.clientHeight;\n      var imgTop = 20;\n\n      // opening image would pass the bottom of the page\n      if (mouseHeight + imageHeight / 2 > pageHeight - 20) {\n        if (imageHeight / 2 < mouseHeight) {\n          imgTop = pageHeight - 20 - imageHeight;\n        }\n      } else if (mouseHeight - 20 > imageHeight / 2) {\n        imgTop = mouseHeight - imageHeight / 2;\n      }\n\n      return {\n        'display': this.state.spinning ? 'none' : 'block',\n        'position': 'absolute',\n        'left': curX + 20 + 'px',\n        'top': imgTop + 'px',\n        'maxHeight': '80%',\n        'maxWidth': '90%',\n        'zIndex': 2\n      };\n    }\n  }, {\n    key: '_spinnerStyle',\n    value: function _spinnerStyle() {\n      if (!this.state.spinning) {\n        return { 'display': 'none' };\n      }\n      return {\n        'position': 'absolute',\n        'left': this.state.left + 20 + 'px',\n        'top': this.state.top + 'px',\n        'zIndex': 2\n      };\n    }\n  }, {\n    key: '_stopSpinner',\n    value: function _stopSpinner() {\n      this.setState({ spinning: false });\n    }\n  }, {\n    key: '_onImageLoaded',\n    value: function _onImageLoaded() {\n      this._stopSpinner();\n      // Recalculate position.\n      this.forceUpdate();\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\n        'div',\n        null,\n        React.createElement('img', {\n          key: 'preview',\n          ref: function ref(img) {\n            _this2._preview = img;\n          },\n          src: this.props.src,\n          style: this._imageStyle(),\n          onLoad: this._onImageLoaded.bind(this) }),\n        React.createElement('i', {\n          key: 'spinner',\n          className: 'glyphicon glyphicon-refresh glyphicon-refresh-animate',\n          style: this._spinnerStyle() })\n      );\n    }\n  }]);\n\n  return ImagePreview;\n}(React.Component);\n\n// BaseAsyncImagePreview is a base class for general async image.\n// When the image URL is determined, the loadable image URL is available via\n// resolvedSrc in state.\n//\n// @prop src the URL for image; it accepts indirect links by using ImageURL\n// module.\n//\n// TODO: This should be a plain class rather than extending from\n// React.Component.\n\n\nvar BaseAsyncImagePreview = function (_React$Component2) {\n  _inherits(BaseAsyncImagePreview, _React$Component2);\n\n  function BaseAsyncImagePreview(props) {\n    _classCallCheck(this, BaseAsyncImagePreview);\n\n    var _this3 = _possibleConstructorReturn(this, (BaseAsyncImagePreview.__proto__ || Object.getPrototypeOf(BaseAsyncImagePreview)).call(this, props));\n\n    _this3.state = { resolvedSrc: '' };\n    return _this3;\n  }\n\n  _createClass(BaseAsyncImagePreview, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._startFetch(this.props.src);\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.props.src != nextProps.src) {\n        this._startFetch(nextProps.src);\n      }\n    }\n  }, {\n    key: '_startFetch',\n    value: function _startFetch(src) {\n      var _this4 = this;\n\n      // Remove previous image.\n      this.setState({ resolvedSrc: '' });\n      if (!src) {\n        return;\n      }\n      var p = _image_urls.ImageURL.create(src);\n      if (p) {\n        var cb = function cb(resolvedSrc) {\n          _this4._onResolve(resolvedSrc, src);\n        };\n        p.fetchSrc().then(cb);\n      }\n    }\n  }, {\n    key: '_onResolve',\n    value: function _onResolve(src, forSrc) {\n      if (forSrc != this.props.src) {\n        // Outdated result.\n        return;\n      }\n      this.setState({ resolvedSrc: src });\n    }\n  }]);\n\n  return BaseAsyncImagePreview;\n}(React.Component);\n\n// AsyncImagePreview resolves image location using ImageURL and displays as\n// ImagePreview.\n\n\nvar AsyncImagePreview = function (_BaseAsyncImagePrevie) {\n  _inherits(AsyncImagePreview, _BaseAsyncImagePrevie);\n\n  function AsyncImagePreview() {\n    _classCallCheck(this, AsyncImagePreview);\n\n    return _possibleConstructorReturn(this, (AsyncImagePreview.__proto__ || Object.getPrototypeOf(AsyncImagePreview)).apply(this, arguments));\n  }\n\n  _createClass(AsyncImagePreview, [{\n    key: 'render',\n    value: function render() {\n      return React.createElement(ImagePreview, { src: this.state.resolvedSrc });\n    }\n  }]);\n\n  return AsyncImagePreview;\n}(BaseAsyncImagePreview);\n\nfunction renderImagePreview(cont, src) {\n  return ReactDOM.render(React.createElement(AsyncImagePreview, { src: src }), cont);\n}\n\n// HyperLinkPreview resolves image location using ImageURL and displays with\n// a img element.\n\nvar HyperLinkPreview = exports.HyperLinkPreview = function (_BaseAsyncImagePrevie2) {\n  _inherits(HyperLinkPreview, _BaseAsyncImagePrevie2);\n\n  function HyperLinkPreview() {\n    _classCallCheck(this, HyperLinkPreview);\n\n    return _possibleConstructorReturn(this, (HyperLinkPreview.__proto__ || Object.getPrototypeOf(HyperLinkPreview)).apply(this, arguments));\n  }\n\n  _createClass(HyperLinkPreview, [{\n    key: 'render',\n    value: function render() {\n      if (this.state.resolvedSrc) {\n        return React.createElement('img', { className: 'easyReadingImg hyperLinkPreview', src: this.state.resolvedSrc });\n      } else {\n        return React.createElement('div', null);\n      }\n    }\n  }]);\n\n  return HyperLinkPreview;\n}(BaseAsyncImagePreview);\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n__webpack_require__(7);\n__webpack_require__(25);\nmodule.exports = __webpack_require__(26);\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _pttchrome = __webpack_require__(8);\n\nvar _i18n = __webpack_require__(0);\n\nvar _util = __webpack_require__(1);\n\nfunction startApp() {\n  var site = (0, _util.getQueryVariable)('site');\n  var from = (0, _util.getQueryVariable)('from');\n  var keepAlive = (0, _util.getQueryVariable)('keepAlive');\n  (0, _i18n.setupI18n)();\n\n  pttchrome.app = new _pttchrome.App(function (app) {\n    app.setInputAreaFocus();\n    $('#BBSWindow').show();\n    //$('#sideMenus').show();\n    app.onWindowResize();\n  }, { from: from, keepAlive: keepAlive });\n}\n\nfunction loadTable(url) {\n  return new Promise(function (resolve, reject) {\n    $.ajax({\n      url: url,\n      processData: false,\n      xhrFields: {\n        responseType: 'arraybuffer'\n      }\n    }).done(function (data) {\n      resolve(data);\n    }).fail(function (jqXHR, textStatus, errorThrown) {\n      console.log('loadTable failed: ' + textStatus + ': ' + url);\n      reject();\n    });\n  });\n}\n\nfunction loadResources() {\n  Promise.all([loadTable('conv/b2u_table.bin'), loadTable('conv/u2b_table.bin')]).then(function (binData) {\n    window.lib = window.lib || {};\n    window.lib.b2uArray = new Uint8Array(binData[0]);\n    window.lib.u2bArray = new Uint8Array(binData[1]);\n    $(document).ready(startApp);\n  }, function () {\n    console.log('loadResources failed');\n  });\n}\n\nloadResources();\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _ansi_parser = __webpack_require__(9);\n\nvar _term_view = __webpack_require__(10);\n\nvar _term_buf = __webpack_require__(3);\n\nvar _telnet = __webpack_require__(16);\n\nvar _websocket = __webpack_require__(17);\n\nvar _easy_reading = __webpack_require__(18);\n\nvar _input_helper = __webpack_require__(19);\n\nvar _pref = __webpack_require__(22);\n\nvar _touch_controller = __webpack_require__(24);\n\nvar _i18n = __webpack_require__(0);\n\nvar _util = __webpack_require__(1);\n\npttchrome = pttchrome || {}; // Main Program\n\npttchrome.App = function (onInitializedCallback, options) {\n\n  this.CmdHandler = document.getElementById('cmdHandler');\n  this.CmdHandler.setAttribute('useMouseBrowsing', '1');\n  this.CmdHandler.setAttribute('doDOMMouseScroll', '0');\n  //this.CmdHandler.setAttribute('useMouseUpDown', '0');\n  //this.CmdHandler.setAttribute('useMouseSwitchPage', '0');\n  //this.CmdHandler.setAttribute(\"useMouseReadThread\", '0');\n  this.CmdHandler.setAttribute('useTextDragAndDrop', '0');\n  this.CmdHandler.setAttribute('webContextMenu', '1');\n  this.CmdHandler.setAttribute('SavePageMenu', '1');\n  this.CmdHandler.setAttribute('EmbeddedPlayerMenu', '1');\n  this.CmdHandler.setAttribute('PreviewPictureMenu', '0');\n  this.CmdHandler.setAttribute('PushThreadMenu', '0');\n  this.CmdHandler.setAttribute('OpenAllLinkMenu', '0');\n  this.CmdHandler.setAttribute(\"MouseBrowseMenu\", '0');\n  this.CmdHandler.setAttribute('FileIoMenu', '0');\n  this.CmdHandler.setAttribute('ScreenKeyboardMenu', '1');\n  this.CmdHandler.setAttribute('ScreenKeyboardOpened', '0');\n  this.CmdHandler.setAttribute('DragingWindow', '0');\n  this.CmdHandler.setAttribute('MaxZIndex', 11);\n  this.CmdHandler.setAttribute('allowDrag', '0');\n  this.CmdHandler.setAttribute('haveLink', '0');\n  //this.CmdHandler.setAttribute('onLink','0');\n  //this.CmdHandler.setAttribute('onPicLink','0');\n  this.CmdHandler.setAttribute('draging', '0');\n  this.CmdHandler.setAttribute('textSelected', '0');\n  this.CmdHandler.setAttribute('dragType', '');\n  this.CmdHandler.setAttribute('LastPicAddr', '0');\n  this.CmdHandler.setAttribute('isMouseRightBtnDrag', '0');\n\n  this.CmdHandler.setAttribute('hideBookMarkLink', '1');\n  this.CmdHandler.setAttribute('hideSendLink', '1');\n  this.CmdHandler.setAttribute('hideBookMarkPage', '1');\n  this.CmdHandler.setAttribute('hideSendPage', '1');\n  this.CmdHandler.setAttribute('hideViewInfo', '1');\n  this.CmdHandler.setAttribute('SkipMouseClick', '0');\n  this.pref = null;\n\n  this.view = new _term_view.TermView(24);\n  this.buf = new _term_buf.TermBuf(80, 24);\n  this.buf.setView(this.view);\n  //this.buf.severNotifyStr=this.getLM('messageNotify');\n  //this.buf.PTTZSTR1=this.getLM('PTTZArea1');\n  //this.buf.PTTZSTR2=this.getLM('PTTZArea2');\n  this.view.setBuf(this.buf);\n  this.view.setCore(this);\n  this.parser = new _ansi_parser.AnsiParser(this.buf);\n  this.easyReading = new _easy_reading.EasyReading(this, this.view, this.buf);\n\n  //new pref - start\n  this.antiIdleStr = '\\x1b\\x1b';\n  this.antiIdleTime = 0;\n  this.idleTime = 0;\n  //new pref - end\n\n  // for picPreview\n  this.curX = 0;\n  this.curY = 0;\n\n  this.inputArea = document.getElementById('t');\n  this.BBSWin = document.getElementById('BBSWindow');\n\n  // horizontally center bbs window\n  this.BBSWin.setAttribute(\"align\", \"center\");\n  this.view.mainDisplay.style.transformOrigin = 'center';\n\n  this.mouseLeftButtonDown = false;\n  this.mouseRightButtonDown = false;\n\n  this.inputAreaFocusTimer = null;\n  this.alertBeforeUnload = false;\n  this.modalShown = false;\n\n  this.inputHelper = new _input_helper.InputHelper(this);\n\n  this.lastSelection = null;\n\n  this.waterball = { userId: '', message: '' };\n  this.appFocused = true;\n\n  this.endTurnsOnLiveUpdate = false;\n  this.copyOnSelect = false;\n  var version = window.navigator.userAgent.match(/Chrom(e|ium)\\/(\\d+)\\./);\n  if (version && version.length > 2) {\n    this.chromeVersion = parseInt(version[2], 10);\n  }\n\n  var self = this;\n  this.CmdHandler.addEventListener(\"OverlayCommand\", function (e) {\n    self.overlayCommandListener(e);\n  }, false);\n\n  window.addEventListener('click', function (e) {\n    self.mouse_click(e);\n  }, false);\n\n  window.addEventListener('mousedown', function (e) {\n    self.mouse_down(e);\n  }, false);\n\n  $(window).mousedown(function (e) {\n    var ret = self.middleMouse_down(e);\n    if (ret === false) {\n      return false;\n    }\n  });\n\n  window.addEventListener('mouseup', function (e) {\n    self.mouse_up(e);\n  }, false);\n\n  document.addEventListener('mousemove', function (e) {\n    self.mouse_move(e);\n  }, false);\n\n  document.addEventListener('mouseover', function (e) {\n    self.mouse_over(e);\n  }, false);\n\n  window.addEventListener('mousewheel', function (e) {\n    self.mouse_scroll(e);\n  }, true);\n\n  window.addEventListener('contextmenu', function (e) {\n    self.context_menu(e);\n  }, false);\n\n  window.addEventListener('focus', function (e) {\n    self.appFocused = true;\n    if (self.view.titleTimer) {\n      self.view.titleTimer.cancel();\n      self.view.titleTimer = null;\n      document.title = self.connectedUrl.site;\n      self.view.notif.close();\n    }\n  }, false);\n\n  window.addEventListener('blur', function (e) {\n    self.appFocused = false;\n  }, false);\n\n  this.strToCopy = null;\n  document.addEventListener('copy', function (e) {\n    self.onDOMCopy(e);\n  });\n  this.inputArea.addEventListener('paste', function (e) {\n    self.onDOMPaste(e);\n  });\n\n  this.view.innerBounds = this.getWindowInnerBounds();\n  this.view.firstGridOffset = this.getFirstGridOffsets();\n  window.onresize = function () {\n    self.onWindowResize();\n  };\n\n  this.isFromApp = options.from === 'app';\n\n  this.dblclickTimer = null;\n  this.mbTimer = null;\n  this.timerEverySec = null;\n  this.pushthreadAutoUpdateCount = 0;\n  this.maxPushthreadAutoUpdateCount = -1;\n  this.onWindowResize();\n  this.setupDeveloperModeAlert();\n  this.setupConnectionAlert();\n  this.setupPasteShortcutAlert();\n  this.setupLiveHelper();\n  this.setupOtherSiteInput();\n  this.setupContextMenus();\n  this.contextMenuShown = false;\n\n  this.pref = new _pref.PttChromePref(this, onInitializedCallback);\n\n  new Promise(function (resolve, reject) {\n    if (pttchrome.Constants.DEVELOPER_MODE) {\n      $('#developerModeAlertDismiss').click(function (e) {\n        $('#developerModeAlert').hide();\n        resolve();\n      });\n      $('#developerModeAlert').show();\n    } else {\n      resolve();\n    }\n  }).then(function () {\n    // connect.\n    self.connect((0, _util.getQueryVariable)('site') || pttchrome.Constants.DEFAULT_SITE);\n\n    // TODO: Call onSymFont for font data when it's implemented.\n\n    console.log(\"load pref from storage\");\n    // call getStorage to trigger load setting\n    self.pref.getStorage();\n  });\n\n  // init touch only if chrome is higher than version 36\n  if (this.chromeVersion && this.chromeVersion >= 37) {\n    this.touch = new _touch_controller.TouchController(this);\n  }\n};\n\npttchrome.App.prototype.isConnected = function () {\n  return this.connectState == 1 && !!this.conn;\n};\n\npttchrome.App.prototype.connect = function (url) {\n  this.connectState = 0;\n  console.log('connect: ' + url);\n\n  var parsed = this._parseURLSimple(url);\n  if (parsed.protocol == 'wsstelnet') {\n    this._setupWebsocketConn('wss://' + parsed.hostname + parsed.path);\n  } else if (parsed.protocol == 'wstelnet') {\n    this._setupWebsocketConn('ws://' + parsed.hostname + parsed.path);\n  } else {\n    console.log('unsupport connect url protocol: ' + parser.protocol);\n    return;\n  }\n\n  this.connectedUrl = {\n    url: url,\n    site: parsed.hostname,\n    port: parsed.port,\n    easyReadingSupported: true\n  };\n};\n\npttchrome.App.prototype._parseURLSimple = function (url) {\n  var protocol = url.split(/:\\/\\//, 2);\n  if (protocol.length != 2) return null;\n  var hostname = protocol[1].split(/\\//, 2);\n  var hostport = hostname[0].split(/:/);\n  if (hostport > 2) return null;\n  var port = hostport.length > 1 ? parseInt(hostport[1]) : {\n    'wstelnet': 80,\n    'wsstelnet': 443,\n    'telnet': 23,\n    'ssh': 22\n  }[protocol[0]];\n  return {\n    protocol: protocol[0],\n    hostname: hostname[0],\n    host: hostport[0],\n    port: port,\n    path: '/' + (hostname.length > 1 ? hostname[1] : '')\n  };\n};\n\npttchrome.App.prototype._setupWebsocketConn = function (url) {\n  var wsConn = new _websocket.Websocket(url);\n  this._attachConn(new _telnet.TelnetConnection(wsConn));\n};\n\npttchrome.App.prototype._attachConn = function (conn) {\n  var self = this;\n  this.conn = conn;\n  this.conn.addEventListener('open', this.onConnect.bind(this));\n  this.conn.addEventListener('close', this.onClose.bind(this));\n  this.conn.addEventListener('data', function (e) {\n    self.onData(e.detail.data);\n  });\n};\n\npttchrome.App.prototype.onConnect = function () {\n  this.conn.isConnected = true;\n  this.view.setConn(this.conn);\n  $('#connectionAlert').hide();\n  (0, _util.dumpLog)(DUMP_TYPE_LOG, \"pttchrome onConnect\");\n  this.connectState = 1;\n  this.updateTabIcon('connect');\n  this.idleTime = 0;\n  var self = this;\n  this.timerEverySec = (0, _util.setTimer)(true, function () {\n    self.antiIdle();\n    self.view.onBlink();\n    self.incrementCountToUpdatePushthread();\n  }, 1000);\n  this.view.resetCursorBlink();\n  if (this.alertBeforeUnload) this.regExitAlert();\n};\n\npttchrome.App.prototype.onData = function (data) {\n  //dumpLog(DUMP_TYPE_LOG, \"pttchrome onData\");\n  this.parser.feed(data);\n\n  if (!this.appFocused && this.view.enableNotifications) {\n    // parse received data for waterball\n    var wb = data.b2u().parseWaterball();\n    if (wb) {\n      if ('userId' in wb) {\n        this.waterball.userId = wb.userId;\n      }\n      if ('message' in wb) {\n        this.waterball.message = wb.message;\n      }\n      this.view.showWaterballNotification();\n    }\n  }\n};\n\npttchrome.App.prototype.onClose = function () {\n  (0, _util.dumpLog)(DUMP_TYPE_LOG, \"pttchrome onClose\");\n  if (this.timerEverySec) {\n    this.timerEverySec.cancel();\n  }\n  if (this.view.cursorBlinkTimer) {\n    this.view.cursorBlinkTimer.cancel();\n  }\n  this.conn.isConnected = false;\n\n  this.cancelMbTimer();\n  this.unregExitAlert();\n\n  this.connectState = 2;\n  this.idleTime = 0;\n\n  $('#connectionAlert').show();\n  this.updateTabIcon('disconnect');\n};\n\npttchrome.App.prototype.sendData = function (str) {\n  if (this.connectState == 1) this.conn.convSend(str);\n};\n\npttchrome.App.prototype.sendCmdData = function (str) {\n  if (this.connectState == 1) this.conn.send(str);\n};\n\npttchrome.App.prototype.cancelMbTimer = function () {\n  if (this.mbTimer) {\n    this.mbTimer.cancel();\n    this.mbTimer = null;\n  }\n};\n\npttchrome.App.prototype.setMbTimer = function () {\n  this.cancelMbTimer();\n  var _this = this;\n  this.mbTimer = (0, _util.setTimer)(false, function () {\n    _this.mbTimer.cancel();\n    _this.mbTimer = null;\n    _this.CmdHandler.setAttribute('SkipMouseClick', '0');\n  }, 100);\n};\n\npttchrome.App.prototype.cancelDblclickTimer = function () {\n  if (this.dblclickTimer) {\n    this.dblclickTimer.cancel();\n    this.dblclickTimer = null;\n  }\n};\n\npttchrome.App.prototype.setDblclickTimer = function () {\n  this.cancelDblclickTimer();\n  var _this = this;\n  this.dblclickTimer = (0, _util.setTimer)(false, function () {\n    _this.dblclickTimer.cancel();\n    _this.dblclickTimer = null;\n  }, 350);\n};\n\npttchrome.App.prototype.setInputAreaFocus = function () {\n  if (this.modalShown || this.touch && this.touch.touchStarted) return;\n  //this.DocInputArea.disabled=\"\";\n  this.inputArea.focus();\n};\n\npttchrome.App.prototype.setupLiveHelper = function () {\n  $('#liveHelperEnable').text((0, _i18n.i18n)('liveHelperEnable'));\n  $('#liveHelperSpan').text((0, _i18n.i18n)('liveHelperSpan'));\n  $('#liveHelperSpanSec').text((0, _i18n.i18n)('liveHelperSpanSec'));\n\n  var self = this;\n  $('#liveHelperEnable').click(function (e) {\n    self.onLiveHelperEnableClicked(true);\n  });\n  $('#liveHelperEnable').tooltip({ title: 'Alt + r' });\n\n  $('#liveHelperSec').change(function (e) {\n    var sec = $(this).val();\n    if (sec < 1) {\n      sec = 1;\n      $(this).val(sec);\n    }\n    var enableThis = $('#liveHelperEnable').hasClass('active');\n    if (enableThis) {\n      self.setAutoPushthreadUpdate(sec);\n    }\n  });\n\n  $('#liveHelperClose').click(function (e) {\n    $('#liveHelper').hide();\n  });\n};\n\npttchrome.App.prototype.onLiveHelperEnableClicked = function (fromUi) {\n  var enableThis = !$('#liveHelperEnable').hasClass('active');\n  if (enableThis) {\n    // cancel easy reading mode first\n    this.view.useEasyReadingMode = false;\n    this.switchToEasyReadingMode();\n    var sec = $('#liveHelperSec').val();\n    this.setAutoPushthreadUpdate(sec);\n    if (!fromUi) {\n      $('#liveHelperEnable').addClass('active');\n    }\n  } else {\n    this.disableLiveHelper(fromUi);\n  }\n};\n\npttchrome.App.prototype.disableLiveHelper = function (fromUi) {\n  this.setAutoPushthreadUpdate(-1);\n  if (!fromUi) {\n    $('#liveHelperEnable').removeClass('active');\n  }\n};\n\npttchrome.App.prototype.switchToEasyReadingMode = function (doSwitch) {\n  this.easyReading.leaveCurrentPost();\n  if (doSwitch) {\n    this.disableLiveHelper();\n    // clear the deep cloned copy of lines\n    this.buf.pageLines = [];\n    if (this.buf.pageState == 3) this.view.conn.send('\\x1b[D\\x1b[C'); //this.view.conn.send('qr');\n  } else {\n    this.view.mainContainer.style.paddingBottom = '';\n    this.view.lastRowIndex = 22;\n    this.view.lastRowDiv.style.display = '';\n    this.view.replyRowDiv.style.display = '';\n    // clear the deep cloned copy of lines\n    this.buf.pageLines = [];\n  }\n  // request the full screen\n  this.view.conn.send('^L'.unescapeStr());\n};\n\npttchrome.App.prototype.setupDeveloperModeAlert = function () {\n  $('#developerModeAlertReconnect').empty();\n  $('#developerModeAlertHeader').text((0, _i18n.i18n)('alert_developerModeHeader'));\n  $('#developerModeAlertText').text((0, _i18n.i18n)('alert_developerModeText'));\n  $('#developerModeAlertDismiss').text((0, _i18n.i18n)('alert_developerModeDismiss'));\n};\n\npttchrome.App.prototype.setupConnectionAlert = function () {\n  $('#connectionAlertReconnect').empty();\n  $('#connectionAlertHeader').text((0, _i18n.i18n)('alert_connectionHeader'));\n  $('#connectionAlertText').text((0, _i18n.i18n)('alert_connectionText'));\n  $('#connectionAlertReconnect').text((0, _i18n.i18n)('alert_connectionReconnect'));\n  $('#connectionAlertPortOption1').text((0, _i18n.i18n)('alert_connectionPortOption1'));\n  $('#connectionAlertPortOption2').text((0, _i18n.i18n)('alert_connectionPortOption2'));\n\n  var self = this;\n  $('#connectionAlertReconnect').click(function (e) {\n    self.connect(self.connectedUrl.url);\n    $('#connectionAlert').hide();\n  });\n  $('#connectionAlertPortOption2').click(function (e) {\n    var port = 443;\n    var site = 'ptt.cc';\n    if (self.connectedUrl.site) {\n      site = self.connectedUrl.site;\n    }\n\n    if (self.isFromApp) {\n      /*\n       * fixing a problem url won't open tab in packaged app mode:\n       * - this used to happen only when user click on \"try 443 port\" after a\n       * disconnection.\n       * - it seems to related with the window.location.replace method\n       */\n\n      self.connect(site + ':' + port);\n    } else {\n      window.location.replace('?site=' + site + ':' + port);\n    }\n  });\n};\n\npttchrome.App.prototype.setupPasteShortcutAlert = function () {\n  $('#pasteShortcutHeader').text((0, _i18n.i18n)('alert_pasteShortcutHeader'));\n  $('#pasteShortcutText').text((0, _i18n.i18n)('alert_pasteShortcutText'));\n  $('#pasteShortcutClose').text((0, _i18n.i18n)('alert_pasteShortcutClose'));\n  $('#pasteShortcutClose').click(function (e) {\n    $('#pasteShortcutAlert').modal('hide');\n    self.modalShown = false;\n  });\n};\n\npttchrome.App.prototype.setupOtherSiteInput = function () {\n  var self = this;\n  $('#siteModal input').attr('placeholder', (0, _i18n.i18n)('input_sitePlaceholder'));\n  $('#siteModal input').keyup(function (e) {\n    if (e.keyCode == 13) {\n      var url = $(this).val();\n      self.connect(url);\n      $('#siteModal').modal('hide');\n    }\n  });\n  $('#siteModal').on('shown.bs.modal', function (e) {\n    $('#connectionAlert').hide();\n    self.modalShown = true;\n    $('#siteModal input').val('');\n    $('#siteModal input').focus();\n  });\n  $('#siteModal').on('hidden.bs.modal', function (e) {\n    $('#connectionAlert').hide();\n    self.modalShown = false;\n  });\n};\n\npttchrome.App.prototype.doCopy = function (str) {\n  if (str.indexOf('\\x1b') < 0) {\n    str = str.replace(/\\r\\n/g, '\\r');\n    str = str.replace(/\\n/g, '\\r');\n    str = str.replace(/ +\\r/g, '\\r');\n  }\n  this.strToCopy = str;\n  document.execCommand('copy');\n};\n\npttchrome.App.prototype.doCopyAnsi = function () {\n  if (!this.lastSelection) return;\n\n  var selection = this.lastSelection;\n  var pageLines = null;\n  if (this.view.useEasyReadingMode && this.buf.pageState == 3) {\n    pageLines = this.buf.pageLines;\n  }\n\n  var ansiText = '';\n  if (selection.start.row == selection.end.row) {\n    ansiText += this.buf.getText(selection.start.row, selection.start.col, selection.end.col, true, true, false, pageLines);\n  } else {\n    for (var i = selection.start.row; i <= selection.end.row; ++i) {\n      var scol = 0;\n      var ecol = this.buf.cols - 1;\n      if (i == selection.start.row) {\n        scol = selection.start.col;\n      } else if (i == selection.end.row) {\n        ecol = selection.end.col;\n      }\n      ansiText += this.buf.getText(i, scol, ecol, true, true, false, pageLines);\n      if (i != selection.end.row) {\n        ansiText += '\\r';\n      }\n    }\n  }\n\n  this.doCopy(ansiText);\n};\n\npttchrome.App.prototype.onDOMCopy = function (e) {\n  if (this.strToCopy) {\n    e.clipboardData.setData('text', this.strToCopy);\n    e.preventDefault();\n    console.log('copied: ', this.strToCopy);\n    this.strToCopy = null;\n  }\n};\n\npttchrome.App.prototype.doPaste = function () {\n  console.log(\"doPaste not implemented\");\n  $('#pasteShortcutAlert').modal('show');\n  self.modalShown = true;\n};\n\npttchrome.App.prototype.onPasteDone = function (content) {\n  //this.conn.convSend(content);\n  this.view.onTextInput(content, true);\n};\n\npttchrome.App.prototype.onDOMPaste = function (e) {\n  var str = e.clipboardData.getData('text');\n  if (str) {\n    e.preventDefault();\n    this.onPasteDone(str);\n  }\n};\n\npttchrome.App.prototype.onSymFont = function (content) {\n  console.log(\"using \" + (content ? \"extension\" : \"system\") + \" font\");\n  var font_src = content ? 'src: url(' + content.data + ');' : '';\n  var css = '@font-face { font-family: MingLiUNoGlyph; ' + font_src + ' }';\n  var style = document.createElement('style');\n  style.type = 'text/css';\n  style.innerHTML = css;\n  document.getElementsByTagName('head')[0].appendChild(style);\n};\n\npttchrome.App.prototype.doSelectAll = function () {\n  window.getSelection().selectAllChildren(this.view.mainDisplay);\n};\n\npttchrome.App.prototype.doSearchGoogle = function (searchTerm) {\n  window.open('http://google.com/search?q=' + searchTerm);\n};\n\npttchrome.App.prototype.doOpenUrlNewTab = function (a) {\n  var e = document.createEvent('MouseEvents');\n  e.initMouseEvent(\"click\", true, true, window, 0, 0, 0, 0, 0, true, false, false, false, 0, null);\n  a.dispatchEvent(e);\n};\n\npttchrome.App.prototype.doGoToOtherSite = function () {\n  $('#siteModal').modal('show');\n};\n\npttchrome.App.prototype.incrementCountToUpdatePushthread = function (interval) {\n  if (this.maxPushthreadAutoUpdateCount == -1) {\n    this.pushthreadAutoUpdateCount = 0;\n    return;\n  }\n\n  if (++this.pushthreadAutoUpdateCount >= this.maxPushthreadAutoUpdateCount) {\n    this.pushthreadAutoUpdateCount = 0;\n    if (this.buf.pageState == 3 || this.buf.pageState == 2) {\n      //this.view.conn.send('qrG');\n      this.view.conn.send('\\x1b[D\\x1b[C\\x1b[4~');\n    }\n  }\n};\npttchrome.App.prototype.setAutoPushthreadUpdate = function (seconds) {\n  this.maxPushthreadAutoUpdateCount = seconds;\n};\n\npttchrome.App.prototype.doAddBlacklistUserId = function (userid) {\n  this.pref.blacklistedUserIds[userid] = true;\n  this.pref.setBlacklistValue();\n  this.pref.setBlacklistStorage();\n  // XXX This should be changed to use a stylesheet to manage.\n  $('.blu_' + userid).css('opacity', '0.2');\n};\n\npttchrome.App.prototype.doRemoveBlacklistUserId = function (userid) {\n  delete this.pref.blacklistedUserIds[userid];\n  this.pref.setBlacklistValue();\n  this.pref.setBlacklistStorage();\n  // XXX This should be changed to use a stylesheet to manage.\n  $('.blu_' + userid).css('opacity', '');\n};\n\npttchrome.App.prototype.doSettings = function () {\n  $('#prefModal').modal('show');\n};\n\npttchrome.App.prototype.onWindowResize = function () {\n  this.view.innerBounds = this.getWindowInnerBounds();\n  this.view.fontResize();\n\n  if (this.modalShown) {\n    var width = document.documentElement.clientWidth * 0.7;\n    width = width > 730 ? width : 730;\n    width -= 190;\n    var height = document.documentElement.clientHeight * 0.9;\n    height = height > 400 ? height : 400;\n    height -= 76;\n    $('#prefModal .modal-body').css('height', height + 'px');\n    $('#prefModal .modal-body').css('width', width + 'px');\n    $('#opt_blacklistedUsers').css('height', height - 150 + 'px');\n  }\n};\n\npttchrome.App.prototype.switchMouseBrowsing = function () {\n  if (this.CmdHandler.getAttribute('useMouseBrowsing') == '1') {\n    this.CmdHandler.setAttribute('useMouseBrowsing', '0');\n    this.buf.useMouseBrowsing = false;\n  } else {\n    this.CmdHandler.setAttribute('useMouseBrowsing', '1');\n    this.buf.useMouseBrowsing = true;\n  }\n\n  if (!this.buf.useMouseBrowsing) {\n    this.buf.BBSWin.style.cursor = 'auto';\n    this.buf.clearHighlight();\n    this.buf.mouseCursor = 0;\n    this.buf.nowHighlight = -1;\n    this.buf.tempMouseCol = 0;\n    this.buf.tempMouseRow = 0;\n  } else {\n    this.buf.resetMousePos();\n    this.view.redraw(true);\n    this.view.updateCursorPos();\n  }\n};\n\npttchrome.App.prototype.antiIdle = function () {\n  if (this.antiIdleTime && this.idleTime > this.antiIdleTime) {\n    if (this.antiIdleStr !== '' && this.connectState == 1) this.conn.send(this.antiIdleStr);\n  } else {\n    if (this.connectState == 1) this.idleTime += 1000;\n  }\n};\n\npttchrome.App.prototype.updateTabIcon = function (aStatus) {\n  var icon = 'icon/logo.png';\n  switch (aStatus) {\n    case 'connect':\n      icon = 'icon/logo_connect.png';\n      this.setInputAreaFocus();\n      break;\n    case 'disconnect':\n      icon = 'icon/logo_disconnect.png';\n      break;\n    default:\n      break;\n  }\n\n  var link = document.querySelector(\"link[rel~='icon']\");\n  if (!link) {\n    link = document.createElement(\"link\");\n    link.setAttribute(\"rel\", \"icon\");\n    link.setAttribute(\"href\", icon);\n    document.head.appendChild(link);\n  } else {\n    link.setAttribute(\"href\", icon);\n  }\n};\n\n// use this method to get better window size in case of page zoom != 100%\npttchrome.App.prototype.getWindowInnerBounds = function () {\n  var width = document.documentElement.clientWidth - this.view.bbsViewMargin * 2;\n  var height = document.documentElement.clientHeight - this.view.bbsViewMargin * 2;\n  var bounds = {\n    width: width,\n    height: height\n  };\n  return bounds;\n};\n\npttchrome.App.prototype.getFirstGridOffsets = function () {\n  var container = $(\"#mainContainer\")[0];\n  return {\n    top: container.offsetTop,\n    left: container.offsetLeft\n  };\n};\n\npttchrome.App.prototype.clientToPos = function (cX, cY) {\n  var x;\n  var y;\n  var w = this.view.innerBounds.width;\n  var h = this.view.innerBounds.height;\n  if (this.view.horizontalAlignCenter && (this.view.scaleX != 1 || this.view.scaleY != 1)) {\n    x = cX - (w - this.view.chw * this.buf.cols * this.view.scaleX) / 2;\n    y = cY - (h - this.view.chh * this.buf.rows * this.view.scaleY) / 2;\n  } else {\n    x = cX - parseFloat(this.view.firstGridOffset.left);\n    y = cY - parseFloat(this.view.firstGridOffset.top);\n  }\n  var col = Math.floor(x / (this.view.chw * this.view.scaleX));\n  var row = Math.floor(y / (this.view.chh * this.view.scaleY));\n\n  if (row < 0) row = 0;else if (row >= this.buf.rows - 1) row = this.buf.rows - 1;\n\n  if (col < 0) col = 0;else if (col >= this.buf.cols - 1) col = this.buf.cols - 1;\n\n  return { col: col, row: row };\n};\n\npttchrome.App.prototype.onMouse_click = function (e) {\n  var cX = e.clientX,\n      cY = e.clientY;\n  if (!this.conn || !this.conn.isConnected) return;\n  if (this.inputHelper.clickedOn) {\n    this.inputHelper.clickedOn = false;\n    return;\n  }\n\n  // disable auto update pushthread if any command is issued;\n  this.disableLiveHelper();\n\n  // TODO make a responder stack.\n  this.easyReading._onMouseClick(e);\n  if (e.defaultPrevented) return;\n\n  // TODO Move this to mouse browsing module.\n  switch (this.buf.mouseCursor) {\n    case 1:\n      this.conn.send('\\x1b[D'); //Arrow Left\n      break;\n    case 2:\n      this.conn.send('\\x1b[5~'); //Page Up\n      break;\n    case 3:\n      this.conn.send('\\x1b[6~'); //Page Down\n      break;\n    case 4:\n      this.conn.send('\\x1b[1~'); //Home\n      break;\n    case 5:\n      this.conn.send('\\x1b[4~'); //End\n      break;\n    case 6:\n      if (this.buf.nowHighlight != -1) {\n        var sendstr = '';\n        if (this.buf.cur_y > this.buf.nowHighlight) {\n          var count = this.buf.cur_y - this.buf.nowHighlight;\n          for (var i = 0; i < count; ++i) {\n            sendstr += '\\x1b[A';\n          } //Arrow Up\n        } else if (this.buf.cur_y < this.buf.nowHighlight) {\n          var count = this.buf.nowHighlight - this.buf.cur_y;\n          for (var i = 0; i < count; ++i) {\n            sendstr += '\\x1b[B';\n          } //Arrow Down\n        }\n        sendstr += '\\r';\n        this.conn.send(sendstr);\n      }\n      break;\n    case 7:\n      var pos = this.clientToPos(cX, cY);\n      var sendstr = '';\n      if (this.buf.cur_y > pos.row) {\n        var count = this.buf.cur_y - pos.row;\n        for (var i = 0; i < count; ++i) {\n          sendstr += '\\x1b[A';\n        } //Arrow Up\n      } else if (this.buf.cur_y < pos.row) {\n        var count = pos.row - this.buf.cur_y;\n        for (var i = 0; i < count; ++i) {\n          sendstr += '\\x1b[B';\n        } //Arrow Down\n      }\n      sendstr += '\\r';\n      this.conn.send(sendstr);\n      break;\n    case 0:\n      this.conn.send('\\x1b[D'); //Arrow Left\n      break;\n    case 8:\n      this.conn.send('['); //Previous post with the same title\n      break;\n    case 9:\n      this.conn.send(']'); //Next post with the same title\n      break;\n    case 10:\n      this.conn.send('='); //First post with the same title\n      break;\n    case 12:\n      this.conn.send('\\x1b[D\\r\\x1b[4~'); //Refresh post / pushed texts\n      break;\n    case 13:\n      this.conn.send('\\x1b[D\\r\\x1b[4~[]'); //Last post with the same title (LIST)\n      break;\n    case 14:\n      this.conn.send('\\x1b[D\\x1b[4~[]\\r'); //Last post with the same title (READING)\n      break;\n    default:\n      //do nothing\n      break;\n  }\n};\n\npttchrome.App.prototype.overlayCommandListener = function (e) {\n  var elm = e.target;\n  var cmd = elm.getAttribute(\"pttChromeCommand\");\n  //dumpLog(DUMP_TYPE_LOG, cmd);\n  if (elm) {\n    if (elm.id == 'cmdHandler') {\n      switch (cmd) {\n        case \"doArrowUp\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop === 0) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\x1b[D\\x1b[A\\x1b[C');\n            } else {\n              this.view.mainDisplay.scrollTop -= this.view.chh;\n            }\n          } else {\n            this.conn.send('\\x1b[A');\n          }\n          break;\n        case \"doArrowDown\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop >= this.view.mainContainer.clientHeight - this.view.chh * this.buf.rows) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\x1b[B');\n            } else {\n              this.view.mainDisplay.scrollTop += this.view.chh;\n            }\n          } else {\n            this.conn.send('\\x1b[B');\n          }\n          break;\n        case \"doPageUp\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.view.mainDisplay.scrollTop -= this.view.chh * this.easyReading._turnPageLines;\n          } else {\n            this.conn.send('\\x1b[5~');\n          }\n          break;\n        case \"doPageDown\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.view.mainDisplay.scrollTop += this.view.chh * this.easyReading._turnPageLines;\n          } else {\n            this.conn.send('\\x1b[6~');\n          }\n          break;\n        case \"previousThread\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.easyReading.leaveCurrentPost();\n            this.conn.send('[');\n          } else if (this.buf.pageState == 2 || this.buf.pageState == 3 || this.buf.pageState == 4) {\n            this.conn.send('[');\n          }\n          break;\n        case \"nextThread\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.easyReading.leaveCurrentPost();\n            this.conn.send(']');\n          } else if (this.buf.pageState == 2 || this.buf.pageState == 3 || this.buf.pageState == 4) {\n            this.conn.send(']');\n          }\n          break;\n        case \"doEnter\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop >= this.view.mainContainer.clientHeight - this.view.chh * this.buf.rows) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\r');\n            } else {\n              this.view.mainDisplay.scrollTop += this.view.chh;\n            }\n          } else {\n            this.conn.send('\\r');\n          }\n          break;\n        case \"doRight\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop >= this.view.mainContainer.clientHeight - this.view.chh * this.buf.rows) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\x1b[C');\n            } else {\n              this.view.mainDisplay.scrollTop += this.view.chh * this.easyReading._turnPageLines;\n            }\n          } else {\n            this.conn.send('\\x1b[C');\n          }\n          break;\n        case \"reloadTabIconDelay\":\n          this.doReloadTabIcon(100);\n          break;\n        case \"reloadTabIcon\":\n          //alert('reloadTabIcon');\n          this.reloadTabIcon();\n          break;\n        case \"doAddTrack\":\n          this.doAddTrack();\n          break;\n        case \"doDelTrack\":\n          this.doDelTrack();\n          break;\n        case \"doClearTrack\":\n          this.doClearTrack();\n          break;\n        case \"openSymbolInput\":\n          if (this.symbolinput) {\n            this.symbolinput.setCore(this);\n            this.symbolinput.displayWindow();\n          }\n          break;\n        case \"doSavePage\":\n          this.doSavePage();\n          break;\n        case \"doCopyHtml\":\n          this.doCopyHtml();\n          break;\n        case \"doSelectAll\":\n          this.doSelectAll();\n          break;\n        case \"doCopy\":\n          this.doCopySelect();\n          break;\n        case \"doPaste\":\n          this.doPaste();\n          break;\n        case \"doOpenAllLink\":\n          this.doOpenAllLink();\n          break;\n        //case \"doLoadUserSetting\":\n        //  this.doLoadUserSetting();\n        //  break;\n        case \"switchMouseBrowsing\":\n          this.switchMouseBrowsing();\n          break;\n        case \"openYoutubeWindow\":\n          var param = elm.getAttribute(\"YoutubeURL\");\n          elm.removeAttribute(\"YoutubeURL\");\n          if (this.playerMgr) this.playerMgr.openYoutubeWindow(param);\n          break;\n        case \"openUstreamWindow\":\n          var param = elm.getAttribute(\"UstreamURL\");\n          elm.removeAttribute(\"UstreamURL\");\n          if (this.playerMgr) this.playerMgr.openUstreamWindow(param);\n          break;\n        case \"openUrecordWindow\":\n          var param = elm.getAttribute(\"UrecordURL\");\n          elm.removeAttribute(\"UrecordURL\");\n          if (this.playerMgr) this.playerMgr.openUrecordWindow(param);\n          break;\n        case \"previewPicture\":\n          var param = elm.getAttribute(\"PictureURL\");\n          elm.removeAttribute(\"PictureURL\");\n          if (this.picViewerMgr) this.picViewerMgr.openPicture(param);\n          break;\n        case \"checkPrefExist\":\n          this.doSiteSettingCheck(250);\n          break;\n        case \"pushThread\":\n          this.doPushThread();\n          break;\n        case \"setAlert\":\n          var param = elm.getAttribute(\"AlertMessage\");\n          elm.removeAttribute(\"AlertMessage\");\n          //this.view.showAlertMessage(document.title, param);\n          //alert(param);\n          break;\n        default:\n          break;\n      }\n    }\n    elm.removeAttribute(\"pttChromeCommand\");\n  }\n};\n\npttchrome.App.prototype.onMouse_move = function (cX, cY) {\n  var pos = this.clientToPos(cX, cY);\n  this.buf.onMouse_move(pos.col, pos.row, false);\n};\n\npttchrome.App.prototype.resetMouseCursor = function (cX, cY) {\n  this.buf.BBSWin.style.cursor = 'auto';\n  this.buf.mouseCursor = 11;\n};\n\npttchrome.App.prototype.onPrefChange = function (pref, name) {\n  try {\n    //var CiStr = Components.interfaces.nsISupportsString;\n    //dumpLog(DUMP_TYPE_LOG, \"onPrefChange \" + name + \":\" + pref.get(name));\n    switch (name) {\n      case 'useMouseBrowsing':\n        var useMouseBrowsing = pref.get(name);\n        this.CmdHandler.setAttribute('useMouseBrowsing', useMouseBrowsing ? '1' : '0');\n        this.buf.useMouseBrowsing = useMouseBrowsing;\n\n        if (!this.buf.useMouseBrowsing) {\n          this.buf.BBSWin.style.cursor = 'auto';\n          this.buf.clearHighlight();\n          this.buf.mouseCursor = 0;\n          this.buf.nowHighlight = -1;\n          this.buf.tempMouseCol = 0;\n          this.buf.tempMouseRow = 0;\n        }\n        this.buf.resetMousePos();\n        this.view.redraw(true);\n        this.view.updateCursorPos();\n        break;\n      case 'mouseBrowsingHighlight':\n        this.buf.highlightCursor = pref.get(name);\n        this.view.redraw(true);\n        this.view.updateCursorPos();\n        break;\n      case 'mouseBrowsingHighlightColor':\n        this.view.highlightBG = pref.get(name);\n        this.view.redraw(true);\n        this.view.updateCursorPos();\n        break;\n      case 'mouseLeftFunction':\n        this.view.leftButtonFunction = pref.get(name);\n        if (typeof this.view.leftButtonFunction == 'boolean') {\n          this.view.leftButtonFunction = this.view.leftButtonFunction ? 1 : 0;\n        }\n        break;\n      case 'mouseMiddleFunction':\n        this.view.middleButtonFunction = pref.get(name);\n        break;\n      case 'mouseWheelFunction1':\n        this.view.mouseWheelFunction1 = pref.get(name);\n        break;\n      case 'mouseWheelFunction2':\n        this.view.mouseWheelFunction2 = pref.get(name);\n        break;\n      case 'mouseWheelFunction3':\n        this.view.mouseWheelFunction3 = pref.get(name);\n        break;\n      case 'copyOnSelect':\n        this.copyOnSelect = pref.get(name);\n        break;\n      case 'closeQuery':\n        this.alertBeforeUnload = pref.get(name);\n        break;\n      case 'endTurnsOnLiveUpdate':\n        this.endTurnsOnLiveUpdate = pref.get(name);\n        break;\n      case 'enablePicPreview':\n        // TODO: move this to ImagePreview.\n        this.view.enablePicPreview = pref.get(name);\n        break;\n      case 'enableNotifications':\n        this.view.enableNotifications = pref.get(name);\n        break;\n      case 'enableEasyReading':\n        /*if (this.connectedUrl.site == 'ptt.cc') {\n          this.view.useEasyReadingMode = this.pref.get('enableEasyReading');\n        } else {\n          this.view.useEasyReadingMode = false;\n        }*/\n        break;\n      case 'antiIdleTime':\n        this.antiIdleTime = pref.get(name) * 1000;\n        break;\n      case 'dbcsDetect':\n        this.view.dbcsDetect = pref.get(name);\n        break;\n      case 'lineWrap':\n        this.conn.lineWrap = pref.get(name);\n        break;\n      case 'fontFitWindowWidth':\n        this.view.fontFitWindowWidth = pref.get(name);\n        if (this.view.fontFitWindowWidth) {\n          $('.main').addClass('trans-fix');\n        } else {\n          $('.main').removeClass('trans-fix');\n        }\n        this.onWindowResize();\n        break;\n      case 'fontFace':\n        var fontFace = pref.get(name);\n        if (!fontFace) fontFace = 'monospace';\n        this.view.setFontFace(fontFace);\n        break;\n      case 'bbsMargin':\n        var margin = pref.get(name);\n        this.view.bbsViewMargin = margin;\n        this.onWindowResize();\n        break;\n      case 'enableBlacklist':\n        this.pref.enableBlacklist = pref.get(name);\n        this.view.redraw(true);\n        break;\n      case 'enableDeleteDupLogin':\n        this.buf.enableDeleteDupLogin = pref.get(name);\n        break;\n      case 'deleteDupLogin':\n        this.buf.deleteDupLogin = pref.get(name);\n        break;\n      default:\n        break;\n    }\n  } catch (e) {\n    // eats all errors\n    return;\n  }\n};\n\npttchrome.App.prototype.checkClass = function (cn) {\n  return cn.indexOf(\"closeSI\") >= 0 || cn.indexOf(\"EPbtn\") >= 0 || cn.indexOf(\"closePP\") >= 0 || cn.indexOf(\"picturePreview\") >= 0 || cn.indexOf(\"drag\") >= 0 || cn.indexOf(\"floatWindowClientArea\") >= 0 || cn.indexOf(\"WinBtn\") >= 0 || cn.indexOf(\"sBtn\") >= 0 || cn.indexOf(\"nonspan\") >= 0 || cn.indexOf(\"nomouse_command\") >= 0;\n};\n\npttchrome.App.prototype.mouse_click = function (e) {\n  if (this.modalShown) return;\n\n  var skipMouseClick = this.CmdHandler.getAttribute('SkipMouseClick') == '1';\n  this.CmdHandler.setAttribute('SkipMouseClick', '0');\n\n  if (e.button == 2) {//right button\n  } else if (e.button === 0) {\n    //left button\n    if ($(e.target).is('a') || $(e.target).parent().is('a')) {\n      return;\n    }\n    if (window.getSelection().isCollapsed) {\n      //no anything be select\n      if (this.buf.useMouseBrowsing) {\n        var doMouseCommand = true;\n        if (e.target.className) if (this.checkClass(e.target.className)) doMouseCommand = false;\n        if (e.target.tagName) if (e.target.tagName.indexOf(\"menuitem\") >= 0) doMouseCommand = false;\n        if (skipMouseClick) {\n          doMouseCommand = false;\n          var pos = this.clientToPos(e.clientX, e.clientY);\n          this.buf.onMouse_move(pos.col, pos.row, true);\n        }\n        if (doMouseCommand) {\n          this.onMouse_click(e);\n          this.setDblclickTimer();\n          e.preventDefault();\n          this.setInputAreaFocus();\n        }\n      } else if (this.view.leftButtonFunction) {\n        if (this.view.leftButtonFunction == 1) {\n          this.setBBSCmd('doEnter', this.CmdHandler);\n          e.preventDefault();\n          this.setInputAreaFocus();\n        } else if (this.view.leftButtonFunction == 2) {\n          this.setBBSCmd('doRight', this.CmdHandler);\n          e.preventDefault();\n          this.setInputAreaFocus();\n        }\n      }\n    }\n  } else if (e.button == 1) {//middle button\n  } else {}\n};\n\npttchrome.App.prototype.middleMouse_down = function (e) {\n  // moved to here because middle click works better with jquery\n  if (e.button == 1) {\n    if ($(e.target).is('a') || $(e.target).parent().is('a')) {\n      return;\n    }\n    if (this.view.middleButtonFunction == 1) {\n      this.conn.send('\\r');\n      return false;\n    } else if (this.view.middleButtonFunction == 2) {\n      this.conn.send('\\x1b[D');\n      return false;\n    } else if (this.view.middleButtonFunction == 3) {\n      this.doPaste();\n      return false;\n    }\n  }\n};\n\npttchrome.App.prototype.mouse_down = function (e) {\n  if (this.modalShown) return;\n  //0=left button, 1=middle button, 2=right button\n  if (e.button === 0) {\n    if (this.buf.useMouseBrowsing) {\n      if (this.dblclickTimer) {\n        //skip\n        e.preventDefault();\n        e.stopPropagation();\n        e.cancelBubble = true;\n      }\n      this.setDblclickTimer();\n    }\n    this.mouseLeftButtonDown = true;\n    //this.setInputAreaFocus();\n    if (!window.getSelection().isCollapsed) this.CmdHandler.setAttribute('SkipMouseClick', '1');\n\n    var onbbsarea = true;\n    if (e.target.className) if (this.checkClass(e.target.className)) onbbsarea = false;\n    if (e.target.tagName) if (e.target.tagName.indexOf(\"menuitem\") >= 0) onbbsarea = false;\n  } else if (e.button == 2) {\n    this.mouseRightButtonDown = true;\n  }\n};\n\npttchrome.App.prototype.mouse_up = function (e) {\n  if (this.modalShown) return;\n  //0=left button, 1=middle button, 2=right button\n  if (e.button === 0) {\n    this.setMbTimer();\n    //this.CmdHandler.setAttribute('MouseLeftButtonDown', '0');\n    this.mouseLeftButtonDown = false;\n  } else if (e.button == 2) {\n    this.mouseRightButtonDown = false;\n    //this.CmdHandler.setAttribute('MouseRightButtonDown', '0');\n  }\n\n  if (e.button === 0 || e.button == 2) {\n    //left or right button\n    if (window.getSelection().isCollapsed) {\n      //no anything be select\n      if (this.buf.useMouseBrowsing) this.onMouse_move(e.clientX, e.clientY);\n\n      this.setInputAreaFocus();\n      if (e.button === 0) {\n        var preventDefault = true;\n        if (e.target.className) if (this.checkClass(e.target.className)) preventDefault = false;\n        if (e.target.tagName) if (e.target.tagName.indexOf(\"menuitem\") >= 0) preventDefault = false;\n        if (preventDefault) e.preventDefault();\n      }\n    } else {\n      //something has be select\n      if (this.copyOnSelect) {\n        this.doCopy(window.getSelection().toString().replace(/\\u00a0/g, \" \"));\n      }\n    }\n  } else {\n    this.setInputAreaFocus();\n    e.preventDefault();\n  }\n  var _this = this;\n  this.inputAreaFocusTimer = (0, _util.setTimer)(false, function () {\n    clearTimeout(_this.inputAreaFocusTimer);\n    _this.inputAreaFocusTimer = null;\n    if (window.getSelection().isCollapsed) _this.setInputAreaFocus();\n  }, 10);\n};\n\npttchrome.App.prototype.mouse_move = function (e) {\n  if (this.inputHelper.mouseDown) {\n    this.inputHelper.onMouseDrag(e);\n    return;\n  }\n\n  if (this.buf.useMouseBrowsing) {\n    if (window.getSelection().isCollapsed) {\n      if (!this.mouseLeftButtonDown) this.onMouse_move(e.clientX, e.clientY);\n    } else this.resetMouseCursor();\n  }\n};\n\npttchrome.App.prototype.mouse_over = function (e) {\n  if (this.modalShown) return;\n\n  this.curX = e.clientX;\n  this.curY = e.clientY;\n\n  if (window.getSelection().isCollapsed && !this.mouseLeftButtonDown) this.setInputAreaFocus();\n};\n\npttchrome.App.prototype.mouse_scroll = function (e) {\n  if (this.modalShown) return;\n  // if in easyreading, use it like webpage\n  if (this.view.useEasyReadingMode && this.buf.pageState == 3) {\n    return;\n  }\n\n  var cmdhandler = this.CmdHandler;\n\n  // scroll = up/down\n  // hold right mouse key + scroll = page up/down\n  // hold left mouse key + scroll = thread prev/next\n  var mouseWheelActionsUp = ['none', 'doArrowUp', 'doPageUp', 'previousThread'];\n  var mouseWheelActionsDown = ['none', 'doArrowDown', 'doPageDown', 'nextThread'];\n\n  if (e.wheelDelta > 0) {\n    // scrolling up\n    if (this.mouseRightButtonDown) {\n      var action = mouseWheelActionsUp[this.view.mouseWheelFunction2];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    } else if (this.mouseLeftButtonDown) {\n      var action = mouseWheelActionsUp[this.view.mouseWheelFunction3];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n        this.setBBSCmd('cancelHoldMouse', cmdhandler);\n      }\n    } else {\n      var action = mouseWheelActionsUp[this.view.mouseWheelFunction1];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    }\n  } else {\n    // scrolling down\n    if (this.mouseRightButtonDown) {\n      var action = mouseWheelActionsDown[this.view.mouseWheelFunction2];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    } else if (this.mouseLeftButtonDown) {\n      var action = mouseWheelActionsDown[this.view.mouseWheelFunction3];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n        this.setBBSCmd('cancelHoldMouse', cmdhandler);\n      }\n    } else {\n      var action = mouseWheelActionsDown[this.view.mouseWheelFunction1];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    }\n  }\n  e.stopPropagation();\n  e.preventDefault();\n\n  if (this.mouseRightButtonDown) //prevent context menu popup\n    cmdhandler.setAttribute('doDOMMouseScroll', '1');\n  if (this.mouseLeftButtonDown) {\n    if (this.buf.useMouseBrowsing) {\n      cmdhandler.setAttribute('SkipMouseClick', '1');\n    }\n  }\n};\n\npttchrome.App.prototype.showQuickSearchMenus = function (e, selectedText, hideContextMenu) {\n  var self = this;\n  if (this.pref.quickSearches.length === 0) return;\n\n  var menuSelector = '#quickSearchMenus';\n  var menuHtml = '';\n  for (var i = 0; i < this.pref.quickSearches.length; ++i) {\n    var q = this.pref.quickSearches[i];\n    menuHtml += '<li class=\"cmenuItem\"><a data-url=\"' + q.url + '\">' + q.name + '</a></li>';\n  }\n  $(menuSelector).html(menuHtml);\n\n  $('#quickSearchMenus a').off();\n  $('#quickSearchMenus a').click(function (e) {\n    var url = $(this).data('url');\n    url = url.replace('%s', selectedText);\n    window.open(url);\n    e.stopPropagation();\n    hideContextMenu();\n  });\n\n  var pageHeight = $(window).height();\n  var pageWidth = $(window).width();\n  if (e.pageY > pageHeight / 2) {\n    $(menuSelector).addClass('cmenuGoesUp');\n  } else {\n    $(menuSelector).removeClass('cmenuGoesUp');\n  }\n  if (e.pageX > pageWidth * 0.8) {\n    $(menuSelector).addClass('cmenuGoesLeft');\n  } else {\n    $(menuSelector).removeClass('cmenuGoesLeft');\n  }\n};\n\npttchrome.App.prototype.setupContextMenus = function () {\n  var self = this;\n  var menuSelector = '#contextMenus';\n  var selectedText = '';\n  var contextOnUrl = '';\n  var contextOnUserId = '';\n  var aElement = null;\n\n  $('#BBSWindow').on('contextmenu', function (e) {\n    // if i am doing scrolling, i should skip\n    var cmdhandler = self.CmdHandler;\n    var doDOMMouseScroll = cmdhandler.getAttribute('doDOMMouseScroll') == '1';\n    if (doDOMMouseScroll) {\n      e.stopPropagation();\n      e.preventDefault();\n      cmdhandler.setAttribute('doDOMMouseScroll', '0');\n      return;\n    }\n\n    var target = $(e.target);\n    contextOnUrl = '';\n    contextOnUserId = '';\n\n    // just in case the selection get de-selected\n    if (window.getSelection().isCollapsed) {\n      self.lastSelection = null;\n    } else {\n      self.lastSelection = self.view.getSelectionColRow();\n    }\n\n    aElement = null;\n    if (target.is('a')) {\n      contextOnUrl = target.attr('href');\n      aElement = target[0];\n    } else if (target.parent().is('a')) {\n      contextOnUrl = target.parent().attr('href');\n      aElement = target[0].parentNode;\n    }\n\n    // for getting push thread user id\n    if (self.pref.enableBlacklist) {\n      var srow = target.attr('srow');\n      if (srow === undefined || srow === null) srow = target.parent().attr('srow');\n      srow = parseInt(srow);\n      if (!isNaN(srow)) {\n        var rowText = '';\n        if (self.view.useEasyReadingMode && self.buf.pageState == 3) {\n          rowText = self.buf.getRowText(srow, 0, self.buf.cols, self.buf.pageLines);\n        } else {\n          rowText = self.buf.getRowText(srow, 0, self.buf.cols);\n        }\n        if (self.buf.pageState == 3) {\n          contextOnUserId = rowText.parsePushthreadForUserId();\n        } else if (self.buf.pageState == 2) {\n          contextOnUserId = rowText.parseThreadForUserId();\n        }\n      }\n    }\n\n    // replace the &nbsp;\n    selectedText = window.getSelection().toString().replace(/\\u00a0/g, \" \");\n\n    if (contextOnUrl) {\n      $('.contextQuickSearch').hide();\n      $('.contextUrl').show();\n      $('.contextSel').hide();\n      $('.contextNormal').hide();\n    } else {\n      if (window.getSelection().isCollapsed) {\n        $('.contextQuickSearch').hide();\n        $('.contextUrl').hide();\n        $('.contextSel').hide();\n        $('.contextNormal').show();\n      } else {\n        // got something selected, show copy and searchGoogle\n        $('.contextUrl').hide();\n        $('.contextSel').show();\n        $('.contextNormal').hide();\n        var clipedText = selectedText;\n        if (clipedText.length > 15) {\n          clipedText = clipedText.substr(0, 15) + ' ... ';\n        }\n        $('#cmenuSearchContent').text(\"'\" + clipedText + \"'\");\n        if (self.pref.quickSearches.length > 0) {\n          self.showQuickSearchMenus(e, selectedText, function () {\n            hideContextMenu();\n          });\n          $('.contextQuickSearch').show();\n        } else {\n          $('.contextQuickSearch').hide();\n        }\n      }\n    }\n\n    if (contextOnUserId) {\n      if (contextOnUserId in self.pref.blacklistedUserIds) {\n        $('#cmenuRemoveBlacklistUserIdContent').text(\"'\" + contextOnUserId + \"'\");\n        $('#cmenu_addBlacklistUserId').hide();\n        $('#cmenu_removeBlacklistUserId').show();\n      } else {\n        $('#cmenuAddBlacklistUserIdContent').text(\"'\" + contextOnUserId + \"'\");\n        $('#cmenu_addBlacklistUserId').show();\n        $('#cmenu_removeBlacklistUserId').hide();\n      }\n      $('#cmenu_divider3').show();\n    } else {\n      $('#cmenu_addBlacklistUserId').hide();\n      $('#cmenu_removeBlacklistUserId').hide();\n    }\n\n    // check if mouse browsing is on\n    if (self.buf.useMouseBrowsing) {\n      $('#cmenu_mouseBrowsing a').addClass('checked');\n    } else {\n      $('#cmenu_mouseBrowsing a').removeClass('checked');\n    }\n\n    // show and position\n    $(menuSelector).show().css({\n      position: \"absolute\",\n      left: function (e) {\n        var mouseWidth = e.pageX;\n        var pageWidth = $(window).width();\n        var menuWidth = $(menuSelector).width();\n\n        // opening menu would pass the side of the page\n        if (mouseWidth + menuWidth > pageWidth && menuWidth < mouseWidth) {\n          return mouseWidth - menuWidth;\n        }\n        return mouseWidth;\n      }(e),\n      top: function (e) {\n        var mouseHeight = e.pageY;\n        var pageHeight = $(window).height();\n        var menuHeight = $(menuSelector).height();\n\n        // opening menu would pass the bottom of the page\n        if (mouseHeight + menuHeight > pageHeight && menuHeight < mouseHeight) {\n          return mouseHeight - menuHeight;\n        }\n        return mouseHeight;\n      }(e)\n    });\n    self.contextMenuShown = true;\n    return false;\n  });\n\n  var hideContextMenu = function hideContextMenu() {\n    $(menuSelector).hide();\n    selectedText = '';\n    self.contextMenuShown = false;\n  };\n\n  // for menuitem shortkey\n  $(window).keyup(function (e) {\n    if (!self.contextMenuShown) return;\n    if (!e.altKey && !e.ctrlKey && !e.shiftKey) {\n      switch (e.keyCode) {\n        case 67:\n          // C\n          self.doCopy(selectedText);\n          hideContextMenu();\n          break;\n        case 69:\n          // E\n          self.doCopy(contextOnUrl);\n          hideContextMenu();\n          break;\n        case 80:\n          // P\n          self.doPaste();\n          hideContextMenu();\n          break;\n        case 83:\n          // S\n          self.doSearchGoogle(selectedText);\n          hideContextMenu();\n          break;\n        case 84:\n          // T\n          self.doOpenUrlNewTab(aElement);\n          hideContextMenu();\n          break;\n      }\n    }\n    e.preventDefault();\n    e.stopPropagation();\n  });\n\n  //make sure menu closes on any click\n  $(window).click(function () {\n    hideContextMenu();\n  });\n  if ('ontouchstart' in window) {\n    window.ontouchstart = function (e) {\n      if (e.target.parentNode.classList.length > 0 && e.target.parentNode.classList[0] == 'cmenuItem') {\n        return;\n      }\n      hideContextMenu();\n    };\n  }\n\n  $('#cmenu_copy a').html((0, _i18n.i18n)('cmenu_copy') + '<span class=\"cmenuHotkey\">Ctrl+C</span>');\n  $('#cmenu_copyAnsi a').text((0, _i18n.i18n)('cmenu_copyAnsi'));\n  $('#cmenu_paste a').html((0, _i18n.i18n)('cmenu_paste') + '<span class=\"cmenuHotkey\">Shift+Insert</span>');\n  $('#cmenu_selectAll a').html((0, _i18n.i18n)('cmenu_selectAll') + '<span class=\"cmenuHotkey\">Ctrl+A</span>');\n  $('#cmenu_searchGoogle a').html((0, _i18n.i18n)('cmenu_searchGoogle') + ' <span id=\"cmenuSearchContent\"></span>');\n  $('#cmenu_quickSearch a').html((0, _i18n.i18n)('cmenu_quickSearch') + ' <span style=\"float:right;\">&#9658;</span>');\n  $('#cmenu_openUrlNewTab a').text((0, _i18n.i18n)('cmenu_openUrlNewTab'));\n  $('#cmenu_copyLinkUrl a').text((0, _i18n.i18n)('cmenu_copyLinkUrl'));\n  $('#cmenu_mouseBrowsing a').text((0, _i18n.i18n)('cmenu_mouseBrowsing'));\n  $('#cmenu_goToOtherSite a').text((0, _i18n.i18n)('cmenu_goToOtherSite'));\n  $('#cmenu_showInputHelper a').text((0, _i18n.i18n)('cmenu_showInputHelper'));\n  $('#cmenu_showLiveArticleHelper a').text((0, _i18n.i18n)('cmenu_showLiveArticleHelper'));\n  $('#cmenu_addBlacklistUserId a').html((0, _i18n.i18n)('cmenu_addBlacklistUserId') + ' <span id=\"cmenuAddBlacklistUserIdContent\"></span>');\n  $('#cmenu_removeBlacklistUserId a').html((0, _i18n.i18n)('cmenu_removeBlacklistUserId') + ' <span id=\"cmenuRemoveBlacklistUserIdContent\"></span>');\n  $('#cmenu_settings a').text((0, _i18n.i18n)('cmenu_settings'));\n\n  var contextMenuItemOnClickHandler = {\n    'cmenu_copy': function cmenu_copy() {\n      self.doCopy(selectedText);\n    },\n    'cmenu_copyAnsi': function cmenu_copyAnsi() {\n      self.doCopyAnsi();\n    },\n    'cmenu_paste': function cmenu_paste() {\n      self.doPaste();\n    },\n    'cmenu_selectAll': function cmenu_selectAll() {\n      self.doSelectAll();\n    },\n    'cmenu_searchGoogle': function cmenu_searchGoogle() {\n      self.doSearchGoogle(selectedText);\n    },\n    'cmenu_openUrlNewTab': function cmenu_openUrlNewTab() {\n      self.doOpenUrlNewTab(aElement);\n    },\n    'cmenu_copyLinkUrl': function cmenu_copyLinkUrl() {\n      self.doCopy(contextOnUrl);\n    },\n    'cmenu_mouseBrowsing': function cmenu_mouseBrowsing() {\n      self.switchMouseBrowsing();\n    },\n    'cmenu_goToOtherSite': function cmenu_goToOtherSite() {\n      self.doGoToOtherSite();\n    },\n    'cmenu_showInputHelper': function cmenu_showInputHelper() {\n      self.inputHelper.showHelper();\n    },\n    'cmenu_showLiveArticleHelper': function cmenu_showLiveArticleHelper() {\n      $('#liveHelper').show();\n    },\n    'cmenu_addBlacklistUserId': function cmenu_addBlacklistUserId() {\n      self.doAddBlacklistUserId(contextOnUserId);\n    },\n    'cmenu_removeBlacklistUserId': function cmenu_removeBlacklistUserId() {\n      self.doRemoveBlacklistUserId(contextOnUserId);\n    },\n    'cmenu_settings': function cmenu_settings() {\n      self.doSettings();\n    }\n  };\n\n  $('.cmenuItem').click(function (e) {\n    var id = $(this).attr('id');\n    if (id in contextMenuItemOnClickHandler) {\n      contextMenuItemOnClickHandler[id]();\n    }\n    e.stopPropagation();\n    hideContextMenu();\n  });\n\n  $(menuSelector).on('contextmenu', function (e) {\n    e.stopPropagation();\n    e.preventDefault();\n  });\n};\n\npttchrome.App.prototype.context_menu = function (e) {\n  var cmdhandler = this.CmdHandler;\n  var doDOMMouseScroll = cmdhandler.getAttribute('doDOMMouseScroll') == '1';\n  if (doDOMMouseScroll) {\n    e.stopPropagation();\n    e.preventDefault();\n    cmdhandler.setAttribute('doDOMMouseScroll', '0');\n    return;\n  }\n};\n\npttchrome.App.prototype.regExitAlert = function () {\n  if (!window.onbeforeunload && window.location.origin.indexOf('http://localhost') !== 0) {\n    window.onbeforeunload = function () {\n      return 'Connected to ' + document.title;\n    };\n  }\n};\n\npttchrome.App.prototype.unregExitAlert = function () {\n  // clear alert for closing tab\n  window.onbeforeunload = null;\n};\n\npttchrome.App.prototype.setBBSCmd = function (cmd, cmdhandler) {\n  //var doc = gBrowser.contentDocument;\n  var doc = document;\n  if (!cmdhandler) cmdhandler = this.getCmdHandler();\n\n  if (cmdhandler && \"createEvent\" in doc) {\n    cmdhandler.setAttribute('pttChromeCommand', cmd);\n    var evt = doc.createEvent(\"Events\");\n    evt.initEvent(\"OverlayCommand\", false, false);\n    cmdhandler.dispatchEvent(evt);\n  }\n};\n\nexports.App = pttchrome.App;\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AnsiParser = AnsiParser;\n// Parser for ANSI escape sequence\n\nfunction AnsiParser(termbuf) {\n  this.termbuf = termbuf;\n  this.state = AnsiParser.STATE_TEXT;\n  this.esc = '';\n};\n\nAnsiParser.STATE_TEXT = 0;\nAnsiParser.STATE_ESC = 1;\nAnsiParser.STATE_CSI = 2;\nAnsiParser.STATE_C1 = 3;\n\nAnsiParser.prototype.feed = function (data) {\n  var term = this.termbuf;\n  if (!term) return;\n  var s = '';\n  var n = data.length;\n  for (var i = 0; i < n; ++i) {\n    var ch = data[i];\n    switch (this.state) {\n      case AnsiParser.STATE_TEXT:\n        switch (ch) {\n          case '\\x1b':\n            if (s) {\n              term.puts(s);\n              s = '';\n            }\n            this.state = AnsiParser.STATE_ESC;\n            break;\n          default:\n            s += ch;\n        }\n        break;\n      case AnsiParser.STATE_CSI:\n        if (ch >= '`' && ch <= 'z' || ch >= '@' && ch <= 'Z') {\n          // if(ch != 'm')\n          //    dump('CSI: ' + this.esc + ch + '\\n');\n          var params = this.esc.split(';');\n          var firstChar = '';\n          if (params[0]) {\n            if (params[0].charAt(0) < '0' || params[0].charAt(0) > '9') {\n              firstChar = params[0].charAt(0);\n              params[0] = params[0].slice(1);\n            }\n          }\n          if (firstChar && ch != 'h' && ch != 'l') {\n            // unknown CSI\n            //dump('unknown CSI: ' + this.esc + ch + '\\n');\n            this.state = AnsiParser.STATE_TEXT;\n            this.esc = '';\n            break;\n          }\n          for (var j = 0; j < params.length; ++j) {\n            if (params[j]) params[j] = parseInt(params[j], 10);else params[j] = 0;\n          }\n          switch (ch) {\n            case 'm':\n              var attr = term.attr;\n              for (var n_params = params.length; n_params; --n_params) {\n                var v = params.shift();\n                switch (v) {\n                  case 0:\n                    // reset\n                    attr.resetAttr();\n                    break;\n                  case 1:\n                    // bright\n                    attr.bright = true;\n                    break;\n                  case 4:\n                    attr.underLine = true;\n                    break;\n                  case 5: // blink\n                  case 6:\n                    attr.blink = true;\n                    break;\n                  case 7:\n                    // invert\n                    attr.invert = true;\n                    break;\n                  case 8:\n                    // invisible is not supported\n                    break;\n                  /*\n                  case 22: // normal, or not bright\n                    attr.bright=false;\n                    break;\n                  case 24: // not underlined\n                    attr.underLine=false;\n                    break;\n                  case 25: // steady, or not blink\n                    attr.blink=false;\n                    break;\n                  case 27: // positive, or not invert\n                    attr.invert=false;\n                    break;\n                  */\n                  default:\n                    if (v <= 37) {\n                      if (v >= 30) {\n                        // fg\n                        attr.fg = v - 30;\n                      }\n                    } else if (v >= 40) {\n                      if (v <= 47) {\n                        //bg\n                        attr.bg = v - 40;\n                      }\n                    }\n                    break;\n                }\n              }\n              break;\n            case '@':\n              term.insert(params[0] > 0 ? params[0] : 1);\n              break;\n            case 'A':\n              term.gotoPos(term.cur_x, term.cur_y - (params[0] ? params[0] : 1));\n              break;\n            case 'B':\n            case 'e':\n              term.gotoPos(term.cur_x, term.cur_y + (params[0] ? params[0] : 1));\n              break;\n            case 'C':\n            case 'e':\n              term.gotoPos(term.cur_x + (params[0] ? params[0] : 1), term.cur_y);\n              break;\n            case 'D':\n              term.gotoPos(term.cur_x - (params[0] ? params[0] : 1), term.cur_y);\n              break;\n            case 'E':\n              term.gotoPos(0, term.cur_y + (params[0] ? params[0] : 1));\n              break;\n            case 'F':\n              term.gotoPos(0, term.cur_y - (params[0] ? params[0] : 1));\n              break;\n            case 'G':\n            case '`':\n              term.gotoPos(params[0] > 0 ? params[0] - 1 : 0, term.cur_y);\n              break;\n            case 'I':\n              term.tab(params[0] > 0 ? params[0] : 1);\n              break;\n            case 'd':\n              term.gotoPos(term.cur_x, params[0] > 0 ? params[0] - 1 : 0);\n              break;\n            /*\n            case 'h':\n              if (firstChar == '?') {\n                var mainobj = term.view.conn.listener;\n                switch(params[0]) {\n                case 1:\n                  term.view.cursorAppMode = true;\n                  break;\n                case 1048:\n                case 1049:\n                  term.cur_x_sav = term.cur_x;\n                  term.cur_y_sav = term.cur_y;\n                  if (params[0] != 1049) break; // 1049 fall through\n                case 47:\n                case 1047:\n                  mainobj.selAll(true); // skipRedraw\n                  term.altScreen=mainobj.ansiCopy(true); // external buffer\n                  term.altScreen+=term.ansiCmp(term.newChar, term.attr);\n                  term.clear(2);\n                  term.attr.resetAttr();\n                  break;\n                default:\n                }\n              }\n              break;\n            case 'l':\n              if (firstChar == '?') {\n                switch (params[0]) {\n                case 1:\n                  term.view.cursorAppMode = false;\n                  break;\n                case 47:\n                case 1047:\n                case 1049:\n                  term.clear(2);\n                  term.attr.resetAttr();\n                  if (term.altScreen) {\n                    this.state = AnsiParser.STATE_TEXT;\n                    this.esc = '';\n                    this.feed(term.altScreen.replace(/(\\r\\n)+$/g, '\\r\\n'));\n                  }\n                  term.altScreen='';\n                  if (params[0] != 1049) break; // 1049 fall through\n                case 1048:\n                  if (term.cur_x_sav<0 || term.cur_y_sav<0) break;\n                  term.cur_x = term.cur_x_sav;\n                  term.cur_y = term.cur_y_sav;\n                  break;\n                default:\n                }\n              }\n              break;\n            */\n            case 'J':\n              term.clear(params ? params[0] : 0);\n              break;\n            case 'H':\n            case 'f':\n              if (params.length < 2) {\n                term.gotoPos(0, 0);\n              } else {\n                if (params[0] > 0) --params[0];\n                if (params[1] > 0) --params[1];\n                term.gotoPos(params[1], params[0]);\n              }\n              break;\n            case 'K':\n              term.eraseLine(params ? params[0] : 0);\n              break;\n            case 'L':\n              term.insertLine(params[0] > 0 ? params[0] : 1);\n              break;\n            case 'M':\n              term.deleteLine(params[0] > 0 ? params[0] : 1);\n              break;\n            case 'P':\n              term.del(params[0] > 0 ? params[0] : 1);\n              break;\n            case 'r':\n              // FIXME: scroll range\n              if (params.length < 2) {\n                term.scrollStart = 0;\n                term.scrollEnd = term.rows - 1;\n              } else {\n                if (params[0] > 0) --params[0];\n                if (params[1] > 0) --params[1];\n                term.scrollStart = params[0];\n                term.scrollEnd = params[1];\n              }\n              break;\n            case 's':\n              term.cur_x_sav = term.cur_x;\n              term.cur_y_sav = term.cur_y;\n              break;\n            case 'u':\n              if (term.cur_x_sav < 0 || term.cur_y_sav < 0) break;\n              term.cur_x = term.cur_x_sav;\n              term.cur_y = term.cur_y_sav;\n              break;\n            case 'S':\n              term.scroll(false, params[0] > 0 ? params[0] : 1);\n              break;\n            case 'T':\n              term.scroll(true, params[0] > 0 ? params[0] : 1);\n              break;\n            case 'X':\n              term.eraseChar(params[0] > 0 ? params[0] : 1);\n              break;\n            case 'Z':\n              term.backTab(params[0] > 0 ? params[0] : 1);\n              break;\n            default:\n            //dump('unknown CSI: ' + this.esc + ch + '\\n');\n          }\n          this.state = AnsiParser.STATE_TEXT;\n          this.esc = '';\n        } else {\n          this.esc += ch;\n        }\n        break;\n      case AnsiParser.STATE_C1:\n        var C1_End = true;\n        var C1_Char = [' ', '#', '%', '(', ')', '*', '+', '-', '.', '/'];\n        if (this.esc) {\n          // multi-char is not supported now\n          for (var j = 0; j < C1_Char.length; ++j) {\n            if (this.esc == C1_Char[j]) C1_End = false;\n          }if (C1_End) --i;else this.esc += ch;\n          //dump('UNKNOWN C1 CONTROL CHAR IS FOUND: ' + this.esc + '\\n');\n          this.esc = '';\n          this.state = AnsiParser.STATE_TEXT;\n          break;\n        }\n        switch (ch) {\n          case '7':\n            term.cur_x_sav = term.cur_x;\n            term.cur_y_sav = term.cur_y;\n            break;\n          case '8':\n            if (term.cur_x_sav < 0 || term.cur_y_sav < 0) break;\n            term.cur_x = term.cur_x_sav;\n            term.cur_y = term.cur_y_sav;\n            break;\n          case 'D':\n            term.scroll(false, 1);\n            break;\n          case 'E':\n            term.lineFeed();\n            term.carriageReturn();\n            break;\n          case 'M':\n            term.scroll(true, 1);\n            break;\n          /*\n          case '=':\n              term.view.keypadAppMode = true;\n              break;\n          case '>':\n              term.view.keypadAppMode = false;\n              break;\n          */\n          default:\n            this.esc += ch;\n            C1_End = false;\n        }\n        if (!C1_End) break;\n        this.esc = '';\n        this.state = AnsiParser.STATE_TEXT;\n        break;\n      case AnsiParser.STATE_ESC:\n        if (ch == '[') this.state = AnsiParser.STATE_CSI;else {\n          this.state = AnsiParser.STATE_C1;\n          --i;\n        }\n        break;\n    }\n  }\n  if (s) {\n    term.puts(s);\n    s = '';\n  }\n};\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TermView = TermView;\n\nvar _term_keyboard = __webpack_require__(11);\n\nvar _term_buf = __webpack_require__(3);\n\nvar _image_preview = __webpack_require__(5);\n\nvar _term_ui = __webpack_require__(4);\n\nvar _i18n = __webpack_require__(0);\n\nvar _util = __webpack_require__(1);\n\n// Terminal View\n\nfunction TermView(rowCount) {\n  //new pref - start\n  this.screenType = 0;\n  this.bbsWidth = 0;\n  this.bbsHeight = 0;\n  this.bbsFontSize = 14;\n  this.useHyperLink = true;\n  this.dbcsDetect = true;\n  this.inputBufferSizeType = 0;\n  this.defineInputBufferSize = 12;\n  this.hideInputBuffer = false;\n  this.hotkeyForSelectAll = false;\n  this.highlightBG = 2;\n  this.charset = 'big5';\n  this.EnterChar = '\\r';\n  this.EscChar = '\\x15'; // Ctrl-U\n  this.dropToPaste = false;\n  this.ctrlPicturePreview = false;\n  this.picturePreviewInfo = false;\n  this.middleButtonFunction = 0;\n  this.leftButtonFunction = false;\n  this.mouseWheelFunction1 = 1;\n  this.mouseWheelFunction2 = 2;\n  this.mouseWheelFunction3 = 3;\n  //this.highlightFG = 7;\n  this.DisplayBackground = false;\n  this.BackgroundMD5 = '';\n  this.fontFitWindowWidth = false;\n  this.verticalAlignCenter = true;\n  this.horizontalAlignCenter = true;\n  this.easyReadingWithImg = false;\n  //new pref - end\n\n  this.bbsViewMargin = 0;\n  this.cursorShow = true;\n\n  this.buf = null;\n  this.bbscore = null;\n  this.page = null;\n\n  // Cursor\n  this.cursorX = 0;\n  this.cursorY = 0;\n\n  // TODO Move this into easy_reading.js\n  this.useEasyReadingMode = false;\n  this.easyReadingKeyDownKeyCode = 0;\n\n  this.doHighlightOnCurRow = false;\n\n  this.displayingRows = [];\n\n  this.curRow = 0;\n  this.curCol = 0;\n\n  this.actualRowIndex = 0;\n\n  this.lineWrap = 78;\n\n  //this.DBDetection = false;\n  this.blinkShow = false;\n  this.blinkOn = false;\n  this.doBlink = true;\n  this.cursorBlinkTimer = null;\n\n  this.selection = null;\n  this.input = document.getElementById('t');\n  this.bbsCursor = document.getElementById('cursor');\n  this.trackKeyWordList = document.getElementById('TrackKeyWordList');\n  this.BBSWin = document.getElementById('BBSWindow');\n  this.enablePicPreview = true;\n  this.scaleX = 1;\n  this.scaleY = 1;\n\n  var dynamicStyle = document.createElement('style');\n  document.head.appendChild(dynamicStyle);\n  this.dynamicCss = dynamicStyle.sheet;\n\n  // for cpu efficiency\n  this.innerBounds = { width: 0, height: 0 };\n  this.firstGridOffset = { top: 0, left: 0 };\n\n  // for notifications\n  this.enableNotifications = true;\n  this.titleTimer = null;\n  this.notif = null;\n\n  var mainDiv = document.createElement('div');\n  mainDiv.setAttribute('class', 'main');\n  var defaultRows = '';\n  for (var i = 0; i < rowCount; ++i) {\n    defaultRows += '<span type=\"bbsrow\" srow=\"' + i + '\"></span>';\n    this.displayingRows.push(null);\n  }\n  mainDiv.innerHTML = '<div id=\"mainContainer\">' + defaultRows + '</div>';\n  this.BBSWin.appendChild(mainDiv);\n  this.mainDisplay = mainDiv;\n\n  var lastRowDiv = document.createElement('div');\n  lastRowDiv.setAttribute('id', 'easyReadingLastRow');\n  this.lastRowDivContent = '<span align=\"left\"><span class=\"q0 b7\">                                                       </span><span class=\"q1 b7\">(y)</span><span class=\"q0 b7\">回應</span><span class=\"q1 b7\">(X%)</span><span class=\"q0 b7\">推文</span><span class=\"q1 b7\">(←)</span><span class=\"q0 b7\">離開 </span> </span>';\n  lastRowDiv.innerHTML = this.lastRowDivContent;\n  this.lastRowDiv = lastRowDiv;\n  this.BBSWin.appendChild(lastRowDiv);\n\n  var replyRowDiv = document.createElement('div');\n  replyRowDiv.setAttribute('id', 'easyReadingReplyRow');\n  this.replyRowDivContent = '<span align=\"left\"></span>';\n  replyRowDiv.innerHTML = this.replyRowDivContent;\n  this.replyRowDiv = replyRowDiv;\n  this.BBSWin.appendChild(replyRowDiv);\n\n  this.mainContainer = document.getElementById('mainContainer');\n  this.mainDisplay.style.border = '0px';\n  this.setFontFace('MingLiu,monospace');\n\n  this._keyboard = new _term_keyboard.TermKeyboard(this.checkLeftDB.bind(this), this.checkCurDB.bind(this), this._send.bind(this));\n\n  var self = this;\n  this.input.addEventListener('compositionstart', function (e) {\n    self.onCompositionStart(e);\n    self.bbscore.setInputAreaFocus();\n  }, false);\n\n  this.input.addEventListener('compositionend', function (e) {\n    self.onCompositionEnd(e);\n    self.bbscore.setInputAreaFocus();\n    // Some browsers fire another input event after composition; some not.\n    // The strategy here is to ignore the inputs during composition.\n    // Instead, we pull all input text at composition end, and clear input text.\n    // So if input event do fire after composition end, we'll get a empty string.\n    self.onInput(e);\n  }, false);\n\n  this.input.addEventListener('compositionupdate', function (e) {}, false);\n\n  addEventListener('keydown', function (e) {\n    // On both Mac and Windows, control/alt+key will be sent as original key\n    // code even under IME.\n    // Char inputs will be handler on input event.\n    // We can safely ignore those IME keys here.\n    if (e.keyCode == 229) return;\n\n    // iOS sends the keydown that starts composition as key code 0. Ignore it.\n    if (e.keyCode == 0) return;\n\n    // iOS sends backspace when composing. Disallow any non-control keys during it.\n    if (self.isComposition && !e.ctrlKey && !e.altKey) return;\n\n    // disable auto update pushthread if any command is issued;\n    if (!e.altKey) self.bbscore.disableLiveHelper();\n\n    if (e.keyCode > 15 && e.keyCode < 19) return; // Shift Ctrl Alt (19)\n    if (self.bbscore.modalShown || self.bbscore.contextMenuShown) return;\n    if (document.getElementById('connectionAlert').style.display != 'none') {\n      if (e.keyCode == 13) document.getElementById('connectionAlertReconnect').click();\n      if (e.keyCode == 27) document.getElementById('connectionAlertExitAll').click();\n      return;\n    }\n    self.onKeyDown(e);\n  }, false);\n\n  addEventListener('keyup', function (e) {\n    // We don't need to handle code 229 here, as it should be already composing.\n\n    if (e.keyCode > 15 && e.keyCode < 19) return; // Shift Ctrl Alt (19)\n    if (self.bbscore.modalShown || self.bbscore.contextMenuShown) return;\n    if (document.getElementById('connectionAlert').style.display != 'none' && (e.keyCode == 13 || e.keyCode == 27)) {\n      return;\n    }\n    // set input area focus whenever key down even if there is selection\n    self.bbscore.setInputAreaFocus();\n  }, false);\n\n  this.input.addEventListener('input', function (e) {\n    self.onInput(e);\n  }, false);\n}\n\nTermView.prototype = {\n\n  onBlink: function onBlink() {\n    this.blinkOn = true;\n    //   if(this.buf && this.buf.changed)\n    this.buf.queueUpdate(true);\n    //   else this.update();\n  },\n\n  onCursorBlink: function onCursorBlink() {\n    this.cursorShow = !this.cursorShow;\n    if (this.cursorShow) this.bbsCursor.style.display = 'block';else this.bbsCursor.style.display = 'none';\n  },\n\n  resetCursorBlink: function resetCursorBlink() {\n    if (!this._isConnected()) return;\n    var self = this;\n    this.cursorShow = true;\n    this.bbsCursor.style.display = 'block';\n    if (this.cursorBlinkTimer) {\n      this.cursorBlinkTimer.cancel();\n    }\n    this.cursorBlinkTimer = (0, _util.setTimer)(true, function () {\n      self.onCursorBlink();\n    }, 1000);\n  },\n\n  setBuf: function setBuf(buf) {\n    this.buf = buf;\n  },\n\n  setConn: function setConn(conn) {\n    this.conn = conn;\n  },\n\n  _send: function _send(data) {\n    if (this.conn) this.conn.send(data);\n  },\n\n  _convSend: function _convSend(data) {\n    if (this.conn) this.conn.convSend(data);\n  },\n\n  setCore: function setCore(core) {\n    this.bbscore = core;\n  },\n\n  _isConnected: function _isConnected() {\n    return this.bbscore.isConnected() && !!this.conn;\n  },\n\n  setFontFace: function setFontFace(fontFace) {\n    this.fontFace = fontFace;\n    this.input.style.setProperty('font-family', this.fontFace, 'important');\n    this.mainDisplay.style.setProperty('font-family', this.fontFace, 'important');\n    this.lastRowDiv.style.setProperty('font-family', this.fontFace, 'important');\n    this.replyRowDiv.style.setProperty('font-family', this.fontFace, 'important');\n    document.getElementById('cursor').style.setProperty('font-family', this.fontFace, 'important');\n  },\n\n  update: function update() {\n    this.redraw(false);\n  },\n\n  prePicRel: function prePicRel(str) {\n    if (str.search(/\\.(bmp|gif|jpe?g|png)$/i) == -1) return ' type=\"w\"';else return ' type=\"p\"';\n  },\n\n  redraw: function redraw(force) {\n\n    //var start = new Date().getTime();\n    var cols = this.buf.cols;\n    var rows = this.buf.rows;\n    var lineChangeds = this.buf.lineChangeds;\n    var changedLineHtmlStr = '';\n    var changedLineHtmlStrs = [];\n    var changedRows = [];\n\n    var lines = this.buf.lines;\n    var outhtmls = this.buf.outputhtmls;\n    for (var row = 0; row < rows; ++row) {\n      var chh = this.chh;\n      this.curRow = row;\n      // resets color\n      var line = lines[row];\n      var outhtml = outhtmls[row];\n      var lineChanged = lineChangeds[row];\n      if (lineChanged === false && !force) continue;\n      var lineUpdated = false;\n      var chw = this.chw;\n\n      for (this.curCol = 0; this.curCol < cols; ++this.curCol) {\n        // always check all because it's hard to know about openSpan when jump update\n        // TODO: maybe set ch.needUpdate false?\n        lineUpdated = true;\n      }\n\n      if (lineUpdated) {\n        lineUpdated = false;\n        changedLineHtmlStrs.push(line);\n        changedRows.push(row);\n        lineChangeds[row] = false;\n      }\n    }\n\n    if (changedLineHtmlStrs.length > 0) {\n      if (this.useEasyReadingMode) {\n        if (this.buf.startedEasyReading && this.buf.easyReadingShowReplyText) {\n          this.updateEasyReadingReplyRow(changedLineHtmlStrs[changedLineHtmlStrs.length - 1]);\n        } else if (this.buf.startedEasyReading && this.buf.easyReadingShowPushInitText) {\n          this.updateEasyReadingPushInitRow(changedLineHtmlStrs[changedLineHtmlStrs.length - 1]);\n        } else {\n          this.populateEasyReadingPage();\n        }\n      } else {\n        while (this.mainContainer.childNodes.length > rows) {\n          this.mainContainer.removeChild(this.mainContainer.lastChild);\n        }for (var i = 0; i < changedRows.length; ++i) {\n          var row = changedRows[i];\n          var component = (0, _term_ui.renderRowHtml)(changedLineHtmlStrs[i], row, this.chh, false, this.mainContainer.childNodes[row]);\n          component.setHighlight(this.buf.highlightCursor && this.buf.currentHighlighted == row);\n          this.displayingRows[row] = component;\n        }\n      }\n      this.buf.prevPageState = this.buf.pageState;\n\n      if (this.enablePicPreview) {\n        // hide preview if any update\n        (0, _image_preview.renderImagePreview)(document.getElementById('imagePreviewContainer'), null);\n        this.setupPicPreviewOnHover();\n      }\n    }\n    //var time = new Date().getTime() - start;\n    //console.log(time);\n  },\n\n  setHighlightedRow: function setHighlightedRow(row) {\n    if (this.currentHighlighted == row || this.currentHighlighted === null && row < 0) return;\n    console.log('highlight: ' + row);\n    if (this.currentHighlighted) this.displayingRows[this.currentHighlighted].setHighlight(false);\n    if (row >= 0) {\n      this.displayingRows[row].setHighlight(true);\n      this.currentHighlighted = row;\n    } else {\n      this.currentHighlighted = null;\n    }\n  },\n\n  onInput: function onInput(e) {\n    if (this.bbscore.modalShown || this.bbscore.contextMenuShown) return;\n    if (this.isComposition) {\n      // beginning chrome 55, we no longer can update input buffer width on compositionupdate\n      // so we update it on input event\n      this.updateInputBufferWidth();\n      return;\n    }\n\n    if (this.useEasyReadingMode && this.buf.startedEasyReading && !this.buf.easyReadingShowReplyText && !this.buf.easyReadingShowPushInitText && this.easyReadingKeyDownKeyCode == 229 && e.target.value != 'X') {\n      // only use on chinese IME\n      e.target.value = '';\n      return;\n    }\n    if (e.target.value) {\n      this.onTextInput(e.target.value);\n    }\n    e.target.value = '';\n  },\n\n  onTextInput: function onTextInput(text, isPasting) {\n    this.resetCursorBlink();\n    if (isPasting) {\n      text = text.replace(/\\r\\n/g, '\\r');\n      text = text.replace(/\\n/g, '\\r');\n      text = text.replace(/\\r/g, this.EnterChar);\n\n      if (text.indexOf('\\x1b') < 0 && this.lineWrap > 0) {\n        text = text.wrapText(this.lineWrap, this.EnterChar);\n      }\n\n      //FIXME: stop user from pasting DBCS words with 2-color\n      text = text.replace(/\\x1b/g, this.EscChar);\n    }\n    this._convSend(text);\n  },\n\n  onKeyDown: function onKeyDown(e) {\n    this.resetCursorBlink();\n\n    if (this.useEasyReadingMode && this.buf.startedEasyReading && !this.buf.easyReadingShowReplyText && !this.buf.easyReadingShowPushInitText) {\n      this.easyReadingKeyDownKeyCode = e.keyCode;\n      this.bbscore.easyReading._onKeyDown(e);\n      if (e.defaultPrevented) return;\n    }\n\n    // TODO: Move this. Make a key event mapper.\n    var stop = false;\n    if (!e.ctrlKey && !e.altKey) {\n      switch (e.key) {\n        case 'End':\n          //End\n          if ((this.bbscore.buf.pageState == 2 || this.bbscore.buf.pageState == 3) && this.bbscore.endTurnsOnLiveUpdate) {\n            this.bbscore.onLiveHelperEnableClicked(false);\n            stop = true;\n          }\n          break;\n      }\n    } else if (e.ctrlKey && !e.altKey && !e.shiftKey) {\n      switch (e.key.toLowerCase()) {\n        case 'c':\n          if (!window.getSelection().isCollapsed) {\n            //^C , do copy\n            var selectedText = window.getSelection().toString().replace(/\\u00a0/g, \" \");\n            this.bbscore.doCopy(selectedText);\n            stop = true;\n          }\n          break;\n        case 'a':\n          this.bbscore.doSelectAll();\n          stop = true;\n          break;\n      }\n    } else if (e.ctrlKey && !e.altKey && e.shiftKey) {\n      switch (e.key.toLowerCase()) {\n        case 'V':\n          this.bbscore.doPaste();\n          stop = true;\n          break;\n      }\n    }\n    if (stop) {\n      e.preventDefault();\n      return;\n    }\n\n    this._keyboard.onKeyDown(e);\n    if (e.defaultPrevented) return;\n  },\n\n  setTermFontSize: function setTermFontSize(cw, ch) {\n    var innerBounds = this.innerBounds;\n    this.chw = cw;\n    this.chh = ch;\n    var fontSize = this.chh + 'px';\n    var mainWidth = this.chw * this.buf.cols + 10 + 'px';\n    this.mainDisplay.style.fontSize = fontSize;\n    this.mainDisplay.style.lineHeight = fontSize;\n    this.bbsCursor.style.fontSize = fontSize;\n    this.bbsCursor.style.lineHeight = fontSize;\n    this.mainDisplay.style.overflowX = 'hidden';\n    this.mainDisplay.style.overflowY = 'auto';\n    this.mainDisplay.style.textAlign = 'left';\n    this.mainDisplay.style.width = mainWidth;\n\n    this.lastRowDiv.style.fontSize = fontSize;\n    this.lastRowDiv.style.width = mainWidth;\n\n    this.replyRowDiv.style.fontSize = fontSize;\n    this.replyRowDiv.style.width = mainWidth;\n    if (this.verticalAlignCenter && this.chh * this.buf.rows < innerBounds.height) this.mainDisplay.style.marginTop = (innerBounds.height - this.chh * this.buf.rows) / 2 + this.bbsViewMargin + 'px';else this.mainDisplay.style.marginTop = this.bbsViewMargin + 'px';\n    if (this.fontFitWindowWidth) {\n      this.scaleX = Math.floor(innerBounds.width / (this.chw * this.buf.cols + 10) * 100) / 100;\n      this.scaleY = Math.floor(innerBounds.height / (this.chh * this.buf.rows) * 100) / 100;\n    } else {\n      this.scaleX = 1;\n      this.scaleY = 1;\n    }\n\n    var scaleCss = 'none';\n    if (this.scaleX != 1 || this.scaleY != 1) {\n      //this.mainDisplay.style.transform = 'scaleX('+this.scaleX+')'; // chrome not stable support yet!\n      scaleCss = 'scale(' + this.scaleX + ',' + this.scaleY + ')';\n      var transOrigin = 'left';\n      if (this.horizontalAlignCenter) {\n        transOrigin = 'center';\n      }\n      this.mainDisplay.style.webkitTransformOriginX = transOrigin;\n      this.lastRowDiv.style.webkitTransformOriginX = transOrigin;\n      this.replyRowDiv.style.webkitTransformOriginX = transOrigin;\n      this.lastRowDiv.style.webkitTransformOriginY = '-1100%'; // somehow these are the right value\n      this.replyRowDiv.style.webkitTransformOriginY = '-1010%';\n    } else {\n      this.lastRowDiv.style.webkitTransformOriginY = '';\n      this.replyRowDiv.style.webkitTransformOriginY = '';\n    }\n    this.mainDisplay.style.webkitTransform = scaleCss;\n    this.lastRowDiv.style.webkitTransform = scaleCss;\n    this.replyRowDiv.style.webkitTransform = scaleCss;\n\n    this.firstGridOffset = this.bbscore.getFirstGridOffsets();\n\n    this.updateReverseScaleCss();\n    this.updateCursorPos();\n  },\n\n  updateReverseScaleCss: function updateReverseScaleCss() {\n    var rule = 'img.hyperLinkPreview { ' + '-webkit-transform: scale(' + Math.floor(1 / this.scaleX * 100) / 100 + ',' + Math.floor(1 / this.scaleY * 100) / 100 + ');' + ' }';\n    while (this.dynamicCss.cssRules.length > 0) {\n      this.dynamicCss.deleteRule(0);\n    }\n    this.dynamicCss.insertRule(rule, this.dynamicCss.cssRules.length);\n  },\n\n  convertMN2XYEx: function convertMN2XYEx(cx, cy) {\n    var origin;\n    var w = this.innerBounds.width;\n    var h = this.innerBounds.height;\n    if (this.horizontalAlignCenter && (this.scaleX != 1 || this.scaleY != 1)) origin = [(w - (this.chw * this.buf.cols + 10) * this.scaleX) / 2 + this.bbsViewMargin, (h - this.chh * this.buf.rows * this.scaleY) / 2 + this.bbsViewMargin];else origin = [this.firstGridOffset.left, this.firstGridOffset.top];\n    var realX = origin[0] + cx * this.chw * this.scaleX;\n    var realY = origin[1] + cy * this.chh * this.scaleY;\n    return [realX, realY];\n  },\n\n  checkLeftDB: function checkLeftDB() {\n    if (this.dbcsDetect && this.buf.cur_x > 1) {\n      var lines = this.buf.lines;\n      var line = lines[this.buf.cur_y];\n      var ch = line[this.buf.cur_x - 2];\n      if (ch.isLeadByte) return true;\n    }\n    return false;\n  },\n\n  checkCurDB: function checkCurDB() {\n    if (this.dbcsDetect) {\n      // && this.buf.cur_x<this.buf.cols-2){\n      var lines = this.buf.lines;\n      var line = lines[this.buf.cur_y];\n      var ch = line[this.buf.cur_x];\n      if (ch.isLeadByte) return true;\n    }\n    return false;\n  },\n\n  // Cursor\n  updateCursorPos: function updateCursorPos() {\n\n    var pos = this.convertMN2XYEx(this.buf.cur_x, this.buf.cur_y);\n    // if you want to set cursor color by now background, use this.\n    if (this.buf.cur_y >= this.buf.rows || this.buf.cur_x >= this.buf.cols) return; //sometimes, the value of this.buf.cur_x is 80 :(\n\n    var lines = this.buf.lines;\n    var line = lines[this.buf.cur_y];\n    var ch = line[this.buf.cur_x];\n    var bg = ch.getBg();\n\n    if (this.scaleX == 1 && this.scaleY == 1) {\n      this.bbsCursor.style.webkitTransform = 'none';\n      this.lastRowDiv.style.webkitTransformOriginY = '';\n      this.replyRowDiv.style.webkitTransformOriginY = '';\n    } else {\n      var scaleCss = 'scale(' + this.scaleX + ',' + this.scaleY + ')';\n      this.mainDisplay.style.webkitTransform = scaleCss;\n      this.lastRowDiv.style.webkitTransform = scaleCss;\n      this.replyRowDiv.style.webkitTransform = scaleCss;\n      this.bbsCursor.style.webkitTransform = scaleCss;\n      this.bbsCursor.style.webkitTransformOriginX = 'left';\n      this.lastRowDiv.style.webkitTransformOriginY = '-1100%';\n      this.replyRowDiv.style.webkitTransformOriginY = '-1010%';\n    }\n\n    this.bbsCursor.style.left = pos[0] + 'px';\n    this.bbsCursor.style.top = pos[1] - this.scaleY + 'px';\n    // if you want to set cursor color by now background, use this.\n    this.bbsCursor.style.color = _term_buf.termInvColors[bg];\n    this.updateInputBufferPos();\n  },\n\n  updateInputBufferPos: function updateInputBufferPos() {\n    if (this.input.getAttribute('bshow') == '1') {\n      var pos = this.convertMN2XYEx(this.buf.cur_x, this.buf.cur_y);\n      if (!this.hideInputBuffer) {\n        this.input.style.opacity = '1';\n        this.input.style.border = 'double';\n        if (this.inputBufferSizeType === 0) {\n          //this.input.style.width  = (this.chh-4)*10 + 'px';\n          this.input.style.fontSize = this.chh - 4 + 'px';\n          //this.input.style.lineHeight = this.chh+4 + 'px';\n          this.input.style.height = this.chh + 'px';\n        } else {\n          //this.input.style.width  = ((this.defineInputBufferSize*2)-4)*10 + 'px';\n          this.input.style.fontSize = this.defineInputBufferSize * 2 - 4 + 'px';\n          //this.input.style.lineHeight = this.bbscore.inputBufferSize*2+4 + 'px';\n          this.input.style.height = this.defineInputBufferSize * 2 + 'px';\n        }\n      } else {\n        this.input.style.border = 'none';\n        this.input.style.width = '0px';\n        this.input.style.height = '0px';\n        this.input.style.fontSize = this.chh + 'px';\n        this.input.style.opacity = '0';\n        //this.input.style.left = '-100000px';\n      }\n      var innerBounds = this.innerBounds;\n      var bbswinheight = innerBounds.height;\n      var bbswinwidth = innerBounds.width;\n      if (bbswinheight < pos[1] + parseFloat(this.input.style.height) + this.chh) this.input.style.top = pos[1] - parseFloat(this.input.style.height) - this.chh + 4 + 'px';else this.input.style.top = pos[1] + this.chh + 'px';\n\n      if (bbswinwidth < pos[0] + parseFloat(this.input.style.width)) this.input.style.left = bbswinwidth - parseFloat(this.input.style.width) - 10 + 'px';else this.input.style.left = pos[0] + 'px';\n\n      //this.input.style.left = pos[0] +'px';\n    }\n  },\n\n  updateInputBufferWidth: function updateInputBufferWidth() {\n    // change width according to input\n    var wordCounts = this.input.value.u2b().length;\n    // chh / 2 - 2 because border of 1\n    var oneWordWidth = this.chh / 2 - 2;\n    var width = oneWordWidth * wordCounts;\n    this.input.style.width = width + 'px';\n    var bounds = this.innerBounds;\n    if (parseInt(this.input.style.left) + width + oneWordWidth * 2 >= bounds.width) {\n      this.input.style.left = bounds.width - width - oneWordWidth * 2 + 'px';\n    }\n  },\n\n  onCompositionStart: function onCompositionStart(e) {\n    //this.input.disabled=\"\";\n    this.input.setAttribute('bshow', '1');\n    this.updateInputBufferPos();\n    this.isComposition = true;\n  },\n\n  onCompositionEnd: function onCompositionEnd(e) {\n    //this.input.disabled=\"\";\n    this.input.setAttribute('bshow', '0');\n    this.input.style.border = 'none';\n    this.input.style.width = '1px';\n    this.input.style.height = '1px';\n    this.input.style.left = '-100000px';\n    this.input.style.top = '-100000px';\n    this.input.style.opacity = '0';\n    //this.input.style.top = '0px';\n    //this.input.style.left = '-100000px';\n    this.isComposition = false;\n  },\n\n  fontResize: function fontResize() {\n    var cols = this.buf ? this.buf.cols : 80;\n    var rows = this.buf ? this.buf.rows : 24;\n\n    var innerBounds = this.innerBounds;\n    var fontWidth = this.bbsFontSize * 2;\n\n    if (this.screenType === 0 || this.screenType == 1) {\n      var width = this.bbsWidth ? this.bbsWidth : innerBounds.width;\n      var height = this.bbsHeight ? this.bbsHeight : innerBounds.height;\n      if (width === 0 || height === 0) return; // errors for openning in a new window\n      width -= 10; // for scroll bar\n\n      var o_h,\n          o_w,\n          i = 4;\n      var nowchh = this.chh;\n      var nowchw = this.chw;\n      do {\n        ++i;\n        nowchh = i * 2;\n        nowchw = i;\n        o_h = nowchh * 24;\n        o_w = nowchw * 80;\n      } while (o_h <= height && o_w <= width);\n      --i;\n      nowchh = i * 2;\n      nowchw = i;\n      this.setTermFontSize(nowchw, nowchh);\n      fontWidth = nowchh;\n    } else {\n      this.setTermFontSize(this.bbsFontSize, this.bbsFontSize * 2);\n    }\n    var forceWidthElems = document.querySelectorAll('.wpadding');\n    for (var i = 0; i < forceWidthElems.length; ++i) {\n      var forceWidthElem = forceWidthElems[i];\n      forceWidthElem.style.width = fontWidth + 'px';\n    }\n  },\n\n  countCol: function countCol(node, pos) {\n    var rowNode = void 0;\n    for (var r = node; r != r.parentNode; r = r.parentNode) {\n      if (r instanceof Element && r.getAttribute('data-type') == 'bbsline') {\n        rowNode = r;\n        break;\n      }\n    }\n    if (!rowNode) {\n      return { row: 0, col: 0 };\n    }\n\n    var col = 0;\n    var doCount = function doCount(cur) {\n      if (cur == node) {\n        col += cur.textContent.substring(0, pos).u2b().length;\n        return false;\n      }\n      if (cur.nodeName == '#text') {\n        col += cur.textContent.u2b().length;\n        return true;\n      }\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = cur.childNodes[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var e = _step.value;\n\n          if (!doCount(e)) {\n            return false;\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return true;\n    };\n    doCount(rowNode);\n\n    return {\n      row: parseInt(rowNode.getAttribute('data-row')),\n      col: col\n    };\n  },\n\n  getSelectionColRow: function getSelectionColRow() {\n    var r = window.getSelection().getRangeAt(0);\n    return {\n      start: this.countCol(r.startContainer, r.startOffset),\n      end: this.countCol(r.endContainer, r.endOffset)\n    };\n  },\n\n  setupPicPreviewOnHover: function setupPicPreviewOnHover() {\n    var self = this;\n    var aNodes = $([\".main a[href^='http://ppt.cc/']\", \".main a[type='p']\", \".main a[href^='http://imgur.com/']\", \".main a[href^='https://imgur.com/']\", \".main a[href^='http://i.imgur.com/']\", \".main a[href^='https://i.imgur.com/']\", \".main a[href^='https://flic.kr/p/']\", \".main a[href^='https://www.flickr.com/photos/']\"].join(\",\")).not([\"a[href^='http://imgur.com/a/']\", \"a[href^='https://imgur.com/a/']\", \"a[href^='http://imgur.com/gallery/']\", \"a[href^='https://imgur.com/gallery/']\"].join(\",\"));\n    var cont = document.getElementById('imagePreviewContainer');\n    var onover = function onover(e) {\n      (0, _image_preview.renderImagePreview)(cont, this.getAttribute('href'));\n    };\n    var onout = function onout(e) {\n      (0, _image_preview.renderImagePreview)(cont, null);\n    };\n    for (var i = 0; i < aNodes.length; ++i) {\n      var aNode = aNodes[i];\n      aNode.addEventListener('mouseover', onover);\n      aNode.addEventListener('mouseout', onout);\n    }\n  },\n\n  showWaterballNotification: function showWaterballNotification() {\n    if (!this.enableNotifications) {\n      return;\n    }\n    var app = this.bbscore;\n    //console.log('message from ' + this.waterball.userId + ': ' + this.waterball.message); \n    var title = app.waterball.userId + ' ' + (0, _i18n.i18n)('notification_said');\n    if (this.titleTimer) {\n      this.titleTimer.cancel();\n      this.titleTimer = null;\n    }\n    this.titleTimer = (0, _util.setTimer)(true, function () {\n      if (document.title == app.connectedUrl.site) {\n        document.title = title + ' ' + app.waterball.message;\n      } else {\n        document.title = app.connectedUrl.site;\n      }\n    }, 1500);\n    var options = {\n      icon: 'icon_128.png',\n      body: app.waterball.message,\n      tag: app.waterball.userId\n    };\n    this.notif = new Notification(title, options);\n    this.notif.onclick = function () {\n      window.focus();\n    };\n  },\n\n  populateEasyReadingPage: function populateEasyReadingPage() {\n    if (this.buf.pageState == 3 && this.buf.prevPageState == 3) {\n      this.mainContainer.style.paddingBottom = '1em';\n      var lastRowText = this.buf.getRowText(23, 0, this.buf.cols);\n      var result = lastRowText.parseStatusRow();\n      if (result) {\n        // row index start with 4 or below will cause duplicated first row of next page\n        // 2015-07-04: better way is to view the row 3 and row 4 as one wrapped line\n        /*\r\n        if (result.rowIndexStart < 5) {\r\n          result.rowIndexStart -= 1;\r\n        }\r\n        */\n        var rowOffset = this.buf.pageLines.length - 1;\n        var beginIndex = 1;\n        var atLastPage = false;\n        if (result.pageIndex == result.pageTotal && result.pagePercent == 100 || result.rowIndexStart != this.actualRowIndex) {\n          // at last page\n          atLastPage = result.rowIndexStart != this.actualRowIndex;\n          // find num of rows between actualRowIndex and rowIndexStart\n          var numRows = 0;\n          for (var i = result.rowIndexStart; i < this.actualRowIndex + 1; ++i) {\n            numRows += this.buf.pageWrappedLines[i];\n          }\n          beginIndex = numRows;\n          rowOffset -= beginIndex - 1;\n        }\n\n        for (var i = beginIndex; i < this.buf.rows - 1; ++i) {\n          if (i > 0 && this.buf.isTextWrappedRow(i - 1)) {\n            this.buf.pageWrappedLines[this.actualRowIndex] += 1;\n            // if the second row is the wrapped line from first row \n            if (!atLastPage && i == beginIndex) {\n              beginIndex++;\n            }\n          } else {\n            this.buf.pageWrappedLines[++this.actualRowIndex] = 1;\n          }\n        }\n        this.appendRows(this.buf.lines.slice(beginIndex, -1), true);\n        // deep clone lines for selection (getRowText and get ansi color)\n        this.buf.pageLines = this.buf.pageLines.concat(JSON.parse(JSON.stringify(this.buf.lines.slice(beginIndex, -1))));\n      }\n      this.buf.prevPageState = 3;\n    } else {\n      this.mainContainer.style.paddingBottom = '';\n      this.actualRowIndex = 0;\n      this.buf.pageWrappedLines = [];\n      if (this.buf.pageState == 3) {\n        var lastRowText = this.buf.getRowText(23, 0, this.buf.cols);\n        for (var i = 0; i < this.buf.rows - 1; ++i) {\n          if (i == 4 || i > 0 && this.buf.isTextWrappedRow(i - 1)) {\n            // row with i == 4 and the i == 3 is the wrapped line\n            this.buf.pageWrappedLines[this.actualRowIndex] += 1;\n          } else {\n            this.buf.pageWrappedLines[++this.actualRowIndex] = 1;\n          }\n        }\n        this.clearRows();\n        this.appendRows(this.buf.lines.slice(0, -1), true);\n        this.lastRowDiv.innerHTML = this.lastRowDivContent;\n        this.lastRowDiv.style.display = 'block';\n        // deep clone lines for selection (getRowText and get ansi color)\n        this.buf.pageLines = this.buf.pageLines.concat(JSON.parse(JSON.stringify(this.buf.lines.slice(0, -1))));\n      } else {\n        this.hideEasyReading();\n      }\n      this.buf.prevPageState = this.buf.pageState;\n    }\n  },\n\n  clearRows: function clearRows() {\n    this.mainContainer.innerHTML = '';\n    this.displayingRows = [];\n  },\n\n  appendRows: function appendRows(lines, showsLinkPreview) {\n    for (var i in lines) {\n      var line = lines[i];\n      var el = document.createElement('span');\n      el.setAttribute('type', 'bbsrow');\n      el.setAttribute('srow', this.mainContainer.childNodes.length);\n      this.mainContainer.appendChild(el);\n      var component = (0, _term_ui.renderRowHtml)(line, this.mainContainer.childNodes.length, this.chh, showsLinkPreview, el);\n      this.displayingRows.push(component);\n    }\n  },\n\n  renderSingleRow: function renderSingleRow(target, row) {\n    var el = document.createElement('span');\n    el.setAttribute('type', 'bbsrow');\n    el.setAttribute('srow', '0');\n    target.appendChild(el);\n    return (0, _term_ui.renderRowHtml)(row, 0, this.chh, false, el);\n  },\n\n  hideEasyReading: function hideEasyReading() {\n    this.lastRowDiv.style.display = '';\n    this.replyRowDiv.style.display = '';\n    // clear the deep cloned copy of lines\n    this.buf.pageLines = [];\n    this.clearRows();\n    this.appendRows(this.buf.lines, false);\n  },\n\n  updateEasyReadingReplyRow: function updateEasyReadingReplyRow(row) {\n    var el = document.createElement('span');\n    el.style = \"background-color:black;\";\n    this.renderSingleRow(el, row);\n    this.setSingleChild(this.replyRowDiv.childNodes[0], el);\n    this.replyRowDiv.style.display = 'block';\n  },\n\n  updateEasyReadingPushInitRow: function updateEasyReadingPushInitRow(row) {\n    var el = document.createElement('span');\n    el.style = \"background-color:black;\";\n    this.renderSingleRow(el, row);\n    this.setSingleChild(this.lastRowDiv.childNodes[0], el);\n  },\n\n  setSingleChild: function setSingleChild(par, child) {\n    while (par.childNodes.length > 0) {\n      par.removeChild(par.lastChild);\n    }par.appendChild(child);\n  }\n\n};\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar KeyMap = {\n  'Backspace': '\\b',\n  'Tab': '\\t',\n  'Enter': '\\r',\n  'Escape': '\\x1b',\n  'Home': '\\x1b[1~',\n  'Insert': '\\x1b[2~',\n  'Delete': '\\x1b[3~',\n  'End': '\\x1b[4~',\n  'PageUp': '\\x1b[5~',\n  'PageDown': '\\x1b[6~',\n  'ArrowUp': '\\x1b[A',\n  'ArrowDown': '\\x1b[B',\n  'ArrowRight': '\\x1b[C',\n  'ArrowLeft': '\\x1b[D'\n};\nvar CtrlShiftMap = {\n  '@': 50,\n  '^': 54,\n  '_': 109,\n  '?': 127,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221\n};\n// A -> 1\nfor (var i = 97; i <= 122; i++) {\n  CtrlShiftMap[String.fromCharCode(i)] = i - 96;\n}\n\n// FIXME: Under Mac, IME inputs will be sent as key of modified char.\n// Need to use key code directly.\n\nvar TermKeyboard = exports.TermKeyboard = function () {\n  // isLeftDB: function() -> bool\n  // isCurDB: function() -> bool\n  // send: function(data)\n  function TermKeyboard(isLeftDB, isCurDB, send) {\n    _classCallCheck(this, TermKeyboard);\n\n    this._checkLeftDB = isLeftDB;\n    this._checkCurDB = isCurDB;\n    this._sendFunc = send;\n  }\n\n  _createClass(TermKeyboard, [{\n    key: '_send',\n    value: function _send(data) {\n      this._sendFunc(data);\n      return true;\n    }\n  }, {\n    key: '_sendCharCode',\n    value: function _sendCharCode(code) {\n      return this._send(String.fromCharCode(code));\n    }\n  }, {\n    key: '_checkDB',\n    value: function _checkDB(key) {\n      switch (key) {\n        case 'Backspace':\n        case 'ArrowLeft':\n          return this._checkLeftDB();\n        case 'Delete':\n        case 'ArrowRight':\n          return this._checkCurDB();\n      }\n      return false;\n    }\n  }, {\n    key: 'onKeyDown',\n    value: function onKeyDown(e) {\n      if (this._onKeyDown(e)) e.preventDefault();\n    }\n  }, {\n    key: '_onKeyDown',\n    value: function _onKeyDown(e) {\n      // Windows/Command key.\n      if (e.getModifierState('Meta')) {\n        return false;\n      }\n\n      if (!e.ctrlKey && !e.altKey) {\n        // Shift-Insert as paste.\n        if (e.shiftKey && e.key == 'Insert') {\n          return false;\n        }\n\n        var mapped = KeyMap[e.key];\n        if (mapped) {\n          if (this._checkDB(e.key)) {\n            return this._send(mapped + mapped);\n          } else {\n            return this._send(mapped);\n          }\n        } else if (e.key.length == 1) {\n          // Normal char\n          return this._send(e.key);\n        }\n      } else if (e.ctrlKey && !e.altKey && !e.shiftKey) {\n        // Use lowercase no even capslock's on.\n        var key = e.key.length == 1 ? e.key.toLowerCase() : e.key;\n        var mappedCode = CtrlShiftMap[key];\n        if (mappedCode) {\n          return this._sendCharCode(mappedCode);\n        }\n      } else if (!e.ctrlKey && e.altKey && !e.shiftKey) {\n        // Remapped keys, which conflict browser shortcuts.\n        // Use lowercase no even capslock's on.\n        switch (e.key.toLowerCase()) {\n          case 'r':\n          case 't':\n          case 'w':\n            // Ctrl+key\n            return this._sendCharCode(e.key.toUpperCase().charCodeAt(0) - 64);\n        }\n      }\n      return false;\n    }\n  }]);\n\n  return TermKeyboard;\n}();\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.symbolTable = {};\nvar a = exports.symbolTable;\na.xa1 = 1;\na.xa0 = 1;\na.xa1 = 1;\na.xa4 = 1;\na.xa7 = 1;\na.xaa = 1;\na.xae = 1;\na.xaf = 1;\na.xb0 = 1;\na.xb1 = 1;\na.xb6 = 1;\na.xb7 = 1;\na.xb8 = 1;\na.xba = 1;\na.xbf = 1;\na.xc0 = 1;\na.xc1 = 1;\na.xc2 = 1;\na.xc3 = 1;\na.xc4 = 1;\na.xc5 = 1;\na.xc6 = 1;\na.xc7 = 1;\na.xc8 = 1;\na.xc9 = 1;\na.xca = 1;\na.xcb = 1;\na.xcc = 1;\na.xcd = 1;\na.xce = 1;\na.xcf = 1;\na.xd0 = 1;\na.xd1 = 1;\na.xd2 = 1;\na.xd3 = 1;\na.xd4 = 1;\na.xd5 = 1;\na.xd6 = 1;\na.xd7 = 1;\na.xd8 = 1;\na.xd9 = 1;\na.xda = 1;\na.xdb = 1;\na.xdc = 1;\na.xde = 1;\na.xdf = 1;\na.xe0 = 1;\na.xe1 = 1;\na.xe2 = 1;\na.xe3 = 1;\na.xe4 = 1;\na.xe5 = 1;\na.xe6 = 1;\na.xe7 = 1;\na.xe8 = 1;\na.xe9 = 1;\na.xea = 1;\na.xeb = 1;\na.xec = 1;\na.xed = 1;\na.xee = 1;\na.xef = 1;\na.xf0 = 1;\na.xf1 = 1;\na.xf2 = 1;\na.xf3 = 1;\na.xf4 = 1;\na.xf5 = 1;\na.xf6 = 1;\na.xf8 = 1;\na.xf9 = 1;\na.xfa = 1;\na.xfb = 1;\na.xfc = 1;\na.xfe = 1;\na.xff = 1;\na.x14a = 2;\na.x153 = 1;\na.x16b = 2;\na.x192 = 1;\na.x28c = 1;\na.x252 = 2;\na.x259 = 2;\na.x25a = 2;\na.x25c = 2;\na.x25d = 2;\na.x26f = 2;\na.x278 = 2;\na.x287 = 2;\na.x292 = 2;\na.x2a4 = 2;\na.x2a7 = 2;\na.x2cf = 2;\na.x414 = 2;\na.x41f = 2;\na.x430 = 2;\na.x431 = 1;\na.x432 = 2;\na.x433 = 2;\na.x434 = 2;\na.x435 = 2;\na.x436 = 2;\na.x437 = 2;\na.x438 = 2;\na.x439 = 2;\na.x43a = 1;\na.x43b = 1;\na.x43c = 2;\na.x43d = 2;\na.x43e = 1;\na.x43f = 2;\na.x440 = 1;\na.x441 = 2;\na.x442 = 2;\na.x445 = 2;\na.x446 = 2;\na.x44b = 2;\na.x44c = 2;\na.x44f = 2;\n\na.x1e3b = 2;\na.x1e43 = 2;\na.x1e49 = 1;\na.x1ef2 = 3; //[4block](type 2?)\na.x1ef3 = 1;\n\na.x2010 = 1;\na.x2027 = 1;\na.x211e = 1;\na.x2122 = 1;\na.x213b = 2;\na.x2157 = 1;\na.x215c = 2;\na.x21b2 = 1;\na.x21e6 = 1;\na.x21e8 = 1;\na.x21e9 = 1;\na.x2200 = 2;\na.x2202 = 1;\na.x222c = 2;\na.x2237 = 2;\na.x2282 = 2;\n\na.x2401 = 3; //code - start\na.x2402 = 3;\na.x2403 = 3;\na.x2404 = 3;\na.x2405 = 3;\na.x2406 = 3;\na.x2407 = 3;\na.x2408 = 3;\na.x2409 = 3;\na.x240a = 3;\na.x240b = 3;\na.x240c = 3;\na.x240d = 3;\na.x240e = 3;\na.x240f = 3;\na.x2410 = 3;\na.x2411 = 3;\na.x2412 = 3;\na.x2413 = 3;\na.x2414 = 3;\na.x2415 = 3;\na.x2416 = 3;\na.x2417 = 3;\na.x2418 = 3;\na.x2419 = 3;\na.x241a = 3;\na.x241b = 3;\na.x241c = 3;\na.x241d = 3;\na.x241e = 3;\na.x241f = 3;\na.x2421 = 3; //code - end\n\na.x246a = 2;\na.x246b = 2;\na.x246c = 2;\na.x246d = 2;\na.x246e = 2;\na.x246f = 2;\na.x2470 = 2;\na.x2471 = 2;\na.x2472 = 2;\na.x2473 = 2;\na.x2503 = 2;\na.x2601 = 2;\na.x2602 = 2;\na.x260e = 2;\na.x2611 = 2;\na.x261b = 2;\na.x261c = 2;\na.x261e = 2;\na.x261f = 2;\na.x2620 = 2;\na.x262f = 2;\na.x2630 = 2;\na.x2631 = 2;\na.x2632 = 2;\na.x2633 = 2;\na.x2634 = 2;\na.x2635 = 2;\na.x2636 = 2;\na.x2637 = 2;\na.x2639 = 1;\na.x263a = 2;\na.x263b = 2;\na.x263c = 2;\na.x263d = 2;\na.x2660 = 2;\na.x2661 = 1;\na.x2662 = 1;\na.x2663 = 2;\na.x2664 = 1;\na.x2665 = 2;\na.x2666 = 1;\na.x2667 = 1;\na.x266a = 1;\na.x266c = 2;\na.x2702 = 2;\na.x2708 = 2;\na.x2709 = 2;\na.x2713 = 2;\na.x2715 = 2;\na.x2721 = 2;\na.x2729 = 2;\na.x274f = 2;\na.x278e = 2;\na.x278f = 2;\na.x2790 = 2;\na.x2791 = 2;\na.x2792 = 2;\n//\na.xe11b = 3;\na.xe282 = 3;\na.xe568 = 3;\na.xe56b = 3;\na.xe686 = 3; //[4block] - start\na.xe687 = 3;\na.xe7e0 = 3;\na.xe9cc = 3;\na.xe9ce = 3;\na.xe9cf = 3;\na.xeb8b = 3;\na.xec63 = 3;\na.xec64 = 3;\na.xec65 = 3;\na.xec66 = 3;\na.xec67 = 3; //[4block] - end\n\na.xec6c = 1;\na.xec6a = 1;\n\na.xec6e = 3; //[4block] - start\na.xec71 = 3;\na.xec72 = 3;\na.xec73 = 3;\na.xec74 = 3;\na.xec71 = 3;\na.xec7c = 3;\na.xec7d = 3;\na.xec80 = 3;\na.xec83 = 3;\na.xec85 = 3;\na.xec86 = 3;\na.xec87 = 3;\na.xec88 = 3;\na.xec89 = 3;\na.xec8a = 3;\na.xec8b = 3;\na.xec8c = 3;\na.xec8d = 3;\na.xec8e = 3;\na.xec8f = 3;\na.xec90 = 3;\na.xec91 = 3;\na.xec9f = 3;\na.xeca0 = 3;\na.xeca1 = 3;\na.xeca3 = 3;\na.xeca4 = 3;\na.xeca5 = 3;\na.xeca6 = 3;\na.xeca7 = 3;\na.xeca8 = 3;\na.xeca9 = 3;\na.xeca3 = 3;\na.xecae = 3;\na.xecb5 = 3;\na.xecb6 = 3;\na.xecb8 = 3;\na.xecc1 = 3;\na.xecc2 = 3;\na.xecc8 = 3;\na.xecca = 3;\na.xeccb = 3;\na.xeccc = 3;\na.xeccd = 3;\na.xecce = 3;\na.xed91 = 3;\na.xed92 = 3;\na.xee1e = 3;\na.xee22 = 3;\na.xee58 = 3;\na.xee5a = 3;\na.xee5c = 3;\na.xee5e = 3;\na.xee5f = 3;\na.xeeb6 = 3; //[4block] - end\n\na.xf7e6 = 3; //[4block] - start\na.xf7e8 = 3;\na.xf7ee = 3;\na.xf7ef = 3;\na.xf7f0 = 3;\na.xf7f1 = 3;\na.xf7f2 = 3;\na.xf7f3 = 3;\na.xf7f4 = 3;\na.xf7f5 = 3;\na.xf7f6 = 3;\na.xf7f7 = 3;\na.xf7f8 = 3;\na.xf7f8 = 3;\na.xf7fa = 3; //[4block] - end\n\na.xf849 = 3; //[4block] - start\na.xf84a = 3;\na.xf84b = 3;\na.xf84c = 3;\na.xf84d = 3;\na.xf84e = 3;\na.xf84f = 3;\na.xf850 = 3;\na.xf851 = 3;\na.xf852 = 3;\na.xf853 = 3;\na.xf854 = 3;\na.xf855 = 3;\na.xf856 = 3;\na.xf857 = 3;\na.xf858 = 3;\na.xf859 = 3;\na.xf85a = 3;\na.xf85b = 3;\na.xf85c = 3;\na.xf85d = 3;\na.xf85e = 3;\na.xf85f = 3;\na.xf860 = 3;\na.xf861 = 3;\na.xf862 = 3;\na.xf863 = 3;\na.xf864 = 3;\na.xf865 = 3; //[4block] - end\n\na.xff61 = 1;\na.xff62 = 1;\na.xff63 = 1;\na.xff64 = 1;\na.xff65 = 1;\na.xff66 = 1;\na.xff67 = 1;\na.xff68 = 1;\na.xff69 = 1;\na.xff6a = 1;\na.xff6b = 1;\na.xff6c = 1;\na.xff6d = 1;\na.xff6e = 1;\na.xff6f = 1;\na.xff70 = 1;\na.xff71 = 1;\na.xff72 = 1;\na.xff73 = 1;\na.xff74 = 1;\na.xff75 = 1;\na.xff76 = 1;\na.xff77 = 1;\na.xff78 = 1;\na.xff79 = 1;\na.xff7a = 1;\na.xff7b = 1;\na.xff7c = 1;\na.xff7d = 1;\na.xff7e = 1;\na.xff7f = 1;\na.xff80 = 1;\na.xff81 = 1;\na.xff82 = 1;\na.xff83 = 1;\na.xff84 = 1;\na.xff85 = 1;\na.xff86 = 1;\na.xff87 = 1;\na.xff88 = 1;\na.xff89 = 1;\na.xff8a = 1;\na.xff8b = 1;\na.xff8c = 1;\na.xff8d = 1;\na.xff8e = 1;\na.xff8f = 1;\na.xff90 = 1;\na.xff91 = 1;\na.xff92 = 1;\na.xff93 = 1;\na.xff94 = 1;\na.xff95 = 1;\na.xff96 = 1;\na.xff97 = 1;\na.xff98 = 1;\na.xff99 = 1;\na.xff9a = 1;\na.xff9b = 1;\na.xff9c = 1;\na.xff9d = 1;\na.xff9e = 1;\na.xff9f = 1;\na.xfffd = 3;\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n'use struct';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ImageURL = exports.ImageURL = function () {\n  function ImageURL() {\n    _classCallCheck(this, ImageURL);\n  }\n\n  _createClass(ImageURL, null, [{\n    key: 'register',\n    value: function register(clazz) {\n      if (!this._providers) {\n        this._providers = [];\n      }\n      this._providers.push(clazz);\n    }\n  }, {\n    key: 'create',\n    value: function create(href) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this._providers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var provider = _step.value;\n\n          var instance = provider.create(href);\n          if (instance) {\n            return instance;\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return ImageURL;\n}();\n\nvar FlickrImageURL = function () {\n  _createClass(FlickrImageURL, null, [{\n    key: 'base58_decode',\n\n    // To decode base58 of flickr photo id\n    // ref: https://www.flickr.com/groups/51035612836@N01/discuss/72157616713786392/72157620931323757\n    value: function base58_decode(snipcode) {\n      var alphabet = '123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ';\n      var num = snipcode.length;\n      var decoded = 0;\n      var multi = 1;\n      for (var i = num - 1; i >= 0; i--) {\n        decoded = decoded + multi * alphabet.indexOf(snipcode[i]);\n        multi = multi * alphabet.length;\n      }\n      return decoded;\n    }\n  }, {\n    key: 'create',\n    value: function create(href) {\n      var found_flickr = href.match('flic\\.kr\\/p\\/\\(\\\\w\\+\\)|flickr\\.com\\/photos\\/[\\\\w@]\\+\\/\\(\\\\d\\+\\)');\n      if (!found_flickr) {\n        return null;\n      }\n      var flickrBase58Id = found_flickr[1];\n      var flickrPhotoId = flickrBase58Id ? this.base58_decode(flickrBase58Id) : found_flickr[2];\n      return new FlickrImageURL(flickrPhotoId);\n    }\n  }]);\n\n  function FlickrImageURL(photoID) {\n    _classCallCheck(this, FlickrImageURL);\n\n    this._photoID = photoID;\n  }\n\n  _createClass(FlickrImageURL, [{\n    key: 'fetchSrc',\n    value: function fetchSrc() {\n      var apiURL = \"https://api.flickr.com/services/rest/\" + \"?method=flickr.photos.getInfo\" + \"&api_key=c8c95356e465b8d7398ff2847152740e\" + \"&photo_id=\" + encodeURIComponent(this._photoID) + \"&format=json\" + \"&jsoncallback=?\";\n      return new Promise(function (resolve, reject) {\n        $.getJSON(apiURL, function (data) {\n          if (data.photo) {\n            var p = data.photo;\n            var src = \"https://farm\" + p.farm + \".staticflickr.com/\" + p.server + \"/\" + p.id + \"_\" + p.secret + \".jpg\";\n            resolve(src);\n          } else {\n            reject();\n          }\n        });\n      });\n    }\n  }]);\n\n  return FlickrImageURL;\n}();\n\nImageURL.register(FlickrImageURL);\n\nvar ImgurImageURL = function () {\n  _createClass(ImgurImageURL, null, [{\n    key: 'create',\n    value: function create(href) {\n      if (href.match('^https?://(i\\.)?imgur\\.com/')) {\n        return new ImgurImageURL(href);\n      }\n      return null;\n    }\n  }]);\n\n  function ImgurImageURL(href) {\n    _classCallCheck(this, ImgurImageURL);\n\n    this._href = href;\n  }\n\n  _createClass(ImgurImageURL, [{\n    key: 'fetchSrc',\n    value: function fetchSrc() {\n      var src = this._href.replace(/^https?:\\/\\/imgur.com/, 'https://i.imgur.com') + '.jpg';\n      return Promise.resolve(src);\n    }\n  }]);\n\n  return ImgurImageURL;\n}();\n\nImageURL.register(ImgurImageURL);\n\nvar GenericImageURL = function () {\n  function GenericImageURL() {\n    _classCallCheck(this, GenericImageURL);\n  }\n\n  _createClass(GenericImageURL, [{\n    key: 'fetchSrc',\n    value: function fetchSrc() {\n      return Promise.reject('not implemented');\n    }\n  }], [{\n    key: 'create',\n    value: function create(href) {\n      // TODO: add support for common suffixes.\n      return null;\n    }\n  }]);\n\n  return GenericImageURL;\n}();\n\nImageURL.register(GenericImageURL);\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.en_US = {\n  \"appName\": {\n    \"message\": \"PttChrome\",\n    \"description\": \"The title of the application, displayed in the web store.\"\n  },\n  \"appDesc\": {\n    \"message\": \"A GNU/GPL telnet client extension specifically designed for BBS browsing.\",\n    \"description\": \"The description of the application, displayed in the web store.\"\n  },\n\n  // side menus\n  \"menu_coloredCopy\": {\n    \"message\": \"Copy with ANSI color\"\n  },\n  \"menu_goToOtherSite\": {\n    \"message\": \"Other site\"\n  },\n  \"menu_paste\": {\n    \"message\": \"Paste\"\n  },\n  \"menu_selectAll\": {\n    \"message\": \"Select all\"\n  },\n  \"menu_mouseBrowsing\": {\n    \"message\": \"Mouse\"\n  },\n  \"menu_settings\": {\n    \"message\": \"Settings\"\n  },\n\n  // context menus\n  \"cmenu_copy\": {\n    \"message\": \"Copy\"\n  },\n  \"cmenu_copyAnsi\": {\n    \"message\": \"Copy with ANSI colors\"\n  },\n  \"cmenu_paste\": {\n    \"message\": \"Paste\"\n  },\n  \"cmenu_selectAll\": {\n    \"message\": \"Select all\"\n  },\n  \"cmenu_searchGoogle\": {\n    \"message\": \"Search Google for\"\n  },\n  \"cmenu_quickSearch\": {\n    \"message\": \"Quick Search\"\n  },\n  \"cmenu_openUrlNewTab\": {\n    \"message\": \"Open link in new tab\"\n  },\n  \"cmenu_copyLinkUrl\": {\n    \"message\": \"Copy link address\"\n  },\n  \"cmenu_mouseBrowsing\": {\n    \"message\": \"Mouse browsing\"\n  },\n  \"cmenu_goToOtherSite\": {\n    \"message\": \"Go to other site ...\"\n  },\n  \"cmenu_showInputHelper\": {\n    \"message\": \"Input helper ...\"\n  },\n  \"cmenu_showLiveArticleHelper\": {\n    \"message\": \"Live article helper ...\"\n  },\n  \"cmenu_addBlacklistUserId\": {\n    \"message\": \"Add blacklist user\"\n  },\n  \"cmenu_removeBlacklistUserId\": {\n    \"message\": \"Remove blacklist user\"\n  },\n  \"cmenu_settings\": {\n    \"message\": \"Settings\"\n  },\n  \"cmenu_restartInTab\": {\n    \"message\": \"Restart PttChrome in a new tab\"\n  },\n\n  // options nav\n  \"options_general\": {\n    \"message\": \"General\"\n  },\n  \"options_autologin\": {\n    \"message\": \"Auto login\"\n  },\n  \"options_blacklist\": {\n    \"message\": \"Blacklist\"\n  },\n  \"options_extensions\": {\n    \"message\": \"Extensions\"\n  },\n  \"options_about\": {\n    \"message\": \"About\"\n  },\n\n  // options\n  \"options_openInPackagedApp\": {\n    \"message\": \"Launch PttChrome in packaged app.\"\n  },\n  \"options_closeQuery\": {\n    \"message\": \"Ask before closing tab.\"\n  },\n  \"options_enablePicPreview\": {\n    \"message\": \"Enable preview when hover on image URLs.\"\n  },\n  \"options_enableNotifications\": {\n    \"message\": \"Enable notifications when a message is received.\"\n  },\n  \"options_enableEasyReading\": {\n    \"message\": \"Enable easy reading article view.\"\n  },\n  \"options_endTurnsOnLiveUpdate\": {\n    \"message\": \"Press END turns on pushthread live update.\"\n  },\n  \"options_copyOnSelect\": {\n    \"message\": \"Copy text when selected.\"\n  },\n  \"options_enableDeleteDupLogin\": {\n    \"message\": \"When asked to disconnect other logged-in connections, answer:\"\n  },\n  \"options_preferences\": {\n    \"message\": \"Preferences\"\n  },\n  \"options_antiIdleTime\": {\n    \"message\": \"Anti-idle interval (sec)\"\n  },\n  \"options_lineWrap\": {\n    \"message\": \"Wrap line for pasting text longer than\"\n  },\n  \"options_reset\": {\n    \"message\": \"Restore defaults\"\n  },\n  \"options_appearance\": {\n    \"message\": \"Appearance\"\n  },\n  \"options_bbsMargin\": {\n    \"message\": \"Margins around BBS view (px)\"\n  },\n  \"options_fontFitWindowWidth\": {\n    \"message\": \"Stretch font to fill the view\"\n  },\n  \"options_fontFace\": {\n    \"message\": \"Font face\"\n  },\n  \"options_mouse\": {\n    \"message\": \"Mouse\"\n  },\n  \"options_mouseBrowsing\": {\n    \"message\": \"Mouse browsing\"\n  },\n  \"options_useMouseBrowsing\": {\n    \"message\": \"Mouse browsing on start\"\n  },\n  \"options_mouseBrowsingHighlight\": {\n    \"message\": \"Mouse browsing highlight effect\"\n  },\n  \"options_highlightColor\": {\n    \"message\": \"Color\"\n  },\n  \"options_mouseLeftFunction\": {\n    \"message\": \"Mouse left button\"\n  },\n  \"options_mouseMiddleFunction\": {\n    \"message\": \"Mouse middle button\"\n  },\n  \"options_mouseWheelFunction1\": {\n    \"message\": \"Mouse wheel\"\n  },\n  \"options_mouseWheelFunction2\": {\n    \"message\": \"Right mouse key + mouse wheel\"\n  },\n  \"options_mouseWheelFunction3\": {\n    \"message\": \"Left mouse key + mouse wheel\"\n  },\n  \"options_none\": {\n    \"message\": \"No action\"\n  },\n  \"options_doPaste\": {\n    \"message\": \"Perform 'Paste'\"\n  },\n  \"options_leftKey\": {\n    \"message\": \"Sends LEFT key\"\n  },\n  \"options_rightKey\": {\n    \"message\": \"Sends RIGHT key\"\n  },\n  \"options_enterKey\": {\n    \"message\": \"Sends ENTER key\"\n  },\n  \"options_upDown\": {\n    \"message\": \"Controls up / down\"\n  },\n  \"options_pageUpDown\": {\n    \"message\": \"Controls pageup / pagedown\"\n  },\n  \"options_threadLastNext\": {\n    \"message\": \"Controls thread previous / next\"\n  },\n  \"options_enableBlacklist\": {\n    \"message\": \"Enable user blacklist feature\"\n  },\n  \"options_blacklistInstruction\": {\n    \"message\": \"Type in the usernames in the textarea below, one per line\"\n  },\n\n  // auto logins\n  \"autologin_username\": {\n    \"message\": \"Username\"\n  },\n  \"autologin_password\": {\n    \"message\": \"Password\"\n  },\n  \"autologin_warning\": {\n    \"message\": \"Login info is not encrypted, DO NOT use on a public machine\"\n  },\n\n  // extensions\n  \"ext_quickSearch\": {\n    \"message\": \"Quick Search\"\n  },\n  \"ext_addQuickSearchNamePlaceholder\": {\n    \"message\": \"Add search engine\"\n  },\n  \"ext_addQuickSearchQueryPlaceholder\": {\n    \"message\": \"URL with %s in place of query\"\n  },\n\n  // about page\n  \"about_appName_subtitle\": {\n    \"message\": \"An open source BBS client\"\n  },\n  \"about_description\": {\n    \"message\": \"Originally written by #link_github_iamchucky#. This is a modified version by #link_github_robertabcd#. It supports connecting over Websocket, and works on most browsers.\"\n  },\n  \"about_version_title\": {\n    \"message\": \"Version\"\n  },\n  \"about_version_current\": {\n    \"message\": \"This version: #link_robertabcd_PttChrome#, #link_GPL20#.\"\n  },\n  \"about_version_original\": {\n    \"message\": \"Original version: webapp12 6/2/2015, #link_iamchucky_PttChrome#, #link_GPL20#.\"\n  },\n  \"about_new_title\": {\n    \"message\": \"What's new\"\n  },\n  \"about_new_content\": {\n    \"message\": ['Allow setting keepAlive from url, append ?keepAlive=[SECONDS] to the URL', 'Added SSH connection to PTT, append ?ssh=true to the URL', 'Limited easy reading mode to ptt.cc only', 'Added features to load/backup blacklist with Google Drive', 'Suggest to try port 443 when disconnected', 'Settings to answer duplicated connection query in autologin settings', 'Added Live Article Helper in context menu to auto refresh pushthread, or use Alt + r', 'Switching easy reading mode in settings no longer require a restart', 'Disabled hammerjs that caused mouse related issue on old Chrome verisons', 'Fixing bug with spacebar when in chinese input mode and easy reading mode', 'Fixing ssh connection problem with kex', 'Added option to ask before closing', 'Added setting to send right arrow key to left mouse button', 'Added option to turn on live update with END', 'Middle mouse button click has new option to do paste', 'Added option to enable copy on select', 'Added Quick Search in settings and context menu (thanks to abccbaandy)']\n  },\n\n  // alerts\n  \"alert_developerModeHeader\": {\n    \"message\": \"Developer Mode\"\n  },\n  \"alert_developerModeText\": {\n    \"message\": \"You are using developer mode. Things may break in this version of PttChrome. Use this at your own risk.\"\n  },\n  \"alert_developerModeDismiss\": {\n    \"message\": \"Yes, I understand.\"\n  },\n\n  \"alert_connectionHeader\": {\n    \"message\": \"You are disconnected!\"\n  },\n  \"alert_connectionText\": {\n    \"message\": \"Would you like to reconnect to the site?\"\n  },\n  \"alert_connectionReconnect\": {\n    \"message\": \"Reconnect (ENTER)\"\n  },\n  \"alert_connectionPortOption1\": {\n    \"message\": \"or\"\n  },\n  \"alert_connectionPortOption2\": {\n    \"message\": \"Try with port 443\"\n  },\n\n  \"alert_pasteShortcutHeader\": {\n    \"message\": \"Paste\"\n  },\n  \"alert_pasteShortcutText\": {\n    \"message\": \"Please use Shift+Insert to paste\"\n  },\n  \"alert_pasteShortcutClose\": {\n    \"message\": \"OK\"\n  },\n\n  // notifications\n  \"notification_said\": {\n    \"message\": \"says:\"\n  },\n\n  \"input_sitePlaceholder\": {\n    \"message\": \"input URL here and then press ENTER\"\n  },\n\n  // input helper\n  \"inputHelperTitle\": {\n    \"message\": \"Input helper\"\n  },\n  \"colorTitle\": {\n    \"message\": \"Color\"\n  },\n  \"colorHelperSend\": {\n    \"message\": \"Send ANSI color code\"\n  },\n  \"colorHelperSendMenuFore\": {\n    \"message\": \"Send foreground only\"\n  },\n  \"colorHelperSendMenuBack\": {\n    \"message\": \"Send background only\"\n  },\n  \"colorHelperSendMenuReset\": {\n    \"message\": \"Send reset code\"\n  },\n  \"colorHelperBlink\": {\n    \"message\": \"Blink\"\n  },\n  \"colorHelperPreview\": {\n    \"message\": \"▅ PREVIEW ▅\"\n  },\n  \"colorHelperTooltip1\": {\n    \"message\": \"Left click: foreground color\"\n  },\n  \"colorHelperTooltip2\": {\n    \"message\": \"Right click: background color, upper row only\"\n  },\n\n  // symbols\n  \"symTitle\": {\n    \"message\": \"Symbols\"\n  },\n  \"symTitle_general\": {\n    \"message\": \"General\"\n  },\n  \"symTitle_lineBorders\": {\n    \"message\": \"Line borders\"\n  },\n  \"symTitle_blocks\": {\n    \"message\": \"Blocks\"\n  },\n  \"symTitle_lines\": {\n    \"message\": \"Lines\"\n  },\n  \"symTitle_special\": {\n    \"message\": \"Special\"\n  },\n  \"symTitle_brackets\": {\n    \"message\": \"Brackets\"\n  },\n  \"symTitle_greek\": {\n    \"message\": \"Greek\"\n  },\n  \"symTitle_phonetic\": {\n    \"message\": \"Phonetic\"\n  },\n  \"symTitle_math\": {\n    \"message\": \"Math\"\n  },\n  \"symTitle_hiragana\": {\n    \"message\": \"Hiragana\"\n  },\n  \"symTitle_katakana\": {\n    \"message\": \"Katakana\"\n  },\n\n  // emoticons\n  \"emoTitle\": {\n    \"message\": \"Emoticons\"\n  },\n  \"emoTitle_angry\": {\n    \"message\": \"Angry\"\n  },\n  \"emoTitle_meh\": {\n    \"message\": \"Meh\"\n  },\n  \"emoTitle_sweat\": {\n    \"message\": \"Sweat & awkward\"\n  },\n  \"emoTitle_happy\": {\n    \"message\": \"Happy\"\n  },\n  \"emoTitle_other\": {\n    \"message\": \"Others\"\n  },\n\n  // live helper\n  \"liveHelperEnable\": {\n    \"message\": \"Enable\"\n  },\n  \"liveHelperSpan\": {\n    \"message\": \"pushthread refreshes every\"\n  },\n  \"liveHelperSpanSec\": {\n    \"message\": \"sec\"\n  },\n\n  // tooltips\n  \"tooltip_antiIdleTime\": {\n    \"message\": \"Input 0 to disable this feature.\"\n  },\n  \"tooltip_fontFace\": {\n    \"message\": \"Separate each font with a comma, start with the desired font and end with a generic font.\"\n  }\n\n};\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nexports.zh_TW = {\n  \"appName\": {\n    \"message\": \"PttChrome\",\n    \"description\": \"The title of the application, displayed in the web store.\"\n  },\n  \"appDesc\": {\n    \"message\": \"專為 BBS 瀏覽設計，採 GNU/GPL 授權的 telnet 連線程式套件\",\n    \"description\": \"The description of the application, displayed in the web store.\"\n  },\n\n  // side menus\n  \"menu_coloredCopy\": {\n    \"message\": \"複製 (包含 ANSI 顏色)\"\n  },\n  \"menu_goToOtherSite\": {\n    \"message\": \"其他站台\"\n  },\n  \"menu_paste\": {\n    \"message\": \"貼上\"\n  },\n  \"menu_selectAll\": {\n    \"message\": \"全選\"\n  },\n  \"menu_mouseBrowsing\": {\n    \"message\": \"滑鼠瀏覽\"\n  },\n  \"menu_settings\": {\n    \"message\": \"設定\"\n  },\n\n  // context menus\n  \"cmenu_copy\": {\n    \"message\": \"複製\"\n  },\n  \"cmenu_copyAnsi\": {\n    \"message\": \"複製 (包含 ANSI 顏色)\"\n  },\n  \"cmenu_paste\": {\n    \"message\": \"貼上\"\n  },\n  \"cmenu_selectAll\": {\n    \"message\": \"全選\"\n  },\n  \"cmenu_searchGoogle\": {\n    \"message\": \"在 Google 上搜尋\"\n  },\n  \"cmenu_quickSearch\": {\n    \"message\": \"快速搜尋\"\n  },\n  \"cmenu_openUrlNewTab\": {\n    \"message\": \"在新分頁中開啟連結\"\n  },\n  \"cmenu_copyLinkUrl\": {\n    \"message\": \"複製連結網址\"\n  },\n  \"cmenu_mouseBrowsing\": {\n    \"message\": \"滑鼠瀏覽\"\n  },\n  \"cmenu_goToOtherSite\": {\n    \"message\": \"去其他站台 ...\"\n  },\n  \"cmenu_showInputHelper\": {\n    \"message\": \"輸入小幫手 ...\"\n  },\n  \"cmenu_showLiveArticleHelper\": {\n    \"message\": \"Live 文小幫手 ...\"\n  },\n  \"cmenu_addBlacklistUserId\": {\n    \"message\": \"在黑名單裡加入使用者\"\n  },\n  \"cmenu_removeBlacklistUserId\": {\n    \"message\": \"在黑名單裡移除使用者\"\n  },\n  \"cmenu_settings\": {\n    \"message\": \"設定\"\n  },\n  \"cmenu_restartInTab\": {\n    \"message\": \"在新分頁重新開啟 PttChrome\"\n  },\n\n  // options nav\n  \"options_general\": {\n    \"message\": \"一般\"\n  },\n  \"options_autologin\": {\n    \"message\": \"自動登入\"\n  },\n  \"options_blacklist\": {\n    \"message\": \"黑名單\"\n  },\n  \"options_extensions\": {\n    \"message\": \"額外功能\"\n  },\n  \"options_about\": {\n    \"message\": \"關於\"\n  },\n\n  // options\n  \"options_openInPackagedApp\": {\n    \"message\": \"'批' 圖示會在獨立視窗開啟 PttChrome\"\n  },\n  \"options_closeQuery\": {\n    \"message\": \"關閉分頁時先詢問\"\n  },\n  \"options_enablePicPreview\": {\n    \"message\": \"當滑鼠在圖片連結上時顯示圖片預覽\"\n  },\n  \"options_enableNotifications\": {\n    \"message\": \"啟用水球通知\"\n  },\n  \"options_enableEasyReading\": {\n    \"message\": \"啟用文章好讀模式\"\n  },\n  \"options_endTurnsOnLiveUpdate\": {\n    \"message\": \"END 啟用推文即時更新 (如 Alt + r)\"\n  },\n  \"options_copyOnSelect\": {\n    \"message\": \"選取文字時自動複製文字\"\n  },\n  \"options_enableDeleteDupLogin\": {\n    \"message\": \"當被問到是否刪除其他重複登入的連線，回答:\"\n  },\n  \"options_preferences\": {\n    \"message\": \"設定\"\n  },\n  \"options_antiIdleTime\": {\n    \"message\": \"防閒置間隔 (秒)\"\n  },\n  \"options_lineWrap\": {\n    \"message\": \"自動換行, 當貼上的字長於\"\n  },\n  \"options_reset\": {\n    \"message\": \"設回預設值\"\n  },\n  \"options_appearance\": {\n    \"message\": \"介面\"\n  },\n  \"options_bbsMargin\": {\n    \"message\": \"BBS 周圍邊距 (像素)\"\n  },\n  \"options_fontFitWindowWidth\": {\n    \"message\": \"把字體拉大來補滿畫面\"\n  },\n  \"options_fontFace\": {\n    \"message\": \"字型\"\n  },\n  \"options_mouseBrowsing\": {\n    \"message\": \"滑鼠瀏覽\"\n  },\n  \"options_useMouseBrowsing\": {\n    \"message\": \"預設使用滑鼠瀏覽\"\n  },\n  \"options_mouseBrowsingHighlight\": {\n    \"message\": \"啟用滑鼠瀏覽的底色效果\"\n  },\n  \"options_highlightColor\": {\n    \"message\": \"底色\"\n  },\n  \"options_mouseLeftFunction\": {\n    \"message\": \"滑鼠左鍵\"\n  },\n  \"options_mouseMiddleFunction\": {\n    \"message\": \"滑鼠中鍵\"\n  },\n  \"options_mouseWheelFunction1\": {\n    \"message\": \"滑鼠滾輪\"\n  },\n  \"options_mouseWheelFunction2\": {\n    \"message\": \"滑鼠右鍵 + 滑鼠滾輪\"\n  },\n  \"options_mouseWheelFunction3\": {\n    \"message\": \"滑鼠左鍵 + 滑鼠滾輪\"\n  },\n  \"options_none\": {\n    \"message\": \"無動作\"\n  },\n  \"options_doPaste\": {\n    \"message\": \"執行 '貼上'\"\n  },\n  \"options_leftKey\": {\n    \"message\": \"送出左方向鍵\"\n  },\n  \"options_rightKey\": {\n    \"message\": \"送出右方向鍵\"\n  },\n  \"options_enterKey\": {\n    \"message\": \"送出ENTER鍵\"\n  },\n  \"options_upDown\": {\n    \"message\": \"控制上 / 下\"\n  },\n  \"options_pageUpDown\": {\n    \"message\": \"控制上頁 / 下頁\"\n  },\n  \"options_threadLastNext\": {\n    \"message\": \"控制文章前篇 / 下篇\"\n  },\n  \"options_enableBlacklist\": {\n    \"message\": \"啟用使用者黑名單功能\"\n  },\n  \"options_blacklistInstruction\": {\n    \"message\": \"請在下面輸入所有欲加入黑名單的使用者ID, 每行一個\"\n  },\n\n  // auto logins\n  \"autologin_username\": {\n    \"message\": \"帳號\"\n  },\n  \"autologin_password\": {\n    \"message\": \"密碼\"\n  },\n  \"autologin_warning\": {\n    \"message\": \"帳號密碼沒有加密儲存, 千萬不要在公用電腦上使用\"\n  },\n\n  // extensions\n  \"ext_quickSearch\": {\n    \"message\": \"快速搜尋\"\n  },\n  \"ext_addQuickSearchNamePlaceholder\": {\n    \"message\": \"新增搜尋引擎\"\n  },\n  \"ext_addQuickSearchQueryPlaceholder\": {\n    \"message\": \"網址以 %s 取代網址中的搜尋字詞\"\n  },\n\n  // about page\n  \"about_appName_subtitle\": {\n    \"message\": \"開放原始碼的 BBS 瀏覽軟體\"\n  },\n  \"about_description\": {\n    \"message\": \"原作者為 #link_github_iamchucky#。此版本是由 #link_github_robertabcd# 修改，使用 Websocket 加密連線，並支援大多數瀏覽器。\"\n  },\n  \"about_version_title\": {\n    \"message\": \"版本\"\n  },\n  \"about_version_current\": {\n    \"message\": \"此版本：#link_robertabcd_PttChrome#, #link_GPL20#.\"\n  },\n  \"about_version_original\": {\n    \"message\": \"原版本：webapp12 6/2/2015, #link_iamchucky_PttChrome#, #link_GPL20#.\"\n  },\n  \"about_new_title\": {\n    \"message\": \"新功能\"\n  },\n  \"about_new_content\": {\n    \"message\": ['網址設定 keepAlive 參數, 只要在網址後面加上 ?keepAlive=[幾秒]', '加入了 SSH 連到 PTT 的功能, 只要在網址後面加上 ?ssh=true', '好讀模式只限於 ptt.cc 上使用', '黑名單可用 Google Drive 來讀取或備份', '斷線提示用 443 端口連線', '自動登入設定頁面可設定是否自動刪除其他重複連線', '右鍵選單新增 Live 文小幫手來自動更新推文, 也可用 Alt + r 來啟動', '設定中切換好讀模式不用再重新整理即可切換', '暫時停用 hammerjs 避免在舊的 Chrome 造成滑鼠圈選的問題', '修正中文輸入法時好讀模式的空白鍵的問題', '修正 ssh 連線 kex 的問題', '加入了關閉分頁先詢問的選項', '加入了滑鼠左鍵送出右方向鍵的選項', '加入了 END 啟用即時更新的選項', '滑鼠中鍵可以設定執行貼上功能', '加入了選取自動複製文字的選項', '新增了快速搜尋的功能 (感謝abccbaandy)']\n  },\n\n  // alerts\n  \"alert_developerModeHeader\": {\n    \"message\": \"開發者模式\"\n  },\n  \"alert_developerModeText\": {\n    \"message\": \"您正在使用開發者模式。此版本的 PttChrome 並不穩定，無法保證所有功能會正常運作。\"\n  },\n  \"alert_developerModeDismiss\": {\n    \"message\": \"是，我瞭解了\"\n  },\n\n  \"alert_connectionHeader\": {\n    \"message\": \"你斷線了!\"\n  },\n  \"alert_connectionText\": {\n    \"message\": \"現在要重新連線嗎?\"\n  },\n  \"alert_connectionReconnect\": {\n    \"message\": \"重新連線 (ENTER)\"\n  },\n  \"alert_connectionPortOption1\": {\n    \"message\": \"或\"\n  },\n  \"alert_connectionPortOption2\": {\n    \"message\": \"用443端口連線\"\n  },\n\n  \"alert_pasteShortcutHeader\": {\n    \"message\": \"貼上\"\n  },\n  \"alert_pasteShortcutText\": {\n    \"message\": \"請使用 Shift+Insert 快速鍵來貼上。\"\n  },\n  \"alert_pasteShortcutClose\": {\n    \"message\": \"確定\"\n  },\n\n  // notifications\n  \"notification_said\": {\n    \"message\": \"說:\"\n  },\n\n  \"input_sitePlaceholder\": {\n    \"message\": \"在此輸入站台地址後按 ENTER\"\n  },\n\n  // input helper\n  \"inputHelperTitle\": {\n    \"message\": \"輸入小幫手\"\n  },\n  \"colorTitle\": {\n    \"message\": \"上色\"\n  },\n  \"colorHelperSend\": {\n    \"message\": \"送出 ANSI 顏色字元\"\n  },\n  \"colorHelperSendMenuFore\": {\n    \"message\": \"只送出前景色彩\"\n  },\n  \"colorHelperSendMenuBack\": {\n    \"message\": \"只送出背景色彩\"\n  },\n  \"colorHelperSendMenuReset\": {\n    \"message\": \"送出色彩還原碼\"\n  },\n  \"colorHelperBlink\": {\n    \"message\": \"閃爍\"\n  },\n  \"colorHelperPreview\": {\n    \"message\": \"▅ 預 覽 ▅\"\n  },\n  \"colorHelperTooltip1\": {\n    \"message\": '點滑鼠\"左\"鍵選\"前景\"顏色'\n  },\n  \"colorHelperTooltip2\": {\n    \"message\": '點滑鼠\"右\"鍵選\"背景\"顏色 (上排)'\n  },\n\n  // symbols\n  \"symTitle\": {\n    \"message\": \"符號\"\n  },\n  \"symTitle_general\": {\n    \"message\": \"一般\"\n  },\n  \"symTitle_lineBorders\": {\n    \"message\": \"線條邊框\"\n  },\n  \"symTitle_blocks\": {\n    \"message\": \"方塊\"\n  },\n  \"symTitle_lines\": {\n    \"message\": \"線條\"\n  },\n  \"symTitle_special\": {\n    \"message\": \"特殊\"\n  },\n  \"symTitle_brackets\": {\n    \"message\": \"括弧\"\n  },\n  \"symTitle_greek\": {\n    \"message\": \"希臘\"\n  },\n  \"symTitle_phonetic\": {\n    \"message\": \"注音\"\n  },\n  \"symTitle_math\": {\n    \"message\": \"數學\"\n  },\n  \"symTitle_hiragana\": {\n    \"message\": \"平假名\"\n  },\n  \"symTitle_katakana\": {\n    \"message\": \"片假名\"\n  },\n\n  // emoticons\n  \"emoTitle\": {\n    \"message\": \"表情\"\n  },\n  \"emoTitle_angry\": {\n    \"message\": \"生氣\"\n  },\n  \"emoTitle_meh\": {\n    \"message\": \"酸民\"\n  },\n  \"emoTitle_sweat\": {\n    \"message\": \"汗顏加三條線\"\n  },\n  \"emoTitle_happy\": {\n    \"message\": \"開心\"\n  },\n  \"emoTitle_other\": {\n    \"message\": \"其他\"\n  },\n\n  // live helper\n  \"liveHelperEnable\": {\n    \"message\": \"啟用\"\n  },\n  \"liveHelperSpan\": {\n    \"message\": \"推文每\"\n  },\n  \"liveHelperSpanSec\": {\n    \"message\": \"秒自動更新\"\n  },\n\n  // tooltips\n  \"tooltip_antiIdleTime\": {\n    \"message\": \"輸入 0 可停用這功能。\"\n  },\n  \"tooltip_fontFace\": {\n    \"message\": \"以逗號隔開，由欲套用的字型開始至較通用的字型。\"\n  }\n\n};\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TelnetConnection = TelnetConnection;\n\nvar _event = __webpack_require__(2);\n\n// Telnet commands\nvar SE = '\\xf0'; // Handle Telnet Connections according to RFC 854\n\nvar NOP = '\\xf1';\nvar DATA_MARK = '\\xf2';\nvar BREAK = '\\xf3';\nvar INTERRUPT_PROCESS = '\\xf4';\nvar ABORT_OUTPUT = '\\xf5';\nvar ARE_YOU_THERE = '\\xf6';\nvar ERASE_CHARACTER = '\\xf7';\nvar ERASE_LINE = '\\xf8';\nvar GO_AHEAD = '\\xf9';\nvar SB = '\\xfa';\n\n// Option commands\nvar WILL = '\\xfb';\nvar WONT = '\\xfc';\nvar DO = '\\xfd';\nvar DONT = '\\xfe';\nvar IAC = '\\xff';\n\n// Telnet options\nvar ECHO = '\\x01';\nvar SUPRESS_GO_AHEAD = '\\x03';\nvar TERM_TYPE = '\\x18';\nvar IS = '\\x00';\nvar SEND = '\\x01';\nvar NAWS = '\\x1f';\n\n// state\nvar STATE_DATA = 0;\nvar STATE_IAC = 1;\nvar STATE_WILL = 2;\nvar STATE_WONT = 3;\nvar STATE_DO = 4;\nvar STATE_DONT = 5;\nvar STATE_SB = 6;\n\nfunction TelnetConnection(socket) {\n  this.socket = socket;\n  this.socket.addEventListener('open', this._onOpen.bind(this));\n  this.socket.addEventListener('data', this._onDataAvailable.bind(this));\n  this.socket.addEventListener('close', this._onClose.bind(this));\n\n  this.state = STATE_DATA;\n  this.iac_sb = '';\n\n  this.termType = 'VT100';\n}\n\n_event.Event.mixin(TelnetConnection.prototype);\n\nTelnetConnection.prototype._onOpen = function (e) {\n  this.dispatchEvent(new CustomEvent('open'));\n};\n\nTelnetConnection.prototype._onClose = function (e) {\n  this.dispatchEvent(new CustomEvent('close'));\n};\n\nTelnetConnection.prototype._onDataAvailable = function (e) {\n  var str = e.detail.data;\n  var data = '';\n  var count = str.length;\n  while (count > 0) {\n    var s = str;\n    count -= s.length;\n    var n = s.length;\n    for (var i = 0; i < n; ++i) {\n      var ch = s[i];\n      switch (this.state) {\n        case STATE_DATA:\n          if (ch == IAC) {\n            if (data) {\n              this._dispatchData(data);\n              data = '';\n            }\n            this.state = STATE_IAC;\n          } else {\n            data += ch;\n          }\n          break;\n        case STATE_IAC:\n          switch (ch) {\n            case WILL:\n              this.state = STATE_WILL;\n              break;\n            case WONT:\n              this.state = STATE_WONT;\n              break;\n            case DO:\n              this.state = STATE_DO;\n              break;\n            case DONT:\n              this.state = STATE_DONT;\n              break;\n            case SB:\n              this.state = STATE_SB;\n              break;\n            default:\n              this.state = STATE_DATA;\n          }\n          break;\n        case STATE_WILL:\n          switch (ch) {\n            case ECHO:\n            case SUPRESS_GO_AHEAD:\n              this._sendRaw(IAC + DO + ch);\n              break;\n            default:\n              this._sendRaw(IAC + DONT + ch);\n          }\n          this.state = STATE_DATA;\n          break;\n        case STATE_DO:\n          switch (ch) {\n            case TERM_TYPE:\n              this._sendRaw(IAC + WILL + ch);\n              break;\n            case NAWS:\n              // Don't respond.\n              //this._sendRaw( IAC + WILL + ch );\n              //this.sendNaws();\n              break;\n            default:\n              this._sendRaw(IAC + WONT + ch);\n          }\n          this.state = STATE_DATA;\n          break;\n        case STATE_DONT:\n        case STATE_WONT:\n          this.state = STATE_DATA;\n          break;\n        case STATE_SB:\n          // sub negotiation\n          this.iac_sb += ch;\n          if (this.iac_sb.slice(-2) == IAC + SE) {\n            // end of sub negotiation\n            switch (this.iac_sb[0]) {\n              case TERM_TYPE:\n                // FIXME: support other terminal types\n                //var termType = this.app.prefs.TermType;\n                var rep = IAC + SB + TERM_TYPE + IS + this.termType + IAC + SE;\n                this._sendRaw(rep);\n                break;\n            }\n            this.state = STATE_DATA;\n            this.iac_sb = '';\n            break;\n          }\n      }\n    }\n    if (data) {\n      this._dispatchData(data);\n      data = '';\n    }\n  }\n};\n\nTelnetConnection.prototype._dispatchData = function (data) {\n  this.dispatchEvent(new CustomEvent('data', {\n    detail: {\n      data: data\n    }\n  }));\n};\n\nTelnetConnection.prototype.send = function (str) {\n  // XXX Should do escape on IAC.\n  this._sendRaw(str);\n};\n\nTelnetConnection.prototype._sendRaw = function (data) {\n  if (data) {\n    this.socket.send(data);\n  }\n};\n\nTelnetConnection.prototype.convSend = function (unicode_str) {\n  // supports UAO\n  // when converting unicode to big5, use UAO.\n\n  var s = unicode_str.u2b();\n  // detect ;50m (half color) and then convert accordingly\n  if (s) {\n    s = s.ansiHalfColorConv();\n    this._sendRaw(s);\n  }\n};\n\nTelnetConnection.prototype.sendNaws = function (cols, rows) {\n  var nawsStr = String.fromCharCode(Math.floor(cols / 256), cols % 256, Math.floor(rows / 256), rows % 256).replace(/(\\xff)/g, '\\xff\\xff');\n  var rep = IAC + SB + NAWS + nawsStr + IAC + SE;\n  this._sendRaw(rep);\n};\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Websocket = Websocket;\n\nvar _event = __webpack_require__(2);\n\nfunction Websocket(url) {\n  this._conn = new WebSocket(url);\n  this._conn.binaryType = \"arraybuffer\";\n  this._conn.addEventListener('open', this._onOpen.bind(this));\n  this._conn.addEventListener('message', this._onMessage.bind(this));\n  this._conn.addEventListener('error', this._onError.bind(this));\n  this._conn.addEventListener('close', this._onClose.bind(this));\n};\n\n_event.Event.mixin(Websocket.prototype);\n\nWebsocket.prototype._onOpen = function (e) {\n  this.dispatchEvent(new CustomEvent('open'));\n};\n\nWebsocket.prototype._onMessage = function (e) {\n  var data = new Uint8Array(e.data);\n  this.dispatchEvent(new CustomEvent('data', {\n    detail: {\n      data: String.fromCharCode.apply(String, data)\n    }\n  }));\n};\n\nWebsocket.prototype._onError = function (e) {\n  this.dispatchEvent(new CustomEvent('error'));\n};\n\nWebsocket.prototype._onClose = function (e) {\n  this.dispatchEvent(new CustomEvent('close'));\n};\n\nWebsocket.prototype.send = function (str) {\n  // XXX: move this to app.\n  // because ptt seems to reponse back slowly after large\n  // chunk of text is pasted, so better to split it up.\n  var chunk = 1000;\n  for (var i = 0; i < str.length; i += chunk) {\n    var chunkStr = str.substring(i, i + chunk);\n    var byteArray = new Uint8Array(chunkStr.split('').map(function (x) {\n      return x.charCodeAt(0);\n    }));\n    this._conn.send(byteArray.buffer);\n  }\n};\n\nWebsocket.prototype.close = function () {\n  this._conn.close();\n};\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EasyReading = EasyReading;\nfunction EasyReading(core, view, termBuf) {\n  this._core = core;\n  this._view = view;\n  this._termBuf = termBuf;\n\n  this._turnPageLines = 22;\n\n  this.easyReadingReachedPageEnd = false;\n  this.sendCommandAfterUpdate = '';\n  this.ignoreOneUpdate = false;\n\n  function bindProperty(target, name, obj, prop) {\n    if (!prop) prop = name;\n    Object.defineProperty(obj, prop, {\n      get: function get() {\n        return target[name];\n      },\n      set: function set(val) {\n        target[name] = val;\n      }\n    });\n  }\n  bindProperty(this._view, 'useEasyReadingMode', this, '_enabled');\n  bindProperty(this._termBuf, 'startedEasyReading', this);\n  bindProperty(this._termBuf, 'easyReadingShowReplyText', this);\n  bindProperty(this._termBuf, 'easyReadingShowPushInitText', this);\n\n  this._termBuf.addEventListener('change', this._onChanged.bind(this));\n  this._termBuf.addEventListener('viewUpdate', this._onViewUpdated.bind(this));\n};\n\nEasyReading.prototype._onChanged = function (e) {\n  console.log(\"page state: \" + this._termBuf.prevPageState + \"->\" + this._termBuf.pageState);\n  // make sure to come back to easy reading mode\n  if (this._termBuf.prevPageState == 2 && this._termBuf.pageState == 3 && !this._enabled && this._core.pref.values.enableEasyReading && this._core.connectedUrl.easyReadingSupported) {\n    this._enabled = true;\n  } else if (!this._core.pref.values.enableEasyReading) {\n    this._enabled = false;\n  }\n\n  if (!this._enabled) return;\n\n  var lastRowText = this._termBuf.getRowText(23, 0, this._termBuf.cols);\n  // dealing with page state jump to 0 because last row wasn't updated fully \n  if (this._termBuf.pageState == 3) {\n    this.startedEasyReading = true;\n  } else if (this.startedEasyReading && lastRowText.parseReqNotMetText()) {\n    this.easyReadingShowPushInitText = true;\n  } else {\n    this.easyReadingShowReplyText = false;\n    this.easyReadingShowPushInitText = false;\n    this.startedEasyReading = false;\n  }\n  if (this.startedEasyReading) {\n    console.log('easy reading cursor pos: ' + this._termBuf.cur_y + ':' + this._termBuf.cur_x);\n    if (this._termBuf.cur_y == 23 && this._termBuf.cur_x == 79) {\n      if (this.ignoreOneUpdate) {\n        this.ignoreOneUpdate = false;\n        return;\n      }\n      var result = lastRowText.parseStatusRow();\n      if (result) {\n        var lastRowFirstCh = this._termBuf.lines[23][0];\n        if (lastRowFirstCh.getBg() == 4 && lastRowFirstCh.getFg() == 7) {\n          this.easyReadingReachedPageEnd = true;\n        } else {\n          this.easyReadingReachedPageEnd = false;\n          if (!this.sendCommandAfterUpdate) {\n            // send page down\n            this.sendCommandAfterUpdate = '\\x1b[6~';\n          }\n        }\n      } else if (!this.easyReadingShowPushInitText) {\n        // only if not showing last row text\n        this._termBuf.pageState = 5;\n        this.startedEasyReading = false;\n      }\n    } else if (this._termBuf.cur_y == 23) {\n      if (!this.easyReadingShowPushInitText) {\n        var lastRowText = this._termBuf.getRowText(23, 0, this._termBuf.cols);\n        var result = lastRowText.parsePushInitText();\n        if (result) {\n          this.easyReadingShowPushInitText = true;\n        } else {\n          this.easyReadingShowPushInitText = false;\n          return;\n        }\n      }\n    } else if (this._termBuf.cur_y == 22) {\n      var secondToLastRowText = this._termBuf.getRowText(22, 0, this._termBuf.cols);\n      var result = secondToLastRowText.parseReplyText();\n      if (result) {\n        this.easyReadingShowReplyText = true;\n      } else {\n        this.easyReadingShowReplyText = false;\n        return;\n      }\n    } else {\n      // last line hasn't changed\n      return;\n    }\n  }\n};\n\nEasyReading.prototype._onViewUpdated = function (e) {\n  console.log('view update');\n  if (this.sendCommandAfterUpdate) {\n    console.log(\"send:\" + this.sendCommandAfterUpdate);\n    if (this.sendCommandAfterUpdate != 'skipOne') {\n      this._send(this.sendCommandAfterUpdate);\n    }\n    this.sendCommandAfterUpdate = '';\n  }\n};\n\nEasyReading.prototype.leaveCurrentPost = function () {\n  console.log('leave curent post');\n  if (!this.easyReadingReachedPageEnd) {\n    this.ignoreOneUpdate = true;\n  }\n  this._termBuf.prevPageState = 0;\n};\n\nEasyReading.prototype.stopEasyReading = function () {\n  console.log('stop easy reading');\n  this.sendCommandAfterUpdate = 'skipOne';\n};\n\nEasyReading.prototype._send = function (data) {\n  this._view.conn.send(data);\n};\n\nEasyReading.prototype._onKeyDown = function (e) {\n  if (!this._enabled || !this.startedEasyReading) return;\n\n  this._onKeyDownProcessUI(e);\n  if (e.defaultPrevented) return;\n\n  var stop = false;\n  if (!e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'Backspace':\n      case 'ArrowUp':\n        this._send('\\x1b[D\\x1b[A\\x1b[C');\n        stop = true;\n        break;\n      case 'ArrowDown':\n        this._send('\\x1b[D\\x1b[B\\x1b[C');\n        stop = true;\n        break;\n    }\n  } else if (e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'h':\n        this._send('\\x1b[D\\x1b[A\\x1b[C');\n        stop = true;\n        break;\n    }\n  }\n  if (stop) e.preventDefault();\n};\n\nEasyReading.prototype._scrollBy = function (lines) {\n  var cont = this._view.mainDisplay;\n  if (lines < 0 && cont.scrollTop == 0) return false;\n  if (lines > 0 && cont.scrollTop >= this._view.mainContainer.clientHeight - this._view.chh * this._termBuf.rows) return false;\n  cont.scrollTop += this._view.chh * lines;\n  return true;\n};\n\nEasyReading.prototype._scrollEnd = function () {\n  this._view.mainDisplay.scrollTop = this._view.mainContainer.clientHeight;\n  return true;\n};\n\nEasyReading.prototype._scrollTop = function () {\n  this._view.mainDisplay.scrollTop = 0;\n  return true;\n};\n\nEasyReading.prototype._onKeyDownProcessUI = function (e) {\n  var stop = false;\n  if (!e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'Backspace':\n        stop = this._scrollBy(-this._turnPageLines);\n        if (!stop) this.leaveCurrentPost();\n        break;\n      case 'ArrowRight':\n      case ' ':\n      case 't':\n        stop = this._scrollBy(this._turnPageLines);\n        if (!stop) this.leaveCurrentPost();\n        break;\n      case 'PageUp':\n        this._scrollBy(-this._turnPageLines);\n        stop = true;\n        break;\n      case 'PageDown':\n        this._scrollBy(this._turnPageLines);\n        stop = true;\n        break;\n      case 'ArrowLeft':\n        this.stopEasyReading();\n        break;\n      case 'ArrowUp':\n        stop = this._scrollBy(-1);\n        if (!stop) this.leaveCurrentPost();\n        break;\n      case 'Enter':\n      case 'ArrowDown':\n        stop = this._scrollBy(1);\n        if (!stop) this.leaveCurrentPost();\n        break;\n      case 'k':\n        this._scrollBy(-1);\n        stop = true;\n        break;\n      case 'j':\n        this._scrollBy(1);\n        stop = true;\n        break;\n      case 'Home':\n      case '0':\n      case 'g':\n        stop = this._scrollTop();\n        break;\n      case 'End':\n      case '$':\n      case 'G':\n        stop = this._scrollEnd();\n        break;\n      case 'Tab':\n        stop = true;\n        break;\n      default:\n        if (\"abf=+-[]ABF\".indexOf(e.key) >= 0) {\n          this.leaveCurrentPost();\n          break;\n        }\n        if (\"123456789hops;,./\\\\H#OP:<>\".indexOf(e.key) >= 0) {\n          stop = true;\n          break;\n        }\n    }\n  } else if (e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'f':\n        this._scrollBy(this._turnPageLines);\n        stop = true;\n        break;\n      case 'b':\n        this._scrollBy(-this._turnPageLines);\n        stop = true;\n        break;\n      case 'h':\n        stop = this._scrollBy(-this._turnPageLines);\n        if (!stop) this.leaveCurrentPost();\n        break;\n      default:\n        if (\"@^_?\".indexOf(e.key) >= 0) {\n          stop = true;\n          break;\n        }\n    }\n  }\n  if (stop) e.preventDefault();\n};\n\nEasyReading.prototype._onMouseClick = function (e) {\n  if (!this._enabled || !this.startedEasyReading) return;\n  var stop = false;\n  // XXX Should not use term buffer to track mouse cursor.\n  switch (this._termBuf.mouseCursor) {\n    case 0:\n    case 1:\n      // Arrow Left\n      this.stopEasyReading();\n      break;\n    case 2:\n      // Page Up\n      this._scrollBy(-this._turnPageLines);\n      stop = true;\n      break;\n    case 3:\n      // Page Down\n      this._scrollBy(this._turnPageLines);\n      stop = true;\n      break;\n    case 4:\n      // Home\n      this._scrollTop();\n      stop = true;\n      break;\n    case 5:\n      // End\n      this._scrollEnd();\n      stop = true;\n      break;\n    case 6:\n    case 7:\n      break;\n    case 8: // [\n    case 9: // ]\n    case 10: // =\n    case 12: // Refresh post / pushed texts\n    case 13: // Last post with the same title (LIST)\n    case 14:\n      // Last post with the same title (READING)\n      this.leaveCurrentPost();\n      break;\n    default:\n      // Do nothing\n      break;\n  }\n  if (stop) e.preventDefault();\n};\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InputHelper = InputHelper;\n\nvar _emoticon = __webpack_require__(20);\n\nvar _symbols = __webpack_require__(21);\n\nvar _i18n = __webpack_require__(0);\n\nvar _util = __webpack_require__(1);\n\nfunction InputHelper(app) {\n  this.app = app;\n  this.node = document.getElementById('inputHelper');\n  this.nodeOffsetTop = 20;\n  this.nodeOffsetLeft = 20;\n  this.mouseDown = false;\n  this.clickedOn = false;\n\n  this.colorHelperBlinkCheckbox = null;\n  this.colorHelperPreview = null;\n  this.colorHelperPreviewFgShown = true;\n  this.colorHelperFg = 7;\n  this.colorHelperBg = 0;\n  this.colorHelperIsBlink = false;\n  this.blinkTimer = null;\n\n  this.symbols = null;\n  this.emoticons = null;\n  this.setupUi();\n  this.registerHandlers();\n}\n\nInputHelper.prototype.setupUi = function () {\n  var self = this;\n  var modalTitle = document.querySelector('#inputHelper .modal-title');\n  modalTitle.textContent = (0, _i18n.i18n)('inputHelperTitle');\n  document.getElementById('colorHelperSend').textContent = (0, _i18n.i18n)('colorHelperSend');\n  document.getElementById('colorHelperBlink').innerHTML = '<label><input id=\"colorHelperBlinkCheckbox\" type=\"checkbox\">' + (0, _i18n.i18n)('colorHelperBlink') + '</label>';\n  document.getElementById('colorHelperPreview').textContent = (0, _i18n.i18n)('colorHelperPreview');\n\n  document.getElementById('inputHelperClose').addEventListener('click', function (e) {\n    self.hideHelper();\n  });\n\n  document.querySelector('#colorsTabTitle a').textContent = (0, _i18n.i18n)('colorTitle');\n  $('#colorHelperSendMenuFore').text((0, _i18n.i18n)('colorHelperSendMenuFore'));\n  $('#colorHelperSendMenuBack').text((0, _i18n.i18n)('colorHelperSendMenuBack'));\n  $('#colorHelperSendMenuReset').text((0, _i18n.i18n)('colorHelperSendMenuReset'));\n\n  this.symbols = new _symbols.Symbols(this.app);\n  this.emoticons = new _emoticon.Emoticons(this.app);\n};\n\nInputHelper.prototype.onMouseDrag = function (e) {\n  window.getSelection().removeAllRanges();\n  this.nodeOffsetTop += e.movementY;\n  this.nodeOffsetLeft += e.movementX;\n  this.node.style.cssText += 'top:' + this.nodeOffsetTop + 'px;left:' + this.nodeOffsetLeft + 'px;';\n};\n\nInputHelper.prototype.registerHandlers = function () {\n  var self = this;\n  var colorHelperList = document.getElementById('colorHelperList');\n  var tooltipHtml = '<div>' + (0, _i18n.i18n)('colorHelperTooltip1') + '</div><div>' + (0, _i18n.i18n)('colorHelperTooltip2') + '</div>';\n  $(colorHelperList).tooltip({ html: true, title: tooltipHtml });\n\n  this.colorHelperBlinkCheckbox = document.getElementById('colorHelperBlinkCheckbox');\n  this.colorHelperPreview = document.getElementById('colorHelperPreview');\n  document.getElementById('colorHelperBlink').addEventListener('click', function (e) {\n    var checked = self.colorHelperBlinkCheckbox.checked;\n    if (checked != self.colorHelperIsBlink) {\n      self.colorHelperIsBlink = checked;\n      if (checked) {\n        self.blinkTimer = (0, _util.setTimer)(true, function () {\n          if (self.colorHelperPreviewFgShown) {\n            self.colorHelperPreview.style.color = 'transparent';\n          } else {\n            self.colorHelperPreview.style.color = '';\n          }\n          self.colorHelperPreviewFgShown = !self.colorHelperPreviewFgShown;\n        }, 1000);\n      } else {\n        self.blinkTimer.cancel();\n        self.blinkTimer = null;\n        self.colorHelperPreview.style.color = '';\n        self.colorHelperPreviewFgShown = true;\n      }\n    }\n    e.stopPropagation();\n  });\n  document.getElementById('colorHelperSend').addEventListener('click', function (e) {\n    self.sendColorCommand();\n  });\n  document.getElementById('colorHelperSendMenu').addEventListener('click', function (e) {\n    if (!e.target.hasAttribute('type')) return;\n    self.sendColorCommand(e.target.getAttribute('type'));\n  });\n\n  colorHelperList.addEventListener('click', function (e) {\n    if (!e.target.hasAttribute('value')) return;\n\n    if (e.which == 1) {\n      // left click, foreground\n      self.colorHelperFg = parseInt(e.target.getAttribute('value'));\n      self.colorHelperPreview.setAttribute('class', 'q' + self.colorHelperFg + ' b' + self.colorHelperBg);\n    }\n    e.preventDefault();\n    e.stopPropagation();\n  });\n  colorHelperList.addEventListener('contextmenu', function (e) {\n    if (!e.target.hasAttribute('value')) return;\n\n    var bg = parseInt(e.target.getAttribute('value'));\n    if (bg > 7) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n\n    // right click, background\n    self.colorHelperBg = bg;\n    self.colorHelperPreview.setAttribute('class', 'q' + self.colorHelperFg + ' b' + self.colorHelperBg);\n    e.preventDefault();\n    e.stopPropagation();\n  });\n\n  this.node.addEventListener('mousedown', function (e) {\n    if (e.which == 1) self.mouseDown = true;\n  });\n  this.node.addEventListener('mouseup', function (e) {\n    if (e.which == 1) self.mouseDown = false;\n  });\n\n  this.node.addEventListener('click', function (e) {\n    self.clickedOn = true;\n  });\n\n  this.symbols.registerHandlers();\n  this.emoticons.registerHandlers();\n};\n\nInputHelper.prototype.sendColorCommand = function (type) {\n  if (type == 'reset') {\n    this.app.conn.send('\\x15[m');\n    return;\n  }\n\n  var fg = this.colorHelperFg;\n  var lightColor = '0;';\n  if (fg > 7) {\n    fg %= 8;\n    lightColor = '1;';\n  }\n  fg += 30;\n  var bg = this.colorHelperBg;\n  bg += 40;\n  var isBlink = this.colorHelperIsBlink;\n  var blink = '';\n  if (isBlink) {\n    blink = '5;';\n  }\n  var cmd = '\\x15[';\n  if (type == 'foreground') {\n    cmd += lightColor + blink + fg + 'm';\n  } else if (type == 'background') {\n    cmd += bg + 'm';\n  } else {\n    cmd += lightColor + blink + fg + ';' + bg + 'm';\n  }\n\n  if (!window.getSelection().isCollapsed && this.app.buf.pageState == 6) {\n    // something selected\n    var sel = this.app.view.getSelectionColRow();\n    var y = this.app.buf.cur_y;\n    var selCmd = '';\n    // move cursor to end and send reset code\n    selCmd += '\\x1b[H';\n    if (y > sel.end.row) {\n      selCmd += '\\x1b[A'.repeat(y - sel.end.row);\n    } else if (y < sel.end.row) {\n      selCmd += '\\x1b[B'.repeat(sel.end.row - y);\n    }\n    var repeats = this.app.buf.getRowText(sel.end.row, 0, sel.end.col).length;\n    selCmd += '\\x1b[C'.repeat(repeats) + '\\x15[m';\n\n    // move cursor to start and send color code\n    y = sel.end.row;\n    selCmd += '\\x1b[H';\n    if (y > sel.start.row) {\n      selCmd += '\\x1b[A'.repeat(y - sel.start.row);\n    } else if (y < sel.start.row) {\n      selCmd += '\\x1b[B'.repeat(sel.start.row - y);\n    }\n    repeats = this.app.buf.getRowText(sel.start.row, 0, sel.start.col).length;\n    selCmd += '\\x1b[C'.repeat(repeats);\n    cmd = selCmd + cmd;\n  }\n  this.app.conn.send(cmd);\n};\n\nInputHelper.prototype.showHelper = function () {\n  this.node.style.display = 'block';\n};\n\nInputHelper.prototype.hideHelper = function () {\n  this.node.style.display = 'none';\n};\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Emoticons = Emoticons;\n\nvar _i18n = __webpack_require__(0);\n\nvar emoticons = {\n\n  angry: [\"(ノ ゜Д゜)ノ ︵ ═╩════╩═\", \"╯-____-)╯~═╩════╩═~\", \"(╭∩╮\\\\_/╭∩╮)\", \"( ︶︿︶)_╭∩╮\", \"( ‵□′)───C＜─___-)|||\", \"(￣ε(#￣) #○=(一-一o)\", \"(o一-一)=○# (￣#)3￣)\", \"╰(‵皿′＊)╯\", \"○(#‵︿′ㄨ)○\", \"◢▆▅▄▃-崩╰(〒皿〒)╯潰-▃▄▅▆◣\"],\n\n  meh: [\"(σ′▽‵)′▽‵)σ 哈哈哈哈～你看看你\", \"( ￣ c￣)y▂ξ\", \"( ′-`)y-～\", \"′_>‵\", \"╮(′～‵〞)╭\", \"╮(﹀_﹀\\\")╭\", \"︿(￣︶￣)︿\", \"..╮(﹋﹏﹌)╭..\", \"╮(╯_╰)╭\", \"╮(╯▽╰)/\"],\n\n  sweat: [\"(－^－)ｄ\", \"(￣￣；)\", \"(￣□￣|||)a\", \"(●；－_－)●\", \"￣▽￣||\", \"╭ ﹀◇﹀〣\", \"ˋ(′_‵||)ˊ\", \"●( ¯▽¯；●\", \"o(＞＜；)o o\"],\n\n  happy: [\"~(￣▽￣)~(＿△＿)~(￣▽￣)~(＿△＿)~(￣▽￣)~\", \"(~^O^~)\", \"(∩_∩)\", \"<(￣︶￣)>\", \"v(￣︶￣)y\", \"﹨(╯▽╰)∕\", \"\\\\(@^0^@)/\", \"\\\\(^▽^)/\", \"\\\\⊙▽⊙/\"],\n\n  other: [\"(．＿．?)\", \"(？o？)\", \"(‧Q‧)\", \"〒△〒\", \"m川@.川m\", \"(¯(∞)¯)\", \"(⊙o⊙)\", \"(≧<>≦)\", \"(☆_☆)\", \"o(‧\\\"‧)o\"]\n\n};\n\nfunction Emoticons(app) {\n  this.app = app;\n\n  this.tab = document.getElementById('inputHelperTabContent');\n  this.setupUi();\n};\n\nEmoticons.prototype.setupUi = function () {\n  var htmlStr = '';\n  var dropdownHtmlStr = '';\n  for (var i in emoticons) {\n    var title = (0, _i18n.i18n)('emoTitle_' + i);\n    dropdownHtmlStr += '<li><a href=\"#emo_' + i + '_list\" name=\"' + i + '\" data-toggle=\"tab\">' + title + '</a></li>';\n    var emo = emoticons[i];\n    var height = emo.length * 27;\n    htmlStr += '<ul id=\"emo_' + i + '_list\" class=\"tab-pane emoList\" style=\"height:' + height + 'px;\"><li>' + emoticons[i].join('</li><li>') + '</li></ul>';\n  }\n\n  // setup tab content\n  this.tab.innerHTML += htmlStr;\n\n  // setup dropdown menu\n  document.querySelector('#emoticonsTabTitle .dropdown-menu').innerHTML = dropdownHtmlStr;\n  document.querySelector('#emoticonsTabTitle .dropdown-toggle').innerHTML = (0, _i18n.i18n)('emoTitle') + ' <span class=\"caret\"></span>';\n};\n\nEmoticons.prototype.registerHandlers = function () {\n  var self = this;\n\n  $('#emoticonsTabTitle .dropdown-menu a').click(function (e) {\n    e.preventDefault();\n    $(this).tab('show');\n  });\n\n  $('.emoList > li').click(function (e) {\n    self.app.conn.convSend(e.target.textContent);\n  });\n};\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Symbols = Symbols;\n\nvar _i18n = __webpack_require__(0);\n\nvar symbols = {\n\n  general: ['，', '、', '。', '．', '？', '！', '～', '＄', '％', '＠', '＆', '＃', '＊', '‧', '；', '︰', '…', '‥', '﹐', '﹒', '˙', '·', '﹔', '﹕', '‘', '’', '“', '”', '〝', '〞', '‵', '′', '〃'],\n\n  lineBorders: ['├', '─', '┼', '┴', '┬', '┤', '┌', '┐', '│', '▕', '└', '┘', '╭', '╮', '╰', '╯', '╔', '╦', '╗', '╠', '═', '╬', '╣', '╓', '╥', '╖', '╒', '╤', '╕', '║', '╚', '╩', '╝', '╟', '╫', '╢', '╙', '╨', '╜', '╞', '╪', '╡', '╘', '╧', '╛'],\n\n  blocks: ['＿', 'ˍ', '▁', '▂', '▃', '▄', '▅', '▆', '▇', '█', '▏', '▎', '▍', '▌', '▋', '▊', '▉', '◢', '◣', '◥', '◤'],\n\n  lines: ['﹣', '﹦', '≡', '｜', '∣', '∥', '–', '︱', '—', '︳', '╴', '¯', '￣', '﹉', '﹊', '﹍', '﹎', '﹋', '﹌', '﹏', '︴', '∕', '﹨', '╱', '╲', '／', '＼'],\n\n  special: ['↑', '↓', '←', '→', '↖', '↗', '↙', '↘', '㊣', '◎', '○', '●', '⊕', '⊙', '△', '▲', '☆', '★', '◇', 'Æ', '□', '■', '▽', '▼', '§', '￥', '〒', '￠', '￡', '※', '♀', '♂'],\n\n  brackets: ['〔', '〕', '【', '】', '《', '》', '（', '）', '｛', '｝', '﹙', '﹚', '『', '』', '﹛', '﹜', '﹝', '﹞', '＜', '＞', '﹤', '﹥', '「', '」', '︵', '︶', '︷', '︸', '︹', '︺', '︻', '︼', '︽', '︾', '〈', '〉', '︿', '﹀', '﹁', '﹂', '﹃', '﹄'],\n\n  greek: ['Α', 'Β', 'Γ', 'Δ', 'Ε', 'Ζ', 'Η', 'Θ', 'Ι', 'Κ', 'Λ', 'Μ', 'Ν', 'Ξ', 'Ο', 'Π', 'Ρ', 'Σ', 'Τ', 'Υ', 'Φ', 'Χ', 'Ψ', 'Ω', 'α', 'β', 'γ', 'δ', 'ε', 'ζ', 'η', 'θ', 'ι', 'κ', 'λ', 'μ', 'ν', 'ξ', 'ο', 'π', 'ρ', 'σ', 'τ', 'υ', 'φ', 'χ', 'ψ', 'ω'],\n\n  phonetic: ['ㄅ', 'ㄆ', 'ㄇ', 'ㄈ', 'ㄉ', 'ㄊ', 'ㄋ', 'ㄌ', 'ㄍ', 'ㄎ', 'ㄏ', 'ㄐ', 'ㄑ', 'ㄒ', 'ㄓ', 'ㄔ', 'ㄕ', 'ㄖ', 'ㄗ', 'ㄘ', 'ㄙ', 'ㄚ', 'ㄛ', 'ㄜ', 'ㄝ', 'ㄞ', 'ㄟ', 'ㄠ', 'ㄡ', 'ㄢ', 'ㄣ', 'ㄤ', 'ㄥ', 'ㄦ', 'ㄧ', 'ㄨ', 'ㄩ', '˙', 'ˊ', 'ˇ', 'ˋ'],\n\n  math: ['╳', '＋', '﹢', '－', '×', '÷', '＝', '≠', '≒', '∞', 'ˇ', '±', '√', '⊥', '∠', '∟', '⊿', '㏒', '㏑', '∫', '∮', '∵', '∴', '≦', '≧', '∩', '∪'],\n\n  hiragana: ['あ', 'い', 'う', 'え', 'お', 'か', 'き', 'く', 'け', 'こ', 'さ', 'し', 'す', 'せ', 'そ', 'た', 'ち', 'つ', 'て', 'と', 'な', 'に', 'ぬ', 'ね', 'の', 'は', 'ひ', 'ふ', 'へ', 'ほ', 'ま', 'み', 'む', 'め', 'も', 'ら', 'り', 'る', 'れ', 'ろ', 'が', 'ぎ', 'ぐ', 'げ', 'ご', 'ざ', 'じ', 'ず', 'ぜ', 'ぞ', 'だ', 'ぢ', 'づ', 'で', 'ど', 'ば', 'び', 'ぶ', 'べ', 'ぼ', 'ぱ', 'ぴ', 'ぷ', 'ぺ', 'ぽ', 'や', 'ゆ', 'よ', 'わ', 'ん', 'を'],\n\n  katakana: ['ア', 'イ', 'ウ', 'エ', 'オ', 'カ', 'キ', 'ク', 'ケ', 'コ', 'サ', 'シ', 'ス', 'セ', 'ソ', 'タ', 'チ', 'ツ', 'テ', 'ト', 'ナ', 'ニ', 'ヌ', 'ネ', 'ノ', 'ハ', 'ヒ', 'フ', 'ヘ', 'ホ', 'マ', 'ミ', 'ム', 'メ', 'モ', 'ラ', 'リ', 'ル', 'レ', 'ロ', 'ガ', 'ギ', 'グ', 'ゲ', 'ゴ', 'ザ', 'ジ', 'ズ', 'ゼ', 'ゾ', 'ダ', 'ジ', 'ズ', 'デ', 'ド', 'バ', 'ビ', 'ブ', 'ベ', 'ボ', 'パ', 'ピ', 'プ', 'ペ', 'ポ', 'ヤ', 'ユ', 'ヨ', 'ワ', 'ン', 'ヲ']\n\n};\n\nfunction Symbols(app) {\n  this.app = app;\n\n  this.tab = document.getElementById('inputHelperTabContent');\n  this.setupUi();\n};\n\nSymbols.prototype.setupUi = function () {\n  var htmlStr = '';\n  var dropdownHtmlStr = '';\n  for (var i in symbols) {\n    var title = (0, _i18n.i18n)('symTitle_' + i);\n    dropdownHtmlStr += '<li><a href=\"#sym_' + i + '_list\" name=\"' + i + '\" data-toggle=\"tab\">' + title + '</a></li>';\n    var sym = symbols[i];\n    var height = Math.ceil(sym.length / 8) * 37; // find height by having 8 element each row\n    htmlStr += '<ul id=\"sym_' + i + '_list\" class=\"tab-pane symList\" style=\"height:' + height + 'px;\"><li>' + symbols[i].join('</li><li>') + '</li></ul>';\n  }\n\n  // setup tab content\n  this.tab.innerHTML += htmlStr;\n\n  // setup dropdown menu\n  document.querySelector('#symbolsTabTitle .dropdown-menu').innerHTML = dropdownHtmlStr;\n  document.querySelector('#symbolsTabTitle .dropdown-toggle').innerHTML = (0, _i18n.i18n)('symTitle') + ' <span class=\"caret\"></span>';\n};\n\nSymbols.prototype.registerHandlers = function () {\n  var self = this;\n\n  $('#symbolsTabTitle .dropdown-menu a').click(function (e) {\n    e.preventDefault();\n    $(this).tab('show');\n  });\n\n  $('.symList > li').click(function (e) {\n    self.app.conn.convSend(e.target.textContent);\n  });\n};\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nexports.PttChromePref = PttChromePref;\n\nvar _i18n = __webpack_require__(0);\n\nvar _pref_about = __webpack_require__(23);\n\nfunction PttChromePref(app, onInitializedCallback) {\n  this.values = {};\n  this.logins = null;\n  this.app = app;\n  this.shouldResetToDefault = false;\n\n  this.enableBlacklist = false;\n  this.blacklistedUserIds = {};\n\n  this.quickSearches = [];\n\n  //this.loadDefault(onInitializedCallback);\n  this.onInitializedCallback = onInitializedCallback;\n  this.initCallbackCalled = false;\n}\n\nPttChromePref.prototype = {\n\n  updateSettingsToUi: function updateSettingsToUi() {\n    this.refreshBlacklistOnUi();\n\n    var self = this;\n    var htmlStr = '';\n    var n = 0;\n    var onMouseBrowsingHighlightColorChange = function onMouseBrowsingHighlightColorChange(e) {\n      var qName = '#opt_mouseBrowsingHighlightColor';\n      var val = $(qName + ' select').val();\n      var bg = $(qName + ' .b' + val).css('background-color');\n      $(qName + ' select').css('background-color', bg);\n    };\n\n    for (var i in this.values) {\n      $('#opt_' + i).empty();\n      var val = this.values[i];\n\n      // for blacklisted userids \n      if (i === 'blacklistedUserIds') {\n        continue;\n      }\n      if (i === 'quickSearchList') {\n        this.setupQuickSearchUiList();\n        this.setupQuickSearchUiHandlers();\n        continue;\n      }\n\n      if (i === 'deleteDupLogin') {\n        var yesNode = $('#opt_deleteDupLoginYes');\n        if (val) {\n          yesNode.click();\n        }\n        continue;\n      }\n\n      // for the color selection box\n      if (i === 'mouseBrowsingHighlightColor') {\n        var qName = '#opt_' + i;\n        htmlStr = (0, _i18n.i18n)('options_highlightColor') + '<select class=\"form-control\">';\n        for (n = 1; n < 16; ++n) {\n          htmlStr += '<option value=\"' + n + '\" class=\"b' + n + '\"></option>';\n        }\n        htmlStr += '</select>';\n        $(qName).html(htmlStr);\n        $(qName + ' select').val(val);\n        var bg = $(qName + ' .b' + val).css('background-color');\n        $(qName + ' select').css('background-color', bg);\n        $(qName + ' select').on('change', onMouseBrowsingHighlightColorChange);\n        continue;\n      }\n\n      // for options that's predefined\n      if (i in PREF_OPTIONS) {\n        var optName = '#opt_' + i;\n        htmlStr = (0, _i18n.i18n)('options_' + i) + '<select class=\"form-control\">';\n        var options = PREF_OPTIONS[i];\n        for (n = 0; n < options.length; ++n) {\n          htmlStr += '<option value=\"' + n + '\">' + (0, _i18n.i18n)(options[n]) + '</option>';\n        }\n        htmlStr += '</select>';\n        $(optName).html(htmlStr);\n        if (typeof val == 'boolean') {\n          val = val ? 1 : 0;\n        }\n        $(optName + ' select').val(val);\n\n        continue;\n      }\n\n      var popoverTooltips = '';\n      if (i == 'fontFace' || i == 'antiIdleTime') {\n        popoverTooltips = ' data-toggle=\"popover\" data-trigger=\"focus\" data-content=\"' + (0, _i18n.i18n)('tooltip_' + i) + '\"';\n      }\n\n      switch (typeof val === 'undefined' ? 'undefined' : _typeof(val)) {\n        case 'number':\n          $('#opt_' + i).html('<label style=\"font-weight:normal;\">' + (0, _i18n.i18n)('options_' + i) + '</label>' + '<input type=\"number\" class=\"form-control\" value=\"' + val + '\"' + popoverTooltips + '>');\n          break;\n        case 'string':\n          $('#opt_' + i).html('<label style=\"font-weight:normal;\">' + (0, _i18n.i18n)('options_' + i) + '</label>' + '<input type=\"text\" class=\"form-control\" value=\"' + val + '\"' + popoverTooltips + '>');\n          break;\n        case 'boolean':\n          $('#opt_' + i).html('<label><input type=\"checkbox\" ' + (val ? 'checked' : '') + '>' + (0, _i18n.i18n)('options_' + i) + '</label>');\n          break;\n        default:\n          break;\n      }\n\n      // init popovers\n      if (i == 'fontFace' || i == 'antiIdleTime') {\n        $('#opt_' + i + ' input').popover();\n      }\n    }\n\n    // autologin\n    $('#login_username').html('<label style=\"font-weight:normal;\">' + (0, _i18n.i18n)('autologin_username') + '</label>' + '<input type=\"text\" class=\"form-control\" value=\"' + this.logins[0] + '\">');\n    $('#login_password').html('<label style=\"font-weight:normal;\">' + (0, _i18n.i18n)('autologin_password') + '</label>' + '<input type=\"password\" class=\"form-control\" value=\"' + this.logins[1] + '\">');\n  },\n\n  setupSettingsUi: function setupSettingsUi() {\n    var self = this;\n    var i;\n    $('#opt_title').text((0, _i18n.i18n)('menu_settings'));\n\n    $('#opt_reset').off();\n    $('#opt_reset').text((0, _i18n.i18n)('options_reset'));\n    $('#opt_reset').click(function () {\n      self.shouldResetToDefault = true;\n      $('#prefModal').modal('hide');\n    });\n    // adjust the size alittle according to the locale\n    var lang = (0, _i18n.getLang)();\n    if (lang == 'en_US') {\n      $('#opt_reset').css('fontSize', '12px');\n      $('#opt_reset').css('marginLeft', '-10px');\n    }\n\n    var cat = '';\n    for (i in PREFS_CATEGORIES) {\n      cat = PREFS_CATEGORIES[i];\n      $('#opt_' + cat).text((0, _i18n.i18n)('options_' + cat));\n    }\n    for (i in PREFS_NAV) {\n      cat = PREFS_NAV[i];\n      $('#optNav_' + cat).text((0, _i18n.i18n)('options_' + cat));\n    }\n\n    $('#opt_tabs a:first').tab('show');\n    var currTab = 'general';\n    $('#modalHeader').text((0, _i18n.i18n)('options_' + currTab));\n\n    $('#opt_autologinWarning').text((0, _i18n.i18n)('autologin_warning'));\n\n    // blacklist\n    $('#opt_blacklistInstruction').text((0, _i18n.i18n)('options_blacklistInstruction'));\n\n    this.setupExtensionsPage();\n\n    this.setupAboutPage();\n\n    $('#opt_tabs a').click(function (e) {\n      e.preventDefault();\n\n      var currTab = $(this).attr('name');\n      $('#modalHeader').text((0, _i18n.i18n)('options_' + currTab));\n      $(this).tab('show');\n    });\n  },\n\n  populateSettingsToUi: function populateSettingsToUi() {\n    var self = this;\n    this.setupSettingsUi();\n    this.updateSettingsToUi();\n\n    $('#prefModal').off();\n    $('#prefModal').on('show.bs.modal', function (e) {\n      var width = document.documentElement.clientWidth * 0.7;\n      width = width > 730 ? width : 730;\n      width -= 190;\n      var height = document.documentElement.clientHeight * 0.9;\n      height = height > 400 ? height : 400;\n      height -= 76;\n      $('#prefModal .modal-body').css('height', height + 'px');\n      $('#prefModal .modal-body').css('width', width + 'px');\n      $('#opt_blacklistedUsers').css('height', height - 150 + 'px');\n      self.refreshBlacklistOnUi();\n    });\n    $('#prefModal').on('shown.bs.modal', function (e) {\n      self.app.disableLiveHelper();\n      self.app.modalShown = true;\n    });\n    $('#prefModal').on('hidden.bs.modal', function (e) {\n      if (self.shouldResetToDefault) {\n        self.clearStorage();\n        self.values = JSON.parse(JSON.stringify(DEFAULT_PREFS));\n        self.blacklistedUserIds = {};\n        self.quickSearches = JSON.parse(DEFAULT_PREFS.quickSearchList);\n        self.logins = ['', ''];\n        self.updateSettingsToUi();\n        self.app.view.redraw(true);\n\n        self.shouldResetToDefault = false;\n      } else {\n        self.readValueFromUi();\n      }\n      self.saveAndDoneWithIt();\n      self.app.switchToEasyReadingMode(self.app.view.useEasyReadingMode);\n    });\n  },\n\n  setupQuickSearchUiList: function setupQuickSearchUiList() {\n    var self = this;\n    $('#ext_quickSearch').text((0, _i18n.i18n)('ext_quickSearch'));\n    var addNewSearchHtml = '<input type=\"text\" class=\"form-control qSearchItemName\" placeholder=\"' + (0, _i18n.i18n)('ext_addQuickSearchNamePlaceholder') + '\" /><input type=\"text\" class=\"form-control qSearchItemQuery\" placeholder=\"' + (0, _i18n.i18n)('ext_addQuickSearchQueryPlaceholder') + '\" />';\n    var buttonCloseHtml = '<button type=\"button\" class=\"close\">&times;</button>';\n    var buttonAddHtml = '<button type=\"button\" class=\"close\" data=\"add\">&#43;</button>';\n    var quickSearchListHtml = '';\n\n    for (var i = 0; i < this.quickSearches.length; ++i) {\n      var qSearch = this.quickSearches[i];\n      quickSearchListHtml += '<li class=\"list-group-item\">';\n      quickSearchListHtml += '<div class=\"qSearchItemName\"><span>' + qSearch.name + '</span><input type=\"text\" class=\"form-control\" value=\"' + qSearch.name + '\" /></div>';\n      quickSearchListHtml += '<div class=\"qSearchItemQuery\"><span>' + qSearch.url + '</span><input type=\"text\" class=\"form-control\" value=\"' + qSearch.url + '\" /></div>';\n      quickSearchListHtml += buttonCloseHtml + '</li>';\n    }\n    quickSearchListHtml += '<li class=\"list-group-item\">' + addNewSearchHtml + buttonAddHtml + '</li>';\n    $('#ext_quickSearchList').html(quickSearchListHtml);\n  },\n\n  validateQuickSearchInput: function validateQuickSearchInput(node) {\n    var val = node.val();\n    if (val === '') {\n      node.addClass('has-error');\n      return;\n    }\n    var isQuery = node.hasClass('qSearchItemQuery') || node.parent().hasClass('qSearchItemQuery');\n    if (isQuery && val.indexOf('%s') < 0) {\n      node.addClass('has-error');\n    } else {\n      node.removeClass('has-error');\n    }\n  },\n\n  setupQuickSearchUiHandlers: function setupQuickSearchUiHandlers() {\n    var self = this;\n    $('#ext_quickSearchList li input').on('input', function (e) {\n      var node = $(this);\n      if (node.parent().is('li')) {\n        // is at the add new node, check if other node is also empty\n        var inputs = node.parent().find('input');\n        for (var i = 0; i < inputs.length; ++i) {\n          node = $(inputs[i]);\n          self.validateQuickSearchInput(node);\n        }\n      } else {\n        self.validateQuickSearchInput(node);\n      }\n    });\n\n    $('#ext_quickSearchList li button').click(function (e) {\n      if ($(this).attr('data') == 'add') {\n        var parent = $(this.parentNode);\n        var nameNode = parent.find('input.qSearchItemName');\n        var queryNode = parent.find('input.qSearchItemQuery');\n        var nameVal = nameNode.val();\n        var queryVal = queryNode.val();\n        // validate input\n        if (nameNode.hasClass('has-error') || queryNode.hasClass('has-error') || nameVal === '' || queryVal === '') {\n          return;\n        }\n\n        // add\n        self.quickSearches.push({ name: nameVal, url: queryVal });\n        self.setupQuickSearchUiList();\n        self.setupQuickSearchUiHandlers();\n      } else {\n        // update quickSearches then remove\n        var ind = $('#ext_quickSearchList li').index(this.parentNode);\n        if (ind > -1) {\n          self.quickSearches.splice(ind, 1);\n        }\n        $(this).parent().remove();\n      }\n    });\n\n    $('#ext_quickSearchList li div').click(function (e) {\n      $(this).parent().addClass('editMode');\n      var inputToSelect = $(this).find('input');\n      inputToSelect[0].select();\n    }).focusout(function (e) {\n      if (e.relatedTarget && e.relatedTarget.parentNode && this.parentNode == e.relatedTarget.parentNode.parentNode) {\n        return;\n      }\n\n      var parent = $(this).parent();\n      if (parent.find('.has-error').length) {\n        return;\n      }\n\n      if ($(this).is('input') && parent.is('li')) {\n        // focus out from add new\n      } else {\n        parent.removeClass('editMode');\n        // update on span\n        var nameVal = parent.find('.qSearchItemName input').val();\n        var queryVal = parent.find('.qSearchItemQuery input').val();\n        parent.find('.qSearchItemName span').text(nameVal);\n        parent.find('.qSearchItemQuery span').text(queryVal);\n\n        // save this now\n        var ind = $('#ext_quickSearchList li').index(this.parentNode);\n        if (ind > -1) {\n          self.quickSearches[ind] = { name: nameVal, url: queryVal };\n          // update the context menu as well\n        }\n      }\n    });\n  },\n\n  setupExtensionsPage: function setupExtensionsPage() {\n    this.setupQuickSearchUiList();\n    this.setupQuickSearchUiHandlers();\n  },\n\n  setupAboutPage: function setupAboutPage() {\n    ReactDOM.render(React.createElement(_pref_about.AboutPane, null), $('#tabContentAbout').get(0));\n  },\n\n  refreshBlacklistOnUi: function refreshBlacklistOnUi() {\n    var listNode = $('#opt_blacklistedUsers');\n    var listStr = Object.keys(this.blacklistedUserIds).join('\\n');\n    listNode.val(listStr);\n  },\n\n  readBlacklistValues: function readBlacklistValues() {\n    var listNode = $('#opt_blacklistedUsers');\n    var listStr = listNode.val();\n    var blacklistArray = listStr.split('\\n');\n\n    this.blacklistedUserIds = {};\n\n    for (var i in blacklistArray) {\n      var b = blacklistArray[i];\n      if (!b) continue;\n      this.blacklistedUserIds[b.replace(' ', '').toLowerCase()] = true;\n    }\n    this.setBlacklistValue();\n    this.app.view.redraw(true);\n  },\n\n  saveAndDoneWithIt: function saveAndDoneWithIt() {\n    var self = this;\n    var data = {\n      values: self.values,\n      logins: { 'u': self.logins[0], 'p': self.logins[1] }\n    };\n    this.setStorage(data);\n    this.updateToApp();\n    this.app.modalShown = false;\n    this.app.setInputAreaFocus();\n  },\n\n  readValueFromUi: function readValueFromUi() {\n    this.readBlacklistValues();\n    var selectedVal;\n    for (var i in this.values) {\n      if (i === 'blacklistedUserIds') {\n        continue;\n      }\n      if (i === 'quickSearchList') {\n        this.values[i] = JSON.stringify(this.quickSearches);\n        continue;\n      }\n\n      if (i === 'deleteDupLogin') {\n        var yesNode = $('#opt_deleteDupLoginYes');\n        this.values[i] = yesNode.prop('checked');\n        continue;\n      }\n\n      if (i === 'mouseBrowsingHighlightColor') {\n        selectedVal = $('#opt_' + i + ' select').val();\n        this.values[i] = parseInt(selectedVal);\n        continue;\n      }\n\n      if (i in PREF_OPTIONS) {\n        selectedVal = $('#opt_' + i + ' select').val();\n        this.values[i] = parseInt(selectedVal);\n        continue;\n      }\n\n      var elem = $('#opt_' + i + ' input');\n      var type = _typeof(this.values[i]);\n      switch (type) {\n        case 'number':\n          this.values[i] = parseInt(elem.val());\n          break;\n        case 'string':\n          this.values[i] = elem.val();\n          break;\n        case 'boolean':\n          this.values[i] = elem.prop('checked');\n          break;\n        default:\n          break;\n      }\n    }\n    var user = $('#login_username input').val();\n    var pswd = $('#login_password input').val();\n    if (user === '') {\n      pswd = '';\n    }\n    this.logins = [user, pswd];\n  },\n\n  loadDefault: function loadDefault(callback) {\n    this.values = JSON.parse(JSON.stringify(DEFAULT_PREFS));\n    this.logins = { 'u': '', 'p': '' };\n    this.updateToApp();\n    this.populateSettingsToUi();\n    callback();\n  },\n\n  updateToApp: function updateToApp() {\n    for (var i in this.values) {\n      this.app.onPrefChange(this, i);\n    }\n    if (this.logins[0]) {\n      this.app.conn.loginStr[1] = this.logins[0];\n    }\n    if (this.logins[1]) {\n      this.app.conn.loginStr[2] = this.logins[1];\n    }\n  },\n\n  resetSettings: function resetSettings() {\n    this.clearStorage();\n    this.getStorage();\n  },\n\n  get: function get(prefName) {\n    console.log(prefName + \" = \" + this.values[prefName]);\n    return this.values[prefName];\n  },\n\n  set: function set(prefName, value) {\n    this.values[prefName] = value;\n  },\n\n  onStorageDone: function onStorageDone(msg) {\n    if (msg.data && msg.data.values) {\n      // iterate through default prefs to make sure all up to date\n      for (var i in DEFAULT_PREFS) {\n        if (!(i in msg.data.values) || msg.data.values[i] === null) {\n          this.values[i] = DEFAULT_PREFS[i];\n          if (i === 'quickSearchList') {\n            this.quickSearches = JSON.parse(this.values[i]);\n          }\n        } else {\n          if (i === 'blacklistedUserIds') {\n            this.blacklistedUserIds = JSON.parse(msg.data.values[i]);\n          } else if (i === 'quickSearchList') {\n            var val = msg.data.values[i];\n            this.quickSearches = JSON.parse(val);\n            this.values[i] = val;\n          } else {\n            this.values[i] = msg.data.values[i];\n          }\n        }\n      }\n    }\n    if (msg.data && msg.data.logins) {\n      var data = msg.data.logins;\n      this.logins = [data.u, data.p];\n    }\n    this.updateToApp();\n    this.populateSettingsToUi();\n    if (!this.initCallbackCalled) {\n      if (this.values !== null && this.logins !== null) {\n        this.initCallbackCalled = true;\n        this.onInitializedCallback(this.app);\n      }\n    }\n  },\n\n  getStorage: function getStorage(key) {\n    console.log(\"getStorage not implemented, returning defaults.\");\n    var defaults = {\n      values: DEFAULT_PREFS,\n      logins: { 'u': '', 'p': '' }\n    };\n    this.onStorageDone({ data: defaults });\n  },\n\n  setBlacklistValue: function setBlacklistValue() {\n    var blacklist = JSON.stringify(this.blacklistedUserIds);\n    this.values.blacklistedUserIds = blacklist;\n  },\n\n  setBlacklistStorage: function setBlacklistStorage() {\n    var items = {\n      values: {\n        blacklistedUserIds: this.values.blacklistedUserIds\n      }\n    };\n    console.log(\"setBlacklistStorage not implemented, items: \" + items);\n  },\n\n  setStorage: function setStorage(items) {\n    console.log(\"setStorage not implemented, items: \" + items);\n  },\n\n  clearStorage: function clearStorage() {\n    console.log(\"clearStorage not implemented\");\n  }\n\n};\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AboutPane = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _i18n = __webpack_require__(0);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar AboutPane = exports.AboutPane = function (_React$Component) {\n  _inherits(AboutPane, _React$Component);\n\n  function AboutPane() {\n    _classCallCheck(this, AboutPane);\n\n    return _possibleConstructorReturn(this, (AboutPane.__proto__ || Object.getPrototypeOf(AboutPane)).apply(this, arguments));\n  }\n\n  _createClass(AboutPane, [{\n    key: 'render',\n    value: function render() {\n      var link = function link(text, url) {\n        return '<a href=\"' + url + '\" target=\"_blank\" rel=\"noreferrer\">' + text + '</a>';\n      };\n      var replacements = {\n        '#link_github_iamchucky#': link('Chuck Yang', 'https://github.com/iamchucky'),\n        '#link_github_robertabcd#': link('robertabcd', 'https://github.com/robertabcd'),\n        '#link_robertabcd_PttChrome#': link('robertabcd/PttChrome', 'https://github.com/robertabcd/PttChrome'),\n        '#link_iamchucky_PttChrome#': link('iamchucky/PttChrome', 'https://github.com/iamchucky/PttChrome'),\n        '#link_GPL20#': link('General Public License v2.0', 'https://www.gnu.org/licenses/old-licenses/gpl-2.0.html')\n      };\n      var replaced_i18n = function replaced_i18n(id) {\n        var text = (0, _i18n.i18n)(id);\n        for (var key in replacements) {\n          text = text.replace(key, replacements[key]);\n        }\n        return React.createElement('span', { dangerouslySetInnerHTML: { __html: text } });\n      };\n      var aboutNewList = (0, _i18n.i18n)('about_new_content').map(function (text, index) {\n        return React.createElement(\n          'li',\n          { key: \"i\" + index },\n          text\n        );\n      });\n      return React.createElement(\n        'div',\n        null,\n        React.createElement(\n          'div',\n          { className: 'list-group' },\n          React.createElement(\n            'h4',\n            { className: 'list-group-item-heading' },\n            'PttChrome',\n            React.createElement(\n              'small',\n              null,\n              ' - ',\n              (0, _i18n.i18n)('about_appName_subtitle')\n            )\n          ),\n          React.createElement(\n            'div',\n            { id: 'about_description' },\n            React.createElement(\n              'p',\n              null,\n              replaced_i18n('about_description')\n            )\n          )\n        ),\n        React.createElement(\n          'div',\n          { className: 'list-group' },\n          React.createElement(\n            'h4',\n            { className: 'list-group-item-heading' },\n            (0, _i18n.i18n)('about_version_title')\n          ),\n          React.createElement(\n            'div',\n            { className: 'list-group-item-text' },\n            React.createElement(\n              'ul',\n              null,\n              React.createElement(\n                'li',\n                null,\n                replaced_i18n('about_version_current')\n              ),\n              React.createElement(\n                'li',\n                null,\n                replaced_i18n('about_version_original')\n              )\n            )\n          )\n        ),\n        React.createElement(\n          'div',\n          { className: 'list-group' },\n          React.createElement(\n            'h4',\n            { className: 'list-group-item-heading' },\n            (0, _i18n.i18n)('about_new_title')\n          ),\n          React.createElement(\n            'div',\n            { className: 'list-group-item-text' },\n            React.createElement(\n              'ul',\n              null,\n              aboutNewList\n            )\n          )\n        )\n      );\n    }\n  }]);\n\n  return AboutPane;\n}(React.Component);\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TouchController = TouchController;\nfunction TouchController(app) {\n  this.app = app;\n  this.highlightCopy = false;\n  this.touchStarted = false;\n  this.touchedCenter = { x: 0, y: 0 };\n\n  // make sure the text selection still works\n  delete Hammer.defaults.cssProps.userSelect;\n\n  this.ham = null;\n  this.setupHandlers();\n};\n\nTouchController.prototype.setupHandlers = function () {\n  var self = this;\n  var app = this.app;\n\n  document.body.ontouchmove = function (e) {\n    if (e.touches.length != 1) return false;\n    return true;\n  };\n\n  document.body.ontouchstart = function (e) {\n    self.touchStarted = true;\n    app.inputArea.blur();\n    console.log('touchstart');\n  };\n\n  document.body.ontouchend = function (e) {\n    if (app.buf.pageState == 2 && app.buf.highlightCursor && app.buf.nowHighlight != -1) {\n      app.onMouse_click(self.touchedCenter.x, self.touchedCenter.y);\n      app.buf.nowHighlight = -1;\n      app.buf.highlightCursor = self.highlightCopy;\n      app.BBSWin.style.cursor = 'auto';\n      self.touchStarted = false;\n      app.inputArea.focus();\n    }\n    console.log('touchend');\n  };\n\n  this.ham = new Hammer(app.BBSWin);\n  this.ham.on('pan', function (ev) {\n    if (ev.pointerType == 'touch') {\n      //console.log(ev);\n      if (app.buf.pageState == 2) {\n        ev.preventDefault();\n        ev.srcEvent.preventDefault();\n\n        self.highlightCopy = app.buf.highlightCursor;\n        app.buf.highlightCursor = true;\n        app.onMouse_move(ev.center.x, ev.center.y);\n        self.touchedCenter.x = ev.center.x;\n        self.touchedCenter.y = ev.center.y;\n      }\n    }\n  });\n\n  this.ham.on('tap', function (ev) {\n    //console.log(ev);\n    ev.preventDefault();\n    ev.srcEvent.stopPropagation();\n    ev.srcEvent.preventDefault();\n    if (ev.pointerType != 'touch') return;\n    self.highlightCopy = app.buf.highlightCursor;\n    app.buf.highlightCursor = false;\n    app.onMouse_move(ev.center.x, ev.center.y);\n    app.onMouse_click(ev.center.x, ev.center.y);\n    app.buf.nowHighlight = -1;\n    app.buf.highlightCursor = self.highlightCopy;\n    app.BBSWin.style.cursor = 'auto';\n    self.touchStarted = false;\n    app.inputArea.focus();\n    console.log('touchtap');\n  });\n};\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// pttchrome.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 766eb063246ee98a64ce","import { en_US } from './en_US_messages';\nimport { zh_TW } from './zh_TW_messages';\n\nvar locale = {};\nlocale.en_US = en_US;\nlocale.zh_TW = zh_TW;\nvar i18n_val = {};\nexport function i18n(str) {\n  if (i18n_val[str]) {\n    return i18n_val[str].message;\n  } else {\n    console.log('missing i18n '+str);\n  }\n}\n\nexport function setupI18n(callback) {\n  var lang = getLang();\n  i18n_val = locale[lang];\n}\n\nexport function getLang() {\n  var lang = navigator.language || navigator.userLanguage;\n  if (lang.length == 5) {\n    // chrome 40+ uses lower case country code\n    lang = lang.substr(0,3) + lang.substr(3,5).toUpperCase();\n  }\n  if (lang === '' || !(lang == 'en-US' || lang == 'zh-TW')) {\n    lang = 'en-US';\n  }\n  lang = lang.replace('-', '_');\n  return lang;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/i18n.js","export function setTimer(repeat, func, timelimit) {\n  if(repeat) {\n\t  return {\n\t\t  timer: setInterval(func, timelimit),\n\t\t  cancel: function() {\n\t\t\t  clearInterval(this.timer);\n\t\t  }\n\t  };\n  } else {\n\t  return {\n\t\t  timer: setTimeout(func, timelimit),\n\t\t  cancel: function() {\n\t\t\t  clearTimeout(this.timer);\n\t\t  }\n\t  };\n  }\n}\n\nexport function getQueryVariable(variable) {\n  var query = window.location.search.substring(1);\n  var vars = query.split(\"&\");\n  for (var i=0;i<vars.length;i++) {\n    var pair = vars[i].split(\"=\");\n    if (pair[0] == variable) {\n      return decodeURIComponent(pair[1]);\n    }\n  }\n  return null;\n}\n\nexport function dumpLog(type, string) {\n\tswitch(type){\n\t\tcase DUMP_TYPE_LOG: \t console.log(string); break;\n\t\tcase DUMP_TYPE_WARN: \t console.warn(string); break;\n\t\tcase DUMP_TYPE_ERROR: \t console.error(string); break;\n\t\tdefault: console.log(string); break;\n\t}\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./js/util.js","export function Event() {}\n\nEvent.mixin = function(obj) {\n  for (var key in Event.prototype) {\n    obj[key] = Event.prototype[key];\n  }\n};\n\nEvent.prototype.addEventListener = function(type, listener) {\n  this._listeners = this._listeners || {};\n  (this._listeners[type] = this._listeners[type] || []).push(listener);\n};\n\nEvent.prototype.dispatchEvent = function(e) {\n  this._listeners = this._listeners || {};\n  var fns = this._listeners[e.type];\n  if (fns) {\n    fns = fns.slice(0);\n    for (var i in fns) {\n      fns[i](e);\n    }\n  }\n};\n\nEvent.prototype.removeEventListener = function(type, listener) {\n  this._listeners = this._listeners || {};\n  var fns = this._listeners[type];\n  if (fns) {\n    for (var i in fns) {\n      if (fns[i] === listener) {\n        fns.splice(i, 1);\n        break;\n      }\n    }\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/event.js","// Terminal Screen Buffer, displayed by TermView\n\nimport { Event } from './event';\nimport { ColorState } from './term_ui';\n\nconst termColors = [\n  // dark\n  '#000000', // black\n  '#800000', // red\n  '#008000', // green\n  '#808000', // yellow\n  '#000080', // blue\n  '#800080', // magenta\n  '#008080', // cyan\n  '#c0c0c0', // light gray\n  // bright\n  '#808080', // gray\n  '#ff0000', // red\n  '#00ff00', // green\n  '#ffff00', // yellow\n  '#0000ff', // blue\n  '#ff00ff', // magenta\n  '#00ffff', // cyan\n  '#ffffff'  // white\n];\n\nexport const termInvColors = [\n  // dark\n  '#FFFFFF', // black\n  '#7FFFFF', // red\n  '#FF7FFF', // green\n  '#7F7FFF', // yellow\n  '#FFFF7F', // blue\n  '#7FFF7F', // magenta\n  '#FF7F7F', // cyan\n  '#3F3F3F', // light gray\n  // bright\n  '#7F7F7F', // gray\n  '#00FFFF', // red\n  '#FF00FF', // green\n  '#0000FF', // yellow\n  '#FFFF00', // blue\n  '#00FF00', // magenta\n  '#FF0000', // cyan\n  '#000000'  // white\n];\n\nconst mouseCursorMap = [\n  'auto',                               // 0\n  'url(cursor/back.png) 0 6,auto',      // 1\n  'url(cursor/pageup.png) 6 0,auto',    // 2\n  'url(cursor/pagedown.png) 6 21,auto', // 3\n  'url(cursor/home.png) 0 0,auto',      // 4\n  'url(cursor/end.png) 0 0,auto',       // 5\n  'pointer',                            // 6\n  'default',                            // 7\n  'url(cursor/prevous.png) 6 0,auto',   // 8\n  'url(cursor/next.png) 6 0,auto',      // 9\n  'url(cursor/first.png) 0 0,auto',     // 10\n  'auto',                               // 11\n  'url(cursor/refresh.png) 0 0,auto',   // 12\n  'url(cursor/last.png) 0 0,auto',      // 13\n  'url(cursor/last.png) 0 0,auto'       // 14\n];\n\nfunction TermChar(ch) {\n  this.ch = ch;\n  this.resetAttr();\n  this.needUpdate = false;\n  this.isLeadByte = false;\n  this.startOfURL = false;\n  this.endOfURL = false;\n  this.partOfURL = false;\n  this.partOfKeyWord = false;\n  this.keyWordColor = '#ff0000';\n  this.fullurl = '';\n}\n\n// static variable for all TermChar objects\nTermChar.defaultFg = 7;\nTermChar.defaultBg = 0;\n\nTermChar.prototype = {\n\n  copyFrom: function(attr) {\n    this.ch = attr.ch;\n    this.isLeadByte = attr.isLeadByte;\n    this.copyAttr(attr);\n  },\n\n  copyAttr: function(attr) {\n    this.fg = attr.fg;\n    this.bg = attr.bg;\n    this.bright = attr.bright;\n    this.invert = attr.invert;\n    this.blink = attr.blink;\n    this.underLine = attr.underLine;\n  },\n\n  resetAttr: function() {\n    this.fg = 7;\n    this.bg = 0;\n    this.bright = false;\n    this.invert = false;\n    this.blink = false;\n    this.underLine = false;\n  },\n  \n  getFg: function() {\n    if (this.invert)\n      return this.bright ? (this.bg + 8) : this.bg;\n    return this.bright ? (this.fg + 8) : this.fg;\n  },\n\n  getBg: function() {\n    return this.invert ? this.fg : this.bg;\n  },\n\n  getColor: function() {\n    return new ColorState(this.getFg(), this.getBg(), this.blink);\n  },\n\n  isUnderLine: function() {\n    return this.underLine;\n  },\n\n  isStartOfURL : function() {\n    return this.startOfURL;\n  },\n\n  isEndOfURL : function() {\n    return this.endOfURL;\n  },\n\n  isPartOfURL : function() {\n    return this.partOfURL;\n  },\n\n  isPartOfKeyWord : function() {\n    return this.partOfKeyWord;\n  },\n\n  getKeyWordColor : function() {\n    return this.keyWordColor;\n  },\n\n  getFullURL: function() {\n    return this.fullurl;\n  }\n};\n\nfunction TermHtml() {\n  this.html='';\n}\n\nTermHtml.prototype = {\n\n  setHtml: function(str) {\n    this.html = str;\n  },\n\n  addHtml: function(str) {\n    this.html += str;\n  },\n\n  getHtml: function() {\n    return this.html;\n  }\n};\n\nexport function TermBuf(cols, rows) {\n  this.cols = cols;\n  this.rows = rows;\n  this.view = null;\n  this.cur_x = 0;\n  this.cur_y = 0;\n  this.cur_x_sav = -1;\n  this.cur_y_sav = -1;\n  this.scrollStart = 0;\n  this.scrollEnd = rows-1;\n  this._nowHighlight = -1;\n  Object.defineProperty(this, 'nowHighlight', {\n    set: this.setHighlight.bind(this),\n    get: function() { return this._nowHighlight; }.bind(this)\n  });\n  this.tempMouseCol = 0;\n  this.tempMouseRow = 0;\n  this.mouseCursor = 0;\n  this.highlightCursor = true;\n  this.useMouseBrowsing = true;\n  //this.scrollingTop=0;\n  //this.scrollingBottom=23;\n  this.attr = new TermChar(' ');\n  this.newChar = new TermChar(' ');\n  this.disableLinefeed = false;\n  this.altScreen = '';\n  this.changed = false;\n  this.posChanged = false;\n  this.pageState = 0;\n  this.forceFullWidth = false;\n  this.enableDeleteDupLogin = false;\n  this.deleteDupLogin = false;\n\n  this.startedEasyReading = false;\n  this.easyReadingShowReplyText = false;\n  this.easyReadingShowPushInitText = false;\n  this.prevPageState = 0;\n\n  this.lines = new Array(rows);\n  this.linesX = new Array(0);\n  this.linesY = new Array(0);\n\n  this.pageLines = [];\n  this.pageWrappedLines = [];\n\n  this.outputhtmls = new Array(rows);\n  this.lineChangeds = new Array(rows);\n\n  this.viewBufferTimer = 30;\n\n  while (--rows >= 0) {\n    var line = new Array(cols);\n    var outputhtml = new Array(cols);\n    var c = cols;\n    while (--c >= 0) {\n      line[c] = new TermChar(' ');\n      outputhtml[c] = new TermHtml();\n    }\n    this.lines[rows] = line;\n    this.outputhtmls[rows] = outputhtml;\n    //this.keyWordLine[rows]=false;\n  }\n  this.BBSWin = document.getElementById('BBSWindow');\n}\n\nTermBuf.prototype = {\n\n  timerUpdate: null,\n\n  uriRegEx: /((ftp|http|https|telnet):\\/\\/([A-Za-z0-9_]+:{0,1}[A-Za-z0-9_]*@)?([A-Za-z0-9_#!:.?+=&%@!\\-\\/\\$\\^,;|*~'()]+)(:[0-9]+)?(\\/|\\/([A-Za-z0-9_#!:.?+=&%@!\\-\\/]))?)|(pid:\\/\\/(\\d{1,10}))/ig,\n\n  setView: function(view) {\n    this.view = view;\n  },\n\n  puts: function(str) {\n    if (!str)\n      return;\n    var cols = this.cols;\n    var rows = this.rows;\n    var lines = this.lines;\n    var n = str.length;\n    var line = lines[this.cur_y];\n    for (var i = 0; i < n; ++i) {\n      var ch = str[i];\n      switch (ch) {\n      case '\\x07':\n        // FIXME: beep (1)Sound (2)AlertNotification (3)change icon\n        // should only play sound\n        continue;\n      case '\\b':\n        this.back();\n        continue;\n      case '\\r':\n        this.carriageReturn();\n        continue;\n      case '\\n':\n      case '\\f':\n      case '\\v':\n        this.lineFeed();\n        line = lines[this.cur_y];\n        continue;\n      case '\\0':\n          continue;\n      }\n      //if( ch < ' ')\n      //    //dump('Unhandled invisible char' + ch.charCodeAt(0)+ '\\n');\n\n      if (this.cur_x >= cols) {\n        // next line\n        if(!this.disableLinefeed) this.lineFeed();\n        this.cur_x=0;\n        line = lines[this.cur_y];\n        this.posChanged=true;\n      }\n\n      switch (ch) {\n      case '\\t':\n        this.tab();\n        break;\n      default:\n        var ch2 = line[this.cur_x];\n        ch2.ch=ch;\n        ch2.copyAttr(this.attr);\n        ch2.needUpdate=true;\n        ++this.cur_x;\n        if (ch2.isLeadByte) // previous state before this function\n          line[this.cur_x].needUpdate=true;\n        if (this.view.charset == 'UTF-8' && this.isFullWidth(ch) && this.cur_x < cols) {\n          ch2 = line[this.cur_x];\n          ch2.ch = '';\n          ch2.copyAttr(this.attr);\n          ch2.needUpdate = true;\n          ++this.cur_x;\n          // assume server will handle mouse moving on full-width char\n        }\n        this.changed = true;\n        this.posChanged = true;\n      }\n    }\n    this.queueUpdate();\n  },\n\n  updateCharAttr: function() {\n    var cols = this.cols;\n    var rows = this.rows;\n    var lines = this.lines;\n    for (var row = 0; row < rows; ++row) {\n      var line = lines[row];\n      var needUpdate = false;\n      for (var col = 0; col < cols; ++col) {\n        var ch = line[col];\n        if (ch.needUpdate)\n            needUpdate=true;\n        // all chars > ASCII code are regarded as lead byte of DBCS.\n        // FIXME: this is not correct, but works most of the times.\n        if ( this.isFullWidth(ch.ch) && (col + 1) < cols ) {\n          ch.isLeadByte = true;\n          ++col;\n          var ch0 = ch;\n          ch = line[col];\n          if (ch.needUpdate)\n            needUpdate = true;\n          // ensure simutaneous redraw of both bytes\n          if ( ch0.needUpdate != ch.needUpdate ) {\n            ch0.needUpdate = ch.needUpdate = true;\n          }\n        } else if (ch.isleadbyte && (col+1) < cols) {\n          var ch2 = line[col+1];\n          ch2.needUpdate = true;\n        }\n        ch.isLeadByte = false;\n      }\n\n      if (needUpdate) { // this line has been changed\n        this.lineChangeds[row] = true;\n        // perform URI detection again\n        // remove all previously cached uri positions\n        if (line.uris) {\n          var uris = line.uris;\n          var nuris = uris.length;\n\n          // FIXME: this is inefficient\n          for (var iuri = 0; iuri < nuris; ++iuri) {\n            var uri = uris[iuri];\n            line[uri[0]].startOfURL = false;\n            line[uri[0]].endOfURL = false;\n            line[uri[0]].fullurl = '';\n            line[uri[1]-1].startOfURL = false;\n            line[uri[1]-1].endOfURL = false;\n            line[uri[1]-1].fullurl = '';\n            for (var col=uri[0]; col < uri[1]; ++col) {\n              line[col].partOfURL = false;\n              line[col].needUpdate = true;\n            }\n          }\n          line.uris=null;\n        }\n        var s = '';\n        for (var col = 0; col < cols; ++col)\n            s += line[col].ch;\n        if (this.view.charset != 'UTF-8')\n          s = s.replace(/[^\\x00-\\x7f]./g,'\\xab\\xcd');\n        else {\n          var str = '';\n          for (var i = 0; i < s.length; ++i) {\n            str += s.charAt(i);\n            if (this.isFullWidth(s.charAt(i)))\n              str += s.charAt(i);\n          }\n          s = str;\n        }\n        var res;\n        var uris = null;\n        // pairs of URI start and end positions are stored in line.uri.\n        while ( (res = this.uriRegEx.exec(s)) !== null ) {\n          if (!uris)   uris = [];\n          var uri = [res.index, res.index+res[0].length];\n          uris.push(uri);\n          // dump('found URI: ' + res[0] + '\\n');\n        }\n\n        if (uris) {\n          line.uris = uris;\n          // dump(line.uris.length + \"uris found\\n\");\n        }\n        //\n        if (line.uris) {\n          var uris = line.uris;\n          var nuris = uris.length;\n          for (var iuri = 0; iuri < nuris; ++iuri) {\n            var uri = uris[iuri];\n            var urlTemp = '';\n\n            for (var col = uri[0]; col < uri[1]; ++col) {\n              urlTemp += line[col].ch;\n              line[col].partOfURL = true;\n              line[col].needUpdate = true; //fix link bug\n            }\n            var u;\n            if (this.view.charset != 'UTF-8')\n              u = urlTemp;//this.conv.convertStringToUTF8(urlTemp, this.view.charset,  true);\n            else {\n              var str = '';\n              for (var i = 0; i < urlTemp.length; ++i) {\n                str += urlTemp.charAt(i);\n                if (this.isFullWidth(urlTemp.charAt(i)))\n                  str += urlTemp.charAt(i);\n              }\n              u = str;\n            }\n            var urlTemp2 = urlTemp.toLowerCase();\n            line[uri[0]].startOfURL = true;\n            if (urlTemp2.substr(0,6) == 'pid://') {\n              line[uri[0]].fullurl='http://www.pixiv.net/member_illust.php?mode=big&illust_id='+urlTemp2.substr(6,15);\n            } else {\n              //var g = encodeURI(u);\n              //line[uri[0]].fullurl=g;\n              line[uri[0]].fullurl = u;\n            }\n            line[uri[1]-1].endOfURL = true;\n            //line[uri[1]-1].needUpdate = true; //fix link bug, some wee need update 2 byte(this byte and prevous byte)\n            //for (var col = uri[0]; col < uri[1]; ++col)\n            //  line[col].fullurl = g;\n          }\n        }\n        //\n      }\n    }\n  },\n\n  clear: function(param) {\n    var rows = this.rows;\n    var cols = this.cols;\n    var lines = this.lines;\n\n    switch (param) {\n    case 0:\n      var line = lines[this.cur_y];\n      var col, row;\n      for (col = this.cur_x; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n      for (row = this.cur_y; row < rows; ++row) {\n        line = lines[row];\n        for (col = 0; col < cols; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n      }\n      break;\n    case 1:\n      var line;\n      var col, row;\n      for (row = 0; row < this.cur_y; ++row) {\n        line = lines[row];\n        for (col = 0; col < cols; ++col) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n      }\n      line = lines[this.cur_y];\n      for (col = 0; col < this.cur_x; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n      break;\n    case 2:\n      while (--rows >= 0) {\n        var col = cols;\n        var line = lines[rows];\n        while (--col >= 0) {\n          line[col].copyFrom(this.newChar);\n          line[col].needUpdate = true;\n        }\n      }\n      break;\n    }\n    this.changed = true;\n    this.gotoPos(0, 0);\n    this.queueUpdate();\n  },\n\n  back: function() {\n    if (this.cur_x > 0) {\n      --this.cur_x;\n      this.posChanged = true;\n      this.queueUpdate();\n    }\n  },\n\n  tab: function(param) {\n    var mod = this.cur_x % 4;\n    this.cur_x += 4 - mod;\n    if (param > 1) this.cur_x += 4 * (param-1);\n    if (this.cur_x >= this.cols)\n      this.cur_x = this.cols-1;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  backTab: function(param) {\n    var mod = this.cur_x % 4;\n    this.cur_x -= (mod > 0 ? mod : 4);\n    if (param > 1) this.cur_x -= 4 * (param-1);\n    if (this.cur_x < 0)\n      this.cur_x = 0;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  insert: function(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    var cur_x = this.cur_x;\n    if (cur_x > 0 && line[cur_x-1].isLeadByte) ++cur_x;\n    if (cur_x == cols) return;\n    if (cur_x + param >= cols) {\n      for(var col = cur_x; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n    } else {\n      while (--param >= 0) {\n        var ch = line.pop();\n        line.splice(cur_x, 0, ch);\n        ch.copyFrom(this.newChar);\n      }\n      for (var col = cur_x; col < cols; ++col)\n        line[col].needUpdate = true;\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  del: function(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    var cur_x = this.cur_x;\n    if (cur_x > 0 && line[cur_x-1].isLeadByte) ++cur_x;\n    if (cur_x == cols) return;\n    if (cur_x + param >= cols) {\n      for (var col = cur_x; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n    } else {\n      var n = cols - cur_x - param;\n      while (--n >= 0)\n        line.splice(cur_x, 0, line.pop());\n      for (var col = cols - param; col < cols; ++col)\n        line[col].copyFrom(this.newChar);\n      for (var col = cur_x; col < cols; ++col)\n        line[col].needUpdate = true;\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  eraseChar: function(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    var cur_x = this.cur_x;\n    if (cur_x > 0 && line[cur_x-1].isLeadByte) ++cur_x;\n    if (cur_x == cols) return;\n    var n = (cur_x + param > cols) ? cols : cur_x + param;\n    for (var col = cur_x; col < n; ++col) {\n      line[col].copyFrom(this.newChar);\n      line[col].needUpdate = true;\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  eraseLine: function(param) {\n    var line = this.lines[this.cur_y];\n    var cols = this.cols;\n    switch (param) {\n    case 0: // erase to rigth\n      for (var col = this.cur_x; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n      break;\n    case 1: //erase to left\n      var cur_x = this.cur_x;\n      for (var col = 0; col < cur_x; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate=true;\n      }\n      break;\n    case 2: //erase all\n      for (var col = 0; col < cols; ++col) {\n        line[col].copyFrom(this.newChar);\n        line[col].needUpdate = true;\n      }\n      break;\n    default:\n      return;\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  deleteLine: function(param) {\n    var scrollStart = this.scrollStart;\n    this.scrollStart = this.cur_y;\n    this.scroll(false, param);\n    this.scrollStart = scrollStart;\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  insertLine: function(param) {\n    var scrollStart = this.scrollStart;\n    if (this.cur_y < this.scrollEnd) {\n      this.scrollStart=this.cur_y;\n      this.scroll(true, param);\n    }\n    this.scrollStart = scrollStart;\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  scroll: function(up, n) {\n    var scrollStart=this.scrollStart;\n    var scrollEnd=this.scrollEnd;\n    if(scrollEnd<=scrollStart) {\n      scrollStart=0;\n      if(scrollEnd<1) scrollEnd=this.rows-1;\n    }\n    if(n>=this.rows) // scroll more than 1 page = clear\n      this.clear(2);\n    else if(n >= scrollEnd-scrollStart+1) {\n      var lines = this.lines;\n      var cols = this.cols;\n      for(var row=scrollStart; row <= scrollEnd; ++row) {\n        for(var col=0; col< cols; ++col) {\n          lines[row][col].copyFrom(this.newChar);\n          lines[row][col].needUpdate=true;\n        }\n      }\n    } else {\n      var lines = this.lines;\n      var rows = this.rows;\n      var cols = this.cols;\n\n      if (up) { // move lines down\n        for (var i = 0; i < rows-1-scrollEnd; ++i)\n          lines.unshift(lines.pop());\n        while (--n >= 0) {\n          var line = lines.pop();\n          lines.splice(rows-1-scrollEnd+scrollStart, 0, line);\n          for (var col = 0; col < cols; ++col)\n            line[col].copyFrom(this.newChar);\n        }\n        for (var i = 0; i < rows-1-scrollEnd; ++i)\n          lines.push(lines.shift());\n      } else { // move lines up\n        for (var i = 0; i < scrollStart; ++i)\n          lines.push(lines.shift());\n        while (--n >= 0) {\n          var line = lines.shift();\n          lines.splice(scrollEnd-scrollStart, 0, line);\n          for (var col = 0; col < cols; ++col) // clear the line\n            line[col].copyFrom(this.newChar);\n        }\n        for (var i = 0; i < scrollStart; ++i)\n          lines.unshift(lines.pop());\n      }\n\n      // update the whole screen within scroll region\n      for (var row = scrollStart; row <= scrollEnd; ++row) {\n        var line = lines[row];\n        for (var col = 0; col < cols; ++col) {\n          line[col].needUpdate = true;\n        }\n      }\n    }\n    this.changed = true;\n    this.queueUpdate();\n  },\n\n  gotoPos: function(x,y) {\n    // dump('gotoPos: ' + x + ', ' + y + '\\n');\n    if (x >= this.cols) x = this.cols-1;\n    if (y >= this.rows) y = this.rows-1;\n    if (x < 0) x = 0;\n    if (y < 0) y = 0;\n    this.cur_x = x;\n    this.cur_y = y;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  carriageReturn: function() {\n    this.cur_x = 0;\n    this.posChanged = true;\n    this.queueUpdate();\n  },\n\n  lineFeed: function() {\n    if (this.cur_y < this.scrollEnd) {\n      ++this.cur_y;\n      this.posChanged = true;\n      this.queueUpdate();\n    } else { // at bottom of screen\n      this.scroll(false, 1);\n    }\n  },\n\n  queueUpdate: function(directupdate) {\n    if (this.timerUpdate)\n      return;\n\n    var _this = this;\n    var func = function() {\n      _this.notify();\n    };\n    if (directupdate)\n      this.timerUpdate = setTimeout(func, 1);\n    else\n      this.timerUpdate = setTimeout(func, 30);\n  },\n\n  notify: function(timer) {\n    clearTimeout(this.timerUpdate);\n    this.timerUpdate = null;\n\n    if (this.changed) { // content changed\n      this.updateCharAttr();\n\n      this.setPageState();\n      if (this.useMouseBrowsing) {\n        // clear highlight and reset cursor on page change\n        // without the redraw being called here\n        this.clearHighlight();\n      }\n\n      if (this.enableDeleteDupLogin) {\n        if (this.pageState === 0) {\n          var strToSend = '\\r';\n          var lastRowText = this.getRowText(22, 0, this.cols);\n          var nextLastRowText = this.getRowText(21, 0, this.cols);\n          if (lastRowText.parseDuplicatedLoginTextLastRow() && \n              nextLastRowText.parseDuplicatedLoginText()) {\n            if (!this.deleteDupLogin) {\n              strToSend = 'n' + strToSend;\n            }\n            this.view.conn.send(strToSend);\n          }\n        }\n      }\n\n      this.dispatchEvent(new CustomEvent('change'));\n\n      if (this.view) {\n        this.view.update();\n      }\n      this.changed = false;\n\n      this.dispatchEvent(new CustomEvent('viewUpdate'));\n    }\n\n    if (this.posChanged) { // cursor pos changed\n      if (this.view) {\n        this.view.updateCursorPos();\n      }\n      this.posChanged=false;\n    }\n\n    if (this.view.blinkOn) {\n      this.view.blinkOn = false;\n      this.view.blinkShow = !this.view.blinkShow;\n      //\n      var allBlinkSpan = document.getElementsByTagName('x');\n      for (var i = 0; i < allBlinkSpan.length; i++) {\n        var c = (this.view.blinkShow && this.view.doBlink) ? allBlinkSpan[i].getAttribute(\"h\") : allBlinkSpan[i].getAttribute(\"s\");\n        allBlinkSpan[i].parentNode.setAttribute(\"class\", c);\n      }\n    }\n  },\n\n  getText: function(row, colStart, colEnd, color, isutf8, reset, lines) {\n    var text = '';\n    if (lines) {\n      text = lines[row];\n    } else {\n      text = this.lines[row];\n    }\n    // always start from leadByte, and end at second-byte of DBCS.\n    // Note: this might change colStart and colEnd. But currently we don't return these changes.\n    if (colStart == this.cols) return '';\n\n    if ( colStart > 0 ) {\n      if ( !text[colStart].isLeadByte && text[colStart-1].isLeadByte ) colStart--;\n    } else colStart = 0;\n\n    if ( colEnd > 0 ){\n      if ( text[colEnd-1].isLeadByte ) colEnd++;\n    } else colEnd = this.cols;\n\n    if (colStart >= colEnd) return '';\n\n    if (!this.view) return;\n\n    var charset = this.view.charset;\n\n    // generate texts with ansi color\n    if (color) {\n      var output = this.ansiCmp(this.newChar, text[colStart], reset);\n      for (var col = colStart; col < colEnd-1; ++col) {\n        if (isutf8 && text[col].isLeadByte && this.ansiCmp(text[col], text[col+1]))\n          output += this.ansiCmp(text[col], text[col+1]).replace(/m$/g, ';50m') + text[col].ch;\n        else\n          output += text[col].ch + this.ansiCmp(text[col], text[col+1]);\n      }\n      output += text[colEnd-1].ch + this.ansiCmp(text[colEnd-1], this.newChar);\n      return (isutf8 && charset != 'UTF-8' ? output.b2u() : output);\n    }\n\n    text = text.slice(colStart, colEnd);\n    return text.map( function(c, col, line) {\n      if (!c.isLeadByte) {\n        if (col >=1 && line[col-1].isLeadByte) { // second byte of DBCS char\n          var prevC = line[col-1];\n          var b5 = prevC.ch + c.ch;\n          if ((this.view && this.view.charset == 'UTF-8') || b5.length == 1)\n            return b5;\n          else\n            return b5.b2u();\n        } else\n          return c.ch;\n      }\n    }).join('');\n  },\n\n  findText: function(text, searchrow) {\n    var result = {col: -1, row: -1};\n    var searchStart = 0;\n    var searchEnd = this.cols - 1;\n    if (searchrow >= 0) searchStart = searchEnd = searchrow;\n    for (var row = searchStart; row <= searchEnd; ++row) {\n      var line = this.getText(row, 0, this.cols, false, true);\n      result.col = line.indexOf(text);\n      if (result.col >= 0) {\n        result.row = row;\n        break;\n      }\n    }\n    return result;\n  },\n\n  getRowText: function(row, colStart, colEnd, lines) {\n\n    var text = '';\n    if (lines) {\n      text = lines[row];\n    } else {\n      text = this.lines[row];\n    }\n    // always start from leadByte, and end at second-byte of DBCS.\n    // Note: this might change colStart and colEnd. But currently we don't return these changes.\n    if ( colStart > 0 ){\n      if ( !text[colStart].isLeadByte && text[colStart-1].isLeadByte ) colStart--;\n    } else colStart = 0;\n\n    if ( colEnd < this.cols ){\n      if ( text[colEnd].isLeadByte ) colEnd++;\n    } else colEnd = this.cols;\n\n    text = text.slice(colStart, colEnd);\n    var charset = this.view.charset;\n    let that = this;\n    return text.map( function(c, col, line) {\n      if (!c.isLeadByte) {\n        if (col >= 1 && line[col-1].isLeadByte) { // second byte of DBCS char\n          var prevC = line[col-1];\n          var b5 = prevC.ch + c.ch;\n          if ((that.view && that.view.charset == 'UTF-8') || b5.length == 1)\n            return b5;\n          else\n            return b5.b2u();\n        } else\n          return c.ch;\n      }\n    }).join('');\n\n  },\n\n  parseText: function(text) {\n    var strs = text.split('^');\n    var returnStr = strs[0];\n    for (var i = 1; i < strs.length; ++i) {\n      if (strs[i].length > 0) {\n        returnStr += String.fromCharCode(strs[i].charCodeAt(0) - 64);\n        returnStr += strs[i].substr(1);\n      } else if (i < strs.length-1) {\n        returnStr += '^' + strs[++i];\n      } else returnStr += '^';\n    }\n    return returnStr;\n  },\n\n  ansiCmp: function(preChar, thisChar, forceReset) {\n    var text = '';\n    var reset = forceReset;\n    if ((preChar.bright && !thisChar.bright) ||\n        (preChar.underLine && !thisChar.underLine) ||\n        (preChar.blink && !thisChar.blink) ||\n        (preChar.invert && !thisChar.invert)) reset = true;\n    if (reset) text = ';';\n    if ((reset || !preChar.bright) && thisChar.bright) text += '1;';\n    if ((reset || !preChar.underLine) && thisChar.underLine) text += '4;';\n    if ((reset || !preChar.blink) && thisChar.blink) text += '5;';\n    if ((reset || !preChar.invert) && thisChar.invert) text += '7;';\n    var DeFg = TermChar.defaultFg;\n    var DeBg = TermChar.defaultBg;\n    var thisFg = (thisChar.fg == -1) ? DeFg : thisChar.fg;\n    var preFg = (preChar.fg == -1) ? DeFg : preChar.fg;\n    var thisBg = (thisChar.bg == -1) ? DeBg : thisChar.bg;\n    var preBg = (preChar.bg == -1) ? DeBg : preChar.bg;\n    if (reset ? (thisFg != DeFg) : (preFg != thisFg))\n      text += '3' + thisFg + ';';\n    if (reset ? (thisBg != DeBg) : (preBg != thisBg))\n      text += '4' + thisBg + ';';\n    if (!text) return '';\n    else return ('\\x1b[' + text.substr(0,text.length-1) + 'm');\n  },\n\n  isFullWidth: function(str) {\n    var code = str.charCodeAt(0);\n    if (this.view.charset != 'UTF-8' || this.forceFullWidth) { // PTT support\n      if (code > 0x7f) return true;\n      else return false;\n    }\n    if ((code >= 0x1100 && code <= 0x115f) || \n        (code >= 0x2329 && code <= 0x232a) || \n        (code >= 0x2e80 && code <= 0x303e) || \n        (code >= 0x3040 && code <= 0xa4cf) || \n        (code >= 0xac00 && code <= 0xd7a3) || \n        (code >= 0xf900 && code <= 0xfaff) || \n        (code >= 0xfe30 && code <= 0xfe6f) || \n        (code >= 0xff00 && code <= 0xff60) || \n        (code >= 0xffe0 && code <= 0xffe6)) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n\n  isTextWrappedRow: function(row) {\n    // determine whether it is wrapped by looking for the ending \"\\\"\n    var rowText = this.getRowText(row, 0, this.cols);\n    var slashIndex = rowText.lastIndexOf('\\\\');\n    if (slashIndex > 0 ) {\n      var col = rowText.substr(0, slashIndex).u2b().length;\n      if (col != 77 && col != 78) return false;\n      // check the color\n      var ch = this.lines[row][col];\n      if (ch.fg == 7 && ch.bg === 0 && ch.bright)\n        return true;\n    }\n    return false;\n  },\n\n  setPageState: function() {\n    //this.pageState = 0; //NORMAL\n    var m_ColsPerPage = 80;\n    var lastRowText = this.getRowText(23, 0, this.cols);\n    if (lastRowText.indexOf('請按任意鍵繼續') > 0 || lastRowText.indexOf('請按 空白鍵 繼續') > 0) {\n      //console.log('pageState = 5 (PASS)');\n      this.pageState = 5; // some ansi drawing screen to pass\n      return;\n    }\n    if (lastRowText.indexOf(' 編輯文章  (^Z/F1)說明 (^P/^G)插入符號/範本 (^X/^Q)離開') === 0) {\n      this.pageState = 6;\n      return;\n    }\n    if (lastRowText.parseStatusRow()) {\n      this.pageState = 3; // READING\n      return;\n    }\n\n    var firstRowText = this.getRowText(0, 0, this.cols);\n\n    if ( this.isUnicolor(0, 0, 29) && this.isUnicolor(0, 60, 70) ) {\n      var main = firstRowText.indexOf('【主功能表】');\n      var classList = firstRowText.indexOf('【分類看板】');\n      var archiveList = firstRowText.indexOf('【精華文章】');\n      if (main === 0 || classList === 0 || archiveList === 0 ||\n          lastRowText.parseListRow()) {\n        //console.log('pageState = 1 (MENU)');\n        this.pageState = 1; // MENU\n      } else if (this.isUnicolor(2, 0, 70) && !this.isLineEmpty(1) && (this.cur_x < 19 || this.cur_y == 23)) {\n        //console.log('pageState = 2 (LIST)');\n        this.pageState = 2; // LIST\n      }\n    } else if ( this.isUnicolor(23, 28, 53) && this.cur_y == 23 && this.cur_x == 79) {\n      //console.log('pageState = 5 (PASS)');\n      this.pageState = 5; // some ansi drawing screen to pass\n    }\n    if (this.pageState != 1 && this.isLineEmpty(23)) {\n      //console.log('pageState = 0 (NORMAL)');\n      this.pageState = 0;\n    }\n  },\n\n  isPttZArea: function() {\n    var rows = 24;\n    var lines = this.lines;\n    if (this.view.charset != 'UTF-8') {\n      var line = lines[0];\n      var PTTstr1 = '\\xa1\\x69\\xba\\xeb\\xb5\\xd8\\xa4\\xe5\\xb3\\xb9\\xa1\\x6a';\n      for (var i = 0; i <= 11; ++i) {\n        if (line[i].ch != PTTstr1.charAt(i))\n          return false;\n      }\n      line = lines[rows-1];\n      var PTTstr2 = '\\xa1\\x69\\xa5\\x5c\\xaf\\xe0\\xc1\\xe4\\xa1\\x6a';\n      for (var i = 1; i <= 10; ++i) {\n        if (line[i].ch != PTTstr2.charAt(i-1))\n          return false;\n      }\n    } else {\n      var line = lines[0];\n      var PTTstr = '';\n      for (var i = 0; i <= 11; i+=2) {\n        PTTstr += line[i].ch;\n      }\n      if (PTTstr != this.PTTZSTR1)\n        return false;\n      line = lines[rows-1];\n      PTTstr = '';\n      for (var i = 1; i <= 10; i+=2) {\n        PTTstr+=line[i].ch;\n      }\n      if (PTTstr != this.PTTZSTR2)\n        return false;\n    }\n    return true;\n  },\n\n  isUnicolor: function(lineindex, start, end){\n    var lines = this.lines;\n    var line = lines[lineindex];\n    var clr = line[start].getBg();\n\n    // a dirty hacking, because of the difference between maple and firebird bbs.\n    for (var i = start; i < end; i++) {\n      var clr1 = line[i].getBg();\n      if (clr1 != clr || clr1 === 0)\n        return false;\n    }\n    return true;\n  },\n\n  isLineEmpty: function(iLine){\n    var rows = this.rows;\n    var lines = this.lines;\n    var line = lines[iLine];\n\n    for ( var col = 0; col < this.cols; col++ )\n      if ( line[col].ch != ' ' || line[col].getBg() )\n        return false;\n    return true;\n  },\n\n  onMouse_move: function(tcol, trow, doRefresh){\n    this.tempMouseCol = tcol;\n    this.tempMouseRow = trow;\n\n    if (this.nowHighlight != trow || doRefresh) {\n      this.clearHighlight();\n    }\n\n    switch( this.pageState ) {\n    case 0: //NORMAL\n      //SetCursor(m_ArrowCursor);\n      //m_CursorState = 0;\n      this.mouseCursor = 0;\n      break;\n\n    case 4: //LIST\n      if (trow>1 && trow < 22) {              //m_pTermData->m_RowsPerPage-1\n        if ( tcol <= 6 ) {\n          this.mouseCursor = 1;\n          this.clearHighlight();\n          //SetCursor(m_ExitCursor);m_CursorState=1;\n        } else if ( tcol >= 64 ) {            //m_pTermData->m_ColsPerPage-16\n          if ( trow > 12 )\n            this.mouseCursor = 3;\n          else\n            this.mouseCursor = 2;\n          this.clearHighlight();\n        } else {\n          if (!this.isLineEmpty(trow)) {\n            this.mouseCursor = 6;\n            this.nowHighlight = trow;\n          } else {\n            this.mouseCursor = 11;\n          }\n        }\n      } else if ( trow == 1 || trow == 2 ) {\n        this.mouseCursor = 2;\n      } else if ( trow === 0 ) {\n        this.mouseCursor = 4;\n      } else { // if ( trow == 23)\n        this.mouseCursor = 5;\n      }\n      break;\n\n    case 2: //LIST\n      if (trow > 2 && trow < 23) {              //m_pTermData->m_RowsPerPage-1\n        if ( tcol <= 6 ) {\n          this.mouseCursor = 1;\n          this.clearHighlight();\n          //SetCursor(m_ExitCursor);m_CursorState=1;\n        } else if ( tcol >= 64 ) {            //m_pTermData->m_ColsPerPage-16\n          if ( trow > 12 )\n            this.mouseCursor = 3;\n          else\n            this.mouseCursor = 2;\n          this.clearHighlight();\n        } else {\n          if (!this.isLineEmpty(trow)) {\n            this.mouseCursor = 6;\n            this.nowHighlight = trow;\n          } else {\n            this.mouseCursor = 11;\n          }\n        }\n      } else if ( trow == 1 || trow == 2 ) {\n        if ( tcol < 2 )//[\n          this.mouseCursor = 8;\n        else if ( tcol >75 )//]\n          this.mouseCursor = 9;\n        else\n          this.mouseCursor = 2;\n      } else if ( trow === 0 ) {\n        if ( tcol < 2 )//=\n          this.mouseCursor = 10;\n        else if ( tcol >75 )//]\n          this.mouseCursor = 9;\n        else\n          this.mouseCursor = 4;\n      } else { // if ( trow == 23)\n        if ( tcol < 2 )\n          this.mouseCursor = 12;\n        else if ( tcol >75 )\n          this.mouseCursor = 13;\n        else\n          this.mouseCursor = 5;\n      }\n      break;\n\n    case 3: //READING\n      if ( trow == 23) {\n        if ( tcol < 2 )//]\n          this.mouseCursor = 12;\n        else if ( tcol > 75 )\n          this.mouseCursor = 14;\n        else\n          this.mouseCursor = 5;\n      } else if ( trow === 0) {\n        if (tcol < 2)//=\n          this.mouseCursor = 10;\n        else if ( tcol >75 )//]\n          this.mouseCursor = 9;\n        else if ( tcol < 7 )\n          this.mouseCursor = 1;\n        else\n          this.mouseCursor = 2;\n      } else if ( trow == 1 || trow == 2) {\n        if (tcol < 2)//[\n          this.mouseCursor = 8;\n        else if ( tcol >75 )//]\n          this.mouseCursor = 9;\n        else if ( tcol < 7 )\n          this.mouseCursor = 1;\n        else\n          this.mouseCursor = 2;\n      } else if ( tcol < 7 )\n        this.mouseCursor = 1;\n      else if ( trow < 12)\n        this.mouseCursor = 2;\n      else\n        this.mouseCursor = 3;\n      break;\n\n    case 1: //MENU\n      if ( trow>0 && trow < 23 ) {\n        if (tcol > 7)\n          this.mouseCursor = 7;\n        else\n          this.mouseCursor = 1;\n      } else {\n        this.mouseCursor = 0;\n        //SetCursor(m_ArrowCursor);m_CursorState=0;\n      }\n      break;\n\n    default:\n      this.mouseCursor = 0;\n      break;\n    }\n\n    this.BBSWin.style.cursor = mouseCursorMap[this.mouseCursor];\n  },\n\n  resetMousePos: function() {\n    if (this.useMouseBrowsing) {\n      this.onMouse_move(this.tempMouseCol, this.tempMouseRow, true);\n    }\n  },\n\n  setHighlight: function(row) {\n    this._nowHighlight = row;\n    this.view.setHighlightedRow(row);\n  },\n\n  clearHighlight: function(){\n    this.nowHighlight = -1;\n    this.mouseCursor = 0;\n  }\n};\n\nEvent.mixin(TermBuf.prototype);\n\n\n\n// WEBPACK FOOTER //\n// ./js/term_buf.js","'use strict';\n\nimport { symbolTable } from './symbol_table';\nimport { HyperLinkPreview } from './image_preview';\n\nclass HyperLink extends React.Component {\n  render() {\n    return <a scol={this.props.col} srow={this.props.row}\n        className=\"y\" href={this.props.href} rel=\"noreferrer\" target=\"_blank\">\n        {this.props.inner}\n        </a>;\n  }\n}\n\nclass ColorSpan extends React.Component {\n  render() {\n    let classes = [\n      'q' + this.props.colorState.fg,\n      'b' + this.props.colorState.bg\n    ].join(' ');\n    let blinkNode = '';\n    if (this.props.colorState.blink) {\n      blinkNode = <x s={classes} h={'qq' + this.props.colorState.bg}></x>;\n    }\n    return <span className={classes}>{blinkNode}{this.props.inner}</span>;\n  }\n}\n\nclass NormalText extends React.Component {\n  render() {\n    return <span>{this.props.text}</span>;\n  }\n}\n\nclass ForceWidthWord extends React.Component {\n  render() {\n    let styles = {\n      display: 'inline-block'\n    };\n    if (this.props.forceWidth) {\n      styles['width'] = this.props.forceWidth.toString() + 'px';\n    }\n    return <span className=\"wpadding\" style={styles}>{this.props.inner}</span>;\n  }\n}\n\nclass TwoColorWord extends React.Component {\n  render() {\n    let c1 = this.props.colorLead, c2 = this.props.colorTail;\n    let classes = [];\n    if (c1.fg == c2.fg) {\n      classes.push('q' + c1.fg);\n    } else {\n      classes.push('w' + c1.fg);\n      classes.push('q' + c2.fg);\n      classes.push('o');\n    }\n    if (c1.bg == c2.bg) {\n      classes.push('b' + c1.bg);\n    } else {\n      classes.push('b' + c1.bg + 'b' + c2.bg);\n    }\n    // TODO: add blinking.\n    let styles = {};\n    if (this.props.forceWidth) {\n      classes.push('wpadding');\n      styles['display'] = 'inline-block';\n      styles['width'] = this.props.forceWidth.toString() + 'px';\n    }\n    return <span className={classes.join(' ')} style={styles}\n      data-text={this.props.text}>{this.props.text}</span>;\n  }\n}\n\nexport class ColorState {\n  constructor(fg, bg, blink) {\n    this.fg = fg;\n    this.bg = bg;\n    this.blink = blink;\n  }\n\n  equals(oth) {\n    if (oth instanceof ColorState) {\n      return this.fg == oth.fg && this.bg == oth.bg && this.blink == oth.blink;\n    }\n    return false;\n  }\n}\n\nclass ColorSegmentBuilder {\n  constructor(currCol) {\n    this.segs = [];\n    this.curr = null;\n    this.currCol = currCol;\n  }\n\n  _isLastSegmentSameColor(color) {\n    return this.curr && this.curr.colorState.equals(color);\n  }\n\n  _addSegment(color) {\n    this.curr = {\n      col: this.currCol,\n      colorState: color,\n      texts: []\n    };\n    this.segs.push(this.curr);\n  }\n\n  _append(type, text, color) {\n    if (!this._isLastSegmentSameColor(color))\n      this._addSegment(color);\n    this.curr.texts.push({\n      col: this.currCol,\n      type: type,\n      text: text\n    });\n  }\n\n  _reuseChars(type, color) {\n    if (!this._isLastSegmentSameColor(color))\n      return null;\n    let len = this.curr.texts.length;\n    if (len == 0)\n      return null;\n    let last = this.curr.texts[len - 1];\n    return last.type == type ? last : null;\n  }\n\n  _appendNormalText(width, text, color) {\n    let reuse = this._reuseChars('normalText', color);\n    if (reuse)\n      reuse.text += text;\n    else\n      this._append('normalText', text, color);\n    this.currCol += width;\n  }\n\n  appendNormalChar(text, color) {\n    this._appendNormalText(1, text, color);\n  }\n\n  appendNormalWord(text, color, forceWidth) {\n    if (forceWidth) {\n      this._append('forceWidthWord', text, color);\n      this.currCol += 2;\n    } else {\n      this._appendNormalText(2, text, color);\n    }\n  }\n\n  appendTwoColorWord(text, color, color2) {\n    this._addSegment(color);\n    this.curr.texts.push({\n      col: this.currCol,\n      type: 'twoColorWord',\n      text: text,\n      color: color,\n      color2: color2\n    });\n    this.currCol += 2;\n    this.curr = null;\n  }\n\n  build() {\n    return this.segs;\n  }\n}\n\nclass Row extends React.Component {\n  constructor() {\n    super();\n    this.state = {highlighted: false};\n  }\n\n  _segmentHyperLinks(chars) {\n    let segments = [];\n    let cur = null;\n    for (let i = 0; i < chars.length; i++) {\n      let ch = chars[i];\n      if (!cur || ch.isStartOfURL()) {\n        cur = {\n          col: i,\n          href: ch.isStartOfURL() ? ch.getFullURL() : null,\n          chars: []\n        };\n        segments.push(cur);\n      }\n      cur.chars.push(ch);\n      if (ch.isEndOfURL())\n        cur = null;\n    }\n    return segments;\n  }\n\n  _segmentTwoColorDBCS(colOffset, chars) {\n    let builder = new ColorSegmentBuilder(colOffset);\n    let lead = null;\n    for (let ch of chars) {\n      if (ch.isLeadByte) {\n        lead = ch;\n        continue;\n      }\n      if (lead) {\n        let u = (lead.ch + ch.ch).b2u();\n        if (u.length == 1) {\n          if (this._isBadDBCS(u)) {\n            builder.appendNormalChar('?', lead.getColor());\n            builder.appendNormalChar('?', ch.getColor());\n          } else if (lead.getColor().equals(ch.getColor())) {\n            builder.appendNormalWord(u, lead.getColor(),\n              this._shouldForceWidth(u) ? this.props.forceWidth : 0);\n          } else {\n            builder.appendTwoColorWord(u, lead.getColor(), ch.getColor());\n          }\n        } else {\n          // Conversion error.\n          builder.appendNormalChar('?', lead.getColor());\n          builder.appendNormalChar(ch.ch == '\\x20' ? ' ' : '?', ch.getColor());\n        }\n        lead = null\n      } else {\n        builder.appendNormalChar(ch.ch, ch.getColor());\n      }\n    }\n    return builder.build();\n  }\n\n  render() {\n    let colOffset = 0;\n    let cols = [];\n    let linkPreviews = [];\n    for (let linkSeg of this._segmentHyperLinks(this.props.chars)) {\n      let inner = [];\n      for (let colorSeg of this._segmentTwoColorDBCS(colOffset, linkSeg.chars)) {\n        let texts = [];\n        for (let ch of colorSeg.texts) {\n          let key = 'text-c-' + ch.col;\n          let forceWidth = this.props.forceWidth ? this.props.forceWidth : 0;\n          switch (ch.type) {\n            case 'normalText':\n              texts.push(<NormalText key={key} text={ch.text} />);\n              break;\n            case 'forceWidthWord':\n              texts.push(<ForceWidthWord key={key} inner={ch.text}\n                forceWidth={forceWidth} />);\n              break;\n            case 'twoColorWord':\n              texts.push(<TwoColorWord key={key} text={ch.text}\n                colorLead={ch.color} colorTail={ch.color2}\n                forceWidth={forceWidth} />);\n              break;\n          }\n        }\n        let key = 'colorSpan-c-' + colorSeg.col;\n        inner.push(<ColorSpan key={key} colorState={colorSeg.colorState}\n          inner={texts} />);\n      }\n      if (linkSeg.href) {\n        let key = 'hyperLink-c-' + linkSeg.col;\n        cols.push(<HyperLink key={key} href={linkSeg.href} inner={inner}\n          data-scol={linkSeg.col} data-srow={this.props.row} />);\n        // TODO: Modularize this.\n        if (this.props.showsLinkPreviews) {\n          linkPreviews.push(\n            <HyperLinkPreview key={key} src={linkSeg.href} />);\n        }\n      } else {\n        cols = cols.concat(inner);\n      }\n      colOffset += linkSeg.chars.length;\n    }\n    let classes = [];\n    if (this.state.highlighted) {\n      classes.push('b2');\n    }\n    // TODO: Detect userid and apply class \"blu_$userid\".\n    return (\n      <div>\n        <span key=\"line\" className={classes.join(' ')}\n            data-type=\"bbsline\"\n            data-row={this.props.row}>{cols}</span>\n        <div key=\"previews\">{linkPreviews}</div>\n      </div>\n    );\n  }\n\n  setHighlight(shouldHighlight) {\n    if (this.state.highlighted != shouldHighlight) {\n      this.setState({highlighted: shouldHighlight});\n    }\n  }\n\n  _isBadDBCS(u) {\n    return symbolTable['x' + u.charCodeAt(0).toString(16)] == 3;\n  }\n\n  _shouldForceWidth(u) {\n    let code = symbolTable['x' + u.charCodeAt(0).toString(16)];\n    return code == 1 || code == 2;\n  }\n}\n\nexport function renderRowHtml(chars, row, forceWidth, showsLinkPreviews, cont) {\n  return ReactDOM.render(\n    <Row chars={chars} row={row} forceWidth={forceWidth}\n      showsLinkPreviews={showsLinkPreviews} />, cont);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term_ui.jsx","'use strict';\n\nimport { ImageURL } from './image_urls';\n\n// ImagePreview shows a spinner or a image that moves along with cursor.\n// It shows a spinner and hides image when the image is loading. Reverse\n// afterwards.\n//\n// @prop src the URL of image to diaplay; empty string hides components.\nclass ImagePreview extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      left: 0,\n      top: 0,\n      spinning: !!this.props.src,\n    };\n  }\n\n  componentDidMount() {\n    this._mouseMoveListener = this._onMouseMove.bind(this);\n    document.addEventListener('mousemove', this._mouseMoveListener);\n  }\n\n  componentWillUnmount() {\n    if (this._mouseMoveListener) {\n      document.removeEventListener('mousemove', this._mouseMoveListener);\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.src != nextProps.src) {\n      this.setState({spinning: !!nextProps.src});\n    }\n  }\n\n  _onMouseMove(e) {\n    this.setState({\n      left: e.clientX,\n      top: e.clientY\n    });\n  }\n\n  _imageStyle() {\n    if (!this._preview || this.props.src === '' || this.state.spinning) {\n      return {'display': 'none'};\n    }\n\n    let mouseHeight = this.state.top;\n    let curX = this.state.left;\n    let pageHeight = $(window).height();\n    let imageHeight = this._preview.clientHeight;\n    let imgTop = 20;\n\n    // opening image would pass the bottom of the page\n    if (mouseHeight + imageHeight / 2 > pageHeight - 20) {\n      if (imageHeight / 2 < mouseHeight) {\n        imgTop = pageHeight - 20 - imageHeight;\n      }\n    } else if (mouseHeight - 20 > imageHeight / 2) {\n      imgTop = mouseHeight - imageHeight / 2;\n    }\n\n    return {\n      'display': this.state.spinning ? 'none' : 'block',\n      'position': 'absolute',\n      'left': (curX + 20) + 'px',\n      'top': imgTop + 'px',\n      'maxHeight': '80%',\n      'maxWidth': '90%',\n      'zIndex': 2\n    };\n  }\n\n  _spinnerStyle() {\n    if (!this.state.spinning) {\n      return {'display': 'none'};\n    }\n    return {\n      'position': 'absolute',\n      'left': (this.state.left + 20) + 'px',\n      'top': this.state.top + 'px',\n      'zIndex': 2\n    };\n  }\n\n  _stopSpinner() {\n    this.setState({spinning: false});\n  }\n\n  _onImageLoaded() {\n    this._stopSpinner();\n    // Recalculate position.\n    this.forceUpdate();\n  }\n\n  render() {\n    return (\n      <div>\n        <img\n            key=\"preview\"\n            ref={(img) => { this._preview = img; }}\n            src={this.props.src}\n            style={this._imageStyle()}\n            onLoad={this._onImageLoaded.bind(this)}></img>\n        <i \n            key=\"spinner\"\n            className=\"glyphicon glyphicon-refresh glyphicon-refresh-animate\"\n            style={this._spinnerStyle()}></i>\n      </div>\n    );\n  }\n}\n\n// BaseAsyncImagePreview is a base class for general async image.\n// When the image URL is determined, the loadable image URL is available via\n// resolvedSrc in state.\n//\n// @prop src the URL for image; it accepts indirect links by using ImageURL\n// module.\n//\n// TODO: This should be a plain class rather than extending from\n// React.Component.\nclass BaseAsyncImagePreview extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {resolvedSrc: ''};\n  }\n\n  componentDidMount() {\n    this._startFetch(this.props.src);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.src != nextProps.src) {\n      this._startFetch(nextProps.src);\n    }\n  }\n\n  _startFetch(src) {\n    // Remove previous image.\n    this.setState({resolvedSrc: ''});\n    if (!src) {\n      return;\n    }\n    let p = ImageURL.create(src);\n    if (p) {\n      let cb = (resolvedSrc) => {\n        this._onResolve(resolvedSrc, src);\n      };\n      p.fetchSrc().then(cb);\n    }\n  }\n\n  _onResolve(src, forSrc) {\n    if (forSrc != this.props.src) {\n      // Outdated result.\n      return;\n    }\n    this.setState({resolvedSrc: src});\n  }\n}\n\n// AsyncImagePreview resolves image location using ImageURL and displays as\n// ImagePreview.\nclass AsyncImagePreview extends BaseAsyncImagePreview {\n  render() {\n    return <ImagePreview src={this.state.resolvedSrc} />;\n  }\n}\n\nexport function renderImagePreview(cont, src) {\n  return ReactDOM.render(<AsyncImagePreview src={src} />, cont);\n}\n\n// HyperLinkPreview resolves image location using ImageURL and displays with\n// a img element.\nexport class HyperLinkPreview extends BaseAsyncImagePreview {\n  render() {\n    if (this.state.resolvedSrc) {\n      return <img className=\"easyReadingImg hyperLinkPreview\" src={this.state.resolvedSrc} />;\n    } else {\n      return <div />;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/image_preview.jsx","import { App } from './pttchrome';\r\nimport { setupI18n } from './i18n';\r\nimport { getQueryVariable } from './util';\r\n\r\nfunction startApp() {\r\n  var site = getQueryVariable('site');\r\n  var from = getQueryVariable('from');\r\n  var keepAlive = getQueryVariable('keepAlive');\r\n  setupI18n();\r\n\r\n  pttchrome.app = new App(function(app) {\r\n    app.setInputAreaFocus();\r\n    $('#BBSWindow').show();\r\n    //$('#sideMenus').show();\r\n    app.onWindowResize();\r\n  }, { from: from, keepAlive: keepAlive });\r\n}\r\n\r\nfunction loadTable(url) {\r\n  return new Promise(function(resolve, reject) {\r\n    $.ajax({\r\n      url: url,\r\n      processData: false,\r\n      xhrFields: {\r\n        responseType: 'arraybuffer'\r\n      }\r\n    }).done(function(data) {\r\n      resolve(data);\r\n    }).fail(function(jqXHR, textStatus, errorThrown) {\r\n      console.log('loadTable failed: ' + textStatus + ': ' + url);\r\n      reject();\r\n    });\r\n  });\r\n}\r\n\r\nfunction loadResources() {\r\n  Promise.all([\r\n    loadTable('conv/b2u_table.bin'),\r\n    loadTable('conv/u2b_table.bin')\r\n  ]).then(function(binData) {\r\n    window.lib = window.lib || {};\r\n    window.lib.b2uArray = new Uint8Array(binData[0]);\r\n    window.lib.u2bArray = new Uint8Array(binData[1]);\r\n    $(document).ready(startApp);\r\n  }, function() {\r\n    console.log('loadResources failed');\r\n  });\r\n}\r\n\r\nloadResources();\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/main.js","// Main Program\n\nimport { AnsiParser } from './ansi_parser';\nimport { TermView } from './term_view';\nimport { TermBuf } from './term_buf';\nimport { TelnetConnection } from './telnet';\nimport { Websocket } from './websocket';\nimport { EasyReading } from './easy_reading';\nimport { InputHelper } from './input_helper';\nimport { PttChromePref } from './pref';\nimport { TouchController } from './touch_controller';\nimport { i18n } from './i18n';\nimport { getQueryVariable, setTimer, dumpLog } from './util';\n\npttchrome = pttchrome || {};\n\npttchrome.App = function(onInitializedCallback, options) {\n\n  this.CmdHandler = document.getElementById('cmdHandler');\n  this.CmdHandler.setAttribute('useMouseBrowsing', '1');\n  this.CmdHandler.setAttribute('doDOMMouseScroll','0');\n  //this.CmdHandler.setAttribute('useMouseUpDown', '0');\n  //this.CmdHandler.setAttribute('useMouseSwitchPage', '0');\n  //this.CmdHandler.setAttribute(\"useMouseReadThread\", '0');\n  this.CmdHandler.setAttribute('useTextDragAndDrop', '0');\n  this.CmdHandler.setAttribute('webContextMenu', '1');\n  this.CmdHandler.setAttribute('SavePageMenu', '1');\n  this.CmdHandler.setAttribute('EmbeddedPlayerMenu', '1');\n  this.CmdHandler.setAttribute('PreviewPictureMenu', '0');\n  this.CmdHandler.setAttribute('PushThreadMenu', '0');\n  this.CmdHandler.setAttribute('OpenAllLinkMenu', '0');\n  this.CmdHandler.setAttribute(\"MouseBrowseMenu\", '0');\n  this.CmdHandler.setAttribute('FileIoMenu', '0');\n  this.CmdHandler.setAttribute('ScreenKeyboardMenu', '1');\n  this.CmdHandler.setAttribute('ScreenKeyboardOpened', '0');\n  this.CmdHandler.setAttribute('DragingWindow', '0');\n  this.CmdHandler.setAttribute('MaxZIndex', 11);\n  this.CmdHandler.setAttribute('allowDrag','0');\n  this.CmdHandler.setAttribute('haveLink','0');\n  //this.CmdHandler.setAttribute('onLink','0');\n  //this.CmdHandler.setAttribute('onPicLink','0');\n  this.CmdHandler.setAttribute('draging','0');\n  this.CmdHandler.setAttribute('textSelected','0');\n  this.CmdHandler.setAttribute('dragType','');\n  this.CmdHandler.setAttribute('LastPicAddr', '0');\n  this.CmdHandler.setAttribute('isMouseRightBtnDrag','0');\n\n  this.CmdHandler.setAttribute('hideBookMarkLink','1');\n  this.CmdHandler.setAttribute('hideSendLink','1');\n  this.CmdHandler.setAttribute('hideBookMarkPage','1');\n  this.CmdHandler.setAttribute('hideSendPage','1');\n  this.CmdHandler.setAttribute('hideViewInfo','1');\n  this.CmdHandler.setAttribute('SkipMouseClick','0');\n  this.pref = null;\n\n  this.view = new TermView(24);\n  this.buf = new TermBuf(80, 24);\n  this.buf.setView(this.view);\n  //this.buf.severNotifyStr=this.getLM('messageNotify');\n  //this.buf.PTTZSTR1=this.getLM('PTTZArea1');\n  //this.buf.PTTZSTR2=this.getLM('PTTZArea2');\n  this.view.setBuf(this.buf);\n  this.view.setCore(this);\n  this.parser = new AnsiParser(this.buf);\n  this.easyReading = new EasyReading(this, this.view, this.buf);\n\n  //new pref - start\n  this.antiIdleStr = '\\x1b\\x1b';\n  this.antiIdleTime = 0;\n  this.idleTime = 0;\n  //new pref - end\n\n  // for picPreview\n  this.curX = 0;\n  this.curY = 0;\n\n  this.inputArea = document.getElementById('t');\n  this.BBSWin = document.getElementById('BBSWindow');\n\n  // horizontally center bbs window\n  this.BBSWin.setAttribute(\"align\", \"center\");\n  this.view.mainDisplay.style.transformOrigin = 'center';\n\n  this.mouseLeftButtonDown = false;\n  this.mouseRightButtonDown = false;\n\n  this.inputAreaFocusTimer = null;\n  this.alertBeforeUnload = false;\n  this.modalShown = false;\n\n  this.inputHelper = new InputHelper(this);\n\n  this.lastSelection = null;\n\n  this.waterball = { userId: '', message: '' };\n  this.appFocused = true;\n\n  this.endTurnsOnLiveUpdate = false;\n  this.copyOnSelect = false;\n  var version = window.navigator.userAgent.match(/Chrom(e|ium)\\/(\\d+)\\./);\n  if (version && version.length > 2) {\n    this.chromeVersion = parseInt(version[2], 10);\n  }\n\n  var self = this;\n  this.CmdHandler.addEventListener(\"OverlayCommand\", function(e) {\n    self.overlayCommandListener(e);\n  }, false);\n\n  window.addEventListener('click', function(e) {\n    self.mouse_click(e);\n  }, false);\n\n  window.addEventListener('mousedown', function(e) {\n    self.mouse_down(e);\n  }, false);\n\n  $(window).mousedown(function(e) {\n    var ret = self.middleMouse_down(e);\n    if (ret === false) {\n      return false;\n    }\n  });\n\n  window.addEventListener('mouseup', function(e) {\n    self.mouse_up(e);\n  }, false);\n\n  document.addEventListener('mousemove', function(e) {\n    self.mouse_move(e);\n  }, false);\n\n  document.addEventListener('mouseover', function(e) {\n    self.mouse_over(e);\n  }, false);\n\n  window.addEventListener('mousewheel', function(e) {\n    self.mouse_scroll(e);\n  }, true);\n\n  window.addEventListener('contextmenu', function(e) {\n    self.context_menu(e);\n  }, false);\n\n  window.addEventListener('focus', function(e) {\n    self.appFocused = true;\n    if (self.view.titleTimer) {\n      self.view.titleTimer.cancel();\n      self.view.titleTimer = null;\n      document.title = self.connectedUrl.site;\n      self.view.notif.close();\n    }\n  }, false);\n\n  window.addEventListener('blur', function(e) {\n    self.appFocused = false;\n  }, false);\n\n  this.strToCopy = null;\n  document.addEventListener('copy', function(e) {\n    self.onDOMCopy(e);\n  });\n  this.inputArea.addEventListener('paste', function(e) {\n    self.onDOMPaste(e);\n  });\n\n  this.view.innerBounds = this.getWindowInnerBounds();\n  this.view.firstGridOffset = this.getFirstGridOffsets();\n  window.onresize = function() {\n    self.onWindowResize();\n  };\n\n  this.isFromApp = (options.from === 'app');\n\n  this.dblclickTimer=null;\n  this.mbTimer=null;\n  this.timerEverySec=null;\n  this.pushthreadAutoUpdateCount = 0;\n  this.maxPushthreadAutoUpdateCount = -1;\n  this.onWindowResize();\n  this.setupDeveloperModeAlert();\n  this.setupConnectionAlert();\n  this.setupPasteShortcutAlert();\n  this.setupLiveHelper();\n  this.setupOtherSiteInput();\n  this.setupContextMenus();\n  this.contextMenuShown = false;\n\n  this.pref = new PttChromePref(this, onInitializedCallback);\n\n  (new Promise(function(resolve, reject) {\n    if (pttchrome.Constants.DEVELOPER_MODE) {\n      $('#developerModeAlertDismiss').click(function(e) {\n        $('#developerModeAlert').hide();\n        resolve();\n      });\n      $('#developerModeAlert').show();\n    } else {\n      resolve();\n    }\n  })).then(function() {\n    // connect.\n    self.connect(getQueryVariable('site') || pttchrome.Constants.DEFAULT_SITE);\n\n    // TODO: Call onSymFont for font data when it's implemented.\n\n    console.log(\"load pref from storage\");\n    // call getStorage to trigger load setting\n    self.pref.getStorage();\n  });\n\n  // init touch only if chrome is higher than version 36\n  if (this.chromeVersion && this.chromeVersion >= 37) {\n    this.touch = new TouchController(this);\n  }\n};\n\npttchrome.App.prototype.isConnected = function() {\n  return this.connectState == 1 && !!this.conn;\n};\n\npttchrome.App.prototype.connect = function(url) {\n  this.connectState = 0;\n  console.log('connect: ' + url);\n\n  var parsed = this._parseURLSimple(url);\n  if (parsed.protocol == 'wsstelnet') {\n    this._setupWebsocketConn('wss://' + parsed.hostname + parsed.path);\n  } else if (parsed.protocol == 'wstelnet') {\n    this._setupWebsocketConn('ws://' + parsed.hostname + parsed.path);\n  } else {\n    console.log('unsupport connect url protocol: ' + parser.protocol);\n    return;\n  }\n\n  this.connectedUrl = {\n    url: url,\n    site: parsed.hostname,\n    port: parsed.port,\n    easyReadingSupported: true\n  };\n};\n\npttchrome.App.prototype._parseURLSimple = function(url) {\n  var protocol = url.split(/:\\/\\//, 2);\n  if (protocol.length != 2)\n    return null;\n  var hostname = protocol[1].split(/\\//, 2);\n  var hostport = hostname[0].split(/:/);\n  if (hostport > 2)\n    return null;\n  var port = hostport.length > 1 ? parseInt(hostport[1]) : {\n    'wstelnet': 80,\n    'wsstelnet': 443,\n    'telnet': 23,\n    'ssh': 22\n  }[protocol[0]];\n  return {\n    protocol: protocol[0],\n    hostname: hostname[0],\n    host: hostport[0],\n    port: port,\n    path: '/' + (hostname.length > 1 ? hostname[1] : '')\n  };\n};\n\npttchrome.App.prototype._setupWebsocketConn = function(url) {\n  var wsConn = new Websocket(url);\n  this._attachConn(new TelnetConnection(wsConn));\n};\n\npttchrome.App.prototype._attachConn = function(conn) {\n  var self = this;\n  this.conn = conn;\n  this.conn.addEventListener('open', this.onConnect.bind(this));\n  this.conn.addEventListener('close', this.onClose.bind(this));\n  this.conn.addEventListener('data', function(e) {\n    self.onData(e.detail.data);\n  });\n};\n\npttchrome.App.prototype.onConnect = function() {\n  this.conn.isConnected = true;\n  this.view.setConn(this.conn);\n  $('#connectionAlert').hide();\n  dumpLog(DUMP_TYPE_LOG, \"pttchrome onConnect\");\n  this.connectState = 1;\n  this.updateTabIcon('connect');\n  this.idleTime = 0;\n  var self = this;\n  this.timerEverySec = setTimer(true, function() {\n    self.antiIdle();\n    self.view.onBlink();\n    self.incrementCountToUpdatePushthread();\n  }, 1000);\n  this.view.resetCursorBlink();\n  if (this.alertBeforeUnload)   this.regExitAlert();\n};\n\npttchrome.App.prototype.onData = function(data) {\n//dumpLog(DUMP_TYPE_LOG, \"pttchrome onData\");\n  this.parser.feed(data);\n\n  if (!this.appFocused && this.view.enableNotifications) {\n    // parse received data for waterball\n    var wb = data.b2u().parseWaterball();\n    if (wb) {\n      if ('userId' in wb) {\n        this.waterball.userId = wb.userId;\n      }\n      if ('message' in wb) {\n        this.waterball.message = wb.message;\n      }\n      this.view.showWaterballNotification();\n    }\n  }\n};\n\npttchrome.App.prototype.onClose = function() {\n  dumpLog(DUMP_TYPE_LOG, \"pttchrome onClose\");\n  if (this.timerEverySec) {\n    this.timerEverySec.cancel();\n  }\n  if (this.view.cursorBlinkTimer) {\n    this.view.cursorBlinkTimer.cancel();\n  }\n  this.conn.isConnected = false;\n\n  this.cancelMbTimer();\n  this.unregExitAlert();\n\n  this.connectState = 2;\n  this.idleTime = 0;\n\n  $('#connectionAlert').show();\n  this.updateTabIcon('disconnect');\n};\n\npttchrome.App.prototype.sendData = function(str) {\n  if (this.connectState == 1)\n    this.conn.convSend(str);\n};\n\npttchrome.App.prototype.sendCmdData = function(str) {\n  if (this.connectState == 1)\n    this.conn.send(str);\n};\n\npttchrome.App.prototype.cancelMbTimer = function() {\n  if (this.mbTimer) {\n    this.mbTimer.cancel();\n    this.mbTimer = null;\n  }\n};\n\npttchrome.App.prototype.setMbTimer = function() {\n  this.cancelMbTimer();\n  var _this = this;\n  this.mbTimer = setTimer(false, function() {\n    _this.mbTimer.cancel();\n    _this.mbTimer = null;\n    _this.CmdHandler.setAttribute('SkipMouseClick', '0');\n  }, 100);\n};\n\npttchrome.App.prototype.cancelDblclickTimer = function() {\n  if (this.dblclickTimer) {\n    this.dblclickTimer.cancel();\n    this.dblclickTimer = null;\n  }\n};\n\npttchrome.App.prototype.setDblclickTimer = function() {\n  this.cancelDblclickTimer();\n  var _this = this;\n  this.dblclickTimer = setTimer(false, function() {\n    _this.dblclickTimer.cancel();\n    _this.dblclickTimer = null;\n  }, 350);\n};\n\npttchrome.App.prototype.setInputAreaFocus = function() {\n  if (this.modalShown || (this.touch && this.touch.touchStarted))\n    return;\n  //this.DocInputArea.disabled=\"\";\n  this.inputArea.focus();\n};\n\npttchrome.App.prototype.setupLiveHelper = function() {\n  $('#liveHelperEnable').text(i18n('liveHelperEnable'));\n  $('#liveHelperSpan').text(i18n('liveHelperSpan'));\n  $('#liveHelperSpanSec').text(i18n('liveHelperSpanSec'));\n\n  var self = this;\n  $('#liveHelperEnable').click(function(e) {\n    self.onLiveHelperEnableClicked(true);\n  });\n  $('#liveHelperEnable').tooltip({title:'Alt + r'});\n\n  $('#liveHelperSec').change(function(e) {\n    var sec = $(this).val();\n    if (sec < 1) {\n      sec = 1;\n      $(this).val(sec);\n    }\n    var enableThis = $('#liveHelperEnable').hasClass('active');\n    if (enableThis) {\n      self.setAutoPushthreadUpdate(sec);\n    }\n  });\n\n  $('#liveHelperClose').click(function(e) {\n    $('#liveHelper').hide();\n  });\n};\n\npttchrome.App.prototype.onLiveHelperEnableClicked = function(fromUi) {\n  var enableThis = !$('#liveHelperEnable').hasClass('active');\n  if (enableThis) {\n    // cancel easy reading mode first\n    this.view.useEasyReadingMode = false;\n    this.switchToEasyReadingMode();\n    var sec = $('#liveHelperSec').val();\n    this.setAutoPushthreadUpdate(sec);\n    if (!fromUi) {\n      $('#liveHelperEnable').addClass('active');\n    }\n  } else {\n    this.disableLiveHelper(fromUi);\n  }\n};\n\npttchrome.App.prototype.disableLiveHelper = function(fromUi) {\n  this.setAutoPushthreadUpdate(-1);\n  if (!fromUi) {\n    $('#liveHelperEnable').removeClass('active');\n  }\n};\n\npttchrome.App.prototype.switchToEasyReadingMode = function(doSwitch) {\n  this.easyReading.leaveCurrentPost();\n  if (doSwitch) {\n    this.disableLiveHelper();\n    // clear the deep cloned copy of lines\n    this.buf.pageLines = [];\n    if (this.buf.pageState == 3) this.view.conn.send('\\x1b[D\\x1b[C'); //this.view.conn.send('qr');\n  } else {\n    this.view.mainContainer.style.paddingBottom = '';\n    this.view.lastRowIndex = 22;\n    this.view.lastRowDiv.style.display = '';\n    this.view.replyRowDiv.style.display = '';\n    // clear the deep cloned copy of lines\n    this.buf.pageLines = [];\n  }\n  // request the full screen\n  this.view.conn.send('^L'.unescapeStr());\n};\n\npttchrome.App.prototype.setupDeveloperModeAlert = function() {\n  $('#developerModeAlertReconnect').empty();\n  $('#developerModeAlertHeader').text(i18n('alert_developerModeHeader'));\n  $('#developerModeAlertText').text(i18n('alert_developerModeText'));\n  $('#developerModeAlertDismiss').text(i18n('alert_developerModeDismiss'));\n};\n\npttchrome.App.prototype.setupConnectionAlert = function() {\n  $('#connectionAlertReconnect').empty();\n  $('#connectionAlertHeader').text(i18n('alert_connectionHeader'));\n  $('#connectionAlertText').text(i18n('alert_connectionText'));\n  $('#connectionAlertReconnect').text(i18n('alert_connectionReconnect'));\n  $('#connectionAlertPortOption1').text(i18n('alert_connectionPortOption1'));\n  $('#connectionAlertPortOption2').text(i18n('alert_connectionPortOption2'));\n\n  var self = this;\n  $('#connectionAlertReconnect').click(function(e) {\n    self.connect(self.connectedUrl.url);\n    $('#connectionAlert').hide();\n  });\n  $('#connectionAlertPortOption2').click(function(e) {\n    var port = 443;\n    var site = 'ptt.cc';\n    if (self.connectedUrl.site) {\n      site = self.connectedUrl.site;\n    }\n\n    if (self.isFromApp) {\n      /*\n       * fixing a problem url won't open tab in packaged app mode:\n       * - this used to happen only when user click on \"try 443 port\" after a\n       * disconnection.\n       * - it seems to related with the window.location.replace method\n       */\n\n      self.connect(site + ':' + port);\n    } else {\n      window.location.replace('?site=' + site + ':'+ port);\n    }\n  });\n};\n\npttchrome.App.prototype.setupPasteShortcutAlert = function(){\n  $('#pasteShortcutHeader').text(i18n('alert_pasteShortcutHeader'));\n  $('#pasteShortcutText').text(i18n('alert_pasteShortcutText'));\n  $('#pasteShortcutClose').text(i18n('alert_pasteShortcutClose'));\n  $('#pasteShortcutClose').click(function(e) {\n    $('#pasteShortcutAlert').modal('hide');\n    self.modalShown = false;\n  });\n};\n\npttchrome.App.prototype.setupOtherSiteInput = function() {\n  var self = this;\n  $('#siteModal input').attr('placeholder', i18n('input_sitePlaceholder'));\n  $('#siteModal input').keyup(function(e) {\n    if (e.keyCode == 13) {\n      var url = $(this).val();\n      self.connect(url);\n      $('#siteModal').modal('hide');\n    }\n  });\n  $('#siteModal').on('shown.bs.modal', function(e) {\n    $('#connectionAlert').hide();\n    self.modalShown = true;\n    $('#siteModal input').val('');\n    $('#siteModal input').focus();\n  });\n  $('#siteModal').on('hidden.bs.modal', function(e) {\n    $('#connectionAlert').hide();\n    self.modalShown = false;\n  });\n\n};\n\npttchrome.App.prototype.doCopy = function(str) {\n  if (str.indexOf('\\x1b') < 0) {\n    str = str.replace(/\\r\\n/g, '\\r');\n    str = str.replace(/\\n/g, '\\r');\n    str = str.replace(/ +\\r/g, '\\r');\n  }\n  this.strToCopy = str;\n  document.execCommand('copy');\n};\n\npttchrome.App.prototype.doCopyAnsi = function() {\n  if (!this.lastSelection)\n    return;\n\n  var selection = this.lastSelection;\n  var pageLines = null;\n  if (this.view.useEasyReadingMode && this.buf.pageState == 3) {\n    pageLines = this.buf.pageLines;\n  }\n\n  var ansiText = '';\n  if (selection.start.row == selection.end.row) {\n    ansiText += this.buf.getText(selection.start.row, selection.start.col, selection.end.col, true, true, false, pageLines);\n  } else {\n    for (var i = selection.start.row; i <= selection.end.row; ++i) {\n      var scol = 0;\n      var ecol = this.buf.cols-1;\n      if (i == selection.start.row) {\n        scol = selection.start.col;\n      } else if (i == selection.end.row) {\n        ecol = selection.end.col;\n      }\n      ansiText += this.buf.getText(i, scol, ecol, true, true, false, pageLines);\n      if (i != selection.end.row ) {\n        ansiText += '\\r';\n      }\n    }\n  }\n\n  this.doCopy(ansiText);\n};\n\npttchrome.App.prototype.onDOMCopy = function(e) {\n  if (this.strToCopy) {\n    e.clipboardData.setData('text', this.strToCopy);\n    e.preventDefault();\n    console.log('copied: ', this.strToCopy);\n    this.strToCopy = null;\n  }\n};\n\npttchrome.App.prototype.doPaste = function() {\n  console.log(\"doPaste not implemented\");\n  $('#pasteShortcutAlert').modal('show');\n  self.modalShown = true;\n};\n\npttchrome.App.prototype.onPasteDone = function(content) {\n  //this.conn.convSend(content);\n  this.view.onTextInput(content, true);\n};\n\npttchrome.App.prototype.onDOMPaste = function(e) {\n  let str = e.clipboardData.getData('text');\n  if (str) {\n    e.preventDefault();\n    this.onPasteDone(str);\n  }\n};\n\npttchrome.App.prototype.onSymFont = function(content) {\n  console.log(\"using \" + (content ? \"extension\" : \"system\") + \" font\");\n  var font_src = content ? 'src: url('+content.data+');' : '';\n  var css = '@font-face { font-family: MingLiUNoGlyph; '+font_src+' }';\n  var style = document.createElement('style');\n  style.type = 'text/css';\n  style.innerHTML = css;\n  document.getElementsByTagName('head')[0].appendChild(style);\n};\n\npttchrome.App.prototype.doSelectAll = function() {\n  window.getSelection().selectAllChildren(this.view.mainDisplay);\n};\n\npttchrome.App.prototype.doSearchGoogle = function(searchTerm) {\n  window.open('http://google.com/search?q='+searchTerm);\n};\n\npttchrome.App.prototype.doOpenUrlNewTab = function(a) {\n  var e = document.createEvent('MouseEvents');\n  e.initMouseEvent(\"click\", true, true, window, 0, 0, 0, 0, 0, true, false, false, false, 0, null);\n  a.dispatchEvent(e);\n};\n\npttchrome.App.prototype.doGoToOtherSite = function() {\n  $('#siteModal').modal('show');\n};\n\npttchrome.App.prototype.incrementCountToUpdatePushthread = function(interval) {\n  if (this.maxPushthreadAutoUpdateCount == -1) {\n    this.pushthreadAutoUpdateCount = 0;\n    return;\n  }\n\n  if (++this.pushthreadAutoUpdateCount >= this.maxPushthreadAutoUpdateCount) {\n    this.pushthreadAutoUpdateCount = 0;\n    if (this.buf.pageState == 3 || this.buf.pageState == 2) {\n      //this.view.conn.send('qrG');\n      this.view.conn.send('\\x1b[D\\x1b[C\\x1b[4~');\n    }\n  }\n};\npttchrome.App.prototype.setAutoPushthreadUpdate = function(seconds) {\n  this.maxPushthreadAutoUpdateCount = seconds;\n};\n\npttchrome.App.prototype.doAddBlacklistUserId = function(userid) {\n  this.pref.blacklistedUserIds[userid] = true;\n  this.pref.setBlacklistValue();\n  this.pref.setBlacklistStorage();\n  // XXX This should be changed to use a stylesheet to manage.\n  $('.blu_'+userid).css('opacity', '0.2');\n};\n\npttchrome.App.prototype.doRemoveBlacklistUserId = function(userid) {\n  delete this.pref.blacklistedUserIds[userid];\n  this.pref.setBlacklistValue();\n  this.pref.setBlacklistStorage();\n  // XXX This should be changed to use a stylesheet to manage.\n  $('.blu_'+userid).css('opacity', '');\n};\n\npttchrome.App.prototype.doSettings = function() {\n  $('#prefModal').modal('show');\n};\n\npttchrome.App.prototype.onWindowResize = function() {\n  this.view.innerBounds = this.getWindowInnerBounds();\n  this.view.fontResize();\n\n  if (this.modalShown) {\n    var width = document.documentElement.clientWidth * 0.7;\n    width = (width > 730) ? width : 730;\n    width -= 190;\n    var height = document.documentElement.clientHeight * 0.9;\n    height = (height > 400) ? height: 400;\n    height -= 76;\n    $('#prefModal .modal-body').css('height', height + 'px');\n    $('#prefModal .modal-body').css('width', width + 'px');\n    $('#opt_blacklistedUsers').css('height', height-150 + 'px');\n  }\n};\n\npttchrome.App.prototype.switchMouseBrowsing = function() {\n  if (this.CmdHandler.getAttribute('useMouseBrowsing')=='1') {\n    this.CmdHandler.setAttribute('useMouseBrowsing', '0');\n    this.buf.useMouseBrowsing=false;\n  } else {\n    this.CmdHandler.setAttribute('useMouseBrowsing', '1');\n    this.buf.useMouseBrowsing=true;\n  }\n\n  if (!this.buf.useMouseBrowsing) {\n    this.buf.BBSWin.style.cursor = 'auto';\n    this.buf.clearHighlight();\n    this.buf.mouseCursor=0;\n    this.buf.nowHighlight=-1;\n    this.buf.tempMouseCol=0;\n    this.buf.tempMouseRow=0;\n  } else {\n    this.buf.resetMousePos();\n    this.view.redraw(true);\n    this.view.updateCursorPos();\n  }\n};\n\npttchrome.App.prototype.antiIdle = function() {\n  if (this.antiIdleTime && this.idleTime > this.antiIdleTime) {\n    if (this.antiIdleStr !== '' && this.connectState == 1)\n      this.conn.send(this.antiIdleStr);\n  } else {\n    if (this.connectState == 1)\n      this.idleTime += 1000;\n  }\n};\n\npttchrome.App.prototype.updateTabIcon = function(aStatus) {\n  var icon = 'icon/logo.png';\n  switch (aStatus) {\n    case 'connect':\n      icon =  'icon/logo_connect.png';\n      this.setInputAreaFocus();\n      break;\n    case 'disconnect':\n      icon =  'icon/logo_disconnect.png';\n      break;\n    default:\n      break;\n  }\n\n  var link = document.querySelector(\"link[rel~='icon']\");\n  if (!link) {\n    link = document.createElement(\"link\");\n    link.setAttribute(\"rel\", \"icon\");\n    link.setAttribute(\"href\", icon);\n    document.head.appendChild(link);\n  } else {\n    link.setAttribute(\"href\", icon);\n  }\n};\n\n// use this method to get better window size in case of page zoom != 100%\npttchrome.App.prototype.getWindowInnerBounds = function() {\n  var width = document.documentElement.clientWidth - this.view.bbsViewMargin * 2;\n  var height = document.documentElement.clientHeight - this.view.bbsViewMargin * 2;\n  var bounds = {\n    width: width,\n    height: height\n  };\n  return bounds;\n};\n\npttchrome.App.prototype.getFirstGridOffsets = function() {\n  var container = $(\"#mainContainer\")[0];\n  return {\n    top: container.offsetTop,\n    left: container.offsetLeft\n  };\n};\n\npttchrome.App.prototype.clientToPos = function(cX, cY) {\n  var x;\n  var y;\n  var w = this.view.innerBounds.width;\n  var h = this.view.innerBounds.height;\n  if (this.view.horizontalAlignCenter && (this.view.scaleX != 1 || this.view.scaleY != 1)) {\n    x = cX - ((w - (this.view.chw * this.buf.cols) * this.view.scaleX) / 2);\n    y = cY - ((h - (this.view.chh * this.buf.rows) * this.view.scaleY) / 2);\n  } else {\n    x = cX - parseFloat(this.view.firstGridOffset.left);\n    y = cY - parseFloat(this.view.firstGridOffset.top);\n  }\n  var col = Math.floor(x / (this.view.chw * this.view.scaleX));\n  var row = Math.floor(y / (this.view.chh * this.view.scaleY));\n\n  if (row < 0)\n    row = 0;\n  else if (row >= this.buf.rows-1)\n    row = this.buf.rows-1;\n\n  if (col < 0)\n    col = 0;\n  else if (col >= this.buf.cols-1)\n    col = this.buf.cols-1;\n\n  return {col: col, row: row};\n};\n\npttchrome.App.prototype.onMouse_click = function (e) {\n  var cX = e.clientX, cY = e.clientY;\n  if (!this.conn || !this.conn.isConnected)\n    return;\n  if (this.inputHelper.clickedOn) {\n    this.inputHelper.clickedOn = false;\n    return;\n  }\n\n  // disable auto update pushthread if any command is issued;\n  this.disableLiveHelper();\n\n  // TODO make a responder stack.\n  this.easyReading._onMouseClick(e);\n  if (e.defaultPrevented)\n    return;\n\n  // TODO Move this to mouse browsing module.\n  switch (this.buf.mouseCursor) {\n    case 1:\n      this.conn.send('\\x1b[D');  //Arrow Left\n      break;\n    case 2:\n      this.conn.send('\\x1b[5~'); //Page Up\n      break;\n    case 3:\n      this.conn.send('\\x1b[6~'); //Page Down\n      break;\n    case 4:\n      this.conn.send('\\x1b[1~'); //Home\n      break;\n    case 5:\n      this.conn.send('\\x1b[4~'); //End\n      break;\n    case 6:\n      if (this.buf.nowHighlight != -1) {\n        var sendstr = '';\n        if (this.buf.cur_y > this.buf.nowHighlight) {\n          var count = this.buf.cur_y - this.buf.nowHighlight;\n          for (var i = 0; i < count; ++i)\n            sendstr += '\\x1b[A'; //Arrow Up\n        } else if (this.buf.cur_y < this.buf.nowHighlight) {\n          var count = this.buf.nowHighlight - this.buf.cur_y;\n          for (var i = 0; i < count; ++i)\n            sendstr += '\\x1b[B'; //Arrow Down\n        }\n        sendstr += '\\r';\n        this.conn.send(sendstr);\n      }\n      break;\n    case 7:\n      var pos = this.clientToPos(cX, cY);\n      var sendstr = '';\n      if (this.buf.cur_y > pos.row) {\n        var count = this.buf.cur_y - pos.row;\n        for (var i = 0; i < count; ++i)\n          sendstr += '\\x1b[A'; //Arrow Up\n      } else if (this.buf.cur_y < pos.row) {\n        var count = pos.row - this.buf.cur_y;\n        for (var i = 0; i < count; ++i)\n          sendstr += '\\x1b[B'; //Arrow Down\n      }\n      sendstr += '\\r';\n      this.conn.send(sendstr);\n      break;\n    case 0:\n      this.conn.send('\\x1b[D'); //Arrow Left\n      break;\n    case 8:\n      this.conn.send('['); //Previous post with the same title\n      break;\n    case 9:\n      this.conn.send(']'); //Next post with the same title\n      break;\n    case 10:\n      this.conn.send('='); //First post with the same title\n      break;\n    case 12:\n      this.conn.send('\\x1b[D\\r\\x1b[4~'); //Refresh post / pushed texts\n      break;\n    case 13:\n      this.conn.send('\\x1b[D\\r\\x1b[4~[]'); //Last post with the same title (LIST)\n      break;\n    case 14:\n      this.conn.send('\\x1b[D\\x1b[4~[]\\r'); //Last post with the same title (READING)\n      break;\n    default:\n      //do nothing\n      break;\n  }\n};\n\npttchrome.App.prototype.overlayCommandListener = function (e) {\n  var elm = e.target;\n  var cmd = elm.getAttribute(\"pttChromeCommand\");\n  //dumpLog(DUMP_TYPE_LOG, cmd);\n  if (elm) {\n    if (elm.id == 'cmdHandler') {\n      switch (cmd) {\n        case \"doArrowUp\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop === 0) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\x1b[D\\x1b[A\\x1b[C');\n            } else {\n              this.view.mainDisplay.scrollTop -= this.view.chh;\n            }\n          } else {\n            this.conn.send('\\x1b[A');\n          }\n          break;\n        case \"doArrowDown\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop >= this.view.mainContainer.clientHeight - this.view.chh * this.buf.rows) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\x1b[B');\n            } else {\n              this.view.mainDisplay.scrollTop += this.view.chh;\n            }\n          } else {\n            this.conn.send('\\x1b[B');\n          }\n          break;\n        case \"doPageUp\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.view.mainDisplay.scrollTop -= this.view.chh * this.easyReading._turnPageLines;\n          } else {\n            this.conn.send('\\x1b[5~');\n          }\n          break;\n        case \"doPageDown\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.view.mainDisplay.scrollTop += this.view.chh * this.easyReading._turnPageLines;\n          } else {\n            this.conn.send('\\x1b[6~');\n          }\n          break;\n        case \"previousThread\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.easyReading.leaveCurrentPost();\n            this.conn.send('[');\n          } else if (this.buf.pageState==2 || this.buf.pageState==3 || this.buf.pageState==4) {\n            this.conn.send('[');\n          }\n          break;\n        case \"nextThread\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            this.easyReading.leaveCurrentPost();\n            this.conn.send(']');\n          } else if (this.buf.pageState==2 || this.buf.pageState==3 || this.buf.pageState==4) {\n            this.conn.send(']');\n          }\n          break;\n        case \"doEnter\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop >= this.view.mainContainer.clientHeight - this.view.chh * this.buf.rows) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\r');\n            } else {\n              this.view.mainDisplay.scrollTop += this.view.chh;\n            }\n          } else {\n            this.conn.send('\\r');\n          }\n          break;\n        case \"doRight\":\n          if (this.view.useEasyReadingMode && this.buf.startedEasyReading) {\n            if (this.view.mainDisplay.scrollTop >= this.view.mainContainer.clientHeight - this.view.chh * this.buf.rows) {\n              this.easyReading.leaveCurrentPost();\n              this.conn.send('\\x1b[C');\n            } else {\n              this.view.mainDisplay.scrollTop += this.view.chh * this.easyReading._turnPageLines;\n            }\n          } else {\n            this.conn.send('\\x1b[C');\n          }\n          break;\n        case \"reloadTabIconDelay\":\n          this.doReloadTabIcon(100);\n          break;\n        case \"reloadTabIcon\":\n          //alert('reloadTabIcon');\n          this.reloadTabIcon();\n          break;\n        case \"doAddTrack\":\n          this.doAddTrack();\n          break;\n        case \"doDelTrack\":\n          this.doDelTrack();\n          break;\n        case \"doClearTrack\":\n          this.doClearTrack();\n          break;\n        case \"openSymbolInput\":\n          if (this.symbolinput) {\n            this.symbolinput.setCore(this);\n            this.symbolinput.displayWindow();\n          }\n          break;\n        case \"doSavePage\":\n          this.doSavePage();\n          break;\n        case \"doCopyHtml\":\n          this.doCopyHtml();\n          break;\n        case \"doSelectAll\":\n          this.doSelectAll();\n          break;\n        case \"doCopy\":\n          this.doCopySelect();\n          break;\n        case \"doPaste\":\n          this.doPaste();\n          break;\n        case \"doOpenAllLink\":\n          this.doOpenAllLink();\n          break;\n        //case \"doLoadUserSetting\":\n        //  this.doLoadUserSetting();\n        //  break;\n        case \"switchMouseBrowsing\":\n          this.switchMouseBrowsing();\n          break;\n        case \"openYoutubeWindow\":\n          var param = elm.getAttribute(\"YoutubeURL\");\n          elm.removeAttribute(\"YoutubeURL\");\n          if (this.playerMgr)\n            this.playerMgr.openYoutubeWindow(param);\n          break;\n        case \"openUstreamWindow\":\n          var param = elm.getAttribute(\"UstreamURL\");\n          elm.removeAttribute(\"UstreamURL\");\n          if (this.playerMgr)\n            this.playerMgr.openUstreamWindow(param);\n          break;\n        case \"openUrecordWindow\":\n          var param = elm.getAttribute(\"UrecordURL\");\n          elm.removeAttribute(\"UrecordURL\");\n          if (this.playerMgr)\n            this.playerMgr.openUrecordWindow(param);\n          break;\n        case \"previewPicture\":\n          var param = elm.getAttribute(\"PictureURL\");\n          elm.removeAttribute(\"PictureURL\");\n          if (this.picViewerMgr)\n            this.picViewerMgr.openPicture(param);\n          break;\n        case \"checkPrefExist\":\n          this.doSiteSettingCheck(250);\n          break;\n        case \"pushThread\":\n          this.doPushThread();\n          break;\n        case \"setAlert\":\n          var param = elm.getAttribute(\"AlertMessage\");\n          elm.removeAttribute(\"AlertMessage\");\n          //this.view.showAlertMessage(document.title, param);\n          //alert(param);\n          break;\n        default:\n          break;\n      }\n    }\n    elm.removeAttribute(\"pttChromeCommand\");\n  }\n};\n\npttchrome.App.prototype.onMouse_move = function(cX, cY) {\n  var pos = this.clientToPos(cX, cY);\n  this.buf.onMouse_move(pos.col, pos.row, false);\n};\n\npttchrome.App.prototype.resetMouseCursor = function(cX, cY) {\n  this.buf.BBSWin.style.cursor = 'auto';\n  this.buf.mouseCursor = 11;\n};\n\npttchrome.App.prototype.onPrefChange = function(pref, name) {\n  try {\n    //var CiStr = Components.interfaces.nsISupportsString;\n    //dumpLog(DUMP_TYPE_LOG, \"onPrefChange \" + name + \":\" + pref.get(name));\n    switch (name) {\n    case 'useMouseBrowsing':\n      var useMouseBrowsing = pref.get(name);\n      this.CmdHandler.setAttribute('useMouseBrowsing', useMouseBrowsing?'1':'0');\n      this.buf.useMouseBrowsing = useMouseBrowsing;\n\n      if (!this.buf.useMouseBrowsing) {\n        this.buf.BBSWin.style.cursor = 'auto';\n        this.buf.clearHighlight();\n        this.buf.mouseCursor = 0;\n        this.buf.nowHighlight = -1;\n        this.buf.tempMouseCol = 0;\n        this.buf.tempMouseRow = 0;\n      }\n      this.buf.resetMousePos();\n      this.view.redraw(true);\n      this.view.updateCursorPos();\n      break;\n    case 'mouseBrowsingHighlight':\n      this.buf.highlightCursor = pref.get(name);\n      this.view.redraw(true);\n      this.view.updateCursorPos();\n      break;\n    case 'mouseBrowsingHighlightColor':\n      this.view.highlightBG = pref.get(name);\n      this.view.redraw(true);\n      this.view.updateCursorPos();\n      break;\n    case 'mouseLeftFunction':\n      this.view.leftButtonFunction = pref.get(name);\n      if (typeof(this.view.leftButtonFunction) == 'boolean') {\n        this.view.leftButtonFunction = this.view.leftButtonFunction ? 1:0;\n      }\n      break;\n    case 'mouseMiddleFunction':\n      this.view.middleButtonFunction = pref.get(name);\n      break;\n    case 'mouseWheelFunction1':\n      this.view.mouseWheelFunction1 = pref.get(name);\n      break;\n    case 'mouseWheelFunction2':\n      this.view.mouseWheelFunction2 = pref.get(name);\n      break;\n    case 'mouseWheelFunction3':\n      this.view.mouseWheelFunction3 = pref.get(name);\n      break;\n    case 'copyOnSelect':\n      this.copyOnSelect = pref.get(name);\n      break;\n    case 'closeQuery':\n      this.alertBeforeUnload = pref.get(name);\n      break;\n    case 'endTurnsOnLiveUpdate':\n      this.endTurnsOnLiveUpdate = pref.get(name);\n      break;\n    case 'enablePicPreview':\n      // TODO: move this to ImagePreview.\n      this.view.enablePicPreview = pref.get(name);\n      break;\n    case 'enableNotifications':\n      this.view.enableNotifications = pref.get(name);\n      break;\n    case 'enableEasyReading':\n      /*if (this.connectedUrl.site == 'ptt.cc') {\n        this.view.useEasyReadingMode = this.pref.get('enableEasyReading');\n      } else {\n        this.view.useEasyReadingMode = false;\n      }*/\n      break;\n    case 'antiIdleTime':\n      this.antiIdleTime = pref.get(name) * 1000;\n      break;\n    case 'dbcsDetect':\n      this.view.dbcsDetect = pref.get(name);\n      break;\n    case 'lineWrap':\n      this.conn.lineWrap = pref.get(name);\n      break;\n    case 'fontFitWindowWidth':\n      this.view.fontFitWindowWidth = pref.get(name);\n      if (this.view.fontFitWindowWidth) {\n        $('.main').addClass('trans-fix');\n      } else {\n        $('.main').removeClass('trans-fix');\n      }\n      this.onWindowResize();\n      break;\n    case 'fontFace':\n      var fontFace = pref.get(name);\n      if (!fontFace) \n        fontFace='monospace';\n      this.view.setFontFace(fontFace);\n      break;\n    case 'bbsMargin':\n      var margin = pref.get(name);\n      this.view.bbsViewMargin = margin;\n      this.onWindowResize();\n      break;\n    case 'enableBlacklist':\n      this.pref.enableBlacklist = pref.get(name);\n      this.view.redraw(true);\n      break;\n    case 'enableDeleteDupLogin':\n      this.buf.enableDeleteDupLogin = pref.get(name);\n      break;\n    case 'deleteDupLogin':\n      this.buf.deleteDupLogin = pref.get(name);\n      break;\n    default:\n      break;\n    }\n  } catch(e) {\n    // eats all errors\n    return;\n  }\n};\n\npttchrome.App.prototype.checkClass = function(cn) {\n  return (  cn.indexOf(\"closeSI\") >= 0  || cn.indexOf(\"EPbtn\") >= 0 || \n      cn.indexOf(\"closePP\") >= 0 || cn.indexOf(\"picturePreview\") >= 0 || \n      cn.indexOf(\"drag\") >= 0    || cn.indexOf(\"floatWindowClientArea\") >= 0 || \n      cn.indexOf(\"WinBtn\") >= 0  || cn.indexOf(\"sBtn\") >= 0 || \n      cn.indexOf(\"nonspan\") >= 0 || cn.indexOf(\"nomouse_command\") >= 0);\n};\n\npttchrome.App.prototype.mouse_click = function(e) {\n  if (this.modalShown)\n    return;\n\n  var skipMouseClick = (this.CmdHandler.getAttribute('SkipMouseClick') == '1');\n  this.CmdHandler.setAttribute('SkipMouseClick','0');\n\n  if (e.button == 2) { //right button\n  } else if (e.button === 0) { //left button\n    if ($(e.target).is('a') || $(e.target).parent().is('a')) {\n      return;\n    }\n    if (window.getSelection().isCollapsed) { //no anything be select\n      if (this.buf.useMouseBrowsing) {\n        var doMouseCommand = true;\n        if (e.target.className)\n          if (this.checkClass(e.target.className))\n            doMouseCommand = false;\n        if (e.target.tagName)\n          if(e.target.tagName.indexOf(\"menuitem\") >= 0 )\n            doMouseCommand = false;\n        if (skipMouseClick) {\n          doMouseCommand = false;\n          var pos = this.clientToPos(e.clientX, e.clientY);\n          this.buf.onMouse_move(pos.col, pos.row, true);\n        }\n        if (doMouseCommand) {\n          this.onMouse_click(e);\n          this.setDblclickTimer();\n          e.preventDefault();\n          this.setInputAreaFocus();\n        }\n      } else if (this.view.leftButtonFunction) {\n        if (this.view.leftButtonFunction == 1) {\n          this.setBBSCmd('doEnter', this.CmdHandler);\n          e.preventDefault();\n          this.setInputAreaFocus();\n        } else if (this.view.leftButtonFunction == 2) {\n          this.setBBSCmd('doRight', this.CmdHandler);\n          e.preventDefault();\n          this.setInputAreaFocus();\n        }\n      }\n    }\n  } else if (e.button == 1) { //middle button\n  } else {\n  }\n};\n\npttchrome.App.prototype.middleMouse_down = function(e) {\n  // moved to here because middle click works better with jquery\n  if (e.button == 1) {\n    if ($(e.target).is('a') || $(e.target).parent().is('a')) {\n      return;\n    }\n    if (this.view.middleButtonFunction == 1) {\n      this.conn.send('\\r');\n      return false;\n    } else if (this.view.middleButtonFunction == 2) {\n      this.conn.send('\\x1b[D');\n      return false;\n    } else if (this.view.middleButtonFunction == 3) {\n      this.doPaste();\n      return false;\n    }\n  }\n};\n\npttchrome.App.prototype.mouse_down = function(e) {\n  if (this.modalShown)\n    return;\n  //0=left button, 1=middle button, 2=right button\n  if (e.button === 0) {\n    if (this.buf.useMouseBrowsing) {\n      if (this.dblclickTimer) { //skip\n        e.preventDefault();\n        e.stopPropagation();\n        e.cancelBubble = true;\n      }\n      this.setDblclickTimer();\n    }\n    this.mouseLeftButtonDown = true;\n    //this.setInputAreaFocus();\n    if (!(window.getSelection().isCollapsed))\n      this.CmdHandler.setAttribute('SkipMouseClick','1');\n\n    var onbbsarea = true;\n    if (e.target.className)\n      if (this.checkClass(e.target.className))\n        onbbsarea = false;\n    if (e.target.tagName)\n      if (e.target.tagName.indexOf(\"menuitem\") >= 0 )\n        onbbsarea = false;\n  } else if(e.button == 2) {\n    this.mouseRightButtonDown = true;\n  }\n};\n\npttchrome.App.prototype.mouse_up = function(e) {\n  if (this.modalShown)\n    return;\n  //0=left button, 1=middle button, 2=right button\n  if (e.button === 0) {\n    this.setMbTimer();\n    //this.CmdHandler.setAttribute('MouseLeftButtonDown', '0');\n    this.mouseLeftButtonDown = false;\n  } else if (e.button == 2) {\n    this.mouseRightButtonDown = false;\n    //this.CmdHandler.setAttribute('MouseRightButtonDown', '0');\n  }\n\n  if (e.button === 0 || e.button == 2) { //left or right button\n    if (window.getSelection().isCollapsed) { //no anything be select\n      if (this.buf.useMouseBrowsing)\n        this.onMouse_move(e.clientX, e.clientY);\n\n      this.setInputAreaFocus();\n      if (e.button === 0) {\n        var preventDefault = true;\n        if (e.target.className)\n          if (this.checkClass(e.target.className))\n            preventDefault = false;\n        if (e.target.tagName)\n          if (e.target.tagName.indexOf(\"menuitem\") >= 0 )\n            preventDefault = false;\n        if (preventDefault)\n          e.preventDefault();\n      }\n    } else { //something has be select\n      if (this.copyOnSelect) {\n        this.doCopy(window.getSelection().toString().replace(/\\u00a0/g, \" \"));\n      }\n    }\n  } else {\n    this.setInputAreaFocus();\n    e.preventDefault();\n  }\n  var _this = this;\n  this.inputAreaFocusTimer = setTimer(false, function() {\n    clearTimeout(_this.inputAreaFocusTimer);\n    _this.inputAreaFocusTimer = null;\n    if (window.getSelection().isCollapsed)\n      _this.setInputAreaFocus();\n  }, 10);\n};\n\npttchrome.App.prototype.mouse_move = function(e) {\n  if (this.inputHelper.mouseDown) {\n    this.inputHelper.onMouseDrag(e);\n    return;\n  }\n\n  if (this.buf.useMouseBrowsing) {\n    if (window.getSelection().isCollapsed) {\n      if(!this.mouseLeftButtonDown)\n        this.onMouse_move(e.clientX, e.clientY);\n    } else\n      this.resetMouseCursor();\n  }\n\n};\n\npttchrome.App.prototype.mouse_over = function(e) {\n  if (this.modalShown)\n    return;\n\n  this.curX = e.clientX;\n  this.curY = e.clientY;\n\n  if(window.getSelection().isCollapsed && !this.mouseLeftButtonDown)\n    this.setInputAreaFocus();\n};\n\npttchrome.App.prototype.mouse_scroll = function(e) {\n  if (this.modalShown) \n    return;\n  // if in easyreading, use it like webpage\n  if (this.view.useEasyReadingMode && this.buf.pageState == 3) {\n    return;\n  }\n\n  var cmdhandler = this.CmdHandler;\n\n  // scroll = up/down\n  // hold right mouse key + scroll = page up/down\n  // hold left mouse key + scroll = thread prev/next\n  var mouseWheelActionsUp = [ 'none', 'doArrowUp', 'doPageUp', 'previousThread' ];\n  var mouseWheelActionsDown = [ 'none', 'doArrowDown', 'doPageDown', 'nextThread' ];\n\n  if (e.wheelDelta > 0) { // scrolling up\n    if (this.mouseRightButtonDown) {\n      var action = mouseWheelActionsUp[this.view.mouseWheelFunction2];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    } else if (this.mouseLeftButtonDown) {\n      var action = mouseWheelActionsUp[this.view.mouseWheelFunction3];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n        this.setBBSCmd('cancelHoldMouse', cmdhandler);\n      }\n    } else {\n      var action = mouseWheelActionsUp[this.view.mouseWheelFunction1];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    }\n  } else { // scrolling down\n    if (this.mouseRightButtonDown) {\n      var action = mouseWheelActionsDown[this.view.mouseWheelFunction2];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    } else if (this.mouseLeftButtonDown) {\n      var action = mouseWheelActionsDown[this.view.mouseWheelFunction3];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n        this.setBBSCmd('cancelHoldMouse', cmdhandler);\n      }\n    } else {\n      var action = mouseWheelActionsDown[this.view.mouseWheelFunction1];\n      if (action !== 'none') {\n        this.setBBSCmd(action, cmdhandler);\n      }\n    }\n  }\n  e.stopPropagation();\n  e.preventDefault();\n\n  if (this.mouseRightButtonDown) //prevent context menu popup\n    cmdhandler.setAttribute('doDOMMouseScroll','1');\n  if (this.mouseLeftButtonDown) {\n    if (this.buf.useMouseBrowsing) {\n      cmdhandler.setAttribute('SkipMouseClick','1');\n    }\n  }\n};\n\npttchrome.App.prototype.showQuickSearchMenus = function(e, selectedText, hideContextMenu) {\n  var self = this;\n  if (this.pref.quickSearches.length === 0) return;\n\n  var menuSelector = '#quickSearchMenus';\n  var menuHtml = '';\n  for (var i = 0; i < this.pref.quickSearches.length; ++i) {\n    var q = this.pref.quickSearches[i];\n    menuHtml += '<li class=\"cmenuItem\"><a data-url=\"'+q.url+'\">'+q.name+'</a></li>';\n  }\n  $(menuSelector).html(menuHtml);\n  \n  $('#quickSearchMenus a').off();\n  $('#quickSearchMenus a').click(function(e) {\n    var url = $(this).data('url');\n    url = url.replace('%s', selectedText);\n    window.open(url);\n    e.stopPropagation();\n    hideContextMenu();\n  });\n\n  var pageHeight = $(window).height();\n  var pageWidth = $(window).width();\n  if (e.pageY > pageHeight/2) {\n    $(menuSelector).addClass('cmenuGoesUp');\n  } else {\n    $(menuSelector).removeClass('cmenuGoesUp');\n  }\n  if (e.pageX > pageWidth * 0.8) {\n    $(menuSelector).addClass('cmenuGoesLeft');\n  } else {\n    $(menuSelector).removeClass('cmenuGoesLeft');\n  }\n};\n\npttchrome.App.prototype.setupContextMenus = function() {\n  var self = this;\n  var menuSelector = '#contextMenus';\n  var selectedText = '';\n  var contextOnUrl = '';\n  var contextOnUserId = '';\n  var aElement = null;\n\n  $('#BBSWindow').on('contextmenu', function(e) {\n    // if i am doing scrolling, i should skip\n    var cmdhandler = self.CmdHandler;\n    var doDOMMouseScroll = (cmdhandler.getAttribute('doDOMMouseScroll')=='1');\n    if (doDOMMouseScroll) {\n      e.stopPropagation();\n      e.preventDefault();\n      cmdhandler.setAttribute('doDOMMouseScroll','0');\n      return;\n    }\n\n    var target = $(e.target);\n    contextOnUrl = '';\n    contextOnUserId = '';\n\n    // just in case the selection get de-selected\n    if (window.getSelection().isCollapsed) {\n      self.lastSelection = null;\n    } else {\n      self.lastSelection = self.view.getSelectionColRow();\n    }\n\n    aElement = null;\n    if (target.is('a')) {\n      contextOnUrl = target.attr('href');\n      aElement = target[0];\n    } else if (target.parent().is('a')) {\n      contextOnUrl = target.parent().attr('href');\n      aElement = target[0].parentNode;\n    }\n\n    // for getting push thread user id\n    if (self.pref.enableBlacklist) {\n      var srow = target.attr('srow');\n      if (srow === undefined || srow === null)\n        srow = target.parent().attr('srow');\n      srow = parseInt(srow);\n      if (!isNaN(srow)) {\n        var rowText = '';\n        if (self.view.useEasyReadingMode && self.buf.pageState == 3) {\n          rowText = self.buf.getRowText(srow, 0, self.buf.cols, self.buf.pageLines);\n        } else {\n          rowText = self.buf.getRowText(srow, 0, self.buf.cols);\n        }\n        if (self.buf.pageState == 3) {\n          contextOnUserId = rowText.parsePushthreadForUserId();\n        } else if (self.buf.pageState == 2) {\n          contextOnUserId = rowText.parseThreadForUserId();\n        }\n      }\n    }\n\n    // replace the &nbsp;\n    selectedText = window.getSelection().toString().replace(/\\u00a0/g, \" \");\n\n    if (contextOnUrl) {\n      $('.contextQuickSearch').hide();\n      $('.contextUrl').show();\n      $('.contextSel').hide();\n      $('.contextNormal').hide();\n    } else {\n      if (window.getSelection().isCollapsed) { \n        $('.contextQuickSearch').hide();\n        $('.contextUrl').hide();\n        $('.contextSel').hide();\n        $('.contextNormal').show();\n      } else {\n        // got something selected, show copy and searchGoogle\n        $('.contextUrl').hide();\n        $('.contextSel').show();\n        $('.contextNormal').hide();\n        var clipedText = selectedText;\n        if (clipedText.length > 15) {\n          clipedText = clipedText.substr(0, 15) + ' ... ';\n        }\n        $('#cmenuSearchContent').text(\"'\"+clipedText+\"'\");\n        if (self.pref.quickSearches.length > 0) {\n          self.showQuickSearchMenus(e, selectedText, function() {\n            hideContextMenu();\n          });\n          $('.contextQuickSearch').show();\n        } else {\n          $('.contextQuickSearch').hide();\n        }\n      }\n    }\n\n    if (contextOnUserId) {\n      if (contextOnUserId in self.pref.blacklistedUserIds) {\n        $('#cmenuRemoveBlacklistUserIdContent').text(\"'\"+contextOnUserId+\"'\");\n        $('#cmenu_addBlacklistUserId').hide();\n        $('#cmenu_removeBlacklistUserId').show();\n      } else {\n        $('#cmenuAddBlacklistUserIdContent').text(\"'\"+contextOnUserId+\"'\");\n        $('#cmenu_addBlacklistUserId').show();\n        $('#cmenu_removeBlacklistUserId').hide();\n      }\n      $('#cmenu_divider3').show();\n    } else {\n      $('#cmenu_addBlacklistUserId').hide();\n      $('#cmenu_removeBlacklistUserId').hide();\n    }\n\n    // check if mouse browsing is on\n    if (self.buf.useMouseBrowsing) {\n      $('#cmenu_mouseBrowsing a').addClass('checked');\n    } else {\n      $('#cmenu_mouseBrowsing a').removeClass('checked');\n    }\n\n    // show and position\n    $(menuSelector)\n      .show()\n      .css({\n        position: \"absolute\",\n        left: function(e) {\n          var mouseWidth = e.pageX;\n          var pageWidth = $(window).width();\n          var menuWidth = $(menuSelector).width();\n          \n          // opening menu would pass the side of the page\n          if (mouseWidth + menuWidth > pageWidth &&\n              menuWidth < mouseWidth) {\n              return mouseWidth - menuWidth;\n          } \n          return mouseWidth;\n        }(e),\n        top: function(e) {\n          var mouseHeight = e.pageY;\n          var pageHeight = $(window).height();\n          var menuHeight = $(menuSelector).height();\n\n          // opening menu would pass the bottom of the page\n          if (mouseHeight + menuHeight > pageHeight &&\n              menuHeight < mouseHeight) {\n              return mouseHeight - menuHeight;\n          } \n          return mouseHeight;\n        }(e)\n      });\n    self.contextMenuShown = true;\n    return false;\n  });\n\n  var hideContextMenu = function() {\n    $(menuSelector).hide();\n    selectedText = '';\n    self.contextMenuShown = false;\n  };\n\n  // for menuitem shortkey\n  $(window).keyup(function(e) {\n    if (!self.contextMenuShown)\n      return;\n    if (!e.altKey && !e.ctrlKey && !e.shiftKey) {\n      switch (e.keyCode) {\n        case 67: // C\n          self.doCopy(selectedText);\n          hideContextMenu();\n          break;\n        case 69: // E\n          self.doCopy(contextOnUrl);\n          hideContextMenu();\n          break;\n        case 80: // P\n          self.doPaste();\n          hideContextMenu();\n          break;\n        case 83: // S\n          self.doSearchGoogle(selectedText);\n          hideContextMenu();\n          break;\n        case 84: // T\n          self.doOpenUrlNewTab(aElement);\n          hideContextMenu();\n          break;\n      }\n    }\n    e.preventDefault();\n    e.stopPropagation();\n  });\n\n  //make sure menu closes on any click\n  $(window).click(function() {\n    hideContextMenu();\n  });\n  if ('ontouchstart' in window) {\n    window.ontouchstart = function(e) {\n      if (e.target.parentNode.classList.length > 0 &&\n          e.target.parentNode.classList[0] == 'cmenuItem') {\n        return;\n      }\n      hideContextMenu();\n    };\n  }\n\n  $('#cmenu_copy a').html(i18n('cmenu_copy')+'<span class=\"cmenuHotkey\">Ctrl+C</span>');\n  $('#cmenu_copyAnsi a').text(i18n('cmenu_copyAnsi'));\n  $('#cmenu_paste a').html(i18n('cmenu_paste')+'<span class=\"cmenuHotkey\">Shift+Insert</span>');\n  $('#cmenu_selectAll a').html(i18n('cmenu_selectAll')+'<span class=\"cmenuHotkey\">Ctrl+A</span>');\n  $('#cmenu_searchGoogle a').html(i18n('cmenu_searchGoogle')+' <span id=\"cmenuSearchContent\"></span>');\n  $('#cmenu_quickSearch a').html(i18n('cmenu_quickSearch')+' <span style=\"float:right;\">&#9658;</span>');\n  $('#cmenu_openUrlNewTab a').text(i18n('cmenu_openUrlNewTab'));\n  $('#cmenu_copyLinkUrl a').text(i18n('cmenu_copyLinkUrl'));\n  $('#cmenu_mouseBrowsing a').text(i18n('cmenu_mouseBrowsing'));\n  $('#cmenu_goToOtherSite a').text(i18n('cmenu_goToOtherSite'));\n  $('#cmenu_showInputHelper a').text(i18n('cmenu_showInputHelper'));\n  $('#cmenu_showLiveArticleHelper a').text(i18n('cmenu_showLiveArticleHelper'));\n  $('#cmenu_addBlacklistUserId a').html(i18n('cmenu_addBlacklistUserId')+' <span id=\"cmenuAddBlacklistUserIdContent\"></span>');\n  $('#cmenu_removeBlacklistUserId a').html(i18n('cmenu_removeBlacklistUserId')+' <span id=\"cmenuRemoveBlacklistUserIdContent\"></span>');\n  $('#cmenu_settings a').text(i18n('cmenu_settings'));\n\n  var contextMenuItemOnClickHandler = {\n    'cmenu_copy': function() { \n      self.doCopy(selectedText); \n    },\n    'cmenu_copyAnsi': function() { \n      self.doCopyAnsi(); \n    },\n    'cmenu_paste': function() { \n      self.doPaste(); \n    },\n    'cmenu_selectAll': function() { \n      self.doSelectAll(); \n    },\n    'cmenu_searchGoogle': function() { \n      self.doSearchGoogle(selectedText); \n    },\n    'cmenu_openUrlNewTab': function() { \n      self.doOpenUrlNewTab(aElement); \n    },\n    'cmenu_copyLinkUrl': function() {\n      self.doCopy(contextOnUrl); \n    },\n    'cmenu_mouseBrowsing': function() { \n      self.switchMouseBrowsing(); \n    },\n    'cmenu_goToOtherSite': function() { \n      self.doGoToOtherSite(); \n    },\n    'cmenu_showInputHelper': function() { \n      self.inputHelper.showHelper(); \n    },\n    'cmenu_showLiveArticleHelper': function() { \n      $('#liveHelper').show(); \n    },\n    'cmenu_addBlacklistUserId': function() { \n      self.doAddBlacklistUserId(contextOnUserId); \n    },\n    'cmenu_removeBlacklistUserId': function() { \n      self.doRemoveBlacklistUserId(contextOnUserId); \n    },\n    'cmenu_settings': function() { \n      self.doSettings(); \n    }\n  };\n\n  $('.cmenuItem').click(function(e) {\n    var id = $(this).attr('id');\n    if (id in contextMenuItemOnClickHandler) {\n      contextMenuItemOnClickHandler[id]();\n    }\n    e.stopPropagation();\n    hideContextMenu();\n  });\n\n  $(menuSelector).on('contextmenu', function(e) {\n    e.stopPropagation();\n    e.preventDefault();\n  });\n};\n\npttchrome.App.prototype.context_menu = function(e) {\n  var cmdhandler = this.CmdHandler;\n  var doDOMMouseScroll = (cmdhandler.getAttribute('doDOMMouseScroll')=='1');\n  if (doDOMMouseScroll) {\n    e.stopPropagation();\n    e.preventDefault();\n    cmdhandler.setAttribute('doDOMMouseScroll','0');\n    return;\n  }\n};\n\npttchrome.App.prototype.regExitAlert = function() {\n  if (!window.onbeforeunload && window.location.origin.indexOf('http://localhost') !== 0) {\n    window.onbeforeunload = function() {\n      return 'Connected to '+document.title;\n    };\n  }\n};\n\npttchrome.App.prototype.unregExitAlert = function() {\n  // clear alert for closing tab\n  window.onbeforeunload = null;\n};\n\npttchrome.App.prototype.setBBSCmd = function(cmd, cmdhandler) {\n  //var doc = gBrowser.contentDocument;\n  var doc = document;\n  if (!cmdhandler)\n    cmdhandler = this.getCmdHandler();\n\n  if (cmdhandler && \"createEvent\" in doc) {\n    cmdhandler.setAttribute('pttChromeCommand', cmd);\n    var evt = doc.createEvent(\"Events\");\n    evt.initEvent(\"OverlayCommand\", false, false);\n    cmdhandler.dispatchEvent(evt);\n  }\n};\n\nexports.App = pttchrome.App;\n\n\n\n// WEBPACK FOOTER //\n// ./js/pttchrome.js","// Parser for ANSI escape sequence\n\nexport function AnsiParser(termbuf) {\n  this.termbuf = termbuf;\n  this.state = AnsiParser.STATE_TEXT;\n  this.esc = '';\n};\n\nAnsiParser.STATE_TEXT = 0;\nAnsiParser.STATE_ESC = 1;\nAnsiParser.STATE_CSI = 2;\nAnsiParser.STATE_C1 = 3;\n\nAnsiParser.prototype.feed = function(data) {\n  var term = this.termbuf;\n  if (!term)\n    return;\n  var s = '';\n  var n = data.length;\n  for (var i = 0; i < n; ++i) {\n    var ch = data[i];\n    switch (this.state) {\n    case AnsiParser.STATE_TEXT:\n      switch (ch) {\n      case '\\x1b':\n        if (s) {\n          term.puts(s);\n          s = '';\n        }\n        this.state = AnsiParser.STATE_ESC;\n        break;\n      default:\n        s += ch;\n      }\n      break;\n    case AnsiParser.STATE_CSI:\n      if ( (ch >= '`' && ch <= 'z') || (ch >= '@' && ch <='Z') ) {\n        // if(ch != 'm')\n        //    dump('CSI: ' + this.esc + ch + '\\n');\n        var params=this.esc.split(';');\n        var firstChar = '';\n        if (params[0]) {\n          if (params[0].charAt(0)<'0' || params[0].charAt(0)>'9') {\n            firstChar = params[0].charAt(0);\n            params[0] = params[0].slice(1);\n          }\n        }\n        if (firstChar && ch != 'h' && ch != 'l') { // unknown CSI\n          //dump('unknown CSI: ' + this.esc + ch + '\\n');\n          this.state = AnsiParser.STATE_TEXT;\n          this.esc = '';\n          break;\n        }\n        for (var j=0; j<params.length; ++j) {\n          if ( params[j] )\n            params[j] = parseInt(params[j], 10);\n          else\n            params[j] = 0;\n        }\n        switch (ch) {\n        case 'm':\n          var attr = term.attr;\n          for (var n_params = params.length; n_params; --n_params){\n            var v = params.shift();\n            switch (v) {\n            case 0: // reset\n              attr.resetAttr();\n              break;\n            case 1: // bright\n              attr.bright=true;\n              break;\n            case 4:\n              attr.underLine=true;\n              break;\n            case 5: // blink\n            case 6:\n              attr.blink=true;\n              break;\n            case 7: // invert\n              attr.invert=true;\n              break;\n            case 8:\n              // invisible is not supported\n              break;\n            /*\n            case 22: // normal, or not bright\n              attr.bright=false;\n              break;\n            case 24: // not underlined\n              attr.underLine=false;\n              break;\n            case 25: // steady, or not blink\n              attr.blink=false;\n              break;\n            case 27: // positive, or not invert\n              attr.invert=false;\n              break;\n            */\n            default:\n              if (v <= 37) {\n                if (v >= 30) { // fg\n                  attr.fg = v - 30;\n                }\n              } else if (v >= 40) {\n                if (v<=47) { //bg\n                  attr.bg = v - 40;\n                }\n              }\n              break;\n            }\n          }\n          break;\n        case '@':\n          term.insert(params[0]>0 ? params[0] : 1);\n          break;\n        case 'A':\n          term.gotoPos(term.cur_x, term.cur_y-(params[0]?params[0]:1));\n          break;\n        case 'B':\n        case 'e':\n          term.gotoPos(term.cur_x, term.cur_y+(params[0]?params[0]:1));\n          break;\n        case 'C':\n        case 'e':\n          term.gotoPos(term.cur_x+(params[0]?params[0]:1), term.cur_y);\n          break;\n        case 'D':\n          term.gotoPos(term.cur_x-(params[0]?params[0]:1), term.cur_y);\n          break;\n        case 'E':\n          term.gotoPos(0, term.cur_y+(params[0]?params[0]:1));\n          break;\n        case 'F':\n          term.gotoPos(0, term.cur_y-(params[0]?params[0]:1));\n          break;\n        case 'G':\n        case '`':\n          term.gotoPos(params[0]>0?params[0]-1:0, term.cur_y);\n          break;\n        case 'I':\n          term.tab(params[0]>0 ? params[0] : 1);\n          break;\n        case 'd':\n          term.gotoPos(term.cur_x, params[0]>0?params[0]-1:0);\n          break;\n        /*\n        case 'h':\n          if (firstChar == '?') {\n            var mainobj = term.view.conn.listener;\n            switch(params[0]) {\n            case 1:\n              term.view.cursorAppMode = true;\n              break;\n            case 1048:\n            case 1049:\n              term.cur_x_sav = term.cur_x;\n              term.cur_y_sav = term.cur_y;\n              if (params[0] != 1049) break; // 1049 fall through\n            case 47:\n            case 1047:\n              mainobj.selAll(true); // skipRedraw\n              term.altScreen=mainobj.ansiCopy(true); // external buffer\n              term.altScreen+=term.ansiCmp(term.newChar, term.attr);\n              term.clear(2);\n              term.attr.resetAttr();\n              break;\n            default:\n            }\n          }\n          break;\n        case 'l':\n          if (firstChar == '?') {\n            switch (params[0]) {\n            case 1:\n              term.view.cursorAppMode = false;\n              break;\n            case 47:\n            case 1047:\n            case 1049:\n              term.clear(2);\n              term.attr.resetAttr();\n              if (term.altScreen) {\n                this.state = AnsiParser.STATE_TEXT;\n                this.esc = '';\n                this.feed(term.altScreen.replace(/(\\r\\n)+$/g, '\\r\\n'));\n              }\n              term.altScreen='';\n              if (params[0] != 1049) break; // 1049 fall through\n            case 1048:\n              if (term.cur_x_sav<0 || term.cur_y_sav<0) break;\n              term.cur_x = term.cur_x_sav;\n              term.cur_y = term.cur_y_sav;\n              break;\n            default:\n            }\n          }\n          break;\n        */\n        case 'J':\n          term.clear(params ? params[0] : 0);\n          break;\n        case 'H':\n        case 'f':\n          if (params.length < 2) {\n            term.gotoPos(0, 0);\n          } else {\n            if (params[0] > 0)\n              --params[0];\n            if (params[1] > 0)\n              --params[1];\n            term.gotoPos(params[1], params[0]);\n          }\n          break;\n        case 'K':\n          term.eraseLine(params? params[0] : 0);\n          break;\n        case 'L':\n          term.insertLine(params[0]>0 ? params[0] : 1);\n          break;\n        case 'M':\n          term.deleteLine(params[0]>0 ? params[0] : 1);\n          break;\n        case 'P':\n          term.del(params[0]>0 ? params[0] : 1);\n          break;\n        case 'r': // FIXME: scroll range\n          if (params.length < 2) {\n            term.scrollStart=0;\n            term.scrollEnd=term.rows-1;\n          } else {\n            if (params[0] > 0)\n              --params[0];\n            if (params[1] > 0)\n              --params[1];\n            term.scrollStart=params[0];\n            term.scrollEnd=params[1];\n          }\n          break;\n        case 's':\n          term.cur_x_sav=term.cur_x;\n          term.cur_y_sav=term.cur_y;\n          break;\n        case 'u':\n          if (term.cur_x_sav<0 || term.cur_y_sav<0) break;\n          term.cur_x = term.cur_x_sav;\n          term.cur_y = term.cur_y_sav;\n          break;\n        case 'S':\n          term.scroll(false, (params[0]>0 ? params[0] : 1));\n          break;\n        case 'T':\n          term.scroll(true, (params[0]>0 ? params[0] : 1));\n          break;\n        case 'X':\n          term.eraseChar(params[0]>0 ? params[0] : 1);\n          break;\n        case 'Z':\n          term.backTab(params[0]>0 ? params[0] : 1);\n          break;\n        default:\n          //dump('unknown CSI: ' + this.esc + ch + '\\n');\n        }\n        this.state = AnsiParser.STATE_TEXT;\n        this.esc = '';\n      } else {\n        this.esc += ch;\n      }\n      break;\n    case AnsiParser.STATE_C1:\n      var C1_End = true;\n      var C1_Char = [' ', '#', '%', '(', ')', '*', '+', '-', '.', '/'];\n      if (this.esc) { // multi-char is not supported now\n        for (var j = 0; j < C1_Char.length; ++j)\n          if (this.esc == C1_Char[j]) C1_End = false;\n        if (C1_End) --i;\n        else this.esc += ch;\n        //dump('UNKNOWN C1 CONTROL CHAR IS FOUND: ' + this.esc + '\\n');\n        this.esc = '';\n        this.state = AnsiParser.STATE_TEXT;\n        break;\n      }\n      switch (ch) {\n      case '7':\n        term.cur_x_sav = term.cur_x;\n        term.cur_y_sav = term.cur_y;\n        break;\n      case '8':\n        if (term.cur_x_sav<0 || term.cur_y_sav<0) break;\n        term.cur_x = term.cur_x_sav;\n        term.cur_y = term.cur_y_sav;\n        break;\n      case 'D':\n        term.scroll(false,1);\n        break;\n      case 'E':\n        term.lineFeed();\n        term.carriageReturn();\n        break;\n      case 'M':\n        term.scroll(true,1);\n        break;\n      /*\n      case '=':\n          term.view.keypadAppMode = true;\n          break;\n      case '>':\n          term.view.keypadAppMode = false;\n          break;\n      */\n      default:\n        this.esc += ch;\n        C1_End=false;\n      }\n      if (!C1_End) break;\n      this.esc = '';\n      this.state = AnsiParser.STATE_TEXT;\n      break;\n    case AnsiParser.STATE_ESC:\n      if (ch == '[')\n        this.state=AnsiParser.STATE_CSI;\n      else {\n        this.state=AnsiParser.STATE_C1;\n        --i;\n      }\n      break;\n    }\n  }\n  if (s) {\n      term.puts(s);\n      s = '';\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/ansi_parser.js","// Terminal View\r\n\r\nimport { TermKeyboard } from './term_keyboard';\r\nimport { termInvColors } from './term_buf';\r\nimport { renderImagePreview } from './image_preview';\r\nimport { renderRowHtml } from './term_ui';\r\nimport { i18n } from './i18n';\r\nimport { setTimer } from './util';\r\n\r\nexport function TermView(rowCount) {\r\n  //new pref - start\r\n  this.screenType = 0;\r\n  this.bbsWidth = 0;\r\n  this.bbsHeight = 0;\r\n  this.bbsFontSize = 14;\r\n  this.useHyperLink = true;\r\n  this.dbcsDetect = true;\r\n  this.inputBufferSizeType = 0;\r\n  this.defineInputBufferSize = 12;\r\n  this.hideInputBuffer = false;\r\n  this.hotkeyForSelectAll = false;\r\n  this.highlightBG = 2;\r\n  this.charset = 'big5';\r\n  this.EnterChar = '\\r';\r\n  this.EscChar = '\\x15'; // Ctrl-U\r\n  this.dropToPaste = false;\r\n  this.ctrlPicturePreview = false;\r\n  this.picturePreviewInfo = false;\r\n  this.middleButtonFunction = 0;\r\n  this.leftButtonFunction = false;\r\n  this.mouseWheelFunction1 = 1;\r\n  this.mouseWheelFunction2 = 2;\r\n  this.mouseWheelFunction3 = 3;\r\n  //this.highlightFG = 7;\r\n  this.DisplayBackground = false;\r\n  this.BackgroundMD5 = '';\r\n  this.fontFitWindowWidth = false;\r\n  this.verticalAlignCenter = true;\r\n  this.horizontalAlignCenter = true;\r\n  this.easyReadingWithImg = false;\r\n  //new pref - end\r\n\r\n  this.bbsViewMargin = 0;\r\n  this.cursorShow = true;\r\n\r\n  this.buf = null;\r\n  this.bbscore = null;\r\n  this.page = null;\r\n\r\n  // Cursor\r\n  this.cursorX = 0;\r\n  this.cursorY = 0;\r\n\r\n  // TODO Move this into easy_reading.js\r\n  this.useEasyReadingMode = false;\r\n  this.easyReadingKeyDownKeyCode = 0;\r\n\r\n  this.doHighlightOnCurRow = false;\r\n\r\n  this.displayingRows = [];\r\n\r\n  this.curRow = 0;\r\n  this.curCol = 0;\r\n\r\n  this.actualRowIndex = 0;\r\n\r\n  this.lineWrap = 78;\r\n\r\n  //this.DBDetection = false;\r\n  this.blinkShow = false;\r\n  this.blinkOn = false;\r\n  this.doBlink = true;\r\n  this.cursorBlinkTimer = null;\r\n\r\n  this.selection = null;\r\n  this.input = document.getElementById('t');\r\n  this.bbsCursor = document.getElementById('cursor');\r\n  this.trackKeyWordList = document.getElementById('TrackKeyWordList');\r\n  this.BBSWin = document.getElementById('BBSWindow');\r\n  this.enablePicPreview = true;\r\n  this.scaleX = 1;\r\n  this.scaleY = 1;\r\n\r\n  var dynamicStyle = document.createElement('style');\r\n  document.head.appendChild(dynamicStyle);\r\n  this.dynamicCss = dynamicStyle.sheet;\r\n\r\n  // for cpu efficiency\r\n  this.innerBounds = { width: 0, height: 0 };\r\n  this.firstGridOffset = { top: 0, left: 0 };\r\n\r\n  // for notifications\r\n  this.enableNotifications = true;\r\n  this.titleTimer = null;\r\n  this.notif = null;\r\n\r\n  var mainDiv = document.createElement('div');\r\n  mainDiv.setAttribute('class', 'main');\r\n  var defaultRows = '';\r\n  for (var i = 0; i < rowCount; ++i) {\r\n    defaultRows += '<span type=\"bbsrow\" srow=\"'+i+'\"></span>';\r\n    this.displayingRows.push(null);\r\n  }\r\n  mainDiv.innerHTML = '<div id=\"mainContainer\">' + defaultRows + '</div>';\r\n  this.BBSWin.appendChild(mainDiv);\r\n  this.mainDisplay = mainDiv;\r\n\r\n  var lastRowDiv = document.createElement('div');\r\n  lastRowDiv.setAttribute('id', 'easyReadingLastRow');\r\n  this.lastRowDivContent = '<span align=\"left\"><span class=\"q0 b7\">                                                       </span><span class=\"q1 b7\">(y)</span><span class=\"q0 b7\">回應</span><span class=\"q1 b7\">(X%)</span><span class=\"q0 b7\">推文</span><span class=\"q1 b7\">(←)</span><span class=\"q0 b7\">離開 </span> </span>';\r\n  lastRowDiv.innerHTML = this.lastRowDivContent;\r\n  this.lastRowDiv = lastRowDiv;\r\n  this.BBSWin.appendChild(lastRowDiv);\r\n\r\n  var replyRowDiv = document.createElement('div');\r\n  replyRowDiv.setAttribute('id', 'easyReadingReplyRow');\r\n  this.replyRowDivContent = '<span align=\"left\"></span>';\r\n  replyRowDiv.innerHTML = this.replyRowDivContent;\r\n  this.replyRowDiv = replyRowDiv;\r\n  this.BBSWin.appendChild(replyRowDiv);\r\n\r\n  this.mainContainer = document.getElementById('mainContainer');\r\n  this.mainDisplay.style.border = '0px';\r\n  this.setFontFace('MingLiu,monospace');\r\n\r\n  this._keyboard = new TermKeyboard(\r\n    this.checkLeftDB.bind(this),\r\n    this.checkCurDB.bind(this),\r\n    this._send.bind(this));\r\n\r\n  var self = this;\r\n  this.input.addEventListener('compositionstart', function(e) {\r\n    self.onCompositionStart(e);\r\n    self.bbscore.setInputAreaFocus();\r\n  }, false);\r\n\r\n  this.input.addEventListener('compositionend', function(e) {\r\n    self.onCompositionEnd(e);\r\n    self.bbscore.setInputAreaFocus();\r\n    // Some browsers fire another input event after composition; some not.\r\n    // The strategy here is to ignore the inputs during composition.\r\n    // Instead, we pull all input text at composition end, and clear input text.\r\n    // So if input event do fire after composition end, we'll get a empty string.\r\n    self.onInput(e);\r\n  }, false);\r\n\r\n  this.input.addEventListener('compositionupdate', function(e) {\r\n  }, false);\r\n\r\n  addEventListener('keydown', function(e) {\r\n    // On both Mac and Windows, control/alt+key will be sent as original key\r\n    // code even under IME.\r\n    // Char inputs will be handler on input event.\r\n    // We can safely ignore those IME keys here.\r\n    if (e.keyCode == 229)\r\n      return;\r\n\r\n    // iOS sends the keydown that starts composition as key code 0. Ignore it.\r\n    if (e.keyCode == 0)\r\n      return;\r\n\r\n    // iOS sends backspace when composing. Disallow any non-control keys during it.\r\n    if (self.isComposition && !e.ctrlKey && !e.altKey)\r\n      return;\r\n\r\n    // disable auto update pushthread if any command is issued;\r\n    if (!e.altKey) self.bbscore.disableLiveHelper();\r\n\r\n    if(e.keyCode > 15 && e.keyCode < 19)\r\n      return; // Shift Ctrl Alt (19)\r\n    if (self.bbscore.modalShown || self.bbscore.contextMenuShown)\r\n      return;\r\n    if (document.getElementById('connectionAlert').style.display != 'none') {\r\n      if (e.keyCode == 13)\r\n        document.getElementById('connectionAlertReconnect').click();\r\n      if (e.keyCode == 27)\r\n        document.getElementById('connectionAlertExitAll').click();\r\n      return;\r\n    }\r\n    self.onKeyDown(e);\r\n  }, false);\r\n\r\n  addEventListener('keyup', function(e) {\r\n    // We don't need to handle code 229 here, as it should be already composing.\r\n\r\n    if(e.keyCode > 15 && e.keyCode < 19)\r\n      return; // Shift Ctrl Alt (19)\r\n    if (self.bbscore.modalShown || self.bbscore.contextMenuShown)\r\n      return;\r\n    if (document.getElementById('connectionAlert').style.display != 'none' && \r\n      (e.keyCode == 13 || e.keyCode == 27)) {\r\n      return;\r\n    }\r\n    // set input area focus whenever key down even if there is selection\r\n    self.bbscore.setInputAreaFocus();\r\n  }, false);\r\n\r\n  this.input.addEventListener('input', function(e) {\r\n    self.onInput(e);\r\n  }, false);\r\n\r\n\r\n}\r\n\r\n\r\nTermView.prototype = {\r\n\r\n  onBlink: function() {\r\n    this.blinkOn=true;\r\n    //   if(this.buf && this.buf.changed)\r\n    this.buf.queueUpdate(true);\r\n    //   else this.update();\r\n  },\r\n\r\n  onCursorBlink: function() {\r\n    this.cursorShow=!this.cursorShow;\r\n    if (this.cursorShow)\r\n      this.bbsCursor.style.display = 'block';\r\n    else\r\n      this.bbsCursor.style.display = 'none';\r\n  },\r\n\r\n  resetCursorBlink: function() {\r\n    if (!this._isConnected())\r\n      return;\r\n    var self = this;\r\n    this.cursorShow = true;\r\n    this.bbsCursor.style.display = 'block';\r\n    if (this.cursorBlinkTimer) {\r\n      this.cursorBlinkTimer.cancel();\r\n    }\r\n    this.cursorBlinkTimer = setTimer(true, function() {\r\n      self.onCursorBlink();\r\n    }, 1000);\r\n  },\r\n\r\n  setBuf: function(buf) {\r\n    this.buf=buf;\r\n  },\r\n\r\n  setConn: function(conn) {\r\n    this.conn=conn;\r\n  },\r\n\r\n  _send: function(data) {\r\n    if (this.conn)\r\n      this.conn.send(data);\r\n  },\r\n\r\n  _convSend: function(data) {\r\n    if (this.conn)\r\n      this.conn.convSend(data);\r\n  },\r\n\r\n  setCore: function(core) {\r\n    this.bbscore=core;\r\n  },\r\n\r\n  _isConnected: function() {\r\n    return this.bbscore.isConnected() && !!this.conn;\r\n  },\r\n\r\n  setFontFace: function(fontFace) {\r\n    this.fontFace = fontFace;\r\n    this.input.style.setProperty('font-family', this.fontFace, 'important');\r\n    this.mainDisplay.style.setProperty('font-family', this.fontFace, 'important');\r\n    this.lastRowDiv.style.setProperty('font-family', this.fontFace, 'important');\r\n    this.replyRowDiv.style.setProperty('font-family', this.fontFace, 'important');\r\n    document.getElementById('cursor').style.setProperty('font-family', this.fontFace, 'important');\r\n  },\r\n\r\n  update: function() {\r\n    this.redraw(false);\r\n  },\r\n\r\n  prePicRel: function(str) {\r\n    if(str.search(/\\.(bmp|gif|jpe?g|png)$/i) == -1)\r\n      return ' type=\"w\"';\r\n    else\r\n      return ' type=\"p\"';\r\n  },\r\n\r\n  redraw: function(force) {\r\n\r\n    //var start = new Date().getTime();\r\n    var cols = this.buf.cols;\r\n    var rows = this.buf.rows;\r\n    var lineChangeds = this.buf.lineChangeds;\r\n    var changedLineHtmlStr = '';\r\n    var changedLineHtmlStrs = [];\r\n    var changedRows = [];\r\n\r\n    var lines = this.buf.lines;\r\n    var outhtmls = this.buf.outputhtmls;\r\n    for (var row = 0; row < rows; ++row) {\r\n      var chh = this.chh;\r\n      this.curRow = row;\r\n      // resets color\r\n      var line = lines[row];\r\n      var outhtml = outhtmls[row];\r\n      var lineChanged = lineChangeds[row];\r\n      if (lineChanged === false && !force)\r\n        continue;\r\n      var lineUpdated = false;\r\n      var chw = this.chw;\r\n\r\n      for (this.curCol = 0; this.curCol < cols; ++this.curCol) {\r\n        // always check all because it's hard to know about openSpan when jump update\r\n        // TODO: maybe set ch.needUpdate false?\r\n        lineUpdated = true;\r\n      }\r\n\r\n      if (lineUpdated) {\r\n        lineUpdated = false;\r\n        changedLineHtmlStrs.push(line);\r\n        changedRows.push(row);\r\n        lineChangeds[row] = false;\r\n      }\r\n    }\r\n\r\n    if (changedLineHtmlStrs.length > 0) {\r\n      if (this.useEasyReadingMode) {\r\n        if (this.buf.startedEasyReading && this.buf.easyReadingShowReplyText) {\r\n          this.updateEasyReadingReplyRow(changedLineHtmlStrs[changedLineHtmlStrs.length-1]);\r\n        } else if (this.buf.startedEasyReading && this.buf.easyReadingShowPushInitText) {\r\n          this.updateEasyReadingPushInitRow(changedLineHtmlStrs[changedLineHtmlStrs.length-1]);\r\n        } else {\r\n          this.populateEasyReadingPage();\r\n        }\r\n      } else {\r\n        while (this.mainContainer.childNodes.length > rows)\r\n          this.mainContainer.removeChild(this.mainContainer.lastChild);\r\n        for (var i = 0; i < changedRows.length; ++i) {\r\n          var row = changedRows[i];\r\n          var component = renderRowHtml(\r\n            changedLineHtmlStrs[i], row, this.chh, false,\r\n            this.mainContainer.childNodes[row]);\r\n          component.setHighlight(\r\n            this.buf.highlightCursor && this.buf.currentHighlighted == row);\r\n          this.displayingRows[row] = component;\r\n        }\r\n      }\r\n      this.buf.prevPageState = this.buf.pageState;\r\n\r\n      if (this.enablePicPreview) {\r\n        // hide preview if any update\r\n        renderImagePreview(document.getElementById('imagePreviewContainer'),\r\n          null);\r\n        this.setupPicPreviewOnHover();\r\n      }\r\n    }\r\n    //var time = new Date().getTime() - start;\r\n    //console.log(time);\r\n\r\n  },\r\n\r\n  setHighlightedRow: function(row) {\r\n    if (this.currentHighlighted == row || this.currentHighlighted === null && row < 0)\r\n      return;\r\n    console.log('highlight: ' + row);\r\n    if (this.currentHighlighted)\r\n      this.displayingRows[this.currentHighlighted].setHighlight(false);\r\n    if (row >= 0) {\r\n      this.displayingRows[row].setHighlight(true);\r\n      this.currentHighlighted = row;\r\n    } else {\r\n      this.currentHighlighted = null;\r\n    }\r\n  },\r\n\r\n  onInput: function(e) {\r\n    if (this.bbscore.modalShown || this.bbscore.contextMenuShown)\r\n      return;\r\n    if (this.isComposition) {\r\n      // beginning chrome 55, we no longer can update input buffer width on compositionupdate\r\n      // so we update it on input event\r\n      this.updateInputBufferWidth();\r\n      return;\r\n    }\r\n\r\n    if (this.useEasyReadingMode && this.buf.startedEasyReading && \r\n        !this.buf.easyReadingShowReplyText && !this.buf.easyReadingShowPushInitText &&\r\n        this.easyReadingKeyDownKeyCode == 229 && e.target.value != 'X') { // only use on chinese IME\r\n      e.target.value = '';\r\n      return;\r\n    }\r\n    if (e.target.value) {\r\n      this.onTextInput(e.target.value);\r\n    }\r\n    e.target.value='';\r\n  },\r\n\r\n  onTextInput: function(text, isPasting) {\r\n    this.resetCursorBlink();\r\n    if (isPasting) {\r\n      text = text.replace(/\\r\\n/g, '\\r');\r\n      text = text.replace(/\\n/g, '\\r');\r\n      text = text.replace(/\\r/g, this.EnterChar);\r\n\r\n      if(text.indexOf('\\x1b') < 0 && this.lineWrap > 0) {\r\n        text = text.wrapText(this.lineWrap, this.EnterChar);\r\n      }\r\n\r\n      //FIXME: stop user from pasting DBCS words with 2-color\r\n      text = text.replace(/\\x1b/g, this.EscChar);\r\n    }\r\n    this._convSend(text);\r\n  },\r\n\r\n  onKeyDown: function(e) {\r\n    this.resetCursorBlink();\r\n\r\n    if (this.useEasyReadingMode && this.buf.startedEasyReading && \r\n        !this.buf.easyReadingShowReplyText && !this.buf.easyReadingShowPushInitText) {\r\n      this.easyReadingKeyDownKeyCode = e.keyCode;\r\n      this.bbscore.easyReading._onKeyDown(e);\r\n      if (e.defaultPrevented)\r\n        return;\r\n    }\r\n\r\n    // TODO: Move this. Make a key event mapper.\r\n    var stop = false;\r\n    if (!e.ctrlKey && !e.altKey) {\r\n      switch (e.key) {\r\n        case 'End': //End\r\n          if ((this.bbscore.buf.pageState == 2 || this.bbscore.buf.pageState == 3) &&\r\n            this.bbscore.endTurnsOnLiveUpdate) {\r\n            this.bbscore.onLiveHelperEnableClicked(false);\r\n            stop = true;\r\n          }\r\n          break;\r\n      }\r\n    } else if (e.ctrlKey && !e.altKey && !e.shiftKey) {\r\n      switch (e.key.toLowerCase()) {\r\n        case 'c':\r\n          if (!window.getSelection().isCollapsed) { //^C , do copy\r\n            var selectedText = window.getSelection().toString().replace(/\\u00a0/g, \" \");\r\n            this.bbscore.doCopy(selectedText);\r\n            stop = true\r\n          }\r\n          break;\r\n        case 'a':\r\n          this.bbscore.doSelectAll();\r\n          stop = true;\r\n          break;\r\n      }\r\n    } else if (e.ctrlKey && !e.altKey && e.shiftKey) {\r\n      switch (e.key.toLowerCase()) {\r\n        case 'V':\r\n          this.bbscore.doPaste();\r\n          stop = true;\r\n          break;\r\n      }\r\n    }\r\n    if (stop) {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    this._keyboard.onKeyDown(e);\r\n    if (e.defaultPrevented)\r\n      return;\r\n  },\r\n\r\n  setTermFontSize: function(cw, ch) {\r\n    var innerBounds = this.innerBounds;\r\n    this.chw = cw;\r\n    this.chh = ch;\r\n    var fontSize = this.chh + 'px';\r\n    var mainWidth = this.chw*this.buf.cols+10 + 'px';\r\n    this.mainDisplay.style.fontSize = fontSize;\r\n    this.mainDisplay.style.lineHeight = fontSize;\r\n    this.bbsCursor.style.fontSize = fontSize;\r\n    this.bbsCursor.style.lineHeight = fontSize;\r\n    this.mainDisplay.style.overflowX = 'hidden';\r\n    this.mainDisplay.style.overflowY = 'auto';\r\n    this.mainDisplay.style.textAlign = 'left';\r\n    this.mainDisplay.style.width = mainWidth;\r\n\r\n    this.lastRowDiv.style.fontSize = fontSize;\r\n    this.lastRowDiv.style.width = mainWidth;\r\n\r\n    this.replyRowDiv.style.fontSize = fontSize;\r\n    this.replyRowDiv.style.width = mainWidth;\r\n    if (this.verticalAlignCenter && this.chh*this.buf.rows < innerBounds.height)\r\n      this.mainDisplay.style.marginTop = ((innerBounds.height-this.chh*this.buf.rows)/2) + this.bbsViewMargin + 'px';\r\n    else\r\n      this.mainDisplay.style.marginTop =  this.bbsViewMargin + 'px';\r\n    if (this.fontFitWindowWidth) {\r\n      this.scaleX = Math.floor(innerBounds.width / (this.chw*this.buf.cols+10) * 100)/100;\r\n      this.scaleY = Math.floor(innerBounds.height / (this.chh*this.buf.rows) * 100)/100;\r\n    } else {\r\n      this.scaleX = 1;\r\n      this.scaleY = 1;\r\n    }\r\n\r\n    var scaleCss = 'none';\r\n    if (this.scaleX != 1 || this.scaleY != 1) {\r\n      //this.mainDisplay.style.transform = 'scaleX('+this.scaleX+')'; // chrome not stable support yet!\r\n      scaleCss = 'scale('+this.scaleX+','+this.scaleY+')';\r\n      var transOrigin = 'left';\r\n      if(this.horizontalAlignCenter) {\r\n        transOrigin = 'center';\r\n      }\r\n      this.mainDisplay.style.webkitTransformOriginX = transOrigin;\r\n      this.lastRowDiv.style.webkitTransformOriginX = transOrigin;\r\n      this.replyRowDiv.style.webkitTransformOriginX = transOrigin;\r\n      this.lastRowDiv.style.webkitTransformOriginY = '-1100%'; // somehow these are the right value\r\n      this.replyRowDiv.style.webkitTransformOriginY = '-1010%';\r\n    } else {\r\n      this.lastRowDiv.style.webkitTransformOriginY = '';\r\n      this.replyRowDiv.style.webkitTransformOriginY = '';\r\n    }\r\n    this.mainDisplay.style.webkitTransform = scaleCss;\r\n    this.lastRowDiv.style.webkitTransform = scaleCss;\r\n    this.replyRowDiv.style.webkitTransform = scaleCss;\r\n\r\n    this.firstGridOffset = this.bbscore.getFirstGridOffsets();\r\n\r\n    this.updateReverseScaleCss();\r\n    this.updateCursorPos();\r\n  },\r\n\r\n  updateReverseScaleCss: function() {\r\n    var rule = 'img.hyperLinkPreview { ' +\r\n      '-webkit-transform: scale(' + Math.floor(1/this.scaleX*100)/100 + ',' +\r\n      Math.floor(1/this.scaleY*100)/100+');' +\r\n      ' }';\r\n    while (this.dynamicCss.cssRules.length > 0) {\r\n      this.dynamicCss.deleteRule(0);\r\n    }\r\n    this.dynamicCss.insertRule(rule, this.dynamicCss.cssRules.length);\r\n  },\r\n\r\n  convertMN2XYEx: function(cx, cy) {\r\n    var origin;\r\n    var w = this.innerBounds.width;\r\n    var h = this.innerBounds.height;\r\n    if(this.horizontalAlignCenter && (this.scaleX!=1 || this.scaleY!=1))\r\n      origin = [((w - (this.chw*this.buf.cols+10)*this.scaleX)/2) + this.bbsViewMargin, ((h - (this.chh*this.buf.rows)*this.scaleY)/2) + this.bbsViewMargin];\r\n    else\r\n      origin = [this.firstGridOffset.left, this.firstGridOffset.top];\r\n    var realX = origin[0] + (cx) * this.chw * this.scaleX;\r\n    var realY = origin[1] + (cy) * this.chh * this.scaleY;\r\n    return [realX, realY];\r\n  },\r\n\r\n  checkLeftDB: function() {\r\n    if (this.dbcsDetect && this.buf.cur_x>1) {\r\n      var lines = this.buf.lines;\r\n      var line = lines[this.buf.cur_y];\r\n      var ch = line[this.buf.cur_x-2];\r\n      if (ch.isLeadByte)\r\n        return true;\r\n    }\r\n    return false;\r\n  },\r\n\r\n  checkCurDB: function() {\r\n    if (this.dbcsDetect) {// && this.buf.cur_x<this.buf.cols-2){\r\n      var lines = this.buf.lines;\r\n      var line = lines[this.buf.cur_y];\r\n      var ch = line[this.buf.cur_x];\r\n      if (ch.isLeadByte)\r\n        return true;\r\n    }\r\n    return false;\r\n  },\r\n\r\n  // Cursor\r\n  updateCursorPos: function() {\r\n\r\n    var pos = this.convertMN2XYEx(this.buf.cur_x, this.buf.cur_y);\r\n    // if you want to set cursor color by now background, use this.\r\n    if (this.buf.cur_y >= this.buf.rows || this.buf.cur_x >= this.buf.cols)\r\n      return; //sometimes, the value of this.buf.cur_x is 80 :(\r\n\r\n    var lines = this.buf.lines;\r\n    var line = lines[this.buf.cur_y];\r\n    var ch = line[this.buf.cur_x];\r\n    var bg = ch.getBg();\r\n\r\n    if (this.scaleX == 1 && this.scaleY == 1) {\r\n      this.bbsCursor.style.webkitTransform = 'none';\r\n      this.lastRowDiv.style.webkitTransformOriginY = '';\r\n      this.replyRowDiv.style.webkitTransformOriginY = '';\r\n    } else {\r\n      var scaleCss = 'scale('+this.scaleX+','+this.scaleY+')';\r\n      this.mainDisplay.style.webkitTransform = scaleCss;\r\n      this.lastRowDiv.style.webkitTransform = scaleCss;\r\n      this.replyRowDiv.style.webkitTransform = scaleCss;\r\n      this.bbsCursor.style.webkitTransform = scaleCss;\r\n      this.bbsCursor.style.webkitTransformOriginX = 'left';\r\n      this.lastRowDiv.style.webkitTransformOriginY = '-1100%';\r\n      this.replyRowDiv.style.webkitTransformOriginY = '-1010%';\r\n    }\r\n\r\n    this.bbsCursor.style.left = pos[0] + 'px';\r\n    this.bbsCursor.style.top = (pos[1] - this.scaleY) + 'px';\r\n    // if you want to set cursor color by now background, use this.\r\n    this.bbsCursor.style.color = termInvColors[bg];\r\n    this.updateInputBufferPos();\r\n\r\n  },\r\n\r\n  updateInputBufferPos: function() {\r\n    if (this.input.getAttribute('bshow') == '1') {\r\n      var pos = this.convertMN2XYEx(this.buf.cur_x, this.buf.cur_y);\r\n      if (!this.hideInputBuffer) {\r\n        this.input.style.opacity = '1';\r\n        this.input.style.border = 'double';\r\n        if (this.inputBufferSizeType === 0) {\r\n          //this.input.style.width  = (this.chh-4)*10 + 'px';\r\n          this.input.style.fontSize = this.chh-4 + 'px';\r\n          //this.input.style.lineHeight = this.chh+4 + 'px';\r\n          this.input.style.height = this.chh + 'px';\r\n        } else {\r\n          //this.input.style.width  = ((this.defineInputBufferSize*2)-4)*10 + 'px';\r\n          this.input.style.fontSize = ((this.defineInputBufferSize*2)-4) + 'px';\r\n          //this.input.style.lineHeight = this.bbscore.inputBufferSize*2+4 + 'px';\r\n          this.input.style.height = this.defineInputBufferSize*2 + 'px';\r\n        }\r\n      } else {\r\n        this.input.style.border = 'none';\r\n        this.input.style.width  = '0px';\r\n        this.input.style.height = '0px';\r\n        this.input.style.fontSize = this.chh + 'px';\r\n        this.input.style.opacity = '0';\r\n        //this.input.style.left = '-100000px';\r\n      }\r\n      var innerBounds = this.innerBounds;\r\n      var bbswinheight = innerBounds.height;\r\n      var bbswinwidth = innerBounds.width;\r\n      if(bbswinheight < pos[1] + parseFloat(this.input.style.height) + this.chh)\r\n        this.input.style.top = (pos[1] - parseFloat(this.input.style.height) - this.chh)+ 4 +'px';\r\n      else\r\n        this.input.style.top = (pos[1] + this.chh) +'px';\r\n\r\n      if(bbswinwidth < pos[0] + parseFloat(this.input.style.width))\r\n        this.input.style.left = bbswinwidth - parseFloat(this.input.style.width)- 10 +'px';\r\n      else\r\n        this.input.style.left = pos[0] +'px';\r\n\r\n      //this.input.style.left = pos[0] +'px';\r\n    }\r\n  },\r\n\r\n  updateInputBufferWidth: function() {\r\n    // change width according to input\r\n    var wordCounts = this.input.value.u2b().length;\r\n    // chh / 2 - 2 because border of 1\r\n    var oneWordWidth = (this.chh/2-2);\r\n    var width = oneWordWidth*wordCounts;\r\n    this.input.style.width  = width + 'px';\r\n    var bounds = this.innerBounds;\r\n    if (parseInt(this.input.style.left) + width + oneWordWidth*2 >= bounds.width) {\r\n      this.input.style.left = bounds.width - width - oneWordWidth*2 + 'px';\r\n    }\r\n  },\r\n\r\n  onCompositionStart: function(e) {\r\n    //this.input.disabled=\"\";\r\n    this.input.setAttribute('bshow', '1');\r\n    this.updateInputBufferPos();\r\n    this.isComposition = true;\r\n  },\r\n\r\n  onCompositionEnd: function(e) {\r\n    //this.input.disabled=\"\";\r\n    this.input.setAttribute('bshow', '0');\r\n    this.input.style.border = 'none';\r\n    this.input.style.width =  '1px';\r\n    this.input.style.height = '1px';\r\n    this.input.style.left =  '-100000px';\r\n    this.input.style.top = '-100000px';\r\n    this.input.style.opacity = '0';\r\n    //this.input.style.top = '0px';\r\n    //this.input.style.left = '-100000px';\r\n    this.isComposition = false;\r\n  },\r\n\r\n  fontResize: function() {\r\n    var cols = this.buf ? this.buf.cols : 80;\r\n    var rows = this.buf ? this.buf.rows : 24;\r\n\r\n    var innerBounds = this.innerBounds;\r\n    var fontWidth = this.bbsFontSize * 2;\r\n\r\n    if (this.screenType === 0 || this.screenType == 1) {\r\n      var width = this.bbsWidth ? this.bbsWidth : innerBounds.width;\r\n      var height = this.bbsHeight ? this.bbsHeight : innerBounds.height;\r\n      if (width === 0 || height === 0) return; // errors for openning in a new window\r\n      width -= 10; // for scroll bar\r\n\r\n      var o_h, o_w, i = 4;\r\n      var nowchh = this.chh;\r\n      var nowchw = this.chw;\r\n      do {\r\n        ++i;\r\n        nowchh = i*2;\r\n        nowchw = i;\r\n        o_h = (nowchh) * 24;\r\n        o_w = nowchw * 80;\r\n      } while (o_h <= height && o_w <= width);\r\n      --i;\r\n      nowchh = i*2;\r\n      nowchw = i;\r\n      this.setTermFontSize(nowchw, nowchh);\r\n      fontWidth = nowchh;\r\n    } else {\r\n      this.setTermFontSize(this.bbsFontSize, this.bbsFontSize*2);\r\n    }\r\n    var forceWidthElems = document.querySelectorAll('.wpadding');\r\n    for (var i = 0; i < forceWidthElems.length; ++i) {\r\n      var forceWidthElem = forceWidthElems[i];\r\n      forceWidthElem.style.width = fontWidth + 'px';\r\n    }\r\n  },\r\n\r\n  countCol: function(node, pos) {\r\n    let rowNode;\r\n    for (let r = node; r != r.parentNode; r = r.parentNode) {\r\n      if (r instanceof Element &&\r\n        r.getAttribute('data-type') == 'bbsline') {\r\n        rowNode = r;\r\n        break;\r\n      }\r\n    }\r\n    if (!rowNode) {\r\n      return { row: 0, col: 0 };\r\n    }\r\n\r\n    let col = 0;\r\n    let doCount = function(cur) {\r\n      if (cur == node) {\r\n        col += cur.textContent.substring(0, pos).u2b().length;\r\n        return false;\r\n      }\r\n      if (cur.nodeName == '#text') {\r\n        col += cur.textContent.u2b().length;\r\n        return true;\r\n      }\r\n      for (let e of cur.childNodes) {\r\n        if (!doCount(e)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n    doCount(rowNode);\r\n\r\n    return {\r\n      row: parseInt(rowNode.getAttribute('data-row')),\r\n      col: col\r\n    };\r\n  },\r\n\r\n  getSelectionColRow: function() {\r\n    let r = window.getSelection().getRangeAt(0);\r\n    return {\r\n      start: this.countCol(r.startContainer, r.startOffset),\r\n      end: this.countCol(r.endContainer, r.endOffset)\r\n    };\r\n  },\r\n\r\n  setupPicPreviewOnHover: function() {\r\n    var self = this;\r\n    var aNodes = $([\r\n      \".main a[href^='http://ppt.cc/']\",\r\n      \".main a[type='p']\",\r\n      \".main a[href^='http://imgur.com/']\",\r\n      \".main a[href^='https://imgur.com/']\",\r\n      \".main a[href^='http://i.imgur.com/']\",\r\n      \".main a[href^='https://i.imgur.com/']\",\r\n      \".main a[href^='https://flic.kr/p/']\",\r\n      \".main a[href^='https://www.flickr.com/photos/']\"\r\n    ].join(\",\")).not([\r\n      \"a[href^='http://imgur.com/a/']\",\r\n      \"a[href^='https://imgur.com/a/']\",\r\n      \"a[href^='http://imgur.com/gallery/']\",\r\n      \"a[href^='https://imgur.com/gallery/']\"\r\n    ].join(\",\"));\r\n    var cont = document.getElementById('imagePreviewContainer');\r\n    var onover = function(e) {\r\n      renderImagePreview(cont, this.getAttribute('href'));\r\n    };\r\n    var onout = function(e) {\r\n      renderImagePreview(cont, null);\r\n    };\r\n    for (var i = 0; i < aNodes.length; ++i) {\r\n      var aNode = aNodes[i];\r\n      aNode.addEventListener('mouseover', onover);\r\n      aNode.addEventListener('mouseout', onout);\r\n    }\r\n  },\r\n\r\n  showWaterballNotification: function() {\r\n    if (!this.enableNotifications) {\r\n      return;\r\n    }\r\n    var app = this.bbscore;\r\n    //console.log('message from ' + this.waterball.userId + ': ' + this.waterball.message); \r\n    var title = app.waterball.userId + ' ' + i18n('notification_said');\r\n    if (this.titleTimer) {\r\n      this.titleTimer.cancel();\r\n      this.titleTimer = null;\r\n    }\r\n    this.titleTimer = setTimer(true, function() {\r\n      if (document.title == app.connectedUrl.site) {\r\n        document.title = title + ' ' + app.waterball.message;\r\n      } else {\r\n        document.title = app.connectedUrl.site;\r\n      }\r\n    }, 1500);\r\n    var options = {\r\n      icon: 'icon_128.png',\r\n      body: app.waterball.message,\r\n      tag: app.waterball.userId\r\n    };\r\n    this.notif = new Notification(title, options);\r\n    this.notif.onclick = function() {\r\n      window.focus();\r\n    };\r\n  },\r\n\r\n  populateEasyReadingPage: function() {\r\n    if (this.buf.pageState == 3 && this.buf.prevPageState == 3) {\r\n      this.mainContainer.style.paddingBottom = '1em';\r\n      var lastRowText = this.buf.getRowText(23, 0, this.buf.cols);\r\n      var result = lastRowText.parseStatusRow();\r\n      if (result) {\r\n        // row index start with 4 or below will cause duplicated first row of next page\r\n        // 2015-07-04: better way is to view the row 3 and row 4 as one wrapped line\r\n        /*\r\n        if (result.rowIndexStart < 5) {\r\n          result.rowIndexStart -= 1;\r\n        }\r\n        */\r\n        var rowOffset = this.buf.pageLines.length-1;\r\n        var beginIndex = 1;\r\n        var atLastPage = false;\r\n        if ((result.pageIndex == result.pageTotal && result.pagePercent == 100) || \r\n            result.rowIndexStart != this.actualRowIndex) { // at last page\r\n          atLastPage = result.rowIndexStart != this.actualRowIndex;\r\n          // find num of rows between actualRowIndex and rowIndexStart\r\n          var numRows = 0;\r\n          for (var i = result.rowIndexStart; i < this.actualRowIndex + 1; ++i) {\r\n            numRows += this.buf.pageWrappedLines[i];\r\n          }\r\n          beginIndex = numRows;\r\n          rowOffset -= beginIndex-1;\r\n        }\r\n\r\n        for (var i = beginIndex; i < this.buf.rows-1; ++i) {\r\n          if (i > 0 && this.buf.isTextWrappedRow(i-1)) {\r\n            this.buf.pageWrappedLines[this.actualRowIndex] += 1;\r\n            // if the second row is the wrapped line from first row \r\n            if (!atLastPage && i == beginIndex) {\r\n              beginIndex++;\r\n            }\r\n          } else {\r\n            this.buf.pageWrappedLines[++this.actualRowIndex] = 1;\r\n          }\r\n        }\r\n        this.appendRows(this.buf.lines.slice(beginIndex, -1), true);\r\n        // deep clone lines for selection (getRowText and get ansi color)\r\n        this.buf.pageLines = this.buf.pageLines.concat(JSON.parse(JSON.stringify(this.buf.lines.slice(beginIndex, -1))));\r\n      }\r\n      this.buf.prevPageState = 3;\r\n    } else {\r\n      this.mainContainer.style.paddingBottom = '';\r\n      this.actualRowIndex = 0;\r\n      this.buf.pageWrappedLines = [];\r\n      if (this.buf.pageState == 3) {\r\n        var lastRowText = this.buf.getRowText(23, 0, this.buf.cols);\r\n        for (var i = 0; i < this.buf.rows-1; ++i) {\r\n          if (i == 4 || i > 0 && this.buf.isTextWrappedRow(i-1)) { // row with i == 4 and the i == 3 is the wrapped line\r\n            this.buf.pageWrappedLines[this.actualRowIndex] += 1;\r\n          } else {\r\n            this.buf.pageWrappedLines[++this.actualRowIndex] = 1;\r\n          }\r\n        }\r\n        this.clearRows();\r\n        this.appendRows(this.buf.lines.slice(0, -1), true);\r\n        this.lastRowDiv.innerHTML = this.lastRowDivContent;\r\n        this.lastRowDiv.style.display = 'block';\r\n        // deep clone lines for selection (getRowText and get ansi color)\r\n        this.buf.pageLines = this.buf.pageLines.concat(JSON.parse(JSON.stringify(this.buf.lines.slice(0, -1))));\r\n      } else {\r\n        this.hideEasyReading();\r\n      }\r\n      this.buf.prevPageState = this.buf.pageState;\r\n    }\r\n  },\r\n\r\n  clearRows: function() {\r\n    this.mainContainer.innerHTML = '';\r\n    this.displayingRows = [];\r\n  },\r\n\r\n  appendRows: function(lines, showsLinkPreview) {\r\n    for (var i in lines) {\r\n      var line = lines[i];\r\n      var el = document.createElement('span');\r\n      el.setAttribute('type', 'bbsrow');\r\n      el.setAttribute('srow', this.mainContainer.childNodes.length);\r\n      this.mainContainer.appendChild(el);\r\n      var component = renderRowHtml(\r\n        line, this.mainContainer.childNodes.length, this.chh,\r\n        showsLinkPreview, el);\r\n      this.displayingRows.push(component);\r\n    }\r\n  },\r\n\r\n  renderSingleRow: function(target, row) {\r\n    var el = document.createElement('span');\r\n    el.setAttribute('type', 'bbsrow');\r\n    el.setAttribute('srow', '0');\r\n    target.appendChild(el);\r\n    return renderRowHtml(row, 0, this.chh, false, el);\r\n  },\r\n\r\n  hideEasyReading: function() {\r\n    this.lastRowDiv.style.display = '';\r\n    this.replyRowDiv.style.display = '';\r\n    // clear the deep cloned copy of lines\r\n    this.buf.pageLines = [];\r\n    this.clearRows();\r\n    this.appendRows(this.buf.lines, false);\r\n  },\r\n\r\n  updateEasyReadingReplyRow: function(row) {\r\n    var el = document.createElement('span');\r\n    el.style = \"background-color:black;\";\r\n    this.renderSingleRow(el, row);\r\n    this.setSingleChild(this.replyRowDiv.childNodes[0], el);\r\n    this.replyRowDiv.style.display = 'block';\r\n  },\r\n\r\n  updateEasyReadingPushInitRow: function(row) {\r\n    var el = document.createElement('span');\r\n    el.style = \"background-color:black;\";\r\n    this.renderSingleRow(el, row);\r\n    this.setSingleChild(this.lastRowDiv.childNodes[0], el);\r\n  },\r\n\r\n  setSingleChild: function(par, child) {\r\n    while (par.childNodes.length > 0)\r\n      par.removeChild(par.lastChild);\r\n    par.appendChild(child);\r\n  }\r\n\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/term_view.js","'use strict';\n\nconst KeyMap = {\n  'Backspace': '\\b',\n  'Tab': '\\t',\n  'Enter': '\\r',\n  'Escape': '\\x1b',\n  'Home': '\\x1b[1~',\n  'Insert': '\\x1b[2~',\n  'Delete': '\\x1b[3~',\n  'End': '\\x1b[4~',\n  'PageUp': '\\x1b[5~',\n  'PageDown': '\\x1b[6~',\n  'ArrowUp': '\\x1b[A',\n  'ArrowDown': '\\x1b[B',\n  'ArrowRight': '\\x1b[C',\n  'ArrowLeft': '\\x1b[D'\n};\nlet CtrlShiftMap = {\n  '@': 50,\n  '^': 54,\n  '_': 109,\n  '?': 127,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221\n};\n// A -> 1\nfor (let i = 97; i <= 122; i++) {\n  CtrlShiftMap[String.fromCharCode(i)] = i - 96;\n}\n\n// FIXME: Under Mac, IME inputs will be sent as key of modified char.\n// Need to use key code directly.\n\nexport class TermKeyboard {\n  // isLeftDB: function() -> bool\n  // isCurDB: function() -> bool\n  // send: function(data)\n  constructor(isLeftDB, isCurDB, send) {\n    this._checkLeftDB = isLeftDB;\n    this._checkCurDB = isCurDB;\n    this._sendFunc = send;\n  }\n\n  _send(data) {\n    this._sendFunc(data);\n    return true;\n  }\n\n  _sendCharCode(code) {\n    return this._send(String.fromCharCode(code));\n  }\n\n  _checkDB(key) {\n    switch (key) {\n      case 'Backspace':\n      case 'ArrowLeft':\n        return this._checkLeftDB();\n      case 'Delete':\n      case 'ArrowRight':\n        return this._checkCurDB();\n    }\n    return false;\n  }\n\n  onKeyDown(e) {\n    if (this._onKeyDown(e))\n      e.preventDefault();\n  }\n\n  _onKeyDown(e) {\n    // Windows/Command key.\n    if (e.getModifierState('Meta')) {\n      return false;\n    }\n\n    if (!e.ctrlKey && !e.altKey) {\n      // Shift-Insert as paste.\n      if (e.shiftKey && e.key == 'Insert') {\n        return false;\n      }\n\n      let mapped = KeyMap[e.key];\n      if (mapped) {\n        if (this._checkDB(e.key)) {\n          return this._send(mapped + mapped);\n        } else {\n          return this._send(mapped);\n        }\n      } else if (e.key.length == 1) { // Normal char\n        return this._send(e.key);\n      }\n    } else if (e.ctrlKey && !e.altKey && !e.shiftKey) {\n      // Use lowercase no even capslock's on.\n      let key = e.key.length == 1 ? e.key.toLowerCase() : e.key;\n      let mappedCode = CtrlShiftMap[key];\n      if (mappedCode) {\n        return this._sendCharCode(mappedCode);\n      }\n    } else if (!e.ctrlKey && e.altKey && !e.shiftKey) {\n      // Remapped keys, which conflict browser shortcuts.\n      // Use lowercase no even capslock's on.\n      switch (e.key.toLowerCase()) {\n        case 'r':\n        case 't':\n        case 'w':\n          // Ctrl+key\n          return this._sendCharCode(e.key.toUpperCase().charCodeAt(0) - 64);\n      }\n    }\n    return false;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/term_keyboard.js","exports.symbolTable = {};\r\nvar a = exports.symbolTable;\r\na.xa1=1;\r\na.xa0=1;\r\na.xa1=1;\r\na.xa4=1;\r\na.xa7=1;\r\na.xaa=1;\r\na.xae=1;\r\na.xaf=1;\r\na.xb0=1;\r\na.xb1=1;\r\na.xb6=1;\r\na.xb7=1;\r\na.xb8=1;\r\na.xba=1;\r\na.xbf=1;\r\na.xc0=1;\r\na.xc1=1;\r\na.xc2=1;\r\na.xc3=1;\r\na.xc4=1;\r\na.xc5=1;\r\na.xc6=1;\r\na.xc7=1;\r\na.xc8=1;\r\na.xc9=1;\r\na.xca=1;\r\na.xcb=1;\r\na.xcc=1;\r\na.xcd=1;\r\na.xce=1;\r\na.xcf=1;\r\na.xd0=1;\r\na.xd1=1;\r\na.xd2=1;\r\na.xd3=1;\r\na.xd4=1;\r\na.xd5=1;\r\na.xd6=1;\r\na.xd7=1;\r\na.xd8=1;\r\na.xd9=1;\r\na.xda=1;\r\na.xdb=1;\r\na.xdc=1;\r\na.xde=1;\r\na.xdf=1;\r\na.xe0=1;\r\na.xe1=1;\r\na.xe2=1;\r\na.xe3=1;\r\na.xe4=1;\r\na.xe5=1;\r\na.xe6=1;\r\na.xe7=1;\r\na.xe8=1;\r\na.xe9=1;\r\na.xea=1;\r\na.xeb=1;\r\na.xec=1;\r\na.xed=1;\r\na.xee=1;\r\na.xef=1;\r\na.xf0=1;\r\na.xf1=1;\r\na.xf2=1;\r\na.xf3=1;\r\na.xf4=1;\r\na.xf5=1;\r\na.xf6=1;\r\na.xf8=1;\r\na.xf9=1;\r\na.xfa=1;\r\na.xfb=1;\r\na.xfc=1;\r\na.xfe=1;\r\na.xff=1;\r\na.x14a=2;\r\na.x153=1;\r\na.x16b=2;\r\na.x192=1;\r\na.x28c=1;\r\na.x252=2;\r\na.x259=2;\r\na.x25a=2;\r\na.x25c=2;\r\na.x25d=2;\r\na.x26f=2;\r\na.x278=2;\r\na.x287=2;\r\na.x292=2;\r\na.x2a4=2;\r\na.x2a7=2;\r\na.x2cf=2;\r\na.x414=2;\r\na.x41f=2;\r\na.x430=2;\r\na.x431=1;\r\na.x432=2;\r\na.x433=2;\r\na.x434=2;\r\na.x435=2;\r\na.x436=2;\r\na.x437=2;\r\na.x438=2;\r\na.x439=2;\r\na.x43a=1;\r\na.x43b=1;\r\na.x43c=2;\r\na.x43d=2;\r\na.x43e=1;\r\na.x43f=2;\r\na.x440=1;\r\na.x441=2;\r\na.x442=2;\r\na.x445=2;\r\na.x446=2;\r\na.x44b=2;\r\na.x44c=2;\r\na.x44f=2;\r\n\r\na.x1e3b=2;\r\na.x1e43=2;\r\na.x1e49=1;\r\na.x1ef2=3; //[4block](type 2?)\r\na.x1ef3=1;\r\n\r\na.x2010=1;\r\na.x2027=1;\r\na.x211e=1;\r\na.x2122=1;\r\na.x213b=2;\r\na.x2157=1;\r\na.x215c=2;\r\na.x21b2=1;\r\na.x21e6=1;\r\na.x21e8=1;\r\na.x21e9=1;\r\na.x2200=2;\r\na.x2202=1;\r\na.x222c=2;\r\na.x2237=2;\r\na.x2282=2;\r\n\r\na.x2401=3;//code - start\r\na.x2402=3;\r\na.x2403=3;\r\na.x2404=3;\r\na.x2405=3;\r\na.x2406=3;\r\na.x2407=3;\r\na.x2408=3;\r\na.x2409=3;\r\na.x240a=3;\r\na.x240b=3;\r\na.x240c=3;\r\na.x240d=3;\r\na.x240e=3;\r\na.x240f=3;\r\na.x2410=3;\r\na.x2411=3;\r\na.x2412=3;\r\na.x2413=3;\r\na.x2414=3;\r\na.x2415=3;\r\na.x2416=3;\r\na.x2417=3;\r\na.x2418=3;\r\na.x2419=3;\r\na.x241a=3;\r\na.x241b=3;\r\na.x241c=3;\r\na.x241d=3;\r\na.x241e=3;\r\na.x241f=3;\r\na.x2421=3;//code - end\r\n\r\na.x246a=2;\r\na.x246b=2;\r\na.x246c=2;\r\na.x246d=2;\r\na.x246e=2;\r\na.x246f=2;\r\na.x2470=2;\r\na.x2471=2;\r\na.x2472=2;\r\na.x2473=2;\r\na.x2503=2;\r\na.x2601=2;\r\na.x2602=2;\r\na.x260e=2;\r\na.x2611=2;\r\na.x261b=2;\r\na.x261c=2;\r\na.x261e=2;\r\na.x261f=2;\r\na.x2620=2;\r\na.x262f=2;\r\na.x2630=2;\r\na.x2631=2;\r\na.x2632=2;\r\na.x2633=2;\r\na.x2634=2;\r\na.x2635=2;\r\na.x2636=2;\r\na.x2637=2;\r\na.x2639=1;\r\na.x263a=2;\r\na.x263b=2;\r\na.x263c=2;\r\na.x263d=2;\r\na.x2660=2;\r\na.x2661=1;\r\na.x2662=1;\r\na.x2663=2;\r\na.x2664=1;\r\na.x2665=2;\r\na.x2666=1;\r\na.x2667=1;\r\na.x266a=1;\r\na.x266c=2;\r\na.x2702=2;\r\na.x2708=2;\r\na.x2709=2;\r\na.x2713=2;\r\na.x2715=2;\r\na.x2721=2;\r\na.x2729=2;\r\na.x274f=2;\r\na.x278e=2;\r\na.x278f=2;\r\na.x2790=2;\r\na.x2791=2;\r\na.x2792=2;\r\n//\r\na.xe11b=3;\r\na.xe282=3;\r\na.xe568=3;\r\na.xe56b=3;\r\na.xe686=3;//[4block] - start\r\na.xe687=3;\r\na.xe7e0=3;\r\na.xe9cc=3;\r\na.xe9ce=3;\r\na.xe9cf=3;\r\na.xeb8b=3;\r\na.xec63=3;\r\na.xec64=3;\r\na.xec65=3;\r\na.xec66=3;\r\na.xec67=3;//[4block] - end\r\n\r\na.xec6c=1;\r\na.xec6a=1;\r\n\r\na.xec6e=3;//[4block] - start\r\na.xec71=3;\r\na.xec72=3;\r\na.xec73=3;\r\na.xec74=3;\r\na.xec71=3;\r\na.xec7c=3;\r\na.xec7d=3;\r\na.xec80=3;\r\na.xec83=3;\r\na.xec85=3;\r\na.xec86=3;\r\na.xec87=3;\r\na.xec88=3;\r\na.xec89=3;\r\na.xec8a=3;\r\na.xec8b=3;\r\na.xec8c=3;\r\na.xec8d=3;\r\na.xec8e=3;\r\na.xec8f=3;\r\na.xec90=3;\r\na.xec91=3;\r\na.xec9f=3;\r\na.xeca0=3;\r\na.xeca1=3;\r\na.xeca3=3;\r\na.xeca4=3;\r\na.xeca5=3;\r\na.xeca6=3;\r\na.xeca7=3;\r\na.xeca8=3;\r\na.xeca9=3;\r\na.xeca3=3;\r\na.xecae=3;\r\na.xecb5=3;\r\na.xecb6=3;\r\na.xecb8=3;\r\na.xecc1=3;\r\na.xecc2=3;\r\na.xecc8=3;\r\na.xecca=3;\r\na.xeccb=3;\r\na.xeccc=3;\r\na.xeccd=3;\r\na.xecce=3;\r\na.xed91=3;\r\na.xed92=3;\r\na.xee1e=3;\r\na.xee22=3;\r\na.xee58=3;\r\na.xee5a=3;\r\na.xee5c=3;\r\na.xee5e=3;\r\na.xee5f=3;\r\na.xeeb6=3;//[4block] - end\r\n\r\na.xf7e6=3;//[4block] - start\r\na.xf7e8=3;\r\na.xf7ee=3;\r\na.xf7ef=3;\r\na.xf7f0=3;\r\na.xf7f1=3;\r\na.xf7f2=3;\r\na.xf7f3=3;\r\na.xf7f4=3;\r\na.xf7f5=3;\r\na.xf7f6=3;\r\na.xf7f7=3;\r\na.xf7f8=3;\r\na.xf7f8=3;\r\na.xf7fa=3;//[4block] - end\r\n\r\na.xf849=3;//[4block] - start\r\na.xf84a=3;\r\na.xf84b=3;\r\na.xf84c=3;\r\na.xf84d=3;\r\na.xf84e=3;\r\na.xf84f=3;\r\na.xf850=3;\r\na.xf851=3;\r\na.xf852=3;\r\na.xf853=3;\r\na.xf854=3;\r\na.xf855=3;\r\na.xf856=3;\r\na.xf857=3;\r\na.xf858=3;\r\na.xf859=3;\r\na.xf85a=3;\r\na.xf85b=3;\r\na.xf85c=3;\r\na.xf85d=3;\r\na.xf85e=3;\r\na.xf85f=3;\r\na.xf860=3;\r\na.xf861=3;\r\na.xf862=3;\r\na.xf863=3;\r\na.xf864=3;\r\na.xf865=3;//[4block] - end\r\n\r\na.xff61=1;\r\na.xff62=1;\r\na.xff63=1;\r\na.xff64=1;\r\na.xff65=1;\r\na.xff66=1;\r\na.xff67=1;\r\na.xff68=1;\r\na.xff69=1;\r\na.xff6a=1;\r\na.xff6b=1;\r\na.xff6c=1;\r\na.xff6d=1;\r\na.xff6e=1;\r\na.xff6f=1;\r\na.xff70=1;\r\na.xff71=1;\r\na.xff72=1;\r\na.xff73=1;\r\na.xff74=1;\r\na.xff75=1;\r\na.xff76=1;\r\na.xff77=1;\r\na.xff78=1;\r\na.xff79=1;\r\na.xff7a=1;\r\na.xff7b=1;\r\na.xff7c=1;\r\na.xff7d=1;\r\na.xff7e=1;\r\na.xff7f=1;\r\na.xff80=1;\r\na.xff81=1;\r\na.xff82=1;\r\na.xff83=1;\r\na.xff84=1;\r\na.xff85=1;\r\na.xff86=1;\r\na.xff87=1;\r\na.xff88=1;\r\na.xff89=1;\r\na.xff8a=1;\r\na.xff8b=1;\r\na.xff8c=1;\r\na.xff8d=1;\r\na.xff8e=1;\r\na.xff8f=1;\r\na.xff90=1;\r\na.xff91=1;\r\na.xff92=1;\r\na.xff93=1;\r\na.xff94=1;\r\na.xff95=1;\r\na.xff96=1;\r\na.xff97=1;\r\na.xff98=1;\r\na.xff99=1;\r\na.xff9a=1;\r\na.xff9b=1;\r\na.xff9c=1;\r\na.xff9d=1;\r\na.xff9e=1;\r\na.xff9f=1;\r\na.xfffd=3;\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/symbol_table.js","'use struct';\n\nexport class ImageURL {\n  static register(clazz) {\n    if (!this._providers) {\n      this._providers = [];\n    }\n    this._providers.push(clazz);\n  }\n\n  static create(href) {\n    for (let provider of this._providers) {\n      let instance = provider.create(href);\n      if (instance) {\n        return instance;\n      }\n    }\n    return null;\n  }\n}\n\nclass FlickrImageURL {\n  // To decode base58 of flickr photo id\n  // ref: https://www.flickr.com/groups/51035612836@N01/discuss/72157616713786392/72157620931323757\n  static base58_decode(snipcode) {\n    var alphabet = '123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ';\n    var num = snipcode.length;\n    var decoded = 0;\n    var multi = 1;\n    for (var i = (num-1); i >= 0; i--) {\n      decoded = decoded + multi * alphabet.indexOf(snipcode[i]);\n      multi = multi * alphabet.length;\n    }\n    return decoded;\n  }\n\n  static create(href) {\n    let found_flickr = href.match(\n      'flic\\.kr\\/p\\/\\(\\\\w\\+\\)|flickr\\.com\\/photos\\/[\\\\w@]\\+\\/\\(\\\\d\\+\\)');\n    if (!found_flickr) {\n      return null;\n    }\n    let flickrBase58Id = found_flickr[1];\n    let flickrPhotoId = flickrBase58Id ?\n      this.base58_decode(flickrBase58Id) : found_flickr[2];\n    return new FlickrImageURL(flickrPhotoId);\n  }\n\n  constructor(photoID) {\n    this._photoID = photoID;\n  }\n\n  fetchSrc() {\n    const apiURL = \"https://api.flickr.com/services/rest/\" +\n      \"?method=flickr.photos.getInfo\" +\n      \"&api_key=c8c95356e465b8d7398ff2847152740e\" +\n      \"&photo_id=\" + encodeURIComponent(this._photoID) +\n      \"&format=json\" + \n      \"&jsoncallback=?\";\n    return new Promise(function(resolve, reject) {\n      $.getJSON(apiURL, function(data) {\n        if (data.photo) {\n          let p = data.photo;\n          let src = \"https://farm\" + p.farm + \".staticflickr.com/\"+\n            p.server + \"/\" + p.id + \"_\" + p.secret + \".jpg\";\n          resolve(src);\n        } else {\n          reject();\n        }\n      });\n    });\n  }\n}\nImageURL.register(FlickrImageURL);\n\nclass ImgurImageURL {\n  static create(href) {\n    if (href.match('^https?://(i\\.)?imgur\\.com/')) {\n      return new ImgurImageURL(href);\n    }\n    return null;\n  }\n\n  constructor(href) {\n    this._href = href;\n  }\n\n  fetchSrc() {\n    let src = this._href.replace(\n      /^https?:\\/\\/imgur.com/, 'https://i.imgur.com') + '.jpg';\n    return Promise.resolve(src);\n  }\n}\nImageURL.register(ImgurImageURL);\n\nclass GenericImageURL {\n  static create(href) {\n    // TODO: add support for common suffixes.\n    return null;\n  }\n\n  fetchSrc() {\n    return Promise.reject('not implemented');\n  }\n}\nImageURL.register(GenericImageURL);\n\n\n\n// WEBPACK FOOTER //\n// ./js/image_urls.js","exports.en_US = {\r\n  \"appName\": {\r\n    \"message\": \"PttChrome\",\r\n    \"description\": \"The title of the application, displayed in the web store.\"\r\n  },\r\n  \"appDesc\": {\r\n    \"message\": \"A GNU/GPL telnet client extension specifically designed for BBS browsing.\",\r\n    \"description\":\"The description of the application, displayed in the web store.\"\r\n  },\r\n\r\n  // side menus\r\n  \"menu_coloredCopy\": {\r\n    \"message\": \"Copy with ANSI color\"\r\n  },\r\n  \"menu_goToOtherSite\": {\r\n    \"message\": \"Other site\"\r\n  },\r\n  \"menu_paste\": {\r\n    \"message\": \"Paste\"\r\n  },\r\n  \"menu_selectAll\": {\r\n    \"message\": \"Select all\"\r\n  },\r\n  \"menu_mouseBrowsing\": {\r\n    \"message\": \"Mouse\"\r\n  },\r\n  \"menu_settings\": {\r\n    \"message\": \"Settings\"\r\n  },\r\n\r\n  // context menus\r\n  \"cmenu_copy\": {\r\n    \"message\": \"Copy\"\r\n  },\r\n  \"cmenu_copyAnsi\": {\r\n    \"message\": \"Copy with ANSI colors\"\r\n  },\r\n  \"cmenu_paste\": {\r\n    \"message\": \"Paste\"\r\n  },\r\n  \"cmenu_selectAll\": {\r\n    \"message\": \"Select all\"\r\n  },\r\n  \"cmenu_searchGoogle\": {\r\n    \"message\": \"Search Google for\"\r\n  },\r\n  \"cmenu_quickSearch\": {\r\n    \"message\": \"Quick Search\"\r\n  },\r\n  \"cmenu_openUrlNewTab\": {\r\n    \"message\": \"Open link in new tab\"\r\n  },\r\n  \"cmenu_copyLinkUrl\": {\r\n    \"message\": \"Copy link address\"\r\n  },\r\n  \"cmenu_mouseBrowsing\": {\r\n    \"message\": \"Mouse browsing\"\r\n  },\r\n  \"cmenu_goToOtherSite\": {\r\n    \"message\": \"Go to other site ...\"\r\n  },\r\n  \"cmenu_showInputHelper\": {\r\n    \"message\": \"Input helper ...\"\r\n  },\r\n  \"cmenu_showLiveArticleHelper\": {\r\n    \"message\": \"Live article helper ...\"\r\n  },\r\n  \"cmenu_addBlacklistUserId\": {\r\n    \"message\": \"Add blacklist user\"\r\n  },\r\n  \"cmenu_removeBlacklistUserId\": {\r\n    \"message\": \"Remove blacklist user\"\r\n  },\r\n  \"cmenu_settings\": {\r\n    \"message\": \"Settings\"\r\n  },\r\n  \"cmenu_restartInTab\": {\r\n    \"message\": \"Restart PttChrome in a new tab\"\r\n  },\r\n\r\n  // options nav\r\n  \"options_general\": {\r\n    \"message\": \"General\"\r\n  },\r\n  \"options_autologin\": {\r\n    \"message\": \"Auto login\"\r\n  },\r\n  \"options_blacklist\": {\r\n    \"message\": \"Blacklist\"\r\n  },\r\n  \"options_extensions\": {\r\n    \"message\": \"Extensions\"\r\n  },\r\n  \"options_about\": {\r\n    \"message\": \"About\"\r\n  },\r\n\r\n  // options\r\n  \"options_openInPackagedApp\": {\r\n    \"message\": \"Launch PttChrome in packaged app.\"\r\n  },\r\n  \"options_closeQuery\": {\r\n    \"message\": \"Ask before closing tab.\"\r\n  },\r\n  \"options_enablePicPreview\": {\r\n    \"message\": \"Enable preview when hover on image URLs.\"\r\n  },\r\n  \"options_enableNotifications\": {\r\n    \"message\": \"Enable notifications when a message is received.\"\r\n  },\r\n  \"options_enableEasyReading\": {\r\n    \"message\": \"Enable easy reading article view.\"\r\n  },\r\n  \"options_endTurnsOnLiveUpdate\": {\r\n    \"message\": \"Press END turns on pushthread live update.\"\r\n  },\r\n  \"options_copyOnSelect\": {\r\n    \"message\": \"Copy text when selected.\"\r\n  },\r\n  \"options_enableDeleteDupLogin\": {\r\n    \"message\": \"When asked to disconnect other logged-in connections, answer:\"\r\n  },\r\n  \"options_preferences\": {\r\n    \"message\": \"Preferences\"\r\n  },\r\n  \"options_antiIdleTime\": {\r\n    \"message\": \"Anti-idle interval (sec)\"\r\n  },\r\n  \"options_lineWrap\": {\r\n    \"message\": \"Wrap line for pasting text longer than\"\r\n  },\r\n  \"options_reset\": {\r\n    \"message\": \"Restore defaults\"\r\n  },\r\n  \"options_appearance\": {\r\n    \"message\": \"Appearance\"\r\n  },\r\n  \"options_bbsMargin\": {\r\n    \"message\": \"Margins around BBS view (px)\"\r\n  },\r\n  \"options_fontFitWindowWidth\": {\r\n    \"message\": \"Stretch font to fill the view\"\r\n  },\r\n  \"options_fontFace\": {\r\n    \"message\": \"Font face\"\r\n  },\r\n  \"options_mouse\": {\r\n    \"message\": \"Mouse\"\r\n  },\r\n  \"options_mouseBrowsing\": {\r\n    \"message\": \"Mouse browsing\"\r\n  },\r\n  \"options_useMouseBrowsing\": {\r\n    \"message\": \"Mouse browsing on start\"\r\n  },\r\n  \"options_mouseBrowsingHighlight\": {\r\n    \"message\": \"Mouse browsing highlight effect\"\r\n  },\r\n  \"options_highlightColor\": {\r\n    \"message\": \"Color\"\r\n  },\r\n  \"options_mouseLeftFunction\": {\r\n    \"message\": \"Mouse left button\"\r\n  },\r\n  \"options_mouseMiddleFunction\": {\r\n    \"message\": \"Mouse middle button\"\r\n  },\r\n  \"options_mouseWheelFunction1\": {\r\n    \"message\": \"Mouse wheel\"\r\n  },\r\n  \"options_mouseWheelFunction2\": {\r\n    \"message\": \"Right mouse key + mouse wheel\"\r\n  },\r\n  \"options_mouseWheelFunction3\": {\r\n    \"message\": \"Left mouse key + mouse wheel\"\r\n  },\r\n  \"options_none\": {\r\n    \"message\": \"No action\"\r\n  },\r\n  \"options_doPaste\": {\r\n    \"message\": \"Perform 'Paste'\"\r\n  },\r\n  \"options_leftKey\": {\r\n    \"message\": \"Sends LEFT key\"\r\n  },\r\n  \"options_rightKey\": {\r\n    \"message\": \"Sends RIGHT key\"\r\n  },\r\n  \"options_enterKey\": {\r\n    \"message\": \"Sends ENTER key\"\r\n  },\r\n  \"options_upDown\": {\r\n    \"message\": \"Controls up / down\"\r\n  },\r\n  \"options_pageUpDown\": {\r\n    \"message\": \"Controls pageup / pagedown\"\r\n  },\r\n  \"options_threadLastNext\": {\r\n    \"message\": \"Controls thread previous / next\"\r\n  },\r\n  \"options_enableBlacklist\": {\r\n    \"message\": \"Enable user blacklist feature\"\r\n  },\r\n  \"options_blacklistInstruction\": {\r\n    \"message\": \"Type in the usernames in the textarea below, one per line\"\r\n  },\r\n\r\n  // auto logins\r\n  \"autologin_username\": {\r\n    \"message\": \"Username\"\r\n  },\r\n  \"autologin_password\": {\r\n    \"message\": \"Password\"\r\n  },\r\n  \"autologin_warning\": {\r\n    \"message\": \"Login info is not encrypted, DO NOT use on a public machine\"\r\n  },\r\n\r\n  // extensions\r\n  \"ext_quickSearch\": {\r\n    \"message\": \"Quick Search\"\r\n  },\r\n  \"ext_addQuickSearchNamePlaceholder\": {\r\n    \"message\": \"Add search engine\"\r\n  },\r\n  \"ext_addQuickSearchQueryPlaceholder\": {\r\n    \"message\": \"URL with %s in place of query\"\r\n  },\r\n\r\n  // about page\r\n  \"about_appName_subtitle\": {\r\n    \"message\": \"An open source BBS client\"\r\n  },\r\n  \"about_description\": {\r\n    \"message\": \"Originally written by #link_github_iamchucky#. This is a modified version by #link_github_robertabcd#. It supports connecting over Websocket, and works on most browsers.\",\r\n  },\r\n  \"about_version_title\": {\r\n    \"message\": \"Version\"\r\n  },\r\n  \"about_version_current\": {\r\n    \"message\": \"This version: #link_robertabcd_PttChrome#, #link_GPL20#.\"\r\n  },\r\n  \"about_version_original\": {\r\n    \"message\": \"Original version: webapp12 6/2/2015, #link_iamchucky_PttChrome#, #link_GPL20#.\"\r\n  },\r\n  \"about_new_title\": {\r\n    \"message\": \"What's new\"\r\n  },\r\n  \"about_new_content\": {\r\n    \"message\": [\r\n      'Allow setting keepAlive from url, append ?keepAlive=[SECONDS] to the URL',\r\n      'Added SSH connection to PTT, append ?ssh=true to the URL',\r\n      'Limited easy reading mode to ptt.cc only',\r\n      'Added features to load/backup blacklist with Google Drive',\r\n      'Suggest to try port 443 when disconnected',\r\n      'Settings to answer duplicated connection query in autologin settings',\r\n      'Added Live Article Helper in context menu to auto refresh pushthread, or use Alt + r',\r\n      'Switching easy reading mode in settings no longer require a restart',\r\n      'Disabled hammerjs that caused mouse related issue on old Chrome verisons',\r\n      'Fixing bug with spacebar when in chinese input mode and easy reading mode',\r\n      'Fixing ssh connection problem with kex',\r\n      'Added option to ask before closing',\r\n      'Added setting to send right arrow key to left mouse button',\r\n      'Added option to turn on live update with END',\r\n      'Middle mouse button click has new option to do paste',\r\n      'Added option to enable copy on select',\r\n      'Added Quick Search in settings and context menu (thanks to abccbaandy)'\r\n    ]\r\n  },\r\n\r\n  // alerts\r\n  \"alert_developerModeHeader\": {\r\n    \"message\": \"Developer Mode\"\r\n  },\r\n  \"alert_developerModeText\": {\r\n    \"message\": \"You are using developer mode. Things may break in this version of PttChrome. Use this at your own risk.\"\r\n  },\r\n  \"alert_developerModeDismiss\": {\r\n    \"message\": \"Yes, I understand.\"\r\n  },\r\n\r\n  \"alert_connectionHeader\": {\r\n    \"message\": \"You are disconnected!\"\r\n  },\r\n  \"alert_connectionText\": {\r\n    \"message\": \"Would you like to reconnect to the site?\"\r\n  },\r\n  \"alert_connectionReconnect\": {\r\n    \"message\": \"Reconnect (ENTER)\"\r\n  },\r\n  \"alert_connectionPortOption1\": {\r\n    \"message\": \"or\"\r\n  },\r\n  \"alert_connectionPortOption2\": {\r\n    \"message\": \"Try with port 443\"\r\n  },\r\n\r\n  \"alert_pasteShortcutHeader\": {\r\n    \"message\": \"Paste\"\r\n  },\r\n  \"alert_pasteShortcutText\": {\r\n    \"message\": \"Please use Shift+Insert to paste\"\r\n  },\r\n  \"alert_pasteShortcutClose\": {\r\n    \"message\": \"OK\"\r\n  },\r\n\r\n  // notifications\r\n  \"notification_said\": {\r\n    \"message\": \"says:\"\r\n  },\r\n\r\n  \"input_sitePlaceholder\": {\r\n    \"message\": \"input URL here and then press ENTER\"\r\n  },\r\n\r\n  // input helper\r\n  \"inputHelperTitle\": {\r\n    \"message\": \"Input helper\"\r\n  },\r\n  \"colorTitle\": {\r\n    \"message\": \"Color\"\r\n  },\r\n  \"colorHelperSend\": {\r\n    \"message\": \"Send ANSI color code\"\r\n  },\r\n  \"colorHelperSendMenuFore\": {\r\n    \"message\": \"Send foreground only\"\r\n  },\r\n  \"colorHelperSendMenuBack\": {\r\n    \"message\": \"Send background only\"\r\n  },\r\n  \"colorHelperSendMenuReset\": {\r\n    \"message\": \"Send reset code\"\r\n  },\r\n  \"colorHelperBlink\": {\r\n    \"message\": \"Blink\"\r\n  },\r\n  \"colorHelperPreview\": {\r\n    \"message\": \"▅ PREVIEW ▅\"\r\n  },\r\n  \"colorHelperTooltip1\": {\r\n    \"message\": \"Left click: foreground color\"\r\n  },\r\n  \"colorHelperTooltip2\": {\r\n    \"message\": \"Right click: background color, upper row only\"\r\n  },\r\n\r\n  // symbols\r\n  \"symTitle\": {\r\n    \"message\": \"Symbols\"\r\n  },\r\n  \"symTitle_general\": {\r\n    \"message\": \"General\"\r\n  },\r\n  \"symTitle_lineBorders\": {\r\n    \"message\": \"Line borders\"\r\n  },\r\n  \"symTitle_blocks\": {\r\n    \"message\": \"Blocks\"\r\n  },\r\n  \"symTitle_lines\": {\r\n    \"message\": \"Lines\"\r\n  },\r\n  \"symTitle_special\": {\r\n    \"message\": \"Special\"\r\n  },\r\n  \"symTitle_brackets\": {\r\n    \"message\": \"Brackets\"\r\n  },\r\n  \"symTitle_greek\": {\r\n    \"message\": \"Greek\"\r\n  },\r\n  \"symTitle_phonetic\": {\r\n    \"message\": \"Phonetic\"\r\n  },\r\n  \"symTitle_math\": {\r\n    \"message\": \"Math\"\r\n  },\r\n  \"symTitle_hiragana\": {\r\n    \"message\": \"Hiragana\"\r\n  },\r\n  \"symTitle_katakana\": {\r\n    \"message\": \"Katakana\"\r\n  },\r\n\r\n  // emoticons\r\n  \"emoTitle\": {\r\n    \"message\": \"Emoticons\"\r\n  },\r\n  \"emoTitle_angry\": {\r\n    \"message\": \"Angry\"\r\n  },\r\n  \"emoTitle_meh\": {\r\n    \"message\": \"Meh\"\r\n  },\r\n  \"emoTitle_sweat\": {\r\n    \"message\": \"Sweat & awkward\"\r\n  },\r\n  \"emoTitle_happy\": {\r\n    \"message\": \"Happy\"\r\n  },\r\n  \"emoTitle_other\": {\r\n    \"message\": \"Others\"\r\n  },\r\n\r\n  // live helper\r\n  \"liveHelperEnable\": {\r\n    \"message\": \"Enable\"\r\n  },\r\n  \"liveHelperSpan\": {\r\n    \"message\": \"pushthread refreshes every\"\r\n  },\r\n  \"liveHelperSpanSec\": {\r\n    \"message\": \"sec\"\r\n  },\r\n\r\n  // tooltips\r\n  \"tooltip_antiIdleTime\": {\r\n    \"message\": \"Input 0 to disable this feature.\"\r\n  },\r\n  \"tooltip_fontFace\": {\r\n    \"message\": \"Separate each font with a comma, start with the desired font and end with a generic font.\"\r\n  }\r\n\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/en_US_messages.js","exports.zh_TW = {\r\n  \"appName\": {\r\n    \"message\": \"PttChrome\",\r\n    \"description\": \"The title of the application, displayed in the web store.\"\r\n  },\r\n  \"appDesc\": {\r\n    \"message\": \"專為 BBS 瀏覽設計，採 GNU/GPL 授權的 telnet 連線程式套件\",\r\n    \"description\":\"The description of the application, displayed in the web store.\"\r\n  },\r\n\r\n  // side menus\r\n  \"menu_coloredCopy\": {\r\n    \"message\": \"複製 (包含 ANSI 顏色)\"\r\n  },\r\n  \"menu_goToOtherSite\": {\r\n    \"message\": \"其他站台\"\r\n  },\r\n  \"menu_paste\": {\r\n    \"message\": \"貼上\"\r\n  },\r\n  \"menu_selectAll\": {\r\n    \"message\": \"全選\"\r\n  },\r\n  \"menu_mouseBrowsing\": {\r\n    \"message\": \"滑鼠瀏覽\"\r\n  },\r\n  \"menu_settings\": {\r\n    \"message\": \"設定\"\r\n  },\r\n\r\n  // context menus\r\n  \"cmenu_copy\": {\r\n    \"message\": \"複製\"\r\n  },\r\n  \"cmenu_copyAnsi\": {\r\n    \"message\": \"複製 (包含 ANSI 顏色)\"\r\n  },\r\n  \"cmenu_paste\": {\r\n    \"message\": \"貼上\"\r\n  },\r\n  \"cmenu_selectAll\": {\r\n    \"message\": \"全選\"\r\n  },\r\n  \"cmenu_searchGoogle\": {\r\n    \"message\": \"在 Google 上搜尋\"\r\n  },\r\n  \"cmenu_quickSearch\": {\r\n    \"message\": \"快速搜尋\"\r\n  },\r\n  \"cmenu_openUrlNewTab\": {\r\n    \"message\": \"在新分頁中開啟連結\"\r\n  },\r\n  \"cmenu_copyLinkUrl\": {\r\n    \"message\": \"複製連結網址\"\r\n  },\r\n  \"cmenu_mouseBrowsing\": {\r\n    \"message\": \"滑鼠瀏覽\"\r\n  },\r\n  \"cmenu_goToOtherSite\": {\r\n    \"message\": \"去其他站台 ...\"\r\n  },\r\n  \"cmenu_showInputHelper\": {\r\n    \"message\": \"輸入小幫手 ...\"\r\n  },\r\n  \"cmenu_showLiveArticleHelper\": {\r\n    \"message\": \"Live 文小幫手 ...\"\r\n  },\r\n  \"cmenu_addBlacklistUserId\": {\r\n    \"message\": \"在黑名單裡加入使用者\"\r\n  },\r\n  \"cmenu_removeBlacklistUserId\": {\r\n    \"message\": \"在黑名單裡移除使用者\"\r\n  },\r\n  \"cmenu_settings\": {\r\n    \"message\": \"設定\"\r\n  },\r\n  \"cmenu_restartInTab\": {\r\n    \"message\": \"在新分頁重新開啟 PttChrome\"\r\n  },\r\n\r\n  // options nav\r\n  \"options_general\": {\r\n    \"message\": \"一般\"\r\n  },\r\n  \"options_autologin\": {\r\n    \"message\": \"自動登入\"\r\n  },\r\n  \"options_blacklist\": {\r\n    \"message\": \"黑名單\"\r\n  },\r\n  \"options_extensions\": {\r\n    \"message\": \"額外功能\"\r\n  },\r\n  \"options_about\": {\r\n    \"message\": \"關於\"\r\n  },\r\n\r\n  // options\r\n  \"options_openInPackagedApp\": {\r\n    \"message\": \"'批' 圖示會在獨立視窗開啟 PttChrome\"\r\n  },\r\n  \"options_closeQuery\": {\r\n    \"message\": \"關閉分頁時先詢問\"\r\n  },\r\n  \"options_enablePicPreview\": {\r\n    \"message\": \"當滑鼠在圖片連結上時顯示圖片預覽\"\r\n  },\r\n  \"options_enableNotifications\": {\r\n    \"message\": \"啟用水球通知\"\r\n  },\r\n  \"options_enableEasyReading\": {\r\n    \"message\": \"啟用文章好讀模式\"\r\n  },\r\n  \"options_endTurnsOnLiveUpdate\": {\r\n    \"message\": \"END 啟用推文即時更新 (如 Alt + r)\"\r\n  },\r\n  \"options_copyOnSelect\": {\r\n    \"message\": \"選取文字時自動複製文字\"\r\n  },\r\n  \"options_enableDeleteDupLogin\": {\r\n    \"message\": \"當被問到是否刪除其他重複登入的連線，回答:\"\r\n  },\r\n  \"options_preferences\": {\r\n    \"message\": \"設定\"\r\n  },\r\n  \"options_antiIdleTime\": {\r\n    \"message\": \"防閒置間隔 (秒)\"\r\n  },\r\n  \"options_lineWrap\": {\r\n    \"message\": \"自動換行, 當貼上的字長於\"\r\n  },\r\n  \"options_reset\": {\r\n    \"message\": \"設回預設值\"\r\n  },\r\n  \"options_appearance\": {\r\n    \"message\": \"介面\"\r\n  },\r\n  \"options_bbsMargin\": {\r\n    \"message\": \"BBS 周圍邊距 (像素)\"\r\n  },\r\n  \"options_fontFitWindowWidth\": {\r\n    \"message\": \"把字體拉大來補滿畫面\"\r\n  },\r\n  \"options_fontFace\": {\r\n    \"message\": \"字型\"\r\n  },\r\n  \"options_mouseBrowsing\": {\r\n    \"message\": \"滑鼠瀏覽\"\r\n  },\r\n  \"options_useMouseBrowsing\": {\r\n    \"message\": \"預設使用滑鼠瀏覽\"\r\n  },\r\n  \"options_mouseBrowsingHighlight\": {\r\n    \"message\": \"啟用滑鼠瀏覽的底色效果\"\r\n  },\r\n  \"options_highlightColor\": {\r\n    \"message\": \"底色\"\r\n  },\r\n  \"options_mouseLeftFunction\": {\r\n    \"message\": \"滑鼠左鍵\"\r\n  },\r\n  \"options_mouseMiddleFunction\": {\r\n    \"message\": \"滑鼠中鍵\"\r\n  },\r\n  \"options_mouseWheelFunction1\": {\r\n    \"message\": \"滑鼠滾輪\"\r\n  },\r\n  \"options_mouseWheelFunction2\": {\r\n    \"message\": \"滑鼠右鍵 + 滑鼠滾輪\"\r\n  },\r\n  \"options_mouseWheelFunction3\": {\r\n    \"message\": \"滑鼠左鍵 + 滑鼠滾輪\"\r\n  },\r\n  \"options_none\": {\r\n    \"message\": \"無動作\"\r\n  },\r\n  \"options_doPaste\": {\r\n    \"message\": \"執行 '貼上'\"\r\n  },\r\n  \"options_leftKey\": {\r\n    \"message\": \"送出左方向鍵\"\r\n  },\r\n  \"options_rightKey\": {\r\n    \"message\": \"送出右方向鍵\"\r\n  },\r\n  \"options_enterKey\": {\r\n    \"message\": \"送出ENTER鍵\"\r\n  },\r\n  \"options_upDown\": {\r\n    \"message\": \"控制上 / 下\"\r\n  },\r\n  \"options_pageUpDown\": {\r\n    \"message\": \"控制上頁 / 下頁\"\r\n  },\r\n  \"options_threadLastNext\": {\r\n    \"message\": \"控制文章前篇 / 下篇\"\r\n  },\r\n  \"options_enableBlacklist\": {\r\n    \"message\": \"啟用使用者黑名單功能\"\r\n  },\r\n  \"options_blacklistInstruction\": {\r\n    \"message\": \"請在下面輸入所有欲加入黑名單的使用者ID, 每行一個\"\r\n  },\r\n\r\n  // auto logins\r\n  \"autologin_username\": {\r\n    \"message\": \"帳號\"\r\n  },\r\n  \"autologin_password\": {\r\n    \"message\": \"密碼\"\r\n  },\r\n  \"autologin_warning\": {\r\n    \"message\": \"帳號密碼沒有加密儲存, 千萬不要在公用電腦上使用\"\r\n  },\r\n\r\n  // extensions\r\n  \"ext_quickSearch\": {\r\n    \"message\": \"快速搜尋\"\r\n  },\r\n  \"ext_addQuickSearchNamePlaceholder\": {\r\n    \"message\": \"新增搜尋引擎\"\r\n  },\r\n  \"ext_addQuickSearchQueryPlaceholder\": {\r\n    \"message\": \"網址以 %s 取代網址中的搜尋字詞\"\r\n  },\r\n\r\n  // about page\r\n  \"about_appName_subtitle\": {\r\n    \"message\": \"開放原始碼的 BBS 瀏覽軟體\",\r\n  },\r\n  \"about_description\": {\r\n    \"message\": \"原作者為 #link_github_iamchucky#。此版本是由 #link_github_robertabcd# 修改，使用 Websocket 加密連線，並支援大多數瀏覽器。\",\r\n  },\r\n  \"about_version_title\": {\r\n    \"message\": \"版本\"\r\n  },\r\n  \"about_version_current\": {\r\n    \"message\": \"此版本：#link_robertabcd_PttChrome#, #link_GPL20#.\"\r\n  },\r\n  \"about_version_original\": {\r\n    \"message\": \"原版本：webapp12 6/2/2015, #link_iamchucky_PttChrome#, #link_GPL20#.\"\r\n  },\r\n  \"about_new_title\": {\r\n    \"message\": \"新功能\"\r\n  },\r\n  \"about_new_content\": {\r\n    \"message\": [\r\n      '網址設定 keepAlive 參數, 只要在網址後面加上 ?keepAlive=[幾秒]',\r\n      '加入了 SSH 連到 PTT 的功能, 只要在網址後面加上 ?ssh=true',\r\n      '好讀模式只限於 ptt.cc 上使用',\r\n      '黑名單可用 Google Drive 來讀取或備份',\r\n      '斷線提示用 443 端口連線',\r\n      '自動登入設定頁面可設定是否自動刪除其他重複連線',\r\n      '右鍵選單新增 Live 文小幫手來自動更新推文, 也可用 Alt + r 來啟動',\r\n      '設定中切換好讀模式不用再重新整理即可切換',\r\n      '暫時停用 hammerjs 避免在舊的 Chrome 造成滑鼠圈選的問題',\r\n      '修正中文輸入法時好讀模式的空白鍵的問題',\r\n      '修正 ssh 連線 kex 的問題',\r\n      '加入了關閉分頁先詢問的選項',\r\n      '加入了滑鼠左鍵送出右方向鍵的選項',\r\n      '加入了 END 啟用即時更新的選項',\r\n      '滑鼠中鍵可以設定執行貼上功能',\r\n      '加入了選取自動複製文字的選項',\r\n      '新增了快速搜尋的功能 (感謝abccbaandy)'\r\n    ]\r\n  },\r\n\r\n  // alerts\r\n  \"alert_developerModeHeader\": {\r\n    \"message\": \"開發者模式\"\r\n  },\r\n  \"alert_developerModeText\": {\r\n    \"message\": \"您正在使用開發者模式。此版本的 PttChrome 並不穩定，無法保證所有功能會正常運作。\"\r\n  },\r\n  \"alert_developerModeDismiss\": {\r\n    \"message\": \"是，我瞭解了\"\r\n  },\r\n\r\n  \"alert_connectionHeader\": {\r\n    \"message\": \"你斷線了!\"\r\n  },\r\n  \"alert_connectionText\": {\r\n    \"message\": \"現在要重新連線嗎?\"\r\n  },\r\n  \"alert_connectionReconnect\": {\r\n    \"message\": \"重新連線 (ENTER)\"\r\n  },\r\n  \"alert_connectionPortOption1\": {\r\n    \"message\": \"或\"\r\n  },\r\n  \"alert_connectionPortOption2\": {\r\n    \"message\": \"用443端口連線\"\r\n  },\r\n\r\n  \"alert_pasteShortcutHeader\": {\r\n    \"message\": \"貼上\"\r\n  },\r\n  \"alert_pasteShortcutText\": {\r\n    \"message\": \"請使用 Shift+Insert 快速鍵來貼上。\"\r\n  },\r\n  \"alert_pasteShortcutClose\": {\r\n    \"message\": \"確定\"\r\n  },\r\n\r\n  // notifications\r\n  \"notification_said\": {\r\n    \"message\": \"說:\"\r\n  },\r\n\r\n  \"input_sitePlaceholder\": {\r\n    \"message\": \"在此輸入站台地址後按 ENTER\"\r\n  },\r\n\r\n  // input helper\r\n  \"inputHelperTitle\": {\r\n    \"message\": \"輸入小幫手\"\r\n  },\r\n  \"colorTitle\": {\r\n    \"message\": \"上色\"\r\n  },\r\n  \"colorHelperSend\": {\r\n    \"message\": \"送出 ANSI 顏色字元\"\r\n  },\r\n  \"colorHelperSendMenuFore\": {\r\n    \"message\": \"只送出前景色彩\"\r\n  },\r\n  \"colorHelperSendMenuBack\": {\r\n    \"message\": \"只送出背景色彩\"\r\n  },\r\n  \"colorHelperSendMenuReset\": {\r\n    \"message\": \"送出色彩還原碼\"\r\n  },\r\n  \"colorHelperBlink\": {\r\n    \"message\": \"閃爍\"\r\n  },\r\n  \"colorHelperPreview\": {\r\n    \"message\": \"▅ 預 覽 ▅\"\r\n  },\r\n  \"colorHelperTooltip1\": {\r\n    \"message\": '點滑鼠\"左\"鍵選\"前景\"顏色'\r\n  },\r\n  \"colorHelperTooltip2\": {\r\n    \"message\": '點滑鼠\"右\"鍵選\"背景\"顏色 (上排)'\r\n  },\r\n\r\n  // symbols\r\n  \"symTitle\": {\r\n    \"message\": \"符號\"\r\n  },\r\n  \"symTitle_general\": {\r\n    \"message\": \"一般\"\r\n  },\r\n  \"symTitle_lineBorders\": {\r\n    \"message\": \"線條邊框\"\r\n  },\r\n  \"symTitle_blocks\": {\r\n    \"message\": \"方塊\"\r\n  },\r\n  \"symTitle_lines\": {\r\n    \"message\": \"線條\"\r\n  },\r\n  \"symTitle_special\": {\r\n    \"message\": \"特殊\"\r\n  },\r\n  \"symTitle_brackets\": {\r\n    \"message\": \"括弧\"\r\n  },\r\n  \"symTitle_greek\": {\r\n    \"message\": \"希臘\"\r\n  },\r\n  \"symTitle_phonetic\": {\r\n    \"message\": \"注音\"\r\n  },\r\n  \"symTitle_math\": {\r\n    \"message\": \"數學\"\r\n  },\r\n  \"symTitle_hiragana\": {\r\n    \"message\": \"平假名\"\r\n  },\r\n  \"symTitle_katakana\": {\r\n    \"message\": \"片假名\"\r\n  },\r\n\r\n  // emoticons\r\n  \"emoTitle\": {\r\n    \"message\": \"表情\"\r\n  },\r\n  \"emoTitle_angry\": {\r\n    \"message\": \"生氣\"\r\n  },\r\n  \"emoTitle_meh\": {\r\n    \"message\": \"酸民\"\r\n  },\r\n  \"emoTitle_sweat\": {\r\n    \"message\": \"汗顏加三條線\"\r\n  },\r\n  \"emoTitle_happy\": {\r\n    \"message\": \"開心\"\r\n  },\r\n  \"emoTitle_other\": {\r\n    \"message\": \"其他\"\r\n  },\r\n\r\n  // live helper\r\n  \"liveHelperEnable\": {\r\n    \"message\": \"啟用\"\r\n  },\r\n  \"liveHelperSpan\": {\r\n    \"message\": \"推文每\"\r\n  },\r\n  \"liveHelperSpanSec\": {\r\n    \"message\": \"秒自動更新\"\r\n  },\r\n\r\n  // tooltips\r\n  \"tooltip_antiIdleTime\": {\r\n    \"message\": \"輸入 0 可停用這功能。\"\r\n  },\r\n  \"tooltip_fontFace\": {\r\n    \"message\": \"以逗號隔開，由欲套用的字型開始至較通用的字型。\"\r\n  }\r\n\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/zh_TW_messages.js","// Handle Telnet Connections according to RFC 854\r\n\r\nimport { Event } from './event';\r\n\r\n// Telnet commands\r\nconst SE = '\\xf0';\r\nconst NOP = '\\xf1';\r\nconst DATA_MARK = '\\xf2';\r\nconst BREAK = '\\xf3';\r\nconst INTERRUPT_PROCESS = '\\xf4';\r\nconst ABORT_OUTPUT = '\\xf5';\r\nconst ARE_YOU_THERE = '\\xf6';\r\nconst ERASE_CHARACTER = '\\xf7';\r\nconst ERASE_LINE = '\\xf8';\r\nconst GO_AHEAD  = '\\xf9';\r\nconst SB = '\\xfa';\r\n\r\n// Option commands\r\nconst WILL  = '\\xfb';\r\nconst WONT  = '\\xfc';\r\nconst DO = '\\xfd';\r\nconst DONT = '\\xfe';\r\nconst IAC = '\\xff';\r\n\r\n// Telnet options\r\nconst ECHO  = '\\x01';\r\nconst SUPRESS_GO_AHEAD = '\\x03';\r\nconst TERM_TYPE = '\\x18';\r\nconst IS = '\\x00';\r\nconst SEND = '\\x01';\r\nconst NAWS = '\\x1f';\r\n\r\n// state\r\nconst STATE_DATA=0;\r\nconst STATE_IAC=1;\r\nconst STATE_WILL=2;\r\nconst STATE_WONT=3;\r\nconst STATE_DO=4;\r\nconst STATE_DONT=5;\r\nconst STATE_SB=6;\r\n\r\nexport function TelnetConnection(socket) {\r\n  this.socket = socket;\r\n  this.socket.addEventListener('open', this._onOpen.bind(this));\r\n  this.socket.addEventListener('data', this._onDataAvailable.bind(this));\r\n  this.socket.addEventListener('close', this._onClose.bind(this));\r\n\r\n  this.state = STATE_DATA;\r\n  this.iac_sb = '';\r\n\r\n  this.termType = 'VT100';\r\n}\r\n\r\nEvent.mixin(TelnetConnection.prototype);\r\n\r\nTelnetConnection.prototype._onOpen = function(e) {\r\n  this.dispatchEvent(new CustomEvent('open'));\r\n};\r\n\r\nTelnetConnection.prototype._onClose = function(e) {\r\n  this.dispatchEvent(new CustomEvent('close'));\r\n};\r\n\r\nTelnetConnection.prototype._onDataAvailable = function(e) {\r\n  var str = e.detail.data;\r\n  var data='';\r\n  var count = str.length;\r\n  while (count > 0) {\r\n    var s = str;\r\n    count -= s.length;\r\n    var n = s.length;\r\n    for (var i = 0; i < n; ++i) {\r\n      var ch = s[i];\r\n      switch (this.state) {\r\n      case STATE_DATA:\r\n        if( ch == IAC ) {\r\n          if (data) {\r\n            this._dispatchData(data);\r\n            data='';\r\n          }\r\n          this.state = STATE_IAC;\r\n        } else {\r\n          data += ch;\r\n        }\r\n        break;\r\n      case STATE_IAC:\r\n        switch (ch) {\r\n        case WILL:\r\n          this.state=STATE_WILL;\r\n          break;\r\n        case WONT:\r\n          this.state=STATE_WONT;\r\n          break;\r\n        case DO:\r\n          this.state=STATE_DO;\r\n          break;\r\n        case DONT:\r\n          this.state=STATE_DONT;\r\n          break;\r\n        case SB:\r\n          this.state=STATE_SB;\r\n          break;\r\n        default:\r\n          this.state=STATE_DATA;\r\n        }\r\n        break;\r\n      case STATE_WILL:\r\n        switch (ch) {\r\n        case ECHO:\r\n        case SUPRESS_GO_AHEAD:\r\n          this._sendRaw( IAC + DO + ch );\r\n          break;\r\n        default:\r\n          this._sendRaw( IAC + DONT + ch );\r\n        }\r\n        this.state = STATE_DATA;\r\n        break;\r\n      case STATE_DO:\r\n        switch (ch) {\r\n        case TERM_TYPE:\r\n          this._sendRaw( IAC + WILL + ch );\r\n          break;\r\n        case NAWS:\r\n          // Don't respond.\r\n          //this._sendRaw( IAC + WILL + ch );\r\n          //this.sendNaws();\r\n          break;\r\n        default:\r\n          this._sendRaw( IAC + WONT + ch );\r\n        }\r\n        this.state = STATE_DATA;\r\n        break;\r\n      case STATE_DONT:\r\n      case STATE_WONT:\r\n        this.state = STATE_DATA;\r\n        break;\r\n      case STATE_SB: // sub negotiation\r\n        this.iac_sb += ch;\r\n        if ( this.iac_sb.slice(-2) == IAC + SE ) {\r\n          // end of sub negotiation\r\n          switch (this.iac_sb[0]) {\r\n          case TERM_TYPE: \r\n            // FIXME: support other terminal types\r\n            //var termType = this.app.prefs.TermType;\r\n            var rep = IAC + SB + TERM_TYPE + IS + this.termType + IAC + SE;\r\n            this._sendRaw( rep );\r\n            break;\r\n          }\r\n          this.state = STATE_DATA;\r\n          this.iac_sb = '';\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (data) {\r\n      this._dispatchData(data);\r\n      data='';\r\n    }\r\n  }\r\n};\r\n\r\nTelnetConnection.prototype._dispatchData = function(data) {\r\n  this.dispatchEvent(new CustomEvent('data', {\r\n    detail: {\r\n      data: data\r\n    }\r\n  }));\r\n};\r\n\r\nTelnetConnection.prototype.send = function(str) {\r\n  // XXX Should do escape on IAC.\r\n  this._sendRaw(str);\r\n};\r\n\r\nTelnetConnection.prototype._sendRaw = function(data) {\r\n  if (data) {\r\n    this.socket.send(data);\r\n  }\r\n}\r\n\r\nTelnetConnection.prototype.convSend = function(unicode_str) {\r\n  // supports UAO\r\n  // when converting unicode to big5, use UAO.\r\n\r\n  var s = unicode_str.u2b();\r\n  // detect ;50m (half color) and then convert accordingly\r\n  if (s) {\r\n    s = s.ansiHalfColorConv();\r\n    this._sendRaw(s);\r\n  }\r\n};\r\n\r\nTelnetConnection.prototype.sendNaws = function(cols, rows) {\r\n  var nawsStr = String.fromCharCode(Math.floor(cols/256), cols%256, Math.floor(rows/256), rows%256).replace(/(\\xff)/g,'\\xff\\xff');\r\n  var rep = IAC + SB + NAWS + nawsStr + IAC + SE;\r\n  this._sendRaw( rep );\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/telnet.js","import { Event } from './event';\n\nexport function Websocket(url) {\n  this._conn = new WebSocket(url);\n  this._conn.binaryType = \"arraybuffer\";\n  this._conn.addEventListener('open', this._onOpen.bind(this));\n  this._conn.addEventListener('message', this._onMessage.bind(this));\n  this._conn.addEventListener('error', this._onError.bind(this));\n  this._conn.addEventListener('close', this._onClose.bind(this));\n};\n\nEvent.mixin(Websocket.prototype);\n\nWebsocket.prototype._onOpen = function(e) {\n  this.dispatchEvent(new CustomEvent('open'));\n};\n\nWebsocket.prototype._onMessage = function(e) {\n  var data = new Uint8Array(e.data);\n  this.dispatchEvent(new CustomEvent('data', {\n    detail: {\n      data: String.fromCharCode.apply(String, data)\n    }\n  }));\n};\n\nWebsocket.prototype._onError = function(e) {\n  this.dispatchEvent(new CustomEvent('error'));\n};\n\nWebsocket.prototype._onClose = function(e) {\n  this.dispatchEvent(new CustomEvent('close'));\n};\n\nWebsocket.prototype.send = function(str) {\n  // XXX: move this to app.\n  // because ptt seems to reponse back slowly after large\n  // chunk of text is pasted, so better to split it up.\n  var chunk = 1000;\n  for (var i = 0; i < str.length; i += chunk) {\n    var chunkStr = str.substring(i, i+chunk);\n    var byteArray = new Uint8Array(chunkStr.split('').map(function(x) { return x.charCodeAt(0); }));\n    this._conn.send(byteArray.buffer);\n  }\n};\n\nWebsocket.prototype.close = function() {\n  this._conn.close();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/websocket.js","export function EasyReading(core, view, termBuf) {\n  this._core = core;\n  this._view = view;\n  this._termBuf = termBuf;\n\n  this._turnPageLines = 22;\n\n  this.easyReadingReachedPageEnd = false;\n  this.sendCommandAfterUpdate = '';\n  this.ignoreOneUpdate = false;\n\n  function bindProperty(target, name, obj, prop) {\n    if (!prop) prop = name;\n    Object.defineProperty(obj, prop, {\n      get: function() { return target[name]; },\n      set: function(val) { target[name] = val; }\n    });\n  }\n  bindProperty(this._view, 'useEasyReadingMode', this, '_enabled');\n  bindProperty(this._termBuf, 'startedEasyReading', this);\n  bindProperty(this._termBuf, 'easyReadingShowReplyText', this);\n  bindProperty(this._termBuf, 'easyReadingShowPushInitText', this);\n\n  this._termBuf.addEventListener('change', this._onChanged.bind(this));\n  this._termBuf.addEventListener('viewUpdate', this._onViewUpdated.bind(this));\n};\n\nEasyReading.prototype._onChanged = function(e) {\n  console.log(\"page state: \" + this._termBuf.prevPageState + \"->\" + this._termBuf.pageState);\n  // make sure to come back to easy reading mode\n  if (this._termBuf.prevPageState == 2 &&\n      this._termBuf.pageState == 3 &&\n      !this._enabled && \n      this._core.pref.values.enableEasyReading &&\n      this._core.connectedUrl.easyReadingSupported)\n  {\n    this._enabled = true;\n  } else if (!this._core.pref.values.enableEasyReading) {\n    this._enabled = false;\n  }\n\n  if (!this._enabled)\n    return;\n\n  var lastRowText = this._termBuf.getRowText(23, 0, this._termBuf.cols);\n  // dealing with page state jump to 0 because last row wasn't updated fully \n  if (this._termBuf.pageState == 3) {\n    this.startedEasyReading = true;\n  } else if (this.startedEasyReading && lastRowText.parseReqNotMetText()) {\n    this.easyReadingShowPushInitText = true;\n  } else {\n    this.easyReadingShowReplyText = false;\n    this.easyReadingShowPushInitText = false;\n    this.startedEasyReading = false;\n  }\n  if (this.startedEasyReading) {\n    console.log('easy reading cursor pos: ' + this._termBuf.cur_y + ':' + this._termBuf.cur_x);\n    if (this._termBuf.cur_y == 23 && this._termBuf.cur_x == 79) {\n      if (this.ignoreOneUpdate) {\n        this.ignoreOneUpdate = false;\n        return;\n      }\n      var result = lastRowText.parseStatusRow();\n      if (result) {\n        var lastRowFirstCh = this._termBuf.lines[23][0];\n        if (lastRowFirstCh.getBg() == 4 && lastRowFirstCh.getFg() == 7) {\n          this.easyReadingReachedPageEnd = true;\n        } else {\n          this.easyReadingReachedPageEnd = false;\n          if (!this.sendCommandAfterUpdate) {\n            // send page down\n            this.sendCommandAfterUpdate = '\\x1b[6~';\n          }\n        }\n      } else if (!this.easyReadingShowPushInitText) { // only if not showing last row text\n        this._termBuf.pageState = 5;\n        this.startedEasyReading = false;\n      }\n    } else if (this._termBuf.cur_y == 23) {\n      if (!this.easyReadingShowPushInitText) {\n        var lastRowText = this._termBuf.getRowText(23, 0, this._termBuf.cols);\n        var result = lastRowText.parsePushInitText();\n        if (result) {\n          this.easyReadingShowPushInitText = true;\n        } else {\n          this.easyReadingShowPushInitText = false;\n          return;\n        }\n      }\n    } else if (this._termBuf.cur_y == 22) {\n      var secondToLastRowText = this._termBuf.getRowText(22, 0, this._termBuf.cols);\n      var result = secondToLastRowText.parseReplyText();\n      if (result) {\n        this.easyReadingShowReplyText = true;\n      } else {\n        this.easyReadingShowReplyText = false;\n        return;\n      }\n    } else {\n      // last line hasn't changed\n      return;\n    }\n  }\n};\n\nEasyReading.prototype._onViewUpdated = function(e) {\n  console.log('view update');\n  if (this.sendCommandAfterUpdate) {\n    console.log(\"send:\" + this.sendCommandAfterUpdate);\n    if (this.sendCommandAfterUpdate != 'skipOne') {\n      this._send(this.sendCommandAfterUpdate);\n    }\n    this.sendCommandAfterUpdate = '';\n  }\n};\n\nEasyReading.prototype.leaveCurrentPost = function() {\n  console.log('leave curent post');\n  if (!this.easyReadingReachedPageEnd) {\n    this.ignoreOneUpdate = true;\n  }\n  this._termBuf.prevPageState = 0;\n};\n\nEasyReading.prototype.stopEasyReading = function() {\n  console.log('stop easy reading');\n  this.sendCommandAfterUpdate = 'skipOne';\n};\n\nEasyReading.prototype._send = function(data) {\n  this._view.conn.send(data);\n};\n\nEasyReading.prototype._onKeyDown = function(e) {\n  if (!this._enabled || !this.startedEasyReading)\n    return;\n\n  this._onKeyDownProcessUI(e);\n  if (e.defaultPrevented)\n    return;\n\n  var stop = false;\n  if (!e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'Backspace':\n      case 'ArrowUp':\n        this._send('\\x1b[D\\x1b[A\\x1b[C');\n        stop = true;\n        break;\n      case 'ArrowDown':\n        this._send('\\x1b[D\\x1b[B\\x1b[C');\n        stop = true;\n        break;\n    }\n  } else if (e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'h':\n        this._send('\\x1b[D\\x1b[A\\x1b[C');\n        stop = true;\n        break;\n    }\n  }\n  if (stop)\n    e.preventDefault();\n};\n\nEasyReading.prototype._scrollBy = function(lines) {\n  var cont = this._view.mainDisplay;\n  if (lines < 0 && cont.scrollTop == 0)\n    return false;\n  if (lines > 0 && cont.scrollTop >=\n    this._view.mainContainer.clientHeight -\n      this._view.chh * this._termBuf.rows)\n    return false;\n  cont.scrollTop += this._view.chh * lines;\n  return true;\n};\n\nEasyReading.prototype._scrollEnd = function() {\n  this._view.mainDisplay.scrollTop = this._view.mainContainer.clientHeight;\n  return true;\n};\n\nEasyReading.prototype._scrollTop = function() {\n  this._view.mainDisplay.scrollTop = 0;\n  return true;\n};\n\nEasyReading.prototype._onKeyDownProcessUI = function(e) {\n  var stop = false;\n  if (!e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'Backspace':\n        stop = this._scrollBy(-this._turnPageLines);\n        if (!stop)\n          this.leaveCurrentPost();\n        break;\n      case 'ArrowRight':\n      case ' ':\n      case 't':\n        stop = this._scrollBy(this._turnPageLines);\n        if (!stop)\n          this.leaveCurrentPost();\n        break;\n      case 'PageUp':\n        this._scrollBy(-this._turnPageLines);\n        stop = true;\n        break;\n      case 'PageDown':\n        this._scrollBy(this._turnPageLines);\n        stop = true;\n        break;\n      case 'ArrowLeft':\n        this.stopEasyReading();\n        break;\n      case 'ArrowUp':\n        stop = this._scrollBy(-1);\n        if (!stop)\n          this.leaveCurrentPost();\n        break;\n      case 'Enter':\n      case 'ArrowDown':\n        stop = this._scrollBy(1);\n        if (!stop)\n          this.leaveCurrentPost();\n        break;\n      case 'k':\n        this._scrollBy(-1);\n        stop = true;\n        break;\n      case 'j':\n        this._scrollBy(1);\n        stop = true;\n        break;\n      case 'Home':\n      case '0':\n      case 'g':\n        stop = this._scrollTop();\n        break;\n      case 'End':\n      case '$':\n      case 'G':\n        stop = this._scrollEnd();\n        break;\n      case 'Tab':\n        stop = true;\n        break;\n      default:\n        if (\"abf=+-[]ABF\".indexOf(e.key) >= 0) {\n          this.leaveCurrentPost();\n          break;\n        }\n        if (\"123456789hops;,./\\\\H#OP:<>\".indexOf(e.key) >= 0) {\n          stop = true;\n          break;\n        }\n    }\n  } else if (e.ctrlKey && !e.altKey) {\n    switch (e.key) {\n      case 'f':\n        this._scrollBy(this._turnPageLines);\n        stop = true;\n        break;\n      case 'b':\n        this._scrollBy(-this._turnPageLines);\n        stop = true;\n        break;\n      case 'h':\n        stop = this._scrollBy(-this._turnPageLines);\n        if (!stop)\n          this.leaveCurrentPost();\n        break;\n      default:\n        if (\"@^_?\".indexOf(e.key) >= 0) {\n          stop = true;\n          break;\n        }\n    }\n  }\n  if (stop)\n    e.preventDefault();\n};\n\nEasyReading.prototype._onMouseClick = function(e) {\n  if (!this._enabled || !this.startedEasyReading)\n    return;\n  var stop = false;\n  // XXX Should not use term buffer to track mouse cursor.\n  switch (this._termBuf.mouseCursor) {\n    case 0:\n    case 1: // Arrow Left\n      this.stopEasyReading();\n      break;\n    case 2: // Page Up\n      this._scrollBy(-this._turnPageLines);\n      stop = true;\n      break;\n    case 3: // Page Down\n      this._scrollBy(this._turnPageLines);\n      stop = true;\n      break;\n    case 4: // Home\n      this._scrollTop();\n      stop = true;\n      break;\n    case 5: // End\n      this._scrollEnd();\n      stop = true;\n      break;\n    case 6:\n    case 7:\n      break;\n    case 8: // [\n    case 9: // ]\n    case 10: // =\n    case 12: // Refresh post / pushed texts\n    case 13: // Last post with the same title (LIST)\n    case 14: // Last post with the same title (READING)\n      this.leaveCurrentPost();\n      break;\n    default: // Do nothing\n      break;\n  }\n  if (stop)\n    e.preventDefault();\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/easy_reading.js","import { Emoticons } from './emoticon';\nimport { Symbols } from './symbols';\nimport { i18n } from './i18n';\nimport { setTimer } from './util';\n\nexport function InputHelper(app) {\n  this.app = app;\n  this.node = document.getElementById('inputHelper');\n  this.nodeOffsetTop = 20;\n  this.nodeOffsetLeft = 20;\n  this.mouseDown = false;\n  this.clickedOn = false;\n\n  this.colorHelperBlinkCheckbox = null;\n  this.colorHelperPreview = null;\n  this.colorHelperPreviewFgShown = true;\n  this.colorHelperFg = 7;\n  this.colorHelperBg = 0;\n  this.colorHelperIsBlink = false;\n  this.blinkTimer = null;\n\n  this.symbols = null;\n  this.emoticons = null;\n  this.setupUi();\n  this.registerHandlers();\n}\n\nInputHelper.prototype.setupUi = function() {\n  var self = this;\n  var modalTitle = document.querySelector('#inputHelper .modal-title');\n  modalTitle.textContent = i18n('inputHelperTitle');\n  document.getElementById('colorHelperSend').textContent = i18n('colorHelperSend');\n  document.getElementById('colorHelperBlink').innerHTML = '<label><input id=\"colorHelperBlinkCheckbox\" type=\"checkbox\">'+i18n('colorHelperBlink')+'</label>';\n  document.getElementById('colorHelperPreview').textContent = i18n('colorHelperPreview');\n\n  document.getElementById('inputHelperClose').addEventListener('click', function(e) {\n    self.hideHelper();\n  });\n\n  document.querySelector('#colorsTabTitle a').textContent = i18n('colorTitle');\n  $('#colorHelperSendMenuFore').text(i18n('colorHelperSendMenuFore'));\n  $('#colorHelperSendMenuBack').text(i18n('colorHelperSendMenuBack'));\n  $('#colorHelperSendMenuReset').text(i18n('colorHelperSendMenuReset'));\n\n  this.symbols = new Symbols(this.app);\n  this.emoticons = new Emoticons(this.app);\n};\n\nInputHelper.prototype.onMouseDrag = function(e) {\n  window.getSelection().removeAllRanges();\n  this.nodeOffsetTop += e.movementY;\n  this.nodeOffsetLeft += e.movementX;\n  this.node.style.cssText += 'top:'+this.nodeOffsetTop+'px;left:'+this.nodeOffsetLeft+'px;';\n};\n\nInputHelper.prototype.registerHandlers = function() {\n  var self = this;\n  var colorHelperList = document.getElementById('colorHelperList');\n  var tooltipHtml = '<div>'+i18n('colorHelperTooltip1')+'</div><div>'+i18n('colorHelperTooltip2')+'</div>';\n  $(colorHelperList).tooltip({html:true, title:tooltipHtml});\n\n  this.colorHelperBlinkCheckbox = document.getElementById('colorHelperBlinkCheckbox');\n  this.colorHelperPreview = document.getElementById('colorHelperPreview');\n  document.getElementById('colorHelperBlink').addEventListener('click', function(e) {\n    var checked = self.colorHelperBlinkCheckbox.checked;\n    if (checked != self.colorHelperIsBlink) {\n      self.colorHelperIsBlink = checked;\n      if (checked) {\n        self.blinkTimer = setTimer(true, function() {\n          if (self.colorHelperPreviewFgShown) {\n            self.colorHelperPreview.style.color = 'transparent';\n          } else {\n            self.colorHelperPreview.style.color = '';\n          }\n          self.colorHelperPreviewFgShown = !self.colorHelperPreviewFgShown;\n        }, 1000);\n      } else {\n        self.blinkTimer.cancel();\n        self.blinkTimer = null;\n        self.colorHelperPreview.style.color = '';\n        self.colorHelperPreviewFgShown = true;\n      }\n    }\n    e.stopPropagation();\n  });\n  document.getElementById('colorHelperSend').addEventListener('click', function(e) {\n    self.sendColorCommand();\n  });\n  document.getElementById('colorHelperSendMenu').addEventListener('click', function(e) {\n    if (!e.target.hasAttribute('type'))\n      return;\n    self.sendColorCommand(e.target.getAttribute('type'));\n  });\n\n  colorHelperList.addEventListener('click', function(e) {\n    if (!e.target.hasAttribute('value'))\n      return;\n\n    if (e.which == 1) { // left click, foreground\n      self.colorHelperFg = parseInt(e.target.getAttribute('value'));\n      self.colorHelperPreview.setAttribute('class', 'q'+self.colorHelperFg+' b'+self.colorHelperBg);\n    }\n    e.preventDefault();\n    e.stopPropagation();\n  });\n  colorHelperList.addEventListener('contextmenu', function(e) {\n    if (!e.target.hasAttribute('value'))\n      return;\n\n    var bg = parseInt(e.target.getAttribute('value'));\n    if (bg > 7) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n\n    // right click, background\n    self.colorHelperBg = bg;\n    self.colorHelperPreview.setAttribute('class', 'q'+self.colorHelperFg+' b'+self.colorHelperBg);\n    e.preventDefault();\n    e.stopPropagation();\n  });\n\n  this.node.addEventListener('mousedown', function(e) {\n    if (e.which == 1)\n      self.mouseDown = true;\n  });\n  this.node.addEventListener('mouseup', function(e) {\n    if (e.which == 1)\n      self.mouseDown = false;\n  });\n\n  this.node.addEventListener('click', function(e) {\n    self.clickedOn = true;\n  });\n\n  this.symbols.registerHandlers();\n  this.emoticons.registerHandlers();\n};\n\nInputHelper.prototype.sendColorCommand = function(type) {\n  if (type == 'reset') {\n    this.app.conn.send('\\x15[m');\n    return;\n  }\n\n  var fg = this.colorHelperFg;\n  var lightColor = '0;';\n  if (fg > 7) {\n    fg %= 8;\n    lightColor = '1;';\n  }\n  fg += 30;\n  var bg = this.colorHelperBg;\n  bg += 40;\n  var isBlink = this.colorHelperIsBlink;\n  var blink = '';\n  if (isBlink) {\n    blink = '5;';\n  }\n  var cmd = '\\x15[';\n  if (type == 'foreground') {\n    cmd += lightColor+blink+fg+'m';\n  } else if (type == 'background') {\n    cmd += bg+'m';\n  } else {\n    cmd += lightColor+blink+fg+';'+bg+'m';\n  }\n\n  if (!window.getSelection().isCollapsed && this.app.buf.pageState == 6) {\n    // something selected\n    var sel = this.app.view.getSelectionColRow();\n    var y = this.app.buf.cur_y;\n    var selCmd = '';\n    // move cursor to end and send reset code\n    selCmd += '\\x1b[H';\n    if (y > sel.end.row) {\n      selCmd += '\\x1b[A'.repeat(y - sel.end.row);\n    } else if (y < sel.end.row) {\n      selCmd += '\\x1b[B'.repeat(sel.end.row - y);\n    }\n    var repeats = this.app.buf.getRowText(sel.end.row, 0, sel.end.col).length;\n    selCmd += '\\x1b[C'.repeat(repeats) + '\\x15[m';\n\n    // move cursor to start and send color code\n    y = sel.end.row;\n    selCmd += '\\x1b[H';\n    if (y > sel.start.row) {\n      selCmd += '\\x1b[A'.repeat(y - sel.start.row);\n    } else if (y < sel.start.row) {\n      selCmd += '\\x1b[B'.repeat(sel.start.row - y);\n    }\n    repeats = this.app.buf.getRowText(sel.start.row, 0, sel.start.col).length;\n    selCmd += '\\x1b[C'.repeat(repeats);\n    cmd = selCmd + cmd;\n  }\n  this.app.conn.send(cmd);\n};\n\nInputHelper.prototype.showHelper = function() {\n  this.node.style.display = 'block';\n};\n\nInputHelper.prototype.hideHelper = function() {\n  this.node.style.display = 'none';\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/input_helper.js","import { i18n } from './i18n';\n\nlet emoticons = {\n  \n  angry: [\n    \"(ノ ゜Д゜)ノ ︵ ═╩════╩═\",\n    \"╯-____-)╯~═╩════╩═~\",\n    \"(╭∩╮\\\\_/╭∩╮)\",\n    \"( ︶︿︶)_╭∩╮\",\n    \"( ‵□′)───C＜─___-)|||\",\n    \"(￣ε(#￣) #○=(一-一o)\",\n    \"(o一-一)=○# (￣#)3￣)\",\n    \"╰(‵皿′＊)╯\",\n    \"○(#‵︿′ㄨ)○\",\n    \"◢▆▅▄▃-崩╰(〒皿〒)╯潰-▃▄▅▆◣\",\n  ],\n\n  meh: [\n    \"(σ′▽‵)′▽‵)σ 哈哈哈哈～你看看你\",\n    \"( ￣ c￣)y▂ξ\",\n    \"( ′-`)y-～\",\n    \"′_>‵\",\n    \"╮(′～‵〞)╭\",\n    \"╮(﹀_﹀\\\")╭\",\n    \"︿(￣︶￣)︿\",\n    \"..╮(﹋﹏﹌)╭..\",\n    \"╮(╯_╰)╭\",\n    \"╮(╯▽╰)/\",\n  ],\n\n  sweat: [\n    \"(－^－)ｄ\",\n    \"(￣￣；)\",\n    \"(￣□￣|||)a\",\n    \"(●；－_－)●\",\n    \"￣▽￣||\",\n    \"╭ ﹀◇﹀〣\",\n    \"ˋ(′_‵||)ˊ\",\n    \"●( ¯▽¯；●\",\n    \"o(＞＜；)o o\",\n  ],\n\n  happy: [\n    \"~(￣▽￣)~(＿△＿)~(￣▽￣)~(＿△＿)~(￣▽￣)~\",\n    \"(~^O^~)\",\n    \"(∩_∩)\",\n    \"<(￣︶￣)>\",\n    \"v(￣︶￣)y\",\n    \"﹨(╯▽╰)∕\",\n    \"\\\\(@^0^@)/\",\n    \"\\\\(^▽^)/\",\n    \"\\\\⊙▽⊙/\",\n  ],\n\n  other: [\n    \"(．＿．?)\",\n    \"(？o？)\",\n    \"(‧Q‧)\",\n    \"〒△〒\",\n    \"m川@.川m\",\n    \"(¯(∞)¯)\",\n    \"(⊙o⊙)\",\n    \"(≧<>≦)\",\n    \"(☆_☆)\",\n    \"o(‧\\\"‧)o\",\n  ]\n\n};\n\nexport function Emoticons(app) {\n  this.app = app;\n\n  this.tab = document.getElementById('inputHelperTabContent');\n  this.setupUi();\n};\n\nEmoticons.prototype.setupUi = function() {\n  var htmlStr = '';\n  var dropdownHtmlStr = '';\n  for (var i in emoticons) {\n    var title = i18n('emoTitle_'+i);\n    dropdownHtmlStr += '<li><a href=\"#emo_'+i+'_list\" name=\"'+i+'\" data-toggle=\"tab\">'+title+'</a></li>';\n    var emo = emoticons[i];\n    var height = emo.length * 27; \n    htmlStr += '<ul id=\"emo_'+i+'_list\" class=\"tab-pane emoList\" style=\"height:'+height+'px;\"><li>' + emoticons[i].join('</li><li>') + '</li></ul>';\n  }\n\n  // setup tab content\n  this.tab.innerHTML += htmlStr;\n  \n  // setup dropdown menu\n  document.querySelector('#emoticonsTabTitle .dropdown-menu').innerHTML = dropdownHtmlStr;\n  document.querySelector('#emoticonsTabTitle .dropdown-toggle').innerHTML = i18n('emoTitle')+' <span class=\"caret\"></span>';\n};\n\nEmoticons.prototype.registerHandlers = function() {\n  var self = this;\n\n  $('#emoticonsTabTitle .dropdown-menu a').click(function (e) {\n    e.preventDefault();\n    $(this).tab('show');\n  });\n\n  $('.emoList > li').click(function(e) {\n    self.app.conn.convSend(e.target.textContent);\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/emoticon.js","import { i18n } from './i18n';\n\nlet symbols = {\n\n  general: [\n    '，','、','。','．','？','！','～','＄','％','＠','＆','＃','＊','‧','；','︰','…',\n    '‥','﹐','﹒','˙','·','﹔','﹕','‘','’','“','”','〝','〞','‵','′','〃'\n  ],\n\n  lineBorders: [\n    '├','─','┼','┴','┬','┤','┌','┐','│','▕','└','┘','╭','╮','╰','╯','╔','╦','╗','╠','═',\n    '╬','╣','╓','╥','╖','╒','╤','╕','║','╚','╩','╝','╟','╫','╢','╙','╨','╜','╞','╪','╡',\n    '╘','╧','╛'\n  ],\n\n  blocks: [\n    '＿','ˍ','▁','▂','▃','▄','▅','▆','▇','█','▏','▎','▍','▌','▋','▊','▉','◢','◣','◥','◤'\n  ],\n\n  lines: [\n    '﹣','﹦','≡','｜','∣','∥','–','︱','—','︳','╴','¯','￣','﹉','﹊','﹍','﹎','﹋',\n    '﹌','﹏','︴','∕','﹨','╱','╲','／','＼'\n  ],\n\n  special: [\n    '↑','↓','←','→','↖','↗','↙','↘','㊣','◎','○','●','⊕','⊙','△','▲','☆','★','◇','Æ','□',\n    '■','▽','▼','§','￥','〒','￠','￡','※','♀','♂'\n  ],\n\n  brackets: [\n    '〔','〕','【','】','《','》','（','）','｛','｝','﹙','﹚','『','』','﹛','﹜','﹝',\n    '﹞','＜','＞','﹤','﹥','「','」','︵','︶','︷','︸','︹','︺','︻','︼','︽','︾',\n    '〈','〉','︿','﹀','﹁','﹂','﹃','﹄'\n  ],\n\n  greek: [\n    'Α','Β','Γ','Δ','Ε','Ζ','Η','Θ','Ι','Κ','Λ','Μ','Ν','Ξ','Ο','Π','Ρ','Σ','Τ','Υ','Φ',\n    'Χ','Ψ','Ω','α','β','γ','δ','ε','ζ','η','θ','ι','κ','λ','μ','ν','ξ','ο','π','ρ','σ',\n    'τ','υ','φ','χ','ψ','ω'\n  ],\n\n  phonetic: [\n    'ㄅ','ㄆ','ㄇ','ㄈ','ㄉ','ㄊ','ㄋ','ㄌ','ㄍ','ㄎ','ㄏ','ㄐ','ㄑ','ㄒ','ㄓ','ㄔ','ㄕ',\n    'ㄖ','ㄗ','ㄘ','ㄙ','ㄚ','ㄛ','ㄜ','ㄝ','ㄞ','ㄟ','ㄠ','ㄡ','ㄢ','ㄣ','ㄤ','ㄥ','ㄦ',\n    'ㄧ','ㄨ','ㄩ','˙','ˊ','ˇ','ˋ'\n  ],\n\n  math: [\n    '╳','＋','﹢','－','×','÷','＝','≠','≒','∞','ˇ','±','√','⊥','∠','∟','⊿','㏒','㏑',\n    '∫','∮','∵','∴','≦','≧','∩','∪'\n  ],\n\n  hiragana: [\n    'あ','い','う','え','お','か','き','く','け','こ','さ','し','す','せ','そ','た','ち',\n    'つ','て','と','な','に','ぬ','ね','の','は','ひ','ふ','へ','ほ','ま','み','む','め',\n    'も','ら','り','る','れ','ろ','が','ぎ','ぐ','げ','ご','ざ','じ','ず','ぜ','ぞ','だ',\n    'ぢ','づ','で','ど','ば','び','ぶ','べ','ぼ','ぱ','ぴ','ぷ','ぺ','ぽ','や','ゆ','よ',\n    'わ','ん','を'\n  ],\n\n  katakana: [\n    'ア','イ','ウ','エ','オ','カ','キ','ク','ケ','コ','サ','シ','ス','セ','ソ','タ','チ',\n    'ツ','テ','ト','ナ','ニ','ヌ','ネ','ノ','ハ','ヒ','フ','ヘ','ホ','マ','ミ','ム','メ',\n    'モ','ラ','リ','ル','レ','ロ','ガ','ギ','グ','ゲ','ゴ','ザ','ジ','ズ','ゼ','ゾ','ダ',\n    'ジ','ズ','デ','ド','バ','ビ','ブ','ベ','ボ','パ','ピ','プ','ペ','ポ','ヤ','ユ','ヨ',\n    'ワ','ン','ヲ'\n  ]\n\n};\n\nexport function Symbols(app) {\n  this.app = app;\n\n  this.tab = document.getElementById('inputHelperTabContent');\n  this.setupUi();\n};\n\nSymbols.prototype.setupUi = function() {\n  var htmlStr = '';\n  var dropdownHtmlStr = '';\n  for (var i in symbols) {\n    var title = i18n('symTitle_'+i);\n    dropdownHtmlStr += '<li><a href=\"#sym_'+i+'_list\" name=\"'+i+'\" data-toggle=\"tab\">'+title+'</a></li>';\n    var sym = symbols[i];\n    var height = Math.ceil(sym.length / 8) * 37; // find height by having 8 element each row\n    htmlStr += '<ul id=\"sym_'+i+'_list\" class=\"tab-pane symList\" style=\"height:'+height+'px;\"><li>' + symbols[i].join('</li><li>') + '</li></ul>';\n  }\n\n  // setup tab content\n  this.tab.innerHTML += htmlStr;\n  \n  // setup dropdown menu\n  document.querySelector('#symbolsTabTitle .dropdown-menu').innerHTML = dropdownHtmlStr;\n  document.querySelector('#symbolsTabTitle .dropdown-toggle').innerHTML = i18n('symTitle')+' <span class=\"caret\"></span>';\n};\n\nSymbols.prototype.registerHandlers = function() {\n  var self = this;\n\n  $('#symbolsTabTitle .dropdown-menu a').click(function (e) {\n    e.preventDefault();\n    $(this).tab('show');\n  });\n\n  $('.symList > li').click(function(e) {\n    self.app.conn.convSend(e.target.textContent);\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/symbols.js","import { i18n, getLang } from './i18n';\r\nimport { AboutPane } from './pref_about';\r\n\r\nexport function PttChromePref(app, onInitializedCallback) {\r\n  this.values = {};\r\n  this.logins = null;\r\n  this.app = app;\r\n  this.shouldResetToDefault = false;\r\n\r\n  this.enableBlacklist = false;\r\n  this.blacklistedUserIds = {};\r\n\r\n  this.quickSearches = [];\r\n\r\n  //this.loadDefault(onInitializedCallback);\r\n  this.onInitializedCallback = onInitializedCallback;\r\n  this.initCallbackCalled = false;\r\n}\r\n\r\nPttChromePref.prototype = {\r\n\r\n  updateSettingsToUi: function() {\r\n    this.refreshBlacklistOnUi();\r\n\r\n    var self = this;\r\n    var htmlStr = '';\r\n    var n = 0;\r\n    var onMouseBrowsingHighlightColorChange = function(e) {\r\n      var qName = '#opt_mouseBrowsingHighlightColor';\r\n      var val = $(qName+' select').val();\r\n      var bg = $(qName+' .b'+val).css('background-color');\r\n      $(qName+' select').css('background-color', bg);\r\n    };\r\n\r\n    for (var i in this.values) {\r\n      $('#opt_'+i).empty();\r\n      var val = this.values[i];\r\n\r\n      // for blacklisted userids \r\n      if (i === 'blacklistedUserIds') {\r\n        continue;\r\n      }\r\n      if (i === 'quickSearchList') {\r\n        this.setupQuickSearchUiList();\r\n        this.setupQuickSearchUiHandlers();\r\n        continue;\r\n      }\r\n\r\n      if (i === 'deleteDupLogin') {\r\n        var yesNode = $('#opt_deleteDupLoginYes');\r\n        if (val) {\r\n          yesNode.click();\r\n        }\r\n        continue;\r\n      }\r\n      \r\n      // for the color selection box\r\n      if (i === 'mouseBrowsingHighlightColor') {\r\n        var qName = '#opt_'+i;\r\n        htmlStr = i18n('options_highlightColor')+'<select class=\"form-control\">';\r\n        for (n = 1; n < 16; ++n) {\r\n          htmlStr += '<option value=\"'+n+'\" class=\"b'+n+'\"></option>';\r\n        }\r\n        htmlStr += '</select>';\r\n        $(qName).html(htmlStr);\r\n        $(qName+' select').val(val);\r\n        var bg = $(qName+' .b'+val).css('background-color');\r\n        $(qName+' select').css('background-color', bg);\r\n        $(qName+' select').on('change', onMouseBrowsingHighlightColorChange);\r\n        continue;\r\n      }\r\n\r\n      // for options that's predefined\r\n      if (i in PREF_OPTIONS) {\r\n        var optName = '#opt_'+i;\r\n        htmlStr = i18n('options_'+i) + '<select class=\"form-control\">';\r\n        var options = PREF_OPTIONS[i];\r\n        for (n = 0; n < options.length; ++n) {\r\n          htmlStr += '<option value=\"'+n+'\">'+i18n(options[n])+'</option>';\r\n        }\r\n        htmlStr += '</select>';\r\n        $(optName).html(htmlStr);\r\n        if (typeof(val) == 'boolean') {\r\n          val = val ? 1:0;\r\n        }\r\n        $(optName+' select').val(val);\r\n\r\n        continue;\r\n      }\r\n\r\n      var popoverTooltips = '';\r\n      if (i == 'fontFace' || i == 'antiIdleTime') {\r\n        popoverTooltips = ' data-toggle=\"popover\" data-trigger=\"focus\" data-content=\"'+i18n('tooltip_'+i)+'\"';\r\n      }\r\n\r\n      switch(typeof(val)) {\r\n        case 'number':\r\n          $('#opt_'+i).html(\r\n            '<label style=\"font-weight:normal;\">'+i18n('options_'+i)+'</label>'+\r\n            '<input type=\"number\" class=\"form-control\" value=\"'+val+'\"'+popoverTooltips+'>');\r\n          break;\r\n        case 'string':\r\n          $('#opt_'+i).html(\r\n            '<label style=\"font-weight:normal;\">'+i18n('options_'+i)+'</label>'+\r\n            '<input type=\"text\" class=\"form-control\" value=\"'+val+'\"'+popoverTooltips+'>');\r\n          break;\r\n        case 'boolean':\r\n          $('#opt_'+i).html(\r\n            '<label><input type=\"checkbox\" '+(val?'checked':'')+'>'+i18n('options_'+i)+'</label>');\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n\r\n      // init popovers\r\n      if (i == 'fontFace' || i == 'antiIdleTime') {\r\n        $('#opt_'+i+' input').popover();\r\n      }\r\n    }\r\n\r\n    // autologin\r\n    $('#login_username').html(\r\n      '<label style=\"font-weight:normal;\">'+i18n('autologin_username')+'</label>'+\r\n      '<input type=\"text\" class=\"form-control\" value=\"'+this.logins[0]+'\">');\r\n    $('#login_password').html(\r\n      '<label style=\"font-weight:normal;\">'+i18n('autologin_password')+'</label>'+\r\n      '<input type=\"password\" class=\"form-control\" value=\"'+this.logins[1]+'\">');\r\n  },\r\n\r\n  setupSettingsUi: function() {\r\n    var self = this;\r\n    var i;\r\n    $('#opt_title').text(i18n('menu_settings'));\r\n\r\n    $('#opt_reset').off();\r\n    $('#opt_reset').text(i18n('options_reset'));\r\n    $('#opt_reset').click(function() {\r\n      self.shouldResetToDefault = true;\r\n      $('#prefModal').modal('hide');\r\n    });\r\n    // adjust the size alittle according to the locale\r\n    var lang = getLang();\r\n    if (lang == 'en_US') {\r\n      $('#opt_reset').css('fontSize', '12px');\r\n      $('#opt_reset').css('marginLeft', '-10px');\r\n    }\r\n\r\n    var cat = '';\r\n    for (i in PREFS_CATEGORIES) {\r\n      cat = PREFS_CATEGORIES[i];\r\n      $('#opt_'+cat).text(i18n('options_'+cat));\r\n    }\r\n    for (i in PREFS_NAV) {\r\n      cat = PREFS_NAV[i];\r\n      $('#optNav_'+cat).text(i18n('options_'+cat));\r\n    }\r\n\r\n    $('#opt_tabs a:first').tab('show');\r\n    var currTab = 'general';\r\n    $('#modalHeader').text(i18n('options_'+currTab));\r\n\r\n    $('#opt_autologinWarning').text(i18n('autologin_warning'));\r\n\r\n    // blacklist\r\n    $('#opt_blacklistInstruction').text(i18n('options_blacklistInstruction'));\r\n\r\n    this.setupExtensionsPage();\r\n\r\n    this.setupAboutPage();\r\n    \r\n    $('#opt_tabs a').click(function(e) {\r\n      e.preventDefault();\r\n\r\n      var currTab = $(this).attr('name');\r\n      $('#modalHeader').text(i18n('options_'+currTab));\r\n      $(this).tab('show');\r\n    });\r\n  },\r\n\r\n  populateSettingsToUi: function() {\r\n    var self = this;\r\n    this.setupSettingsUi();\r\n    this.updateSettingsToUi();\r\n\r\n    $('#prefModal').off();\r\n    $('#prefModal').on('show.bs.modal', function(e) {\r\n      var width = document.documentElement.clientWidth * 0.7;\r\n      width = (width > 730) ? width : 730;\r\n      width -= 190;\r\n      var height = document.documentElement.clientHeight * 0.9;\r\n      height = (height > 400) ? height: 400;\r\n      height -= 76;\r\n      $('#prefModal .modal-body').css('height', height + 'px');\r\n      $('#prefModal .modal-body').css('width', width + 'px');\r\n      $('#opt_blacklistedUsers').css('height', height-150 + 'px');\r\n      self.refreshBlacklistOnUi();\r\n    });\r\n    $('#prefModal').on('shown.bs.modal', function(e) {\r\n      self.app.disableLiveHelper();\r\n      self.app.modalShown = true;\r\n    });\r\n    $('#prefModal').on('hidden.bs.modal', function(e) {\r\n      if (self.shouldResetToDefault) {\r\n        self.clearStorage();\r\n        self.values = JSON.parse(JSON.stringify(DEFAULT_PREFS));\r\n        self.blacklistedUserIds = {};\r\n        self.quickSearches = JSON.parse(DEFAULT_PREFS.quickSearchList);\r\n        self.logins = ['',''];\r\n        self.updateSettingsToUi();\r\n        self.app.view.redraw(true);\r\n\r\n        self.shouldResetToDefault = false;\r\n      } else {\r\n        self.readValueFromUi();\r\n      }\r\n      self.saveAndDoneWithIt();\r\n      self.app.switchToEasyReadingMode(self.app.view.useEasyReadingMode);\r\n    });\r\n  },\r\n\r\n  setupQuickSearchUiList: function() {\r\n    var self = this;\r\n    $('#ext_quickSearch').text(i18n('ext_quickSearch'));\r\n    var addNewSearchHtml = '<input type=\"text\" class=\"form-control qSearchItemName\" placeholder=\"' + i18n('ext_addQuickSearchNamePlaceholder') + '\" /><input type=\"text\" class=\"form-control qSearchItemQuery\" placeholder=\"' + i18n('ext_addQuickSearchQueryPlaceholder') + '\" />';\r\n    var buttonCloseHtml = '<button type=\"button\" class=\"close\">&times;</button>';\r\n    var buttonAddHtml = '<button type=\"button\" class=\"close\" data=\"add\">&#43;</button>';\r\n    var quickSearchListHtml = '';\r\n\r\n    for (var i = 0; i < this.quickSearches.length; ++i) {\r\n      var qSearch = this.quickSearches[i];\r\n      quickSearchListHtml += '<li class=\"list-group-item\">';\r\n      quickSearchListHtml += '<div class=\"qSearchItemName\"><span>'+qSearch.name+'</span><input type=\"text\" class=\"form-control\" value=\"'+qSearch.name+'\" /></div>';\r\n      quickSearchListHtml += '<div class=\"qSearchItemQuery\"><span>'+qSearch.url+'</span><input type=\"text\" class=\"form-control\" value=\"'+qSearch.url+'\" /></div>';\r\n      quickSearchListHtml += buttonCloseHtml + '</li>';\r\n    }\r\n    quickSearchListHtml += '<li class=\"list-group-item\">' + addNewSearchHtml + buttonAddHtml + '</li>';\r\n    $('#ext_quickSearchList').html(quickSearchListHtml);\r\n  },\r\n\r\n  validateQuickSearchInput: function(node) {\r\n    var val = node.val();\r\n    if (val === '') {\r\n      node.addClass('has-error');\r\n      return;\r\n    }\r\n    var isQuery = node.hasClass('qSearchItemQuery') || node.parent().hasClass('qSearchItemQuery');\r\n    if (isQuery && val.indexOf('%s') < 0) {\r\n      node.addClass('has-error');\r\n    } else {\r\n      node.removeClass('has-error');\r\n    }\r\n  },\r\n\r\n  setupQuickSearchUiHandlers: function() {\r\n    var self = this;\r\n    $('#ext_quickSearchList li input').on('input', function(e) {\r\n      var node = $(this);\r\n      if (node.parent().is('li')) {\r\n        // is at the add new node, check if other node is also empty\r\n        var inputs = node.parent().find('input');\r\n        for (var i = 0; i < inputs.length; ++i) {\r\n          node = $(inputs[i]);\r\n          self.validateQuickSearchInput(node);\r\n        }\r\n      } else {\r\n        self.validateQuickSearchInput(node);\r\n      }\r\n    });\r\n\r\n    $('#ext_quickSearchList li button').click(function(e) {\r\n      if ($(this).attr('data') == 'add') {\r\n        var parent = $(this.parentNode);\r\n        var nameNode = parent.find('input.qSearchItemName');\r\n        var queryNode = parent.find('input.qSearchItemQuery');\r\n        var nameVal = nameNode.val();\r\n        var queryVal = queryNode.val();\r\n        // validate input\r\n        if (nameNode.hasClass('has-error') || queryNode.hasClass('has-error') ||\r\n            nameVal === '' || queryVal === '') {\r\n          return;\r\n        }\r\n\r\n        // add\r\n        self.quickSearches.push({ name: nameVal, url: queryVal });\r\n        self.setupQuickSearchUiList();\r\n        self.setupQuickSearchUiHandlers();\r\n      } else {\r\n        // update quickSearches then remove\r\n        var ind = $('#ext_quickSearchList li').index(this.parentNode);\r\n        if (ind > -1) {\r\n          self.quickSearches.splice(ind, 1);\r\n        }\r\n        $(this).parent().remove();\r\n      }\r\n    });\r\n\r\n    $('#ext_quickSearchList li div').click(function(e) {\r\n      $(this).parent().addClass('editMode');\r\n      var inputToSelect = $(this).find('input');\r\n      inputToSelect[0].select();\r\n    }).focusout(function(e) {\r\n      if (e.relatedTarget && e.relatedTarget.parentNode && \r\n          this.parentNode == e.relatedTarget.parentNode.parentNode) {\r\n        return;\r\n      }\r\n\r\n      var parent = $(this).parent();\r\n      if (parent.find('.has-error').length) {\r\n        return;\r\n      }\r\n\r\n      if ($(this).is('input') && parent.is('li')) {\r\n        // focus out from add new\r\n      } else {\r\n        parent.removeClass('editMode');\r\n        // update on span\r\n        var nameVal = parent.find('.qSearchItemName input').val();\r\n        var queryVal = parent.find('.qSearchItemQuery input').val();\r\n        parent.find('.qSearchItemName span').text(nameVal);\r\n        parent.find('.qSearchItemQuery span').text(queryVal);\r\n\r\n        // save this now\r\n        var ind = $('#ext_quickSearchList li').index(this.parentNode);\r\n        if (ind > -1) {\r\n          self.quickSearches[ind] = { name: nameVal, url: queryVal };\r\n          // update the context menu as well\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  setupExtensionsPage: function() {\r\n    this.setupQuickSearchUiList();\r\n    this.setupQuickSearchUiHandlers();\r\n  },\r\n\r\n  setupAboutPage: function() {\r\n    ReactDOM.render(<AboutPane />, $('#tabContentAbout').get(0));\r\n  },\r\n\r\n  refreshBlacklistOnUi: function() {\r\n    var listNode = $('#opt_blacklistedUsers');\r\n    var listStr = Object.keys(this.blacklistedUserIds).join('\\n');\r\n    listNode.val(listStr);\r\n  },\r\n\r\n  readBlacklistValues: function() {\r\n    var listNode = $('#opt_blacklistedUsers');\r\n    var listStr = listNode.val();\r\n    var blacklistArray = listStr.split('\\n');\r\n\r\n    this.blacklistedUserIds = {};\r\n\r\n    for (var i in blacklistArray) {\r\n      var b = blacklistArray[i];\r\n      if (!b) continue;\r\n      this.blacklistedUserIds[b.replace(' ','').toLowerCase()] = true;\r\n    }\r\n    this.setBlacklistValue();\r\n    this.app.view.redraw(true);\r\n  },\r\n\r\n  saveAndDoneWithIt: function() {\r\n    var self = this;\r\n    var data = {\r\n      values: self.values,\r\n      logins: {'u':self.logins[0], 'p':self.logins[1]}\r\n    };\r\n    this.setStorage(data);\r\n    this.updateToApp();\r\n    this.app.modalShown = false;\r\n    this.app.setInputAreaFocus();\r\n  },\r\n\r\n  readValueFromUi: function() {\r\n    this.readBlacklistValues();\r\n    var selectedVal;\r\n    for (var i in this.values) {\r\n      if (i === 'blacklistedUserIds') {\r\n        continue;\r\n      }\r\n      if (i === 'quickSearchList') {\r\n        this.values[i] = JSON.stringify(this.quickSearches);\r\n        continue;\r\n      }\r\n\r\n      if (i === 'deleteDupLogin') {\r\n        var yesNode = $('#opt_deleteDupLoginYes');\r\n        this.values[i] = yesNode.prop('checked');\r\n        continue;\r\n      }\r\n\r\n      if (i === 'mouseBrowsingHighlightColor') {\r\n        selectedVal = $('#opt_'+i+' select').val();\r\n        this.values[i] = parseInt(selectedVal);\r\n        continue;\r\n      }\r\n\r\n      if (i in PREF_OPTIONS) {\r\n        selectedVal = $('#opt_'+i+' select').val();\r\n        this.values[i] = parseInt(selectedVal);\r\n        continue;\r\n      }\r\n\r\n      var elem = $('#opt_'+i+' input');\r\n      var type = typeof(this.values[i]);\r\n      switch(type) {\r\n        case 'number':\r\n          this.values[i] = parseInt(elem.val());\r\n          break;\r\n        case 'string':\r\n          this.values[i] = elem.val();\r\n          break;\r\n        case 'boolean':\r\n          this.values[i] = elem.prop('checked');\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    var user = $('#login_username input').val();\r\n    var pswd = $('#login_password input').val();\r\n    if (user === '') {\r\n      pswd = '';\r\n    }\r\n    this.logins = [user, pswd];\r\n  },\r\n\r\n  loadDefault: function(callback) {\r\n    this.values = JSON.parse(JSON.stringify(DEFAULT_PREFS));\r\n    this.logins = {'u':'', 'p':''};\r\n    this.updateToApp();\r\n    this.populateSettingsToUi();\r\n    callback();\r\n  },\r\n\r\n  updateToApp: function() {\r\n    for (var i in this.values) {\r\n      this.app.onPrefChange(this, i);\r\n    }\r\n    if (this.logins[0]) {\r\n      this.app.conn.loginStr[1] = this.logins[0];\r\n    }\r\n    if (this.logins[1]) {\r\n      this.app.conn.loginStr[2] = this.logins[1];\r\n    }\r\n  },\r\n\r\n  resetSettings: function() {\r\n    this.clearStorage();\r\n    this.getStorage();\r\n  },\r\n\r\n  get: function(prefName) {\r\n    console.log(prefName + \" = \" + this.values[prefName]);\r\n    return this.values[prefName];\r\n  },\r\n\r\n  set: function(prefName, value) {\r\n    this.values[prefName] = value;\r\n  },\r\n\r\n  onStorageDone: function(msg) {\r\n    if (msg.data && msg.data.values) {\r\n      // iterate through default prefs to make sure all up to date\r\n      for (var i in DEFAULT_PREFS) {\r\n        if (!(i in msg.data.values) || msg.data.values[i] === null) {\r\n          this.values[i] = DEFAULT_PREFS[i];\r\n          if (i === 'quickSearchList') {\r\n            this.quickSearches = JSON.parse(this.values[i]);\r\n          }\r\n        } else {\r\n          if (i === 'blacklistedUserIds') {\r\n            this.blacklistedUserIds = JSON.parse(msg.data.values[i]);\r\n          } else if (i === 'quickSearchList') {\r\n            var val = msg.data.values[i];\r\n            this.quickSearches = JSON.parse(val);\r\n            this.values[i] = val;\r\n          } else {\r\n            this.values[i] = msg.data.values[i];\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (msg.data && msg.data.logins) {\r\n      var data = msg.data.logins;\r\n      this.logins = [data.u, data.p];\r\n    }\r\n    this.updateToApp();\r\n    this.populateSettingsToUi();\r\n    if (!this.initCallbackCalled) {\r\n      if (this.values !== null && this.logins !== null) {\r\n        this.initCallbackCalled = true;\r\n        this.onInitializedCallback(this.app);\r\n      }\r\n    }\r\n  },\r\n\r\n  getStorage: function(key) {\r\n    console.log(\"getStorage not implemented, returning defaults.\");\r\n    var defaults = {\r\n      values: DEFAULT_PREFS,\r\n      logins: {'u':'', 'p':''}\r\n    };\r\n    this.onStorageDone({ data: defaults });\r\n  },\r\n\r\n  setBlacklistValue: function() {\r\n    var blacklist = JSON.stringify(this.blacklistedUserIds);\r\n    this.values.blacklistedUserIds = blacklist;\r\n  },\r\n\r\n  setBlacklistStorage: function() {\r\n    var items = { \r\n      values: {\r\n        blacklistedUserIds: this.values.blacklistedUserIds\r\n      }\r\n    };\r\n    console.log(\"setBlacklistStorage not implemented, items: \" + items);\r\n  },\r\n\r\n  setStorage: function(items) {\r\n    console.log(\"setStorage not implemented, items: \" + items);\r\n  },\r\n\r\n  clearStorage: function() {\r\n    console.log(\"clearStorage not implemented\");\r\n  }\r\n\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./js/pref.js","import { i18n } from './i18n';\n\nexport class AboutPane extends React.Component {\n  render() {\n    const link = (text, url) =>\n      '<a href=\"' + url + '\" target=\"_blank\" rel=\"noreferrer\">' + text + '</a>';\n    const replacements = {\n      '#link_github_iamchucky#': link('Chuck Yang', 'https://github.com/iamchucky'),\n      '#link_github_robertabcd#': link('robertabcd', 'https://github.com/robertabcd'),\n      '#link_robertabcd_PttChrome#': link('robertabcd/PttChrome', 'https://github.com/robertabcd/PttChrome'),\n      '#link_iamchucky_PttChrome#': link('iamchucky/PttChrome', 'https://github.com/iamchucky/PttChrome'),\n      '#link_GPL20#': link('General Public License v2.0', 'https://www.gnu.org/licenses/old-licenses/gpl-2.0.html')\n    };\n    const replaced_i18n = (id) => {\n      let text = i18n(id);\n      for (let key in replacements) {\n        text = text.replace(key, replacements[key]);\n      }\n      return <span dangerouslySetInnerHTML={{__html: text}} />;\n    };\n    let aboutNewList = i18n('about_new_content').map((text, index) => (\n      <li key={\"i\" + index}>{text}</li>\n    ));\n    return (\n      <div>\n        <div className=\"list-group\">\n          <h4 className=\"list-group-item-heading\">\n            PttChrome<small> - {i18n('about_appName_subtitle')}</small>\n          </h4>\n          <div id=\"about_description\">\n            <p>{replaced_i18n('about_description')}</p>\n          </div>\n        </div>\n        <div className=\"list-group\">\n          <h4 className=\"list-group-item-heading\">\n            {i18n('about_version_title')}\n          </h4>\n          <div className=\"list-group-item-text\">\n            <ul>\n              <li>{replaced_i18n('about_version_current')}</li>\n              <li>{replaced_i18n('about_version_original')}</li>\n            </ul>\n          </div>\n        </div>\n        <div className=\"list-group\">\n          <h4 className=\"list-group-item-heading\">\n            {i18n('about_new_title')}\n          </h4>\n          <div className=\"list-group-item-text\">\n            <ul>{aboutNewList}</ul>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./js/pref_about.jsx","export function TouchController(app) {\n  this.app = app;\n  this.highlightCopy = false;\n  this.touchStarted = false;\n  this.touchedCenter = { x: 0, y: 0 };\n\n  // make sure the text selection still works\n  delete Hammer.defaults.cssProps.userSelect;\n\n  this.ham = null;\n  this.setupHandlers();\n};\n\nTouchController.prototype.setupHandlers = function() {\n  var self = this;\n  var app = this.app;\n\n  document.body.ontouchmove = function(e) { \n    if (e.touches.length != 1) return false;\n    return true;\n  };\n\n  document.body.ontouchstart = function(e) {\n    self.touchStarted = true;\n    app.inputArea.blur();\n    console.log('touchstart');\n  };\n\n  document.body.ontouchend = function(e) {\n    if (app.buf.pageState == 2 && app.buf.highlightCursor &&\n        app.buf.nowHighlight != -1) {\n      app.onMouse_click(self.touchedCenter.x, self.touchedCenter.y);\n      app.buf.nowHighlight = -1;\n      app.buf.highlightCursor = self.highlightCopy;\n      app.BBSWin.style.cursor = 'auto';\n      self.touchStarted = false;\n      app.inputArea.focus();\n    }\n    console.log('touchend');\n  };\n\n  this.ham = new Hammer(app.BBSWin);\n  this.ham.on('pan', function(ev) {\n    if (ev.pointerType == 'touch') {\n      //console.log(ev);\n      if (app.buf.pageState == 2) {\n        ev.preventDefault();\n        ev.srcEvent.preventDefault();\n\n        self.highlightCopy = app.buf.highlightCursor;\n        app.buf.highlightCursor = true;\n        app.onMouse_move(ev.center.x, ev.center.y);\n        self.touchedCenter.x = ev.center.x;\n        self.touchedCenter.y = ev.center.y;\n      }\n    }\n  });\n\n  this.ham.on('tap', function(ev) {\n    //console.log(ev);\n    ev.preventDefault();\n    ev.srcEvent.stopPropagation();\n    ev.srcEvent.preventDefault();\n    if (ev.pointerType != 'touch')  return; \n    self.highlightCopy = app.buf.highlightCursor;\n    app.buf.highlightCursor = false;\n    app.onMouse_move(ev.center.x, ev.center.y);\n    app.onMouse_click(ev.center.x, ev.center.y);\n    app.buf.nowHighlight = -1;\n    app.buf.highlightCursor = self.highlightCopy;\n    app.BBSWin.style.cursor = 'auto';\n    self.touchStarted = false;\n    app.inputArea.focus();\n    console.log('touchtap');\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./js/touch_controller.js"],"sourceRoot":""}